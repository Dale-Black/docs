<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.33" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.33</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.33">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.071293605024728</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.071293605024728</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-2.260447635152036, 0.12788279676966086, -0.47015180552222]), MALAState{Vector{Float64}}([-2.260447635152036, 0.12788279676966086, -0.47015180552222]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.15212   -5.12201  -4.41396  -5.52277   …  -6.29521   -4.12206   -4.12206
 -0.226839   2.31817   1.26109  -0.813906     -0.490627  -0.617504  -0.617504
  3.08044    3.96603   4.8939    3.74847       4.47803    3.50072    3.50072</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99186    1.0081
 -0.0332599  0.993589
  5.0102     0.98872</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip520">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip520)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip521">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip520)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip522">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip520)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1542.33 2640.76,1542.33 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1228.43 2640.76,1228.43 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,914.533 2640.76,914.533 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,600.635 2640.76,600.635 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,286.737 2640.76,286.737 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1542.33 170.644,1542.33 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1228.43 170.644,1228.43 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,914.533 170.644,914.533 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,600.635 170.644,600.635 "></polyline>
<polyline clip-path="url(#clip520)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,286.737 170.644,286.737 "></polyline>
<path clip-path="url(#clip520)" d="M49.5521 1542.78 L79.2279 1542.78 L79.2279 1546.72 L49.5521 1546.72 L49.5521 1542.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M99.8991 1540.47 Q96.7509 1540.47 94.8991 1542.62 Q93.0704 1544.77 93.0704 1548.52 Q93.0704 1552.25 94.8991 1554.42 Q96.7509 1556.58 99.8991 1556.58 Q103.047 1556.58 104.876 1554.42 Q106.728 1552.25 106.728 1548.52 Q106.728 1544.77 104.876 1542.62 Q103.047 1540.47 99.8991 1540.47 M109.181 1525.81 L109.181 1530.07 Q107.422 1529.24 105.617 1528.8 Q103.834 1528.36 102.075 1528.36 Q97.4454 1528.36 94.9917 1531.48 Q92.5612 1534.61 92.2139 1540.93 Q93.5797 1538.91 95.6398 1537.85 Q97.7 1536.76 100.177 1536.76 Q105.385 1536.76 108.394 1539.93 Q111.427 1543.08 111.427 1548.52 Q111.427 1553.84 108.279 1557.06 Q105.131 1560.28 99.8991 1560.28 Q93.9037 1560.28 90.7325 1555.7 Q87.5612 1551.09 87.5612 1542.36 Q87.5612 1534.17 91.45 1529.31 Q95.3389 1524.42 101.89 1524.42 Q103.649 1524.42 105.431 1524.77 Q107.237 1525.12 109.181 1525.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M50.3623 1228.88 L80.0381 1228.88 L80.0381 1232.82 L50.3623 1232.82 L50.3623 1228.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M104.297 1227.08 Q107.654 1227.79 109.529 1230.06 Q111.427 1232.33 111.427 1235.66 Q111.427 1240.78 107.908 1243.58 Q104.39 1246.38 97.9083 1246.38 Q95.7324 1246.38 93.4176 1245.94 Q91.126 1245.53 88.6723 1244.67 L88.6723 1240.16 Q90.6167 1241.29 92.9315 1241.87 Q95.2463 1242.45 97.7695 1242.45 Q102.168 1242.45 104.459 1240.71 Q106.774 1238.97 106.774 1235.66 Q106.774 1232.61 104.621 1230.9 Q102.492 1229.16 98.6722 1229.16 L94.6445 1229.16 L94.6445 1225.32 L98.8574 1225.32 Q102.306 1225.32 104.135 1223.95 Q105.964 1222.56 105.964 1219.97 Q105.964 1217.31 104.066 1215.9 Q102.191 1214.46 98.6722 1214.46 Q96.7509 1214.46 94.5519 1214.88 Q92.3528 1215.29 89.7139 1216.17 L89.7139 1212.01 Q92.376 1211.27 94.6908 1210.9 Q97.0287 1210.53 99.0889 1210.53 Q104.413 1210.53 107.515 1212.96 Q110.617 1215.36 110.617 1219.48 Q110.617 1222.35 108.973 1224.35 Q107.33 1226.31 104.297 1227.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M99.4824 900.331 Q95.8713 900.331 94.0426 903.896 Q92.2371 907.438 92.2371 914.567 Q92.2371 921.674 94.0426 925.239 Q95.8713 928.78 99.4824 928.78 Q103.117 928.78 104.922 925.239 Q106.751 921.674 106.751 914.567 Q106.751 907.438 104.922 903.896 Q103.117 900.331 99.4824 900.331 M99.4824 896.628 Q105.293 896.628 108.348 901.234 Q111.427 905.818 111.427 914.567 Q111.427 923.294 108.348 927.901 Q105.293 932.484 99.4824 932.484 Q93.6723 932.484 90.5936 927.901 Q87.538 923.294 87.538 914.567 Q87.538 905.818 90.5936 901.234 Q93.6723 896.628 99.4824 896.628 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M104.297 599.281 Q107.654 599.998 109.529 602.267 Q111.427 604.535 111.427 607.869 Q111.427 612.984 107.908 615.785 Q104.39 618.586 97.9083 618.586 Q95.7324 618.586 93.4176 618.146 Q91.126 617.73 88.6723 616.873 L88.6723 612.359 Q90.6167 613.494 92.9315 614.072 Q95.2463 614.651 97.7695 614.651 Q102.168 614.651 104.459 612.915 Q106.774 611.179 106.774 607.869 Q106.774 604.813 104.621 603.1 Q102.492 601.364 98.6722 601.364 L94.6445 601.364 L94.6445 597.521 L98.8574 597.521 Q102.306 597.521 104.135 596.156 Q105.964 594.767 105.964 592.174 Q105.964 589.512 104.066 588.1 Q102.191 586.665 98.6722 586.665 Q96.7509 586.665 94.5519 587.082 Q92.3528 587.498 89.7139 588.378 L89.7139 584.211 Q92.376 583.471 94.6908 583.1 Q97.0287 582.73 99.0889 582.73 Q104.413 582.73 107.515 585.16 Q110.617 587.568 110.617 591.688 Q110.617 594.558 108.973 596.549 Q107.33 598.517 104.297 599.281 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip520)" d="M99.8991 284.873 Q96.7509 284.873 94.8991 287.026 Q93.0704 289.179 93.0704 292.929 Q93.0704 296.656 94.8991 298.832 Q96.7509 300.984 99.8991 300.984 Q103.047 300.984 104.876 298.832 Q106.728 296.656 106.728 292.929 Q106.728 289.179 104.876 287.026 Q103.047 284.873 99.8991 284.873 M109.181 270.221 L109.181 274.48 Q107.422 273.647 105.617 273.207 Q103.834 272.767 102.075 272.767 Q97.4454 272.767 94.9917 275.892 Q92.5612 279.017 92.2139 285.336 Q93.5797 283.322 95.6398 282.258 Q97.7 281.17 100.177 281.17 Q105.385 281.17 108.394 284.341 Q111.427 287.489 111.427 292.929 Q111.427 298.253 108.279 301.471 Q105.131 304.688 99.8991 304.688 Q93.9037 304.688 90.7325 300.105 Q87.5612 295.498 87.5612 286.772 Q87.5612 278.577 91.45 273.716 Q95.3389 268.832 101.89 268.832 Q103.649 268.832 105.431 269.179 Q107.237 269.526 109.181 270.221 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip522)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1244.35 224.541,1562.76 226.891,1292.7 229.242,1365.01 231.592,1324.34 233.943,1516.98 236.293,1237.21 238.644,1469.07 240.994,1373.41 243.345,1327.6 245.695,1416.58 248.046,1441.26 250.396,1438.23 252.747,1468.26 255.097,1561.73 257.448,1441.66 259.798,1571.43 262.148,1515.48 264.499,1427.44 266.849,1389.72 269.2,1456.95 271.55,1278.29 273.901,1458.93 276.251,1400.96 278.602,1524.3 280.952,1414.3 283.303,1402.57 285.653,1381.24 288.004,1390.82 290.354,1446.96 292.705,1337.5 295.055,1367.06 297.406,1522.55 299.756,1477.64 302.107,1606.26 304.457,1495.35 306.807,1438.2 309.158,1631.41 311.508,1444.08 313.859,1444.49 316.209,1354.11 318.56,1372.99 320.91,1462.01 323.261,1345.63 325.611,1402.59 327.962,1656.32 330.312,1485.81 332.663,1454.59 335.013,1660.29 337.364,1382.33 339.714,1374.42 342.065,1318.67 344.415,1477.81 346.765,1542.5 349.116,1421.07 351.466,1314.71 353.817,1552.25 356.167,1274.72 358.518,1494.27 360.868,1447.01 363.219,1245.6 365.569,1357.41 367.92,1341.79 370.27,1457.88 372.621,1427.49 374.971,1514.06 377.322,1438.01 379.672,1484.93 382.023,1509.56 384.373,1285.77 386.724,1495.31 389.074,1554.87 391.424,1480.2 393.775,1437.11 396.125,1512.9 398.476,1455.7 400.826,1395.66 403.177,1732.13 405.527,1397.15 407.878,1255.25 410.228,1420.27 412.579,1419.25 414.929,1309.35 417.28,1544.2 419.63,1390.83 421.981,1357.54 424.331,1197.6 426.682,1313.29 429.032,1313.87 431.382,1630.13 433.733,1438.92 436.083,1277.8 438.434,1462.27 440.784,1487.71 443.135,1407.19 445.485,1604.04 447.836,1410.06 450.186,1424.52 452.537,1684.27 454.887,1615.92 457.238,1461.77 459.588,1652.14 461.939,1329.84 464.289,1394.72 466.64,1558.46 468.99,1401.73 471.341,1448.76 473.691,1523.87 476.041,1443.6 478.392,1460.13 480.742,1522.9 483.093,1417.51 485.443,1432 487.794,1455.44 490.144,1253 492.495,1516.12 494.845,1483.74 497.196,1466.57 499.546,1457.91 501.897,1329.53 504.247,1493.21 506.598,1277.14 508.948,1699.72 511.299,1481.84 513.649,1286.52 515.999,1457.87 518.35,1296.75 520.7,1420.84 523.051,1400.75 525.401,1534.33 527.752,1361.12 530.102,1332.67 532.453,1336.44 534.803,1324.23 537.154,1473.97 539.504,1541.12 541.855,1546.77 544.205,1454.35 546.556,1451.23 548.906,1648.74 551.257,1431.52 553.607,1344.83 555.958,1258.87 558.308,1466.44 560.658,1539.13 563.009,1247.27 565.359,1306.25 567.71,1445.32 570.06,1588.07 572.411,1443.79 574.761,1270.39 577.112,1535.87 579.462,1371.7 581.813,1297.49 584.163,1246.34 586.514,1374.61 588.864,1624.14 591.215,1453.76 593.565,1501.77 595.916,1520.95 598.266,1455.09 600.616,1314.51 602.967,1237.97 605.317,1512.56 607.668,1573.51 610.018,1513.02 612.369,1526.9 614.719,1679.96 617.07,1504.19 619.42,1467.17 621.771,1579.53 624.121,1403.88 626.472,1478.85 628.822,1362.8 631.173,1722.22 633.523,1423.84 635.874,1598.39 638.224,1355.53 640.575,1341.84 642.925,1529.08 645.275,1512.02 647.626,1467.93 649.976,1535.6 652.327,1377.33 654.677,1557.19 657.028,1438.76 659.378,1629.99 661.729,1609.58 664.079,1143.12 666.43,1333.91 668.78,1579.04 671.131,1594.78 673.481,1255.54 675.832,1390.83 678.182,1530.61 680.533,1618.36 682.883,1494.31 685.233,1638.33 687.584,1465.15 689.934,1537.92 692.285,1426.09 694.635,1510.8 696.986,1634.12 699.336,1449.14 701.687,1447.67 704.037,1429.75 706.388,1490.69 708.738,1465.15 711.089,1390.51 713.439,1442.53 715.79,1459.72 718.14,1433.45 720.491,1387.7 722.841,1492.59 725.192,1591.11 727.542,1395.29 729.892,1372.38 732.243,1727.45 734.593,1470.8 736.944,1436.43 739.294,1293.87 741.645,1394.62 743.995,1465.22 746.346,1497.94 748.696,1728.92 751.047,1279.31 753.397,1530.96 755.748,1414.78 758.098,1514.02 760.449,1536.72 762.799,1495.97 765.15,1490.33 767.5,1527.59 769.85,1343.52 772.201,1510.49 774.551,1326.14 776.902,1465.45 779.252,1398.81 781.603,1300.95 783.953,1511.24 786.304,1491.16 788.654,1598 791.005,1457.68 793.355,1385.49 795.706,1282.48 798.056,1565.17 800.407,1387.47 802.757,1576.01 805.108,1507.29 807.458,1598.5 809.809,1505.41 812.159,1554.37 814.509,1614.47 816.86,1347.7 819.21,1371.12 821.561,1541.27 823.911,1402.95 826.262,1182.3 828.612,1326.8 830.963,1302.37 833.313,1613.24 835.664,1535.36 838.014,1538.18 840.365,1404.28 842.715,1258.93 845.066,1641.65 847.416,1587.66 849.767,1486.42 852.117,1529.48 854.467,1608.77 856.818,1428.16 859.168,1532.63 861.519,1165.96 863.869,1519.66 866.22,1497.09 868.57,1594.02 870.921,1421.14 873.271,1465.67 875.622,1388.86 877.972,1426.61 880.323,1304.93 882.673,1391.47 885.024,1550.32 887.374,1521.78 889.725,1232.4 892.075,1475.31 894.426,1579.84 896.776,1311.32 899.126,1566.13 901.477,1384.43 903.827,1493.29 906.178,1378.13 908.528,1407.57 910.879,1224.65 913.229,1425.66 915.58,1328.3 917.93,1423.58 920.281,1428.77 922.631,1287.69 924.982,1406.96 927.332,1452.89 929.683,1516.74 932.033,1451.88 934.384,1286.5 936.734,1296.42 939.084,1374.8 941.435,1333.74 943.785,1442.85 946.136,1629.65 948.486,1353.07 950.837,1463.01 953.187,1430.04 955.538,1385.1 957.888,1418.33 960.239,1505.15 962.589,1442.2 964.94,1544.62 967.29,1392.11 969.641,1599.55 971.991,1437.45 974.342,1387.93 976.692,1549.92 979.043,1651.23 981.393,1418.64 983.743,1445.06 986.094,1410.15 988.444,1630.34 990.795,1466.24 993.145,1441.66 995.496,1414.45 997.846,1578.24 1000.2,1557.95 1002.55,1333.79 1004.9,1338.34 1007.25,1650.87 1009.6,1191.07 1011.95,1481.68 1014.3,1513.1 1016.65,1595.48 1019,1298.56 1021.35,1601.83 1023.7,1442.17 1026.05,1463.89 1028.4,1316.98 1030.75,1282.32 1033.1,1380.31 1035.45,1392.4 1037.8,1544.77 1040.15,1458.37 1042.51,1350.45 1044.86,1614.65 1047.21,1361.54 1049.56,1470.25 1051.91,1570.41 1054.26,1456.78 1056.61,1279.6 1058.96,1177.73 1061.31,1417 1063.66,1396.64 1066.01,1386.8 1068.36,1478.73 1070.71,1340.54 1073.06,1636.17 1075.41,1340.73 1077.76,1572.33 1080.11,1357.43 1082.46,1438.2 1084.81,1545.35 1087.16,1347.39 1089.51,1506.25 1091.87,1459.16 1094.22,1371.63 1096.57,1274.55 1098.92,1324.39 1101.27,1439.61 1103.62,1314.79 1105.97,1399.47 1108.32,1576.35 1110.67,1471.26 1113.02,1587.42 1115.37,1395.72 1117.72,1352.49 1120.07,1439.14 1122.42,1480.41 1124.77,1364.26 1127.12,1503.81 1129.47,1447.23 1131.82,1416.99 1134.17,1565.12 1136.52,1527.13 1138.87,1486.64 1141.23,1378.68 1143.58,1622.08 1145.93,1322.05 1148.28,1462.5 1150.63,1312.93 1152.98,1526.16 1155.33,1542.14 1157.68,1492.42 1160.03,1548.15 1162.38,1388.48 1164.73,1533.87 1167.08,1361.33 1169.43,1413.3 1171.78,1318.9 1174.13,1350.04 1176.48,1575.4 1178.83,1568.26 1181.18,1483.37 1183.53,1270.57 1185.88,1653.94 1188.23,1468.9 1190.59,1307.88 1192.94,1475.6 1195.29,1411.2 1197.64,1374.57 1199.99,1588.67 1202.34,1635.28 1204.69,1502.5 1207.04,1465.47 1209.39,1526.57 1211.74,1613.17 1214.09,1515.15 1216.44,1508.35 1218.79,1509.38 1221.14,1324.79 1223.49,1576.68 1225.84,1567.81 1228.19,1455.97 1230.54,1498.09 1232.89,1484.13 1235.24,1506.42 1237.59,1532.07 1239.94,1585.47 1242.3,1364.4 1244.65,1456.47 1247,1565.02 1249.35,1229.65 1251.7,1361.39 1254.05,1443.69 1256.4,1434.72 1258.75,1558.74 1261.1,1682.18 1263.45,1360.94 1265.8,1467.78 1268.15,1434.25 1270.5,1602.1 1272.85,1555.24 1275.2,1486.9 1277.55,1557.01 1279.9,1390.82 1282.25,1386.46 1284.6,1372.09 1286.95,1500.94 1289.3,1580.74 1291.66,1581.88 1294.01,1421.8 1296.36,1372.56 1298.71,1255.02 1301.06,1436.24 1303.41,1304.5 1305.76,1463.65 1308.11,1553.98 1310.46,1670.03 1312.81,1295.88 1315.16,1316.2 1317.51,1355.15 1319.86,1459.15 1322.21,1512.03 1324.56,1514.46 1326.91,1546.19 1329.26,1538.26 1331.61,1496.55 1333.96,1438.71 1336.31,1409.74 1338.66,1497.54 1341.02,1505.69 1343.37,1363.88 1345.72,1438.45 1348.07,1666.68 1350.42,1415.68 1352.77,1531.09 1355.12,1406.03 1357.47,1270.89 1359.82,1337.22 1362.17,1382.61 1364.52,1295.49 1366.87,1289.94 1369.22,1261.22 1371.57,1361.25 1373.92,1462.46 1376.27,1461.68 1378.62,1276.27 1380.97,1475.98 1383.32,1377.7 1385.67,1359.54 1388.02,1543.73 1390.38,1426.82 1392.73,1288.79 1395.08,1406.86 1397.43,1106.54 1399.78,1293.18 1402.13,1537.79 1404.48,1490.32 1406.83,1429.87 1409.18,1438.83 1411.53,1230.8 1413.88,1347.47 1416.23,1450.77 1418.58,1296.2 1420.93,1434.53 1423.28,1328.91 1425.63,1376.58 1427.98,1483.38 1430.33,1296.28 1432.68,1361.65 1435.03,1335.17 1437.38,1356.25 1439.74,1396.55 1442.09,1519.53 1444.44,1509.95 1446.79,1437.89 1449.14,1352.22 1451.49,1549.77 1453.84,1537.4 1456.19,1537.5 1458.54,1429.25 1460.89,1278.22 1463.24,1473.11 1465.59,1479.99 1467.94,1449.77 1470.29,1636.91 1472.64,1285.6 1474.99,1435.22 1477.34,1585.17 1479.69,1561.03 1482.04,1322.37 1484.39,1655 1486.74,1528.97 1489.1,1190.47 1491.45,1565.72 1493.8,1378.05 1496.15,1392.44 1498.5,1508.07 1500.85,1344.66 1503.2,1260.75 1505.55,1501.85 1507.9,1379.01 1510.25,1582.18 1512.6,1453.21 1514.95,1580.34 1517.3,1673.72 1519.65,1468.08 1522,1462.41 1524.35,1288.19 1526.7,1465.5 1529.05,1362.71 1531.4,1470.32 1533.75,1465.5 1536.1,1463.74 1538.45,1453.72 1540.81,1343.26 1543.16,1534.11 1545.51,1547.56 1547.86,1371.43 1550.21,1439.3 1552.56,1540.53 1554.91,1615.37 1557.26,1417.52 1559.61,1344.28 1561.96,1521.62 1564.31,1381.35 1566.66,1439.5 1569.01,1355.23 1571.36,1374.15 1573.71,1330.41 1576.06,1510.44 1578.41,1480.64 1580.76,1314.32 1583.11,1443.31 1585.46,1727.48 1587.81,1565.83 1590.17,1363.77 1592.52,1472.66 1594.87,1479.05 1597.22,1275.13 1599.57,1382.49 1601.92,1455.86 1604.27,1539.31 1606.62,1457.93 1608.97,1260.38 1611.32,1605.28 1613.67,1369.95 1616.02,1425.77 1618.37,1488.41 1620.72,1153.06 1623.07,1325.51 1625.42,1518.47 1627.77,1280.55 1630.12,1370.48 1632.47,1460.11 1634.82,1582.9 1637.17,1438.11 1639.53,1427.58 1641.88,1394.68 1644.23,1288.49 1646.58,1419.16 1648.93,1591.67 1651.28,1386.57 1653.63,1296.08 1655.98,1440.81 1658.33,1315.09 1660.68,1732.96 1663.03,1469.82 1665.38,1548.55 1667.73,1486.66 1670.08,1639.22 1672.43,1304.22 1674.78,1464.32 1677.13,1547.45 1679.48,1337.77 1681.83,1475.68 1684.18,1614.91 1686.53,1337.15 1688.89,1378.72 1691.24,1501.63 1693.59,1572.5 1695.94,1568.73 1698.29,1410.57 1700.64,1472.81 1702.99,1561.37 1705.34,1420.54 1707.69,1467.84 1710.04,1533.31 1712.39,1573.88 1714.74,1444.79 1717.09,1390.56 1719.44,1433.29 1721.79,1471.21 1724.14,1301.98 1726.49,1563.17 1728.84,1522.83 1731.19,1364.62 1733.54,1273.86 1735.89,1428.6 1738.25,1336.29 1740.6,1381.63 1742.95,1502.15 1745.3,1290.81 1747.65,1469.99 1750,1574.34 1752.35,1365.51 1754.7,1539.72 1757.05,1420.95 1759.4,1400.7 1761.75,1410.74 1764.1,1367.86 1766.45,1247.57 1768.8,1455.65 1771.15,1324.99 1773.5,1259.77 1775.85,1469.73 1778.2,1587.28 1780.55,1394.42 1782.9,1593.99 1785.25,1407.97 1787.6,1451.18 1789.96,1349.92 1792.31,1494.86 1794.66,1459.73 1797.01,1325.78 1799.36,1333.21 1801.71,1405.46 1804.06,1406.75 1806.41,1453.84 1808.76,1503.26 1811.11,1435.15 1813.46,1443.26 1815.81,1307.94 1818.16,1367.63 1820.51,1344.56 1822.86,1401.47 1825.21,1383.81 1827.56,1443.64 1829.91,1469.53 1832.26,1376.67 1834.61,1379.44 1836.96,1302.32 1839.32,1414.89 1841.67,1282.9 1844.02,1470.67 1846.37,1441.09 1848.72,1464.13 1851.07,1561.25 1853.42,1360.68 1855.77,1503.28 1858.12,1446.83 1860.47,1563.95 1862.82,1265.62 1865.17,1469.74 1867.52,1414.9 1869.87,1341.52 1872.22,1431.69 1874.57,1604.81 1876.92,1518.22 1879.27,1493.63 1881.62,1482.79 1883.97,1333.06 1886.32,1331.37 1888.68,1523.47 1891.03,1466.01 1893.38,1378.66 1895.73,1297.29 1898.08,1563.69 1900.43,1444.39 1902.78,1506.92 1905.13,1447.71 1907.48,1450.73 1909.83,1514.03 1912.18,1573.17 1914.53,1379 1916.88,1467.66 1919.23,1638.7 1921.58,1469.24 1923.93,1517.52 1926.28,1290.72 1928.63,1531.56 1930.98,1400.33 1933.33,1520.71 1935.68,1334.86 1938.04,1433.73 1940.39,1510.75 1942.74,1459.63 1945.09,1299.69 1947.44,1433.63 1949.79,1582.53 1952.14,1505.04 1954.49,1499.54 1956.84,1420.05 1959.19,1402.05 1961.54,1356.17 1963.89,1508.75 1966.24,1297.61 1968.59,1446.68 1970.94,1423.22 1973.29,1443.08 1975.64,1510.59 1977.99,1422.31 1980.34,1572.27 1982.69,1315.86 1985.04,1230.98 1987.4,1580.35 1989.75,1578.47 1992.1,1502.07 1994.45,1416.53 1996.8,1543.41 1999.15,1366.02 2001.5,1332.92 2003.85,1420.28 2006.2,1327 2008.55,1523.83 2010.9,1320.51 2013.25,1233.11 2015.6,1395.81 2017.95,1435.11 2020.3,1619.02 2022.65,1502.08 2025,1371.8 2027.35,1283.09 2029.7,1349.57 2032.05,1396.28 2034.4,1425.19 2036.76,1425.59 2039.11,1426.35 2041.46,1329.34 2043.81,1425.39 2046.16,1386.54 2048.51,1187.57 2050.86,1418.24 2053.21,1461.76 2055.56,1586.17 2057.91,1378.52 2060.26,1568.68 2062.61,1542.55 2064.96,1457.43 2067.31,1153.26 2069.66,1423.14 2072.01,1303.93 2074.36,1470.73 2076.71,1286.1 2079.06,1302.2 2081.41,1360.05 2083.76,1515.17 2086.11,1275.06 2088.47,1563.93 2090.82,1231.76 2093.17,1380.16 2095.52,1459.26 2097.87,1511.3 2100.22,1430.75 2102.57,1353.81 2104.92,1487.23 2107.27,1422.55 2109.62,1465.23 2111.97,1354.02 2114.32,1283.15 2116.67,1561.77 2119.02,1446.38 2121.37,1445.87 2123.72,1469.84 2126.07,1530.01 2128.42,1580.52 2130.77,1505.78 2133.12,1611.98 2135.47,1442.77 2137.83,1318.86 2140.18,1171.61 2142.53,1639.02 2144.88,1182.25 2147.23,1557.71 2149.58,1473.88 2151.93,1375.9 2154.28,1294.67 2156.63,1389.93 2158.98,1450.54 2161.33,1328.19 2163.68,1423.4 2166.03,1225.41 2168.38,1434.15 2170.73,1420.1 2173.08,1544.36 2175.43,1517.31 2177.78,1450.27 2180.13,1531.69 2182.48,1492.38 2184.83,1401.6 2187.19,1421.5 2189.54,1538.73 2191.89,1481.69 2194.24,1243.61 2196.59,1365.83 2198.94,1395.6 2201.29,1481.29 2203.64,1386.71 2205.99,1354.72 2208.34,1414.32 2210.69,1438.94 2213.04,1270.25 2215.39,1354.58 2217.74,1458.72 2220.09,1323.05 2222.44,1422.46 2224.79,1221.93 2227.14,1377.73 2229.49,1500.1 2231.84,1359.81 2234.19,1323.76 2236.55,1477.57 2238.9,1479.81 2241.25,1322.44 2243.6,1302.55 2245.95,1326.57 2248.3,1470.32 2250.65,1386.88 2253,1367.08 2255.35,1569.69 2257.7,1452.3 2260.05,1410.08 2262.4,1298.51 2264.75,1191.08 2267.1,1380.98 2269.45,1379 2271.8,1544.57 2274.15,1537.62 2276.5,1456.14 2278.85,1489.36 2281.2,1334.99 2283.55,1430.48 2285.91,1310.21 2288.26,1420.77 2290.61,1373.12 2292.96,1751.15 2295.31,1391.63 2297.66,1376.32 2300.01,1471.16 2302.36,1363.69 2304.71,1540.68 2307.06,1373.12 2309.41,1479.58 2311.76,1520.6 2314.11,1419.54 2316.46,1351.81 2318.81,1483.7 2321.16,1357.51 2323.51,1224.46 2325.86,1211.72 2328.21,1453.15 2330.56,1526.88 2332.91,1429.92 2335.27,1433.95 2337.62,1448.25 2339.97,1183.15 2342.32,1462.08 2344.67,1340.43 2347.02,1269.21 2349.37,1467.66 2351.72,1359.86 2354.07,1353.78 2356.42,1640.44 2358.77,1406.38 2361.12,1588.26 2363.47,1581.31 2365.82,1472.63 2368.17,1342.71 2370.52,1294.18 2372.87,1338.99 2375.22,1172.12 2377.57,1353.75 2379.92,1489.92 2382.27,1319.68 2384.62,1435.5 2386.98,1538.58 2389.33,1418.03 2391.68,1363.96 2394.03,1422.15 2396.38,1436.08 2398.73,1370.94 2401.08,1461.38 2403.43,1408.27 2405.78,1408.8 2408.13,1482.2 2410.48,1317.3 2412.83,1405.48 2415.18,1378.03 2417.53,1476.9 2419.88,1491.85 2422.23,1410.31 2424.58,1521.42 2426.93,1395.13 2429.28,1490.67 2431.63,1437.21 2433.98,1589.31 2436.34,1314.16 2438.69,1262.23 2441.04,1273.77 2443.39,1340.62 2445.74,1455.48 2448.09,1329.09 2450.44,1455.19 2452.79,1295.94 2455.14,1300.37 2457.49,1351.06 2459.84,1458.54 2462.19,1469.48 2464.54,1482.03 2466.89,1577.55 2469.24,1433.51 2471.59,1395.35 2473.94,1382.78 2476.29,1467.57 2478.64,1392.24 2480.99,1472.06 2483.34,1511.06 2485.7,1369.49 2488.05,1229.4 2490.4,1352.3 2492.75,1488.38 2495.1,1498.06 2497.45,1458.71 2499.8,1520.92 2502.15,1548.27 2504.5,1437.84 2506.85,1640.72 2509.2,1534.21 2511.55,1484.79 2513.9,1138.58 2516.25,1445.13 2518.6,1599.37 2520.95,1473.16 2523.3,1443.47 2525.65,1455.96 2528,1434.58 2530.35,1455.89 2532.7,1516.14 2535.06,1296.64 2537.41,1158.56 2539.76,1514.65 2542.11,1436.01 2544.46,1347.57 2546.81,1455.04 2549.16,1449.09 2551.51,1535.6 2553.86,1360.58 2556.21,1343.93 2558.56,1375.96 2560.91,1473.77 2563.26,1475.5 2565.61,1570.09 2567.96,1349.28 2570.31,1666.29 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,938.268 224.541,987.902 226.891,990.113 229.242,889.974 231.592,721.627 233.943,857.253 236.293,913.822 238.644,985.454 240.994,945.411 243.345,806.95 245.695,828.16 248.046,795.965 250.396,853.058 252.747,895.4 255.097,822.752 257.448,824.42 259.798,899.473 262.148,860.174 264.499,1074.92 266.849,940.515 269.2,1002.89 271.55,801.436 273.901,645.85 276.251,862.328 278.602,782.288 280.952,677.616 283.303,741.164 285.653,854.028 288.004,1117.48 290.354,782.67 292.705,944.662 295.055,896.816 297.406,806.191 299.756,1021.4 302.107,913.443 304.457,690.392 306.807,908.343 309.158,954.213 311.508,1031.82 313.859,946.547 316.209,1006.23 318.56,1053.61 320.91,959.434 323.261,708.601 325.611,753.52 327.962,978.414 330.312,922.359 332.663,1091 335.013,1048.91 337.364,808.002 339.714,1070.15 342.065,925.888 344.415,999.383 346.765,1014.67 349.116,867.93 351.466,1024.3 353.817,812.312 356.167,1051.83 358.518,898.271 360.868,852.917 363.219,874.401 365.569,1023.32 367.92,770.771 370.27,852.912 372.621,860.067 374.971,985.654 377.322,1070.17 379.672,735.162 382.023,929.091 384.373,870.513 386.724,912.541 389.074,921.32 391.424,900.381 393.775,1100.34 396.125,1024.75 398.476,724.469 400.826,702.481 403.177,874.556 405.527,769.06 407.878,924.052 410.228,863.722 412.579,985.328 414.929,893.293 417.28,903.129 419.63,940.001 421.981,884.123 424.331,990.349 426.682,902.508 429.032,928.087 431.382,942.718 433.733,978.821 436.083,999.286 438.434,1132.78 440.784,914.587 443.135,1067.81 445.485,822.911 447.836,834.023 450.186,798.003 452.537,733.678 454.887,926.471 457.238,1106.71 459.588,877.931 461.939,1093.18 464.289,885.214 466.64,909.147 468.99,824.068 471.341,1032.4 473.691,994.04 476.041,827.239 478.392,863.516 480.742,888.526 483.093,900.287 485.443,900.763 487.794,698.84 490.144,1175.96 492.495,720.643 494.845,833.426 497.196,855.958 499.546,828.464 501.897,934.807 504.247,888.334 506.598,910.219 508.948,1024.83 511.299,852.528 513.649,1072.26 515.999,1027.45 518.35,1029.02 520.7,936.116 523.051,935.516 525.401,880.446 527.752,948.603 530.102,1040.4 532.453,976.293 534.803,1020.35 537.154,842.707 539.504,742.716 541.855,919.901 544.205,1037.65 546.556,1114.66 548.906,787.121 551.257,882.383 553.607,937.212 555.958,986.069 558.308,853.612 560.658,752.111 563.009,834.466 565.359,997.929 567.71,1000.78 570.06,917.03 572.411,938.743 574.761,860.481 577.112,1033.09 579.462,1004.83 581.813,1032.8 584.163,725.478 586.514,898.831 588.864,1001.19 591.215,1026.7 593.565,774.222 595.916,914.014 598.266,772.422 600.616,1013.83 602.967,853.638 605.317,884.075 607.668,788.198 610.018,859.973 612.369,955.747 614.719,798.808 617.07,674.282 619.42,862.161 621.771,804.202 624.121,1050.6 626.472,1134.46 628.822,1020.18 631.173,931.638 633.523,931.384 635.874,914.953 638.224,979.086 640.575,794.83 642.925,859.099 645.275,723.454 647.626,845.842 649.976,886.21 652.327,785.569 654.677,884.512 657.028,858.032 659.378,928.8 661.729,954.336 664.079,1072.82 666.43,878.371 668.78,871.289 671.131,882.993 673.481,961.752 675.832,1021.69 678.182,950.02 680.533,989.275 682.883,1029.13 685.233,828.777 687.584,840.534 689.934,867.067 692.285,822.426 694.635,1017.34 696.986,891.462 699.336,983.51 701.687,990.653 704.037,940.657 706.388,1113.58 708.738,1121.49 711.089,863.734 713.439,870.346 715.79,818.087 718.14,857.18 720.491,928.035 722.841,912.45 725.192,867.635 727.542,994.87 729.892,876.807 732.243,1040.32 734.593,879.779 736.944,895.596 739.294,951.72 741.645,751.003 743.995,863.171 746.346,1024.54 748.696,814.252 751.047,1099.02 753.397,910.778 755.748,970.122 758.098,865.597 760.449,852.321 762.799,884.258 765.15,1058.39 767.5,894.333 769.85,846.821 772.201,1064.29 774.551,840.304 776.902,928.178 779.252,987.611 781.603,931.464 783.953,931.762 786.304,945.538 788.654,873.908 791.005,880.343 793.355,802.23 795.706,975.538 798.056,971.727 800.407,876.423 802.757,926.945 805.108,912.09 807.458,891.968 809.809,1097.43 812.159,1066.74 814.509,1049.62 816.86,818.225 819.21,880.765 821.561,888.632 823.911,794.909 826.262,812.456 828.612,858.425 830.963,1018.17 833.313,755.145 835.664,853.452 838.014,757.937 840.365,1107.88 842.715,944.815 845.066,950.921 847.416,911.812 849.767,1013.21 852.117,863.079 854.467,862.733 856.818,965.538 859.168,746.162 861.519,846.749 863.869,960.873 866.22,914.871 868.57,844.859 870.921,789.607 873.271,759.879 875.622,936.093 877.972,860.863 880.323,890.553 882.673,764.718 885.024,890.403 887.374,1003.3 889.725,915.085 892.075,904.358 894.426,1109.66 896.776,739.518 899.126,1044.99 901.477,857.399 903.827,1209.5 906.178,1198.99 908.528,936.81 910.879,846.576 913.229,904.243 915.58,1135.87 917.93,842.972 920.281,843.397 922.631,875.782 924.982,835.044 927.332,985.437 929.683,1017.9 932.033,966.96 934.384,868.452 936.734,848.719 939.084,918.7 941.435,893.362 943.785,804.39 946.136,823.27 948.486,833.509 950.837,1051.23 953.187,898.651 955.538,1078.95 957.888,866.899 960.239,877.334 962.589,954.142 964.94,811.346 967.29,886.387 969.641,807.227 971.991,1098.81 974.342,811.348 976.692,861.951 979.043,973.34 981.393,937.769 983.743,1024.67 986.094,802.502 988.444,908.047 990.795,958.323 993.145,883.397 995.496,905.061 997.846,724.056 1000.2,907.338 1002.55,647.495 1004.9,882.028 1007.25,816.485 1009.6,1027.47 1011.95,1094.73 1014.3,894.397 1016.65,1153.94 1019,1060.38 1021.35,908.847 1023.7,832.328 1026.05,1029.25 1028.4,1042.13 1030.75,870.977 1033.1,1003.56 1035.45,858.372 1037.8,943.003 1040.15,915.079 1042.51,999.709 1044.86,958.776 1047.21,833.849 1049.56,817.481 1051.91,918.362 1054.26,996.931 1056.61,1022.39 1058.96,806.043 1061.31,1010.13 1063.66,887.893 1066.01,1109.57 1068.36,859.554 1070.71,1040.3 1073.06,933.527 1075.41,1016.9 1077.76,809.355 1080.11,916.195 1082.46,1052.71 1084.81,894.9 1087.16,964.468 1089.51,1040.01 1091.87,1074.67 1094.22,944.762 1096.57,876.247 1098.92,982.653 1101.27,914.986 1103.62,1057.45 1105.97,872.43 1108.32,972.331 1110.67,831.209 1113.02,738.075 1115.37,979.836 1117.72,1053.11 1120.07,930.742 1122.42,1035.17 1124.77,858.139 1127.12,1031.82 1129.47,1083.95 1131.82,892.867 1134.17,950.203 1136.52,848.941 1138.87,855.646 1141.23,935.521 1143.58,1144.62 1145.93,1015.36 1148.28,868.071 1150.63,722.065 1152.98,937.874 1155.33,995.993 1157.68,976.743 1160.03,930.897 1162.38,888.652 1164.73,947.754 1167.08,854.93 1169.43,787.551 1171.78,945.246 1174.13,636.307 1176.48,882.152 1178.83,873.284 1181.18,1090.27 1183.53,989.099 1185.88,907.722 1188.23,830.52 1190.59,972.437 1192.94,911.411 1195.29,841.691 1197.64,874.087 1199.99,812.386 1202.34,967.216 1204.69,971.9 1207.04,1026.13 1209.39,864.285 1211.74,969.511 1214.09,964.237 1216.44,978.435 1218.79,1051.8 1221.14,1028 1223.49,830.656 1225.84,970.146 1228.19,931.256 1230.54,1027.8 1232.89,1048.36 1235.24,981.03 1237.59,1228.76 1239.94,960.005 1242.3,824.22 1244.65,992.048 1247,1058.29 1249.35,1073.29 1251.7,828.099 1254.05,806.401 1256.4,882.261 1258.75,793.078 1261.1,692.712 1263.45,967.819 1265.8,914.824 1268.15,974.555 1270.5,985.718 1272.85,971.108 1275.2,1050.05 1277.55,935.465 1279.9,1075.06 1282.25,877.617 1284.6,829.292 1286.95,749.098 1289.3,862.898 1291.66,974.262 1294.01,890.62 1296.36,1010.51 1298.71,971.521 1301.06,766.238 1303.41,883.284 1305.76,857.251 1308.11,825.426 1310.46,862.445 1312.81,915.738 1315.16,820.542 1317.51,934.23 1319.86,891.973 1322.21,798.577 1324.56,732.399 1326.91,848.324 1329.26,1102.63 1331.61,927.306 1333.96,852.282 1336.31,793.837 1338.66,982.396 1341.02,926.973 1343.37,1082.9 1345.72,867.981 1348.07,943.843 1350.42,938.591 1352.77,1025.77 1355.12,703.025 1357.47,819.582 1359.82,868.684 1362.17,904.194 1364.52,874.351 1366.87,893.441 1369.22,1079.39 1371.57,710.974 1373.92,926.754 1376.27,1080.65 1378.62,983.495 1380.97,911.401 1383.32,908.741 1385.67,910.026 1388.02,883.564 1390.38,788.915 1392.73,719.809 1395.08,987.84 1397.43,937.067 1399.78,825.527 1402.13,1125.72 1404.48,908.913 1406.83,1030.91 1409.18,1067.06 1411.53,857.424 1413.88,863.414 1416.23,971.239 1418.58,776.492 1420.93,1105.25 1423.28,872.495 1425.63,806.41 1427.98,837.665 1430.33,994.457 1432.68,1000.79 1435.03,886.092 1437.38,866.164 1439.74,1042.64 1442.09,765.023 1444.44,761.942 1446.79,1036.25 1449.14,754.952 1451.49,922.13 1453.84,957.081 1456.19,1000.89 1458.54,876.007 1460.89,858.143 1463.24,986.02 1465.59,1208.51 1467.94,879.338 1470.29,791.772 1472.64,910.62 1474.99,1070.09 1477.34,963.464 1479.69,993.192 1482.04,1167.25 1484.39,932.596 1486.74,965.975 1489.1,924.924 1491.45,944.682 1493.8,1011.26 1496.15,910.866 1498.5,813.133 1500.85,802.01 1503.2,1068.13 1505.55,947.937 1507.9,891.447 1510.25,895.36 1512.6,913.031 1514.95,685.324 1517.3,1073.37 1519.65,715.307 1522,924.259 1524.35,740.995 1526.7,806.216 1529.05,852.07 1531.4,1032.88 1533.75,1079.5 1536.1,1129.46 1538.45,872.247 1540.81,982.556 1543.16,951.455 1545.51,900.893 1547.86,888.352 1550.21,832.038 1552.56,1004.18 1554.91,1057.07 1557.26,1036.84 1559.61,1007.16 1561.96,870.776 1564.31,969.417 1566.66,1011.37 1569.01,873.531 1571.36,824.603 1573.71,975.865 1576.06,773.487 1578.41,715.903 1580.76,987.079 1583.11,907.195 1585.46,937.59 1587.81,1007.74 1590.17,862.006 1592.52,1121.83 1594.87,703.187 1597.22,898.942 1599.57,885.751 1601.92,984.17 1604.27,926.074 1606.62,845.313 1608.97,921.323 1611.32,937.866 1613.67,937.869 1616.02,862.842 1618.37,963.486 1620.72,730.325 1623.07,1052.57 1625.42,753.6 1627.77,862.467 1630.12,1040.57 1632.47,1090.62 1634.82,919.349 1637.17,1082.74 1639.53,892.372 1641.88,874.541 1644.23,1026.65 1646.58,783.6 1648.93,966.509 1651.28,743.824 1653.63,938.419 1655.98,756.272 1658.33,1004.29 1660.68,844.356 1663.03,901.846 1665.38,860.225 1667.73,972.807 1670.08,847.829 1672.43,1091.86 1674.78,943.407 1677.13,1029.07 1679.48,891.167 1681.83,1025.03 1684.18,769.285 1686.53,1119.5 1688.89,1010.7 1691.24,947.758 1693.59,850.748 1695.94,1001.41 1698.29,1111.72 1700.64,678.915 1702.99,765.514 1705.34,1067.71 1707.69,861.505 1710.04,794.468 1712.39,984.592 1714.74,752.727 1717.09,920.631 1719.44,1262.06 1721.79,901.915 1724.14,941.216 1726.49,870.141 1728.84,812.247 1731.19,925.306 1733.54,992.209 1735.89,900.429 1738.25,751.454 1740.6,806.29 1742.95,849.486 1745.3,824.422 1747.65,909.955 1750,1035.92 1752.35,963.744 1754.7,967.281 1757.05,800.225 1759.4,986.081 1761.75,877.831 1764.1,974.153 1766.45,813.758 1768.8,1055.48 1771.15,782.972 1773.5,836.834 1775.85,1108.33 1778.2,919.414 1780.55,899.983 1782.9,1036.08 1785.25,869.874 1787.6,851.07 1789.96,1002.6 1792.31,951.088 1794.66,1004.68 1797.01,975.359 1799.36,923.025 1801.71,940.226 1804.06,804.443 1806.41,1168.21 1808.76,1064.07 1811.11,1262.12 1813.46,844.941 1815.81,1109.79 1818.16,909.26 1820.51,706.024 1822.86,935.301 1825.21,946.258 1827.56,898.487 1829.91,849.413 1832.26,794.598 1834.61,806.295 1836.96,803.852 1839.32,871.963 1841.67,1050.14 1844.02,891.918 1846.37,987.508 1848.72,873.254 1851.07,871.86 1853.42,744.853 1855.77,949.075 1858.12,929.272 1860.47,892.04 1862.82,1024.37 1865.17,980.377 1867.52,855.768 1869.87,1005.69 1872.22,927.354 1874.57,1023.44 1876.92,1103.49 1879.27,791.189 1881.62,767.978 1883.97,739.318 1886.32,973.648 1888.68,908.891 1891.03,998.278 1893.38,1045.8 1895.73,833.48 1898.08,1015.16 1900.43,859.206 1902.78,1018.53 1905.13,927.073 1907.48,910.85 1909.83,739.148 1912.18,879.88 1914.53,1115.58 1916.88,1003.37 1919.23,673.014 1921.58,1013.06 1923.93,946.886 1926.28,875.26 1928.63,732.395 1930.98,931.422 1933.33,1095.89 1935.68,964.825 1938.04,976.703 1940.39,753.981 1942.74,768.147 1945.09,745.772 1947.44,933.478 1949.79,981.512 1952.14,1008.69 1954.49,873.477 1956.84,761.578 1959.19,909.316 1961.54,894.434 1963.89,922.079 1966.24,1004.36 1968.59,728.483 1970.94,828.614 1973.29,886.363 1975.64,812.59 1977.99,773.425 1980.34,1050.45 1982.69,874.529 1985.04,921.465 1987.4,825.458 1989.75,1064.65 1992.1,642.414 1994.45,934.511 1996.8,1079.27 1999.15,894.808 2001.5,1156.53 2003.85,867.393 2006.2,764.595 2008.55,1158.37 2010.9,927.584 2013.25,870.226 2015.6,1037.82 2017.95,1047.08 2020.3,841.637 2022.65,966.25 2025,809.874 2027.35,1031.33 2029.7,1049.64 2032.05,966.749 2034.4,1176.73 2036.76,1026.01 2039.11,789.029 2041.46,987.517 2043.81,964.637 2046.16,779.638 2048.51,784.846 2050.86,1007.72 2053.21,723.626 2055.56,816.844 2057.91,1178.86 2060.26,969.557 2062.61,908.317 2064.96,877.366 2067.31,889.949 2069.66,912.483 2072.01,880.929 2074.36,759.107 2076.71,1023.02 2079.06,1110.33 2081.41,740.964 2083.76,975.709 2086.11,932.614 2088.47,956.073 2090.82,887.952 2093.17,728.265 2095.52,685.072 2097.87,956.108 2100.22,941.372 2102.57,892.925 2104.92,911.069 2107.27,1006.27 2109.62,898.014 2111.97,1028.06 2114.32,896.829 2116.67,1029.34 2119.02,932.446 2121.37,1034.9 2123.72,1040.89 2126.07,925.728 2128.42,953.31 2130.77,817.898 2133.12,878.888 2135.47,849.9 2137.83,947.911 2140.18,684.719 2142.53,847.484 2144.88,962.863 2147.23,908.706 2149.58,989.417 2151.93,997.904 2154.28,859.364 2156.63,963.425 2158.98,755.598 2161.33,974.813 2163.68,1067.58 2166.03,1114.11 2168.38,984.617 2170.73,734.585 2173.08,1142.52 2175.43,979.997 2177.78,981.352 2180.13,935.634 2182.48,1053.09 2184.83,966.161 2187.19,687.364 2189.54,1118.95 2191.89,792.011 2194.24,919.762 2196.59,780.091 2198.94,1073.58 2201.29,617.556 2203.64,1068.18 2205.99,732.47 2208.34,1071.88 2210.69,828.551 2213.04,991.75 2215.39,840.776 2217.74,899.112 2220.09,752.139 2222.44,620.799 2224.79,995.476 2227.14,932.078 2229.49,1036.64 2231.84,777.745 2234.19,1017.23 2236.55,944.02 2238.9,918.031 2241.25,896.342 2243.6,957.544 2245.95,942.75 2248.3,813.379 2250.65,1054.73 2253,1013.14 2255.35,894.994 2257.7,902.721 2260.05,1041.25 2262.4,876.427 2264.75,860.953 2267.1,946.694 2269.45,998.069 2271.8,806.962 2274.15,912.398 2276.5,921.123 2278.85,803.825 2281.2,944.784 2283.55,1002.82 2285.91,1057.72 2288.26,951.667 2290.61,858.215 2292.96,997.713 2295.31,915.662 2297.66,1138.99 2300.01,796.878 2302.36,865.481 2304.71,651.172 2307.06,920.461 2309.41,995.43 2311.76,978.322 2314.11,815.162 2316.46,930.502 2318.81,1062.26 2321.16,839.966 2323.51,977.22 2325.86,1084.01 2328.21,1106.08 2330.56,838.82 2332.91,962.974 2335.27,1037.54 2337.62,821.977 2339.97,936.588 2342.32,951.403 2344.67,824.696 2347.02,914.935 2349.37,1044.53 2351.72,851.809 2354.07,824.22 2356.42,816.881 2358.77,937.405 2361.12,795.17 2363.47,888.5 2365.82,780.235 2368.17,1039.15 2370.52,676.794 2372.87,901.67 2375.22,1062.59 2377.57,627.844 2379.92,956.537 2382.27,995.783 2384.62,958.048 2386.98,1039.3 2389.33,850.424 2391.68,889.696 2394.03,898.388 2396.38,890.741 2398.73,1164.88 2401.08,759.696 2403.43,885.889 2405.78,1152.21 2408.13,824.261 2410.48,872.433 2412.83,782.633 2415.18,905.255 2417.53,952.476 2419.88,821.192 2422.23,865.483 2424.58,994.84 2426.93,1012.91 2429.28,1073.12 2431.63,899.503 2433.98,930.608 2436.34,994.098 2438.69,864.794 2441.04,918.055 2443.39,977.208 2445.74,836.15 2448.09,904.606 2450.44,891.048 2452.79,953.486 2455.14,1053.78 2457.49,882.101 2459.84,933.156 2462.19,833.133 2464.54,965.858 2466.89,852.575 2469.24,889.366 2471.59,1024.73 2473.94,787.911 2476.29,776.138 2478.64,856.055 2480.99,796.55 2483.34,955.319 2485.7,989.119 2488.05,862.148 2490.4,927.556 2492.75,1036.94 2495.1,896.438 2497.45,918.22 2499.8,1057.22 2502.15,1047.62 2504.5,763.203 2506.85,1123.4 2509.2,934.703 2511.55,878.165 2513.9,880.888 2516.25,982.964 2518.6,1009.89 2520.95,1051.68 2523.3,1058.85 2525.65,768.678 2528,958.667 2530.35,928.996 2532.7,1065.6 2535.06,887.296 2537.41,992.546 2539.76,783.85 2542.11,1068.3 2544.46,1028.8 2546.81,884.772 2549.16,857.446 2551.51,926.83 2553.86,999.422 2556.21,871.549 2558.56,863.61 2560.91,892.085 2563.26,993.747 2565.61,1032.43 2567.96,735.788 2570.31,968.848 "></polyline>
<polyline clip-path="url(#clip522)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,592.219 224.541,471.491 226.891,385.549 229.242,515.928 231.592,388.047 233.943,356.728 236.293,430.647 238.644,271.684 240.994,476.253 243.345,440.064 245.695,337.646 248.046,572.114 250.396,549.862 252.747,468.01 255.097,391.583 257.448,356.493 259.798,549.341 262.148,470.036 264.499,326.489 266.849,292.746 269.2,218.172 271.55,341.358 273.901,361.378 276.251,263.721 278.602,382.428 280.952,387.846 283.303,382.272 285.653,288.582 288.004,425.983 290.354,441.494 292.705,379.33 295.055,528.178 297.406,143.856 299.756,235.468 302.107,371.336 304.457,287.185 306.807,436.347 309.158,412.95 311.508,466.388 313.859,427.665 316.209,456.472 318.56,389.611 320.91,223.221 323.261,333.185 325.611,258.989 327.962,372.547 330.312,320.25 332.663,527.298 335.013,459.921 337.364,414.683 339.714,389.34 342.065,444.87 344.415,417.778 346.765,369.196 349.116,569.118 351.466,581.649 353.817,366.371 356.167,372.809 358.518,426.858 360.868,451.702 363.219,289.755 365.569,214.633 367.92,194.921 370.27,330.885 372.621,598.209 374.971,442.146 377.322,459.355 379.672,516.749 382.023,711.621 384.373,574.277 386.724,327.533 389.074,378.235 391.424,368.709 393.775,481.639 396.125,436.329 398.476,374.311 400.826,545.95 403.177,440.14 405.527,317.166 407.878,505.11 410.228,472.945 412.579,375.325 414.929,372.84 417.28,234.466 419.63,553.475 421.981,230.023 424.331,634.187 426.682,235.535 429.032,284.837 431.382,360.148 433.733,500.35 436.083,418.006 438.434,268.336 440.784,472.379 443.135,394.04 445.485,414.333 447.836,510.714 450.186,386.723 452.537,268.137 454.887,208.767 457.238,555.68 459.588,197.071 461.939,529.163 464.289,335.972 466.64,232.12 468.99,463.943 471.341,318.319 473.691,345.003 476.041,308.804 478.392,340.724 480.742,211.15 483.093,262.767 485.443,363.051 487.794,350.642 490.144,489.28 492.495,446.149 494.845,353.673 497.196,331.825 499.546,399.65 501.897,357.526 504.247,444.182 506.598,367.31 508.948,404.675 511.299,429.233 513.649,366.199 515.999,442.604 518.35,237.659 520.7,200.105 523.051,445.042 525.401,459.591 527.752,547.567 530.102,334.659 532.453,258.295 534.803,542.648 537.154,330.114 539.504,456.162 541.855,389.496 544.205,592.129 546.556,360.01 548.906,499.663 551.257,493.145 553.607,150.038 555.958,216.557 558.308,568.501 560.658,269.715 563.009,345.935 565.359,525.111 567.71,548.33 570.06,273.071 572.411,295.194 574.761,423.636 577.112,402.101 579.462,352.432 581.813,432.216 584.163,309.617 586.514,277.26 588.864,251.371 591.215,308.85 593.565,538.302 595.916,333.248 598.266,313.525 600.616,414.147 602.967,371.058 605.317,405.808 607.668,345.56 610.018,300.84 612.369,562.818 614.719,425.87 617.07,247.055 619.42,289.237 621.771,460.384 624.121,501.242 626.472,277.391 628.822,486.702 631.173,350.192 633.523,470.761 635.874,424.966 638.224,356.67 640.575,298.03 642.925,331.614 645.275,412.882 647.626,446.205 649.976,428.039 652.327,608.676 654.677,347.007 657.028,527.029 659.378,311.037 661.729,450.96 664.079,377.253 666.43,403.255 668.78,279.111 671.131,480.014 673.481,470.068 675.832,402.31 678.182,398.908 680.533,415.534 682.883,455.662 685.233,305.587 687.584,214.757 689.934,430.059 692.285,435.407 694.635,504.994 696.986,368.096 699.336,299.346 701.687,378.775 704.037,514.311 706.388,334.914 708.738,340.769 711.089,373.959 713.439,618.839 715.79,381.398 718.14,376.648 720.491,597.065 722.841,325.574 725.192,218.044 727.542,336.2 729.892,322.196 732.243,439.063 734.593,524.813 736.944,399.628 739.294,336.509 741.645,327.964 743.995,562.095 746.346,326.636 748.696,483.853 751.047,389.885 753.397,299.886 755.748,499.268 758.098,409.117 760.449,373.039 762.799,314.163 765.15,340.154 767.5,394.977 769.85,355.302 772.201,428.791 774.551,460.21 776.902,440.358 779.252,492.381 781.603,376.186 783.953,642.675 786.304,558.345 788.654,498.764 791.005,257.084 793.355,339.26 795.706,465.252 798.056,441.449 800.407,261.795 802.757,447.243 805.108,285.575 807.458,223.788 809.809,272.818 812.159,415.455 814.509,224.698 816.86,598.442 819.21,373.245 821.561,359.85 823.911,217.622 826.262,294.686 828.612,561.105 830.963,407.115 833.313,345.684 835.664,404.196 838.014,379.458 840.365,519.82 842.715,321.295 845.066,588.573 847.416,361.637 849.767,264.052 852.117,348.916 854.467,446.322 856.818,220.725 859.168,337.983 861.519,331.857 863.869,468.411 866.22,303.354 868.57,389.021 870.921,252.206 873.271,142.081 875.622,324.073 877.972,331.096 880.323,216.451 882.673,425.268 885.024,333.337 887.374,436.162 889.725,305.722 892.075,452.832 894.426,470.975 896.776,344.302 899.126,324.083 901.477,315.861 903.827,329.135 906.178,399.849 908.528,530.622 910.879,313.292 913.229,410.518 915.58,492.027 917.93,434.215 920.281,467.183 922.631,397.105 924.982,364.265 927.332,700.112 929.683,287.192 932.033,452.189 934.384,386.425 936.734,451.254 939.084,340.343 941.435,573.739 943.785,473.42 946.136,401.409 948.486,397.514 950.837,380.775 953.187,406.467 955.538,247.79 957.888,282.718 960.239,581.477 962.589,292.56 964.94,575.326 967.29,381.24 969.641,684.595 971.991,404.762 974.342,120.547 976.692,457.599 979.043,202.511 981.393,263.175 983.743,495.514 986.094,350.506 988.444,218.234 990.795,597.881 993.145,424.787 995.496,315.826 997.846,421.741 1000.2,609.222 1002.55,258.367 1004.9,589.712 1007.25,520.936 1009.6,432.151 1011.95,506.808 1014.3,309.788 1016.65,624.098 1019,336.955 1021.35,353.367 1023.7,340.796 1026.05,394.451 1028.4,494.484 1030.75,329.781 1033.1,274.827 1035.45,299.489 1037.8,660.74 1040.15,355.776 1042.51,313.101 1044.86,481.673 1047.21,331.796 1049.56,357.586 1051.91,361.27 1054.26,417.945 1056.61,405.248 1058.96,355.415 1061.31,278.641 1063.66,331.617 1066.01,485.361 1068.36,366.386 1070.71,423.86 1073.06,325.124 1075.41,264.22 1077.76,383.546 1080.11,404.235 1082.46,379.142 1084.81,443.169 1087.16,471.178 1089.51,250.835 1091.87,308.441 1094.22,406.104 1096.57,518.336 1098.92,342.889 1101.27,284.169 1103.62,640.445 1105.97,343.488 1108.32,484.168 1110.67,446.222 1113.02,460.798 1115.37,383.336 1117.72,333.687 1120.07,384.041 1122.42,368.948 1124.77,292.509 1127.12,497.938 1129.47,460.476 1131.82,324.136 1134.17,344.901 1136.52,353.579 1138.87,477.122 1141.23,313.336 1143.58,490.096 1145.93,435.322 1148.28,342.092 1150.63,419.676 1152.98,393.053 1155.33,470.124 1157.68,360.859 1160.03,229.703 1162.38,267.301 1164.73,452.514 1167.08,357.397 1169.43,342.001 1171.78,342.023 1174.13,556.232 1176.48,381.022 1178.83,285.871 1181.18,472.677 1183.53,300.232 1185.88,501.171 1188.23,385.429 1190.59,341.706 1192.94,273.809 1195.29,328.629 1197.64,366.69 1199.99,519.359 1202.34,496.881 1204.69,303.968 1207.04,363.337 1209.39,333.374 1211.74,421.144 1214.09,427.742 1216.44,346.395 1218.79,474.867 1221.14,295.261 1223.49,356.263 1225.84,309.512 1228.19,405.641 1230.54,320.502 1232.89,229.354 1235.24,360.197 1237.59,375.498 1239.94,406.318 1242.3,605.904 1244.65,490.214 1247,428.278 1249.35,492.628 1251.7,505.951 1254.05,462.139 1256.4,365.804 1258.75,327.341 1261.1,227.481 1263.45,515.61 1265.8,509.825 1268.15,356.9 1270.5,280.902 1272.85,611.051 1275.2,305.574 1277.55,418.609 1279.9,532.912 1282.25,216.52 1284.6,305.643 1286.95,368.061 1289.3,488.095 1291.66,363.551 1294.01,240.774 1296.36,118.882 1298.71,432.697 1301.06,624.016 1303.41,367.98 1305.76,367.282 1308.11,356.92 1310.46,324.866 1312.81,462.549 1315.16,336.958 1317.51,363.228 1319.86,395.716 1322.21,247.328 1324.56,242.119 1326.91,308.592 1329.26,439.386 1331.61,327.921 1333.96,431.27 1336.31,389.394 1338.66,412.906 1341.02,242.622 1343.37,242.136 1345.72,182.63 1348.07,355.08 1350.42,357.092 1352.77,473.796 1355.12,633.165 1357.47,310.471 1359.82,278.6 1362.17,362.98 1364.52,334.98 1366.87,354.752 1369.22,389.493 1371.57,433.04 1373.92,377.701 1376.27,409.299 1378.62,440.292 1380.97,307.445 1383.32,482.213 1385.67,392.876 1388.02,500.046 1390.38,476.026 1392.73,528.184 1395.08,125.93 1397.43,249.751 1399.78,285.53 1402.13,357.672 1404.48,407.401 1406.83,334.685 1409.18,370.608 1411.53,403.729 1413.88,219.995 1416.23,385.856 1418.58,522.387 1420.93,309.929 1423.28,142.003 1425.63,343.799 1427.98,378.564 1430.33,196.455 1432.68,353.059 1435.03,474.606 1437.38,288.24 1439.74,228.43 1442.09,96.8724 1444.44,278.42 1446.79,320.174 1449.14,401.508 1451.49,442.792 1453.84,380.355 1456.19,430.56 1458.54,389.289 1460.89,340.842 1463.24,277.989 1465.59,400.328 1467.94,270.876 1470.29,440.218 1472.64,438.521 1474.99,338.404 1477.34,329.236 1479.69,606.584 1482.04,211.846 1484.39,403.158 1486.74,423.948 1489.1,360.797 1491.45,457.461 1493.8,308.618 1496.15,440.361 1498.5,350.679 1500.85,206.514 1503.2,449.098 1505.55,303.724 1507.9,329.045 1510.25,286.106 1512.6,242.174 1514.95,395.992 1517.3,446.115 1519.65,378.014 1522,458.906 1524.35,327.89 1526.7,429.393 1529.05,293.033 1531.4,413.173 1533.75,475.192 1536.1,223.836 1538.45,446.439 1540.81,213.633 1543.16,312.442 1545.51,320.733 1547.86,401.972 1550.21,412.829 1552.56,595.636 1554.91,406.211 1557.26,254.629 1559.61,219.729 1561.96,459.12 1564.31,326.216 1566.66,424.801 1569.01,462.024 1571.36,370.897 1573.71,527.989 1576.06,522.582 1578.41,351.326 1580.76,317.747 1583.11,481.195 1585.46,327.242 1587.81,317.951 1590.17,271.133 1592.52,459.736 1594.87,626.666 1597.22,320.538 1599.57,431.502 1601.92,475.054 1604.27,512.639 1606.62,282.798 1608.97,459.229 1611.32,319.094 1613.67,417.915 1616.02,523.852 1618.37,634.659 1620.72,367.7 1623.07,358.153 1625.42,386.776 1627.77,300.253 1630.12,424.934 1632.47,151.89 1634.82,383.933 1637.17,409.225 1639.53,316.343 1641.88,485.503 1644.23,289.362 1646.58,403.637 1648.93,518.527 1651.28,426.852 1653.63,363.685 1655.98,518.796 1658.33,404.345 1660.68,407.063 1663.03,536.402 1665.38,471.853 1667.73,414.215 1670.08,465.392 1672.43,528.883 1674.78,381.255 1677.13,336.902 1679.48,441.064 1681.83,248.757 1684.18,373.738 1686.53,427.663 1688.89,350.923 1691.24,477.823 1693.59,280.964 1695.94,424.148 1698.29,433.49 1700.64,408.187 1702.99,378.24 1705.34,425.398 1707.69,472.15 1710.04,440.88 1712.39,520.238 1714.74,357.487 1717.09,351.717 1719.44,410.567 1721.79,296.938 1724.14,669.118 1726.49,613.158 1728.84,362.371 1731.19,447.457 1733.54,342.349 1735.89,402.963 1738.25,478.619 1740.6,422.877 1742.95,254.174 1745.3,380.938 1747.65,495.733 1750,386.346 1752.35,317.797 1754.7,486.109 1757.05,462.968 1759.4,509.606 1761.75,427.527 1764.1,544.649 1766.45,295.582 1768.8,414.429 1771.15,448.715 1773.5,435.984 1775.85,533.083 1778.2,543.865 1780.55,395.51 1782.9,327.663 1785.25,431.24 1787.6,484.665 1789.96,380.778 1792.31,362.254 1794.66,499.642 1797.01,443.626 1799.36,325.097 1801.71,323.604 1804.06,503.413 1806.41,430.151 1808.76,259.566 1811.11,409.074 1813.46,373.663 1815.81,512.319 1818.16,426.577 1820.51,349.149 1822.86,355.614 1825.21,362.408 1827.56,388.478 1829.91,213.325 1832.26,511.052 1834.61,203.729 1836.96,364.809 1839.32,365.149 1841.67,419.398 1844.02,284.077 1846.37,292.974 1848.72,423.491 1851.07,250.674 1853.42,446.705 1855.77,487.017 1858.12,428.011 1860.47,309.222 1862.82,268.299 1865.17,408.774 1867.52,455.573 1869.87,256.139 1872.22,368.564 1874.57,271.622 1876.92,187.652 1879.27,412.997 1881.62,255.722 1883.97,507.156 1886.32,374.79 1888.68,406.202 1891.03,371.321 1893.38,362.144 1895.73,385.704 1898.08,377.944 1900.43,624.127 1902.78,443.678 1905.13,343.835 1907.48,229.421 1909.83,541.074 1912.18,264.434 1914.53,378.47 1916.88,270.89 1919.23,268.853 1921.58,461.821 1923.93,387.331 1926.28,383.734 1928.63,475.59 1930.98,401.741 1933.33,233.972 1935.68,383.248 1938.04,409.465 1940.39,399.68 1942.74,184.534 1945.09,311.142 1947.44,368.453 1949.79,402.656 1952.14,347.612 1954.49,544.242 1956.84,464.004 1959.19,359.781 1961.54,411.994 1963.89,447.142 1966.24,139.757 1968.59,528.298 1970.94,511.287 1973.29,311.897 1975.64,613.676 1977.99,252.793 1980.34,358.057 1982.69,585.667 1985.04,373.81 1987.4,428.893 1989.75,332.89 1992.1,428.531 1994.45,427.455 1996.8,316.545 1999.15,678.141 2001.5,301.985 2003.85,495.217 2006.2,554.222 2008.55,488.77 2010.9,351.036 2013.25,204.462 2015.6,478.012 2017.95,537 2020.3,347.911 2022.65,366.685 2025,358.783 2027.35,499.289 2029.7,410.005 2032.05,283.683 2034.4,340.425 2036.76,303.142 2039.11,523.494 2041.46,297.909 2043.81,280.969 2046.16,190.21 2048.51,313.025 2050.86,307.699 2053.21,381.548 2055.56,423.843 2057.91,426.581 2060.26,368.226 2062.61,407.273 2064.96,530.472 2067.31,487.59 2069.66,621.06 2072.01,410.449 2074.36,310.952 2076.71,310.345 2079.06,456.277 2081.41,357.391 2083.76,299.598 2086.11,409.331 2088.47,385.028 2090.82,286.643 2093.17,381.378 2095.52,545.378 2097.87,479.483 2100.22,294.737 2102.57,353.61 2104.92,309.906 2107.27,386.917 2109.62,506.546 2111.97,553.493 2114.32,490.348 2116.67,512.252 2119.02,409.417 2121.37,459.025 2123.72,347.795 2126.07,515.703 2128.42,408.234 2130.77,276.383 2133.12,403.141 2135.47,304.551 2137.83,229.58 2140.18,319.372 2142.53,256.632 2144.88,385.313 2147.23,553.89 2149.58,327.502 2151.93,247.195 2154.28,219.629 2156.63,312.343 2158.98,232.428 2161.33,306.915 2163.68,289.045 2166.03,454.399 2168.38,265.687 2170.73,427.773 2173.08,429.179 2175.43,521.331 2177.78,364.804 2180.13,589.38 2182.48,517.091 2184.83,349.911 2187.19,490.682 2189.54,427.852 2191.89,203.6 2194.24,310.321 2196.59,438.229 2198.94,540.175 2201.29,339.455 2203.64,383.921 2205.99,188.602 2208.34,415.634 2210.69,392.942 2213.04,453.385 2215.39,345.468 2217.74,386.222 2220.09,338.231 2222.44,188.846 2224.79,347.431 2227.14,265.619 2229.49,213.054 2231.84,497.407 2234.19,537.911 2236.55,400.401 2238.9,263.606 2241.25,385.091 2243.6,463.799 2245.95,259.976 2248.3,247.14 2250.65,338.14 2253,302.443 2255.35,430.559 2257.7,443.406 2260.05,484.712 2262.4,456.148 2264.75,192.561 2267.1,353.73 2269.45,228.531 2271.8,599.572 2274.15,399.068 2276.5,358.612 2278.85,239.871 2281.2,437.538 2283.55,533.389 2285.91,249.821 2288.26,320.899 2290.61,432.599 2292.96,653.295 2295.31,446.893 2297.66,235.331 2300.01,253.713 2302.36,342.159 2304.71,256.233 2307.06,408.703 2309.41,383.612 2311.76,435.381 2314.11,391.896 2316.46,246.414 2318.81,315.014 2321.16,459.162 2323.51,597.724 2325.86,527.154 2328.21,399.96 2330.56,119.54 2332.91,504.057 2335.27,204.662 2337.62,451.531 2339.97,491.022 2342.32,509.571 2344.67,312.908 2347.02,406.863 2349.37,289.747 2351.72,425.291 2354.07,442.878 2356.42,586.542 2358.77,471.613 2361.12,213.271 2363.47,389.853 2365.82,316.526 2368.17,388.933 2370.52,337.294 2372.87,317.729 2375.22,340.569 2377.57,237.697 2379.92,342.816 2382.27,494.631 2384.62,413.347 2386.98,397.01 2389.33,526.406 2391.68,588.088 2394.03,309.94 2396.38,469.007 2398.73,349.724 2401.08,539.257 2403.43,578.4 2405.78,434.013 2408.13,292.684 2410.48,475.92 2412.83,309.549 2415.18,463.651 2417.53,622.066 2419.88,491.522 2422.23,661.841 2424.58,380.627 2426.93,355.346 2429.28,421.746 2431.63,170.564 2433.98,476.427 2436.34,461.173 2438.69,380.728 2441.04,450.661 2443.39,390.365 2445.74,347.306 2448.09,372.991 2450.44,235.703 2452.79,613.257 2455.14,293.943 2457.49,398.885 2459.84,115.604 2462.19,290.217 2464.54,204.466 2466.89,409.417 2469.24,287.767 2471.59,340.625 2473.94,470.916 2476.29,353.781 2478.64,267.418 2480.99,329.549 2483.34,424.815 2485.7,408.329 2488.05,438.258 2490.4,283.411 2492.75,419.107 2495.1,436.504 2497.45,436.737 2499.8,522.79 2502.15,307.116 2504.5,505.763 2506.85,457.024 2509.2,334.142 2511.55,335.444 2513.9,272.654 2516.25,424.828 2518.6,353.026 2520.95,357.361 2523.3,375.255 2525.65,563.271 2528,373.819 2530.35,404.948 2532.7,233.003 2535.06,239.103 2537.41,273.115 2539.76,368.504 2542.11,769.69 2544.46,358.959 2546.81,474.492 2549.16,360.965 2551.51,215.91 2553.86,276.231 2556.21,356.107 2558.56,418.128 2560.91,373.405 2563.26,388.353 2565.61,322.738 2567.96,347.678 2570.31,338.819 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.49329   -3.42458   -4.29134  …  -4.88984   -4.4973    -3.95587
 -0.515177  -0.346531  -1.61546     -0.251394   0.623104   0.060108
  2.69008    5.13447    5.60751      5.42388    4.24699    4.96245

[:, :, 2] =
 -1.74623  -4.16584  -3.71962   -3.71962   …  -4.92863   -5.53201   -3.94055
 -1.50938  -1.15943  -0.698089  -0.698089     -0.999181  -0.876989  -0.37973
  3.07563   2.02233   4.27735    4.27735       5.57684    6.28647    5.70323

[:, :, 3] =
 -3.32134   -4.91506  -4.9534    …  -4.03889   -4.28481   -4.9005
 -0.701844  -1.2116   -0.877138     -0.570239  -0.659066  -0.927156
  2.57584    4.77262   5.99088       5.55934    5.99195    5.7231

[:, :, 4] =
 -2.6046    -4.47837   -4.10437   …  -6.1471    -5.84686   -6.0439
 -0.713222   0.439033   0.780458     -0.855342   0.392058   0.297999
  1.01588    4.64464    4.88783       5.19878    5.04058    5.4281</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.04354      0.994088
  0.000442871  0.995561
  5.01194      0.99196</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.42 seconds
Compute duration  = 2.42 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9834    1.0034    0.0172   3409.8155   4687.1809    1.0002   ⋯
        x[2]    0.0060    0.9991    0.0169   3485.6333   4944.7192    1.0000   ⋯
        x[3]    5.0274    1.0075    0.0175   3313.2378   4798.6896    1.0004   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9497   -5.6533   -5.0095   -4.3142   -2.9420
        x[2]   -1.9549   -0.6649   -0.0077    0.6901    1.9804
        x[3]    3.0578    4.3477    5.0175    5.7129    6.9419</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.47 seconds
Compute duration  = 1.47 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5029    0.1875    0.0028   4272.9193   5701.4209    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1474    0.3648    0.5049    0.6419    0.8544</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.8936    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.8936    0.8936    0.8936    0.8936    0.8936</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.08569975541093466,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.08569975541093466,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/oGEEM/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/93t4P/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/93t4P/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#108
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/93t4P/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/93t4P/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:274 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:265 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:262 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.53 seconds
Compute duration  = 0.53 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.9143    0.6259    0.0450   160.2991   100.3651    1.0110     ⋯
           x   -0.1088    1.1151    0.0744   352.5816   126.7107    1.0073     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1207    0.4156    0.7869    1.2647    2.5013
           x   -3.3108   -0.4755   -0.0340    0.4085    2.0559</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.82 seconds
Compute duration  = 2.82 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8550    0.5630    0.0234   379.8955   155.6767    1.0018     ⋯
           x    0.0005    0.9600    0.0433   594.7536   401.1792    1.0022     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1160    0.4225    0.7364    1.1903    2.2243
           x   -2.1467   -0.4670    0.0026    0.4406    2.0504</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>