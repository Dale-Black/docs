<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.33" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.33</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.33">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.978778082193017</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.978778082193017</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.85865   -5.34023   -4.49034  …  -4.57115    -5.05253   -4.80326
 -0.246959   0.533593  -1.37227     -0.0566763  -0.376432  -0.479378
  1.8821     3.00842    4.18009      6.07241     3.75852    4.90126</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97021    0.993033
 -0.0325088  1.00622
  4.98416    1.00678</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip300">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip300)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip301">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip300)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip302">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip300)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1567.77 2640.76,1567.77 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1256.82 2640.76,1256.82 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,945.871 2640.76,945.871 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,634.92 2640.76,634.92 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,323.97 2640.76,323.97 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1567.77 170.644,1567.77 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1256.82 170.644,1256.82 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,945.871 170.644,945.871 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,634.92 170.644,634.92 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,323.97 170.644,323.97 "></polyline>
<path clip-path="url(#clip300)" d="M49.5521 1568.22 L79.2279 1568.22 L79.2279 1572.16 L49.5521 1572.16 L49.5521 1568.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M99.8991 1565.91 Q96.7509 1565.91 94.8991 1568.06 Q93.0704 1570.21 93.0704 1573.96 Q93.0704 1577.69 94.8991 1579.87 Q96.7509 1582.02 99.8991 1582.02 Q103.047 1582.02 104.876 1579.87 Q106.728 1577.69 106.728 1573.96 Q106.728 1570.21 104.876 1568.06 Q103.047 1565.91 99.8991 1565.91 M109.181 1551.26 L109.181 1555.51 Q107.422 1554.68 105.617 1554.24 Q103.834 1553.8 102.075 1553.8 Q97.4454 1553.8 94.9917 1556.93 Q92.5612 1560.05 92.2139 1566.37 Q93.5797 1564.36 95.6398 1563.29 Q97.7 1562.2 100.177 1562.2 Q105.385 1562.2 108.394 1565.38 Q111.427 1568.52 111.427 1573.96 Q111.427 1579.29 108.279 1582.51 Q105.131 1585.72 99.8991 1585.72 Q93.9037 1585.72 90.7325 1581.14 Q87.5612 1576.53 87.5612 1567.81 Q87.5612 1559.61 91.45 1554.75 Q95.3389 1549.87 101.89 1549.87 Q103.649 1549.87 105.431 1550.21 Q107.237 1550.56 109.181 1551.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M50.3623 1257.27 L80.0381 1257.27 L80.0381 1261.21 L50.3623 1261.21 L50.3623 1257.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M104.297 1255.47 Q107.654 1256.18 109.529 1258.45 Q111.427 1260.72 111.427 1264.06 Q111.427 1269.17 107.908 1271.97 Q104.39 1274.77 97.9083 1274.77 Q95.7324 1274.77 93.4176 1274.33 Q91.126 1273.92 88.6723 1273.06 L88.6723 1268.55 Q90.6167 1269.68 92.9315 1270.26 Q95.2463 1270.84 97.7695 1270.84 Q102.168 1270.84 104.459 1269.1 Q106.774 1267.37 106.774 1264.06 Q106.774 1261 104.621 1259.29 Q102.492 1257.55 98.6722 1257.55 L94.6445 1257.55 L94.6445 1253.71 L98.8574 1253.71 Q102.306 1253.71 104.135 1252.34 Q105.964 1250.95 105.964 1248.36 Q105.964 1245.7 104.066 1244.29 Q102.191 1242.85 98.6722 1242.85 Q96.7509 1242.85 94.5519 1243.27 Q92.3528 1243.68 89.7139 1244.56 L89.7139 1240.4 Q92.376 1239.66 94.6908 1239.29 Q97.0287 1238.92 99.0889 1238.92 Q104.413 1238.92 107.515 1241.35 Q110.617 1243.75 110.617 1247.87 Q110.617 1250.74 108.973 1252.74 Q107.33 1254.7 104.297 1255.47 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M99.4824 931.67 Q95.8713 931.67 94.0426 935.234 Q92.2371 938.776 92.2371 945.906 Q92.2371 953.012 94.0426 956.577 Q95.8713 960.118 99.4824 960.118 Q103.117 960.118 104.922 956.577 Q106.751 953.012 106.751 945.906 Q106.751 938.776 104.922 935.234 Q103.117 931.67 99.4824 931.67 M99.4824 927.966 Q105.293 927.966 108.348 932.572 Q111.427 937.156 111.427 945.906 Q111.427 954.632 108.348 959.239 Q105.293 963.822 99.4824 963.822 Q93.6723 963.822 90.5936 959.239 Q87.538 954.632 87.538 945.906 Q87.538 937.156 90.5936 932.572 Q93.6723 927.966 99.4824 927.966 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M104.297 633.566 Q107.654 634.284 109.529 636.552 Q111.427 638.821 111.427 642.154 Q111.427 647.27 107.908 650.071 Q104.39 652.872 97.9083 652.872 Q95.7324 652.872 93.4176 652.432 Q91.126 652.015 88.6723 651.159 L88.6723 646.645 Q90.6167 647.779 92.9315 648.358 Q95.2463 648.936 97.7695 648.936 Q102.168 648.936 104.459 647.2 Q106.774 645.464 106.774 642.154 Q106.774 639.099 104.621 637.386 Q102.492 635.649 98.6722 635.649 L94.6445 635.649 L94.6445 631.807 L98.8574 631.807 Q102.306 631.807 104.135 630.441 Q105.964 629.052 105.964 626.46 Q105.964 623.798 104.066 622.386 Q102.191 620.95 98.6722 620.95 Q96.7509 620.95 94.5519 621.367 Q92.3528 621.784 89.7139 622.663 L89.7139 618.497 Q92.376 617.756 94.6908 617.386 Q97.0287 617.015 99.0889 617.015 Q104.413 617.015 107.515 619.446 Q110.617 621.853 110.617 625.974 Q110.617 628.844 108.973 630.835 Q107.33 632.802 104.297 633.566 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M99.8991 322.106 Q96.7509 322.106 94.8991 324.259 Q93.0704 326.412 93.0704 330.162 Q93.0704 333.889 94.8991 336.065 Q96.7509 338.217 99.8991 338.217 Q103.047 338.217 104.876 336.065 Q106.728 333.889 106.728 330.162 Q106.728 326.412 104.876 324.259 Q103.047 322.106 99.8991 322.106 M109.181 307.454 L109.181 311.713 Q107.422 310.88 105.617 310.44 Q103.834 310 102.075 310 Q97.4454 310 94.9917 313.125 Q92.5612 316.25 92.2139 322.569 Q93.5797 320.555 95.6398 319.491 Q97.7 318.403 100.177 318.403 Q105.385 318.403 108.394 321.574 Q111.427 324.722 111.427 330.162 Q111.427 335.486 108.279 338.704 Q105.131 341.921 99.8991 341.921 Q93.9037 341.921 90.7325 337.338 Q87.5612 332.731 87.5612 324.005 Q87.5612 315.81 91.45 310.949 Q95.3389 306.065 101.89 306.065 Q103.649 306.065 105.431 306.412 Q107.237 306.759 109.181 307.454 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip302)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1345.82 224.541,1372.73 226.891,1380.4 229.242,1381.37 231.592,1352.56 233.943,1471.46 236.293,1245.92 238.644,1531.1 240.994,1475.78 243.345,1426.25 245.695,1608.06 248.046,1466.09 250.396,1532.56 252.747,1507.43 255.097,1459.7 257.448,1533.95 259.798,1461.42 262.148,1503.5 264.499,1540.86 266.849,1554.96 269.2,1603.99 271.55,1387.66 273.901,1544.31 276.251,1361.38 278.602,1413.29 280.952,1608.86 283.303,1458.37 285.653,1260.51 288.004,1547.52 290.354,1525.88 292.705,1405.67 295.055,1534.56 297.406,1545.5 299.756,1313.51 302.107,1498.34 304.457,1471.69 306.807,1562.86 309.158,1567.32 311.508,1740.73 313.859,1681.89 316.209,1427.01 318.56,1541.42 320.91,1329.94 323.261,1704.82 325.611,1422.9 327.962,1325.38 330.312,1297.43 332.663,1413.62 335.013,1460.31 337.364,1550.18 339.714,1437.99 342.065,1593.12 344.415,1427.3 346.765,1501 349.116,1730.34 351.466,1524.71 353.817,1629.65 356.167,1598.7 358.518,1560.73 360.868,1438.1 363.219,1475.86 365.569,1472.81 367.92,1641.43 370.27,1364.71 372.621,1368.71 374.971,1502.04 377.322,1390.18 379.672,1566.73 382.023,1371.9 384.373,1226.57 386.724,1519.98 389.074,1395.57 391.424,1358.74 393.775,1465 396.125,1659.35 398.476,1415.86 400.826,1411.26 403.177,1311.69 405.527,1511.45 407.878,1443.55 410.228,1451.06 412.579,1533.91 414.929,1460.22 417.28,1483.38 419.63,1510.65 421.981,1270.94 424.331,1432.95 426.682,1513.98 429.032,1700.58 431.382,1507.87 433.733,1553.05 436.083,1607.72 438.434,1300.75 440.784,1490.54 443.135,1422.38 445.485,1433.92 447.836,1416.73 450.186,1561.4 452.537,1412.75 454.887,1505.41 457.238,1364.21 459.588,1438.29 461.939,1495.6 464.289,1438.3 466.64,1522.45 468.99,1335.19 471.341,1569.8 473.691,1609.26 476.041,1400.43 478.392,1573.32 480.742,1491.37 483.093,1587.75 485.443,1564.15 487.794,1391.69 490.144,1569.95 492.495,1432.95 494.845,1398.64 497.196,1445.59 499.546,1404.85 501.897,1439.4 504.247,1425.48 506.598,1379.15 508.948,1606.22 511.299,1534.18 513.649,1493.73 515.999,1382.6 518.35,1558.84 520.7,1442.86 523.051,1532.13 525.401,1449.91 527.752,1639.13 530.102,1469.8 532.453,1505.74 534.803,1527.67 537.154,1542.06 539.504,1544.64 541.855,1668.87 544.205,1475.62 546.556,1474.62 548.906,1342.18 551.257,1364.94 553.607,1556.75 555.958,1312.73 558.308,1487.28 560.658,1668.01 563.009,1448.08 565.359,1428.09 567.71,1521.5 570.06,1447.07 572.411,1490.51 574.761,1478.83 577.112,1510.49 579.462,1486.36 581.813,1406.7 584.163,1407.44 586.514,1570.52 588.864,1511.27 591.215,1442.38 593.565,1430.19 595.916,1436.18 598.266,1286.39 600.616,1414.65 602.967,1542.17 605.317,1437 607.668,1380.31 610.018,1327.92 612.369,1217.33 614.719,1349.19 617.07,1289.62 619.42,1472.92 621.771,1491.22 624.121,1509.95 626.472,1701.8 628.822,1456.87 631.173,1561.76 633.523,1522.33 635.874,1410.14 638.224,1478.61 640.575,1573.88 642.925,1423.19 645.275,1399.29 647.626,1397.24 649.976,1400.22 652.327,1500.8 654.677,1389.23 657.028,1449.34 659.378,1578.15 661.729,1548.5 664.079,1373.11 666.43,1402.09 668.78,1379.69 671.131,1322.02 673.481,1478.68 675.832,1528.08 678.182,1398 680.533,1489.4 682.883,1312.16 685.233,1467.91 687.584,1569.7 689.934,1610.5 692.285,1524.82 694.635,1366.91 696.986,1493.68 699.336,1430.26 701.687,1479.52 704.037,1363.27 706.388,1425.62 708.738,1520.23 711.089,1525.08 713.439,1376.66 715.79,1354.25 718.14,1550.23 720.491,1542.51 722.841,1655.3 725.192,1461.96 727.542,1331.07 729.892,1561.82 732.243,1509.77 734.593,1577.74 736.944,1452.03 739.294,1407.21 741.645,1451.57 743.995,1353.4 746.346,1465.36 748.696,1384.31 751.047,1406.97 753.397,1367.71 755.748,1540.65 758.098,1417.14 760.449,1412.44 762.799,1386.01 765.15,1411.73 767.5,1621.84 769.85,1384.5 772.201,1385.43 774.551,1277.39 776.902,1383.67 779.252,1395.96 781.603,1369.8 783.953,1472.94 786.304,1552.05 788.654,1474.09 791.005,1490.46 793.355,1499.78 795.706,1511.59 798.056,1526.38 800.407,1617.98 802.757,1417.31 805.108,1412.82 807.458,1638.12 809.809,1542.97 812.159,1405.33 814.509,1515.06 816.86,1445.67 819.21,1561.88 821.561,1503.5 823.911,1380.77 826.262,1463.45 828.612,1622.61 830.963,1454.84 833.313,1424.83 835.664,1463.27 838.014,1472.86 840.365,1473.6 842.715,1375.35 845.066,1455.7 847.416,1250.3 849.767,1642.28 852.117,1381.6 854.467,1517.39 856.818,1388.75 859.168,1549.09 861.519,1410.13 863.869,1584.91 866.22,1479.88 868.57,1111.56 870.921,1154.56 873.271,1629.22 875.622,1390.08 877.972,1386.75 880.323,1441.25 882.673,1738 885.024,1518.45 887.374,1270.66 889.725,1332.96 892.075,1443.25 894.426,1344.8 896.776,1484.18 899.126,1441.62 901.477,1421.58 903.827,1508.49 906.178,1525.93 908.528,1637.49 910.879,1550.77 913.229,1355.3 915.58,1454.08 917.93,1600.95 920.281,1502.68 922.631,1419.81 924.982,1382.99 927.332,1507.53 929.683,1465.12 932.033,1440.23 934.384,1343.33 936.734,1394.15 939.084,1496.55 941.435,1557.34 943.785,1307.07 946.136,1449.64 948.486,1507.49 950.837,1194.25 953.187,1480.31 955.538,1485.63 957.888,1555.9 960.239,1264.45 962.589,1430.04 964.94,1329.08 967.29,1450.29 969.641,1424.65 971.991,1402.47 974.342,1426.43 976.692,1368.54 979.043,1472.56 981.393,1578.57 983.743,1464.89 986.094,1376.03 988.444,1327.46 990.795,1366.72 993.145,1569.01 995.496,1350.49 997.846,1461.38 1000.2,1468.03 1002.55,1562.9 1004.9,1517.27 1007.25,1439.77 1009.6,1348.63 1011.95,1390.71 1014.3,1466.09 1016.65,1566.39 1019,1560.52 1021.35,1527.68 1023.7,1372.3 1026.05,1478.08 1028.4,1454.67 1030.75,1498.53 1033.1,1434.8 1035.45,1547.98 1037.8,1482.51 1040.15,1467.14 1042.51,1502.65 1044.86,1506.99 1047.21,1377.83 1049.56,1366.97 1051.91,1513.24 1054.26,1545.98 1056.61,1472.06 1058.96,1240.73 1061.31,1565.02 1063.66,1460.76 1066.01,1472.25 1068.36,1446.02 1070.71,1648.91 1073.06,1529.59 1075.41,1381.9 1077.76,1656.47 1080.11,1563.83 1082.46,1524.91 1084.81,1501.1 1087.16,1416.78 1089.51,1281.35 1091.87,1621.77 1094.22,1422.3 1096.57,1533.88 1098.92,1409.18 1101.27,1527.73 1103.62,1508.28 1105.97,1713.46 1108.32,1277.48 1110.67,1591.09 1113.02,1481.44 1115.37,1619.66 1117.72,1725.26 1120.07,1409.36 1122.42,1478 1124.77,1429.51 1127.12,1481.73 1129.47,1444.83 1131.82,1554.47 1134.17,1472.48 1136.52,1156.97 1138.87,1404.92 1141.23,1409.07 1143.58,1464.66 1145.93,1451.31 1148.28,1472.46 1150.63,1306.71 1152.98,1452.56 1155.33,1465.08 1157.68,1496.89 1160.03,1531.37 1162.38,1573.65 1164.73,1603.05 1167.08,1487.83 1169.43,1365.81 1171.78,1485.6 1174.13,1468.22 1176.48,1602.28 1178.83,1465.65 1181.18,1370.16 1183.53,1414.23 1185.88,1401.1 1188.23,1226.61 1190.59,1547.8 1192.94,1607.8 1195.29,1482.79 1197.64,1466.09 1199.99,1272.71 1202.34,1467.29 1204.69,1356.46 1207.04,1319.49 1209.39,1560.02 1211.74,1533.8 1214.09,1450.2 1216.44,1317.82 1218.79,1601.16 1221.14,1420.67 1223.49,1510.61 1225.84,1277.71 1228.19,1508.78 1230.54,1592.25 1232.89,1417.88 1235.24,1309 1237.59,1669.25 1239.94,1213.42 1242.3,1470.26 1244.65,1493.13 1247,1437.29 1249.35,1428.66 1251.7,1448.3 1254.05,1666.84 1256.4,1432.2 1258.75,1317.17 1261.1,1550.17 1263.45,1578.11 1265.8,1394.36 1268.15,1522.79 1270.5,1494.23 1272.85,1567.7 1275.2,1506.88 1277.55,1581.19 1279.9,1313.68 1282.25,1648.47 1284.6,1360.86 1286.95,1415.32 1289.3,1653.77 1291.66,1335.92 1294.01,1470.88 1296.36,1292.09 1298.71,1539.03 1301.06,1551.92 1303.41,1301.99 1305.76,1468.06 1308.11,1443.23 1310.46,1417.57 1312.81,1585.34 1315.16,1389.93 1317.51,1455.55 1319.86,1415.66 1322.21,1176.58 1324.56,1506.2 1326.91,1351.33 1329.26,1337.02 1331.61,1437.79 1333.96,1350.46 1336.31,1502.23 1338.66,1421.08 1341.02,1434.01 1343.37,1496.27 1345.72,1442.7 1348.07,1701.73 1350.42,1350.37 1352.77,1420.16 1355.12,1580.64 1357.47,1289.14 1359.82,1388.25 1362.17,1545.49 1364.52,1373.02 1366.87,1304.57 1369.22,1487.7 1371.57,1465.28 1373.92,1374.85 1376.27,1226.86 1378.62,1438.1 1380.97,1463.51 1383.32,1569.9 1385.67,1559.92 1388.02,1427.55 1390.38,1516.49 1392.73,1466.82 1395.08,1550.17 1397.43,1607.49 1399.78,1456.78 1402.13,1469.95 1404.48,1515.29 1406.83,1507.09 1409.18,1555.96 1411.53,1573.9 1413.88,1537.36 1416.23,1444.26 1418.58,1298.52 1420.93,1379.56 1423.28,1529.74 1425.63,1336.45 1427.98,1503.13 1430.33,1407.8 1432.68,1566.57 1435.03,1603.67 1437.38,1528.17 1439.74,1318.91 1442.09,1501.49 1444.44,1615.83 1446.79,1390.65 1449.14,1316.95 1451.49,1457.32 1453.84,1233.36 1456.19,1331.47 1458.54,1487.23 1460.89,1536.97 1463.24,1560.78 1465.59,1450.32 1467.94,1702.62 1470.29,1309.55 1472.64,1524.6 1474.99,1436.76 1477.34,1525.93 1479.69,1338.49 1482.04,1346.56 1484.39,1455.92 1486.74,1445.7 1489.1,1468.07 1491.45,1462.22 1493.8,1465.02 1496.15,1583.66 1498.5,1539.92 1500.85,1347.87 1503.2,1497.07 1505.55,1354.07 1507.9,1661.05 1510.25,1461.87 1512.6,1387.1 1514.95,1381.3 1517.3,1536.22 1519.65,1524.47 1522,1354.09 1524.35,1312.51 1526.7,1508.84 1529.05,1493.81 1531.4,1454.79 1533.75,1540.13 1536.1,1312.8 1538.45,1255.59 1540.81,1550.75 1543.16,1472.87 1545.51,1539.8 1547.86,1542.46 1550.21,1351.87 1552.56,1652.76 1554.91,1251.86 1557.26,1441.1 1559.61,1576.64 1561.96,1297.85 1564.31,1319.65 1566.66,1344.44 1569.01,1436.54 1571.36,1443.18 1573.71,1452.65 1576.06,1511.1 1578.41,1491.12 1580.76,1349.31 1583.11,1417.5 1585.46,1621.42 1587.81,1421.01 1590.17,1349.01 1592.52,1402.22 1594.87,1543.38 1597.22,1307.22 1599.57,1170.29 1601.92,1408.33 1604.27,1364.59 1606.62,1351.6 1608.97,1340.33 1611.32,1389.31 1613.67,1504.9 1616.02,1492.25 1618.37,1517.77 1620.72,1388.92 1623.07,1463.74 1625.42,1474.81 1627.77,1488.28 1630.12,1457.59 1632.47,1365.49 1634.82,1317.28 1637.17,1549.96 1639.53,1461.13 1641.88,1530.34 1644.23,1493.89 1646.58,1482.8 1648.93,1371.34 1651.28,1463.23 1653.63,1562.19 1655.98,1334.81 1658.33,1388.53 1660.68,1649.81 1663.03,1524.43 1665.38,1444.08 1667.73,1408.07 1670.08,1538.39 1672.43,1479.29 1674.78,1522.58 1677.13,1505.5 1679.48,1575.78 1681.83,1363.7 1684.18,1508.61 1686.53,1413.47 1688.89,1583.6 1691.24,1393.94 1693.59,1554.61 1695.94,1478.69 1698.29,1311.35 1700.64,1470.02 1702.99,1385.54 1705.34,1598.34 1707.69,1370.95 1710.04,1461.38 1712.39,1546.32 1714.74,1476.15 1717.09,1506.27 1719.44,1286.55 1721.79,1521.41 1724.14,1345.33 1726.49,1275.48 1728.84,1349.54 1731.19,1479.86 1733.54,1428.96 1735.89,1574.07 1738.25,1478.95 1740.6,1663.54 1742.95,1408.86 1745.3,1370.62 1747.65,1425.73 1750,1501.18 1752.35,1412.29 1754.7,1494.07 1757.05,1474.16 1759.4,1368.96 1761.75,1527.54 1764.1,1465.79 1766.45,1287.29 1768.8,1458.37 1771.15,1338.64 1773.5,1250.8 1775.85,1509.93 1778.2,1546.26 1780.55,1455.22 1782.9,1585.4 1785.25,1404.27 1787.6,1593.57 1789.96,1594.78 1792.31,1350.72 1794.66,1413.4 1797.01,1443.08 1799.36,1637.96 1801.71,1406.11 1804.06,1506.04 1806.41,1377.69 1808.76,1504.92 1811.11,1461.97 1813.46,1432.38 1815.81,1465.71 1818.16,1425.66 1820.51,1394.95 1822.86,1531.58 1825.21,1433.84 1827.56,1459.2 1829.91,1441.22 1832.26,1335 1834.61,1443.48 1836.96,1347.5 1839.32,1273.44 1841.67,1545.47 1844.02,1606.25 1846.37,1720.22 1848.72,1357.34 1851.07,1409.9 1853.42,1563.06 1855.77,1599.69 1858.12,1366.13 1860.47,1441.87 1862.82,1544.8 1865.17,1521.21 1867.52,1437.18 1869.87,1342.49 1872.22,1395.52 1874.57,1436.36 1876.92,1560.96 1879.27,1580.93 1881.62,1616.82 1883.97,1529.41 1886.32,1567.86 1888.68,1587.18 1891.03,1239.55 1893.38,1500.21 1895.73,1466.63 1898.08,1533.28 1900.43,1478.46 1902.78,1633.49 1905.13,1599.28 1907.48,1336.94 1909.83,1603.32 1912.18,1577.66 1914.53,1366.65 1916.88,1501.14 1919.23,1380.61 1921.58,1538.59 1923.93,1423.03 1926.28,1401.95 1928.63,1344.1 1930.98,1334.87 1933.33,1464.07 1935.68,1356.49 1938.04,1486.53 1940.39,1638.93 1942.74,1409.11 1945.09,1600.39 1947.44,1364.85 1949.79,1452.93 1952.14,1312.84 1954.49,1426.63 1956.84,1541.22 1959.19,1457.78 1961.54,1570.69 1963.89,1272.12 1966.24,1513.46 1968.59,1584.93 1970.94,1495.07 1973.29,1424.45 1975.64,1494.89 1977.99,1344.6 1980.34,1467.59 1982.69,1291.17 1985.04,1729.72 1987.4,1591.91 1989.75,1633.11 1992.1,1251.27 1994.45,1428.96 1996.8,1421.14 1999.15,1413.45 2001.5,1470.09 2003.85,1391.28 2006.2,1560.65 2008.55,1432.03 2010.9,1553.92 2013.25,1486.06 2015.6,1474.09 2017.95,1341.1 2020.3,1460.63 2022.65,1671.32 2025,1687.17 2027.35,1450.41 2029.7,1360.17 2032.05,1572.1 2034.4,1320.44 2036.76,1442.44 2039.11,1490.2 2041.46,1501.44 2043.81,1520.03 2046.16,1711.53 2048.51,1538.93 2050.86,1229.88 2053.21,1561.17 2055.56,1405.05 2057.91,1258.19 2060.26,1465.71 2062.61,1282.33 2064.96,1407.42 2067.31,1360.3 2069.66,1413.15 2072.01,1445.05 2074.36,1401.4 2076.71,1283.57 2079.06,1435.08 2081.41,1398.22 2083.76,1361.41 2086.11,1547.81 2088.47,1492.07 2090.82,1431.75 2093.17,1407.11 2095.52,1395.84 2097.87,1321.12 2100.22,1496.85 2102.57,1383.55 2104.92,1306.16 2107.27,1410.68 2109.62,1342.48 2111.97,1513.98 2114.32,1603.82 2116.67,1503.07 2119.02,1496.22 2121.37,1547.03 2123.72,1452.31 2126.07,1430.36 2128.42,1595.93 2130.77,1567.03 2133.12,1353.8 2135.47,1415.39 2137.83,1581.14 2140.18,1466.72 2142.53,1499.11 2144.88,1283.71 2147.23,1446.33 2149.58,1617.2 2151.93,1403.36 2154.28,1484.14 2156.63,1404.05 2158.98,1505.67 2161.33,1462.21 2163.68,1460.61 2166.03,1662.86 2168.38,1520.1 2170.73,1492.42 2173.08,1582.97 2175.43,1584.51 2177.78,1445.14 2180.13,1429.43 2182.48,1581.48 2184.83,1654.55 2187.19,1507.42 2189.54,1561.98 2191.89,1487.8 2194.24,1444.28 2196.59,1344.27 2198.94,1364.86 2201.29,1506.77 2203.64,1384.83 2205.99,1452.44 2208.34,1564.83 2210.69,1273.35 2213.04,1554.41 2215.39,1425.97 2217.74,1563.31 2220.09,1565.55 2222.44,1280.05 2224.79,1377.88 2227.14,1546.49 2229.49,1441.42 2231.84,1404.09 2234.19,1274.83 2236.55,1451.57 2238.9,1385.28 2241.25,1384.41 2243.6,1333.05 2245.95,1576.3 2248.3,1589.07 2250.65,1362.64 2253,1361.4 2255.35,1537.96 2257.7,1466.75 2260.05,1522.43 2262.4,1565.49 2264.75,1421.63 2267.1,1584.55 2269.45,1404.55 2271.8,1318.39 2274.15,1451.75 2276.5,1477.56 2278.85,1532.69 2281.2,1452.55 2283.55,1548.27 2285.91,1436.96 2288.26,1221.04 2290.61,1277.12 2292.96,1492.34 2295.31,1279.41 2297.66,1254.47 2300.01,1459.4 2302.36,1345.65 2304.71,1431.78 2307.06,1434.31 2309.41,1472.71 2311.76,1751.15 2314.11,1602.34 2316.46,1499.4 2318.81,1445.91 2321.16,1326.41 2323.51,1338.38 2325.86,1487.18 2328.21,1396.65 2330.56,1409.33 2332.91,1461.57 2335.27,1584.21 2337.62,1510.53 2339.97,1333.2 2342.32,1431.19 2344.67,1650.16 2347.02,1464.11 2349.37,1453.75 2351.72,1450.45 2354.07,1344.82 2356.42,1492.72 2358.77,1458.67 2361.12,1515.64 2363.47,1542.36 2365.82,1609.38 2368.17,1401.48 2370.52,1557.74 2372.87,1488.52 2375.22,1418.87 2377.57,1426.96 2379.92,1391.41 2382.27,1345.14 2384.62,1275.78 2386.98,1434.13 2389.33,1522.61 2391.68,1398.05 2394.03,1338.63 2396.38,1611.95 2398.73,1412.45 2401.08,1493.4 2403.43,1527.01 2405.78,1449.56 2408.13,1412.78 2410.48,1336.73 2412.83,1424.55 2415.18,1520.5 2417.53,1329.72 2419.88,1506.65 2422.23,1420.12 2424.58,1485.37 2426.93,1486.39 2429.28,1410.14 2431.63,1612.29 2433.98,1557.91 2436.34,1409.37 2438.69,1400.25 2441.04,1468.94 2443.39,1526.98 2445.74,1348.12 2448.09,1491.23 2450.44,1560.75 2452.79,1364.7 2455.14,1574.42 2457.49,1429.7 2459.84,1283.69 2462.19,1475.49 2464.54,1394.65 2466.89,1573.51 2469.24,1590.05 2471.59,1477.94 2473.94,1398.46 2476.29,1388.58 2478.64,1590.1 2480.99,1446.7 2483.34,1436.76 2485.7,1355.24 2488.05,1409.81 2490.4,1419.82 2492.75,1234.4 2495.1,1295.51 2497.45,1479.07 2499.8,1371.87 2502.15,1498.69 2504.5,1543.1 2506.85,1716.98 2509.2,1597.99 2511.55,1291.76 2513.9,1481.23 2516.25,1527.5 2518.6,1412.92 2520.95,1401.67 2523.3,1335.33 2525.65,1595.8 2528,1517.59 2530.35,1369.24 2532.7,1343.54 2535.06,1418.56 2537.41,1232.9 2539.76,1452.46 2542.11,1212.6 2544.46,1523.27 2546.81,1555.14 2549.16,1476.65 2551.51,1626.96 2553.86,1354.01 2556.21,1359.14 2558.56,1539.79 2560.91,1385.33 2563.26,1560.1 2565.61,1663.61 2567.96,1275.46 2570.31,1478.04 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,971.468 224.541,973.133 226.891,1191.31 229.242,1116.37 231.592,1045.48 233.943,974.363 236.293,912.494 238.644,1266.7 240.994,964.485 243.345,940.507 245.695,1006.91 248.046,891.875 250.396,968.319 252.747,1016.39 255.097,779.169 257.448,886.097 259.798,781.094 262.148,810.207 264.499,948.015 266.849,813.031 269.2,1106.17 271.55,1036.72 273.901,1135.27 276.251,910.727 278.602,833.822 280.952,929.73 283.303,971.786 285.653,892.471 288.004,943.528 290.354,941.72 292.705,816.606 295.055,900.529 297.406,1127.59 299.756,871.766 302.107,1127.61 304.457,1011.77 306.807,988.602 309.158,957.916 311.508,857.585 313.859,983.693 316.209,983.514 318.56,1028.61 320.91,892.942 323.261,739.385 325.611,839.08 327.962,936.042 330.312,848.247 332.663,1081.31 335.013,1032.22 337.364,972.067 339.714,969.462 342.065,902.411 344.415,923.807 346.765,937.11 349.116,957.739 351.466,905.772 353.817,968.693 356.167,1045.97 358.518,918.135 360.868,1075.45 363.219,736.96 365.569,997.758 367.92,890.287 370.27,980.894 372.621,986.039 374.971,1221.6 377.322,947.892 379.672,883.866 382.023,965.544 384.373,877.61 386.724,1042.38 389.074,966.685 391.424,857.402 393.775,877.771 396.125,976.461 398.476,1087.72 400.826,875.006 403.177,938.488 405.527,993.57 407.878,958.009 410.228,1011.08 412.579,964.83 414.929,1003.98 417.28,1030.89 419.63,896.119 421.981,908.763 424.331,907.34 426.682,871.927 429.032,1043.23 431.382,843.1 433.733,947.804 436.083,939.607 438.434,954.899 440.784,927.79 443.135,858.38 445.485,929.158 447.836,948.716 450.186,1002.55 452.537,751.007 454.887,964.587 457.238,952.857 459.588,1005.57 461.939,1046.61 464.289,884.355 466.64,1007.1 468.99,896.732 471.341,985.812 473.691,920.832 476.041,952.473 478.392,954.812 480.742,961.224 483.093,810.654 485.443,1064.66 487.794,805.098 490.144,721.498 492.495,1027.34 494.845,922.921 497.196,1164.56 499.546,1029.64 501.897,1047.39 504.247,938.297 506.598,1029.16 508.948,1062.15 511.299,1197.23 513.649,973.034 515.999,1028.72 518.35,991.018 520.7,918.865 523.051,776.49 525.401,864.202 527.752,859.661 530.102,957.552 532.453,859.369 534.803,895.1 537.154,813.687 539.504,909.721 541.855,945.427 544.205,969.513 546.556,1022.69 548.906,855.979 551.257,838.061 553.607,910.381 555.958,841.627 558.308,1047.01 560.658,920.67 563.009,764.777 565.359,959.284 567.71,818.016 570.06,875.638 572.411,940.677 574.761,909.912 577.112,978.232 579.462,1052 581.813,834.283 584.163,849.791 586.514,787.518 588.864,922.382 591.215,862.587 593.565,832.359 595.916,863.329 598.266,1002.38 600.616,1004.25 602.967,1009.01 605.317,879.022 607.668,1001.34 610.018,843.68 612.369,1069.07 614.719,1043.41 617.07,784.176 619.42,990.289 621.771,934.966 624.121,1076.89 626.472,952.975 628.822,1156.66 631.173,892.142 633.523,1033.67 635.874,1109.37 638.224,913.418 640.575,1018.61 642.925,903.614 645.275,700.33 647.626,1151.37 649.976,962.915 652.327,998.137 654.677,934.805 657.028,911.03 659.378,890.335 661.729,932.127 664.079,1032.96 666.43,929.007 668.78,1092.85 671.131,963.746 673.481,1090.97 675.832,783.256 678.182,964.206 680.533,781.818 682.883,858.002 685.233,976.007 687.584,776.716 689.934,950.386 692.285,896.784 694.635,1093.33 696.986,1040.57 699.336,1209.16 701.687,913.064 704.037,1044.2 706.388,868.217 708.738,944.041 711.089,814.438 713.439,950.996 715.79,1035.08 718.14,920.653 720.491,786.18 722.841,865.717 725.192,847.48 727.542,909.717 729.892,788.756 732.243,1105.78 734.593,1000.64 736.944,1087.87 739.294,789.925 741.645,1142.92 743.995,783.05 746.346,1034.16 748.696,849.681 751.047,939.549 753.397,850.429 755.748,810.751 758.098,770.925 760.449,1005.14 762.799,896.173 765.15,928.293 767.5,1080.49 769.85,835.062 772.201,887.502 774.551,898.512 776.902,1095.24 779.252,1033.38 781.603,825.372 783.953,997.192 786.304,965.682 788.654,911.546 791.005,1068.96 793.355,1032.6 795.706,1036.08 798.056,857.089 800.407,893.328 802.757,968.122 805.108,1124.87 807.458,984.867 809.809,852.04 812.159,1004.83 814.509,992.716 816.86,1046.87 819.21,867.02 821.561,1040.52 823.911,1094.43 826.262,879.207 828.612,973.183 830.963,1014.45 833.313,928.083 835.664,995.629 838.014,969.321 840.365,890.502 842.715,1084.97 845.066,1086.54 847.416,895.32 849.767,940.884 852.117,1002.06 854.467,1147.7 856.818,947.412 859.168,914.006 861.519,850.503 863.869,1037.19 866.22,924.181 868.57,996.605 870.921,793.426 873.271,861.499 875.622,713.407 877.972,943.434 880.323,825.746 882.673,977.689 885.024,768.593 887.374,909.688 889.725,1015.09 892.075,1082 894.426,846.384 896.776,909.076 899.126,1130.63 901.477,1049.52 903.827,831.243 906.178,840.589 908.528,739.01 910.879,968.081 913.229,905.713 915.58,919.807 917.93,928.623 920.281,897.006 922.631,923.356 924.982,859.155 927.332,995.183 929.683,895.898 932.033,867.655 934.384,923.461 936.734,857.343 939.084,1052.56 941.435,901.607 943.785,1145.58 946.136,995.016 948.486,1061.49 950.837,1019.31 953.187,879.069 955.538,894.385 957.888,923.361 960.239,893.348 962.589,897.505 964.94,984.972 967.29,770.93 969.641,914.426 971.991,914.706 974.342,890.325 976.692,912.61 979.043,819.834 981.393,1047.71 983.743,995.167 986.094,1037.35 988.444,912.776 990.795,865.595 993.145,875.106 995.496,1042.55 997.846,1083.62 1000.2,1051.97 1002.55,775.595 1004.9,947.451 1007.25,964.406 1009.6,964.818 1011.95,954.897 1014.3,951.307 1016.65,1042.47 1019,832.93 1021.35,1014.8 1023.7,908.046 1026.05,915.229 1028.4,944.714 1030.75,1017.81 1033.1,854.552 1035.45,944.104 1037.8,1095.37 1040.15,909.114 1042.51,916.248 1044.86,873.143 1047.21,1048.99 1049.56,928.239 1051.91,1072.08 1054.26,1129.18 1056.61,860.015 1058.96,1080.83 1061.31,993.11 1063.66,946.466 1066.01,858.085 1068.36,900.588 1070.71,818.062 1073.06,957.107 1075.41,914.955 1077.76,960.799 1080.11,1016.08 1082.46,1019.56 1084.81,921.404 1087.16,911.066 1089.51,1029.56 1091.87,845.405 1094.22,843.17 1096.57,852.446 1098.92,974.926 1101.27,1029.8 1103.62,1157.19 1105.97,906.716 1108.32,1029.03 1110.67,919.026 1113.02,773.503 1115.37,1108.33 1117.72,717.538 1120.07,815.01 1122.42,1189.41 1124.77,1047.52 1127.12,955.196 1129.47,900.522 1131.82,881.705 1134.17,828.384 1136.52,935.435 1138.87,1024.65 1141.23,874.844 1143.58,1151.55 1145.93,998.378 1148.28,1157.88 1150.63,1066.16 1152.98,982.34 1155.33,954.44 1157.68,1055.52 1160.03,1056.29 1162.38,963.75 1164.73,886.096 1167.08,901.161 1169.43,920.74 1171.78,1053.38 1174.13,998.373 1176.48,777.235 1178.83,818.731 1181.18,968.335 1183.53,987.778 1185.88,1035.48 1188.23,847.626 1190.59,841.127 1192.94,895.121 1195.29,999.879 1197.64,945.208 1199.99,930.728 1202.34,787.29 1204.69,921.205 1207.04,1031.6 1209.39,1044.93 1211.74,1040.74 1214.09,821.063 1216.44,989.91 1218.79,1131.54 1221.14,815.545 1223.49,1029.02 1225.84,965.689 1228.19,868.399 1230.54,1000.59 1232.89,879.002 1235.24,945.088 1237.59,1019.83 1239.94,1110.54 1242.3,1009.02 1244.65,906.595 1247,1002.76 1249.35,853.368 1251.7,1023.89 1254.05,933.194 1256.4,947.116 1258.75,790.681 1261.1,897.649 1263.45,913.5 1265.8,858.325 1268.15,733.76 1270.5,821.482 1272.85,1008.95 1275.2,986.837 1277.55,964.916 1279.9,839.428 1282.25,816.753 1284.6,963.929 1286.95,977.912 1289.3,941.293 1291.66,893.82 1294.01,944.36 1296.36,1023.25 1298.71,989.915 1301.06,1067.09 1303.41,1085.36 1305.76,1049.98 1308.11,1054.71 1310.46,949.984 1312.81,958.555 1315.16,1032.84 1317.51,1060.94 1319.86,919.483 1322.21,867.165 1324.56,995.227 1326.91,955.449 1329.26,875.003 1331.61,1048.58 1333.96,1099.17 1336.31,1051.8 1338.66,945.628 1341.02,967.692 1343.37,1051.49 1345.72,905.175 1348.07,867.472 1350.42,1071.49 1352.77,939.813 1355.12,949.187 1357.47,866.355 1359.82,905.29 1362.17,1026.12 1364.52,1000.19 1366.87,975.837 1369.22,1039.74 1371.57,1091.9 1373.92,974.258 1376.27,868.604 1378.62,732.154 1380.97,1083.68 1383.32,930.223 1385.67,918.568 1388.02,904.344 1390.38,831.453 1392.73,799.614 1395.08,1076.45 1397.43,829.1 1399.78,953.658 1402.13,1060.71 1404.48,960.685 1406.83,857.373 1409.18,711.001 1411.53,891.406 1413.88,990.135 1416.23,1089.47 1418.58,1069.88 1420.93,820.488 1423.28,788.41 1425.63,798.928 1427.98,1215.7 1430.33,920.819 1432.68,982.948 1435.03,1036.26 1437.38,1080.99 1439.74,1083.01 1442.09,1019.68 1444.44,997.732 1446.79,987.865 1449.14,1003.33 1451.49,831.202 1453.84,916.406 1456.19,908.393 1458.54,905.716 1460.89,833.622 1463.24,877.912 1465.59,917.969 1467.94,814.763 1470.29,934.069 1472.64,968.068 1474.99,1063.98 1477.34,1107.63 1479.69,895.349 1482.04,880.74 1484.39,1062.16 1486.74,982.248 1489.1,934.047 1491.45,1012.13 1493.8,880.374 1496.15,1047.07 1498.5,793.152 1500.85,705.736 1503.2,1047.15 1505.55,968.545 1507.9,1016.57 1510.25,1010.98 1512.6,1015.34 1514.95,1071.92 1517.3,924.516 1519.65,883.586 1522,1110.62 1524.35,998.003 1526.7,955.475 1529.05,901.931 1531.4,916.602 1533.75,770.917 1536.1,1049.24 1538.45,1146.27 1540.81,968.746 1543.16,971.589 1545.51,679.73 1547.86,1081.06 1550.21,882.823 1552.56,820.071 1554.91,837.823 1557.26,996.704 1559.61,849.041 1561.96,994.621 1564.31,1082.79 1566.66,841.714 1569.01,900.183 1571.36,852.805 1573.71,1079.54 1576.06,804.238 1578.41,1048.76 1580.76,971.855 1583.11,1043.18 1585.46,636.823 1587.81,1015.46 1590.17,934.663 1592.52,706.03 1594.87,913.366 1597.22,944.487 1599.57,959.497 1601.92,929.055 1604.27,977.846 1606.62,908.15 1608.97,958.492 1611.32,1069.51 1613.67,1050.93 1616.02,885.39 1618.37,722.318 1620.72,1003.42 1623.07,946.232 1625.42,1142.45 1627.77,899.103 1630.12,885.862 1632.47,1092.58 1634.82,724.12 1637.17,1001.16 1639.53,867.435 1641.88,937.913 1644.23,1031.73 1646.58,1034.95 1648.93,972.381 1651.28,919.897 1653.63,807.462 1655.98,1085.77 1658.33,813.602 1660.68,981.07 1663.03,949.273 1665.38,830.981 1667.73,1086.59 1670.08,862.381 1672.43,879.142 1674.78,987.393 1677.13,1102.04 1679.48,1044.57 1681.83,888.768 1684.18,883.063 1686.53,1055.32 1688.89,903.454 1691.24,1027.94 1693.59,760.646 1695.94,980.043 1698.29,1094.73 1700.64,1030.86 1702.99,1014.52 1705.34,930.823 1707.69,932.457 1710.04,965.6 1712.39,920.615 1714.74,1003.6 1717.09,1063.38 1719.44,918.105 1721.79,866.479 1724.14,883.972 1726.49,1011.6 1728.84,712.742 1731.19,928.169 1733.54,932.889 1735.89,1121.55 1738.25,1022.37 1740.6,987.754 1742.95,913.522 1745.3,839.751 1747.65,976.255 1750,880.918 1752.35,1044.84 1754.7,925.246 1757.05,1061.88 1759.4,988.752 1761.75,897.767 1764.1,1019.82 1766.45,817.732 1768.8,940.606 1771.15,1050.02 1773.5,942.617 1775.85,1017.31 1778.2,914.466 1780.55,814.619 1782.9,941.352 1785.25,882.833 1787.6,954.243 1789.96,856.725 1792.31,853.655 1794.66,948.488 1797.01,838.582 1799.36,769.45 1801.71,942.832 1804.06,879.289 1806.41,889.55 1808.76,1061.94 1811.11,836.803 1813.46,1182.16 1815.81,1066.39 1818.16,974.506 1820.51,1079.05 1822.86,1053.25 1825.21,1025.92 1827.56,1001.28 1829.91,988.461 1832.26,1127.1 1834.61,1013.15 1836.96,1068.76 1839.32,883.317 1841.67,813.535 1844.02,1033.78 1846.37,840.429 1848.72,980.842 1851.07,860.792 1853.42,1101.03 1855.77,910.726 1858.12,744.797 1860.47,858.857 1862.82,915.543 1865.17,1195.53 1867.52,976.34 1869.87,963.291 1872.22,920.551 1874.57,984.218 1876.92,1162.26 1879.27,944.817 1881.62,842.593 1883.97,949.254 1886.32,790.431 1888.68,1040.9 1891.03,775.311 1893.38,1129.06 1895.73,814.318 1898.08,916.883 1900.43,896.858 1902.78,1015.18 1905.13,888.051 1907.48,1034.02 1909.83,1073.66 1912.18,1032.12 1914.53,988.981 1916.88,924.812 1919.23,834.236 1921.58,1033.39 1923.93,960.891 1926.28,1223.1 1928.63,981.817 1930.98,900.691 1933.33,938.636 1935.68,1009.67 1938.04,1064.58 1940.39,925.522 1942.74,972.177 1945.09,797.973 1947.44,856.922 1949.79,1111.77 1952.14,829.185 1954.49,947.68 1956.84,935.84 1959.19,862.546 1961.54,874.378 1963.89,978.157 1966.24,895.388 1968.59,997.747 1970.94,1065.99 1973.29,1067.53 1975.64,967.218 1977.99,898.697 1980.34,894.524 1982.69,1023 1985.04,1140.72 1987.4,1039.73 1989.75,869.143 1992.1,1034.86 1994.45,1043.48 1996.8,642.843 1999.15,864.534 2001.5,811.594 2003.85,914.976 2006.2,751.784 2008.55,928.598 2010.9,939.111 2013.25,1013.86 2015.6,1027.25 2017.95,1088.15 2020.3,961.922 2022.65,991.206 2025,806.394 2027.35,907.34 2029.7,930.501 2032.05,839.298 2034.4,956.783 2036.76,1110.2 2039.11,770.532 2041.46,897.014 2043.81,1055.61 2046.16,884.347 2048.51,956.468 2050.86,913.207 2053.21,995.182 2055.56,922.38 2057.91,1254.75 2060.26,855.931 2062.61,1006.44 2064.96,1058.66 2067.31,1111.84 2069.66,929.676 2072.01,841.709 2074.36,951.71 2076.71,997.654 2079.06,877.018 2081.41,933.223 2083.76,750.627 2086.11,1024.18 2088.47,814.073 2090.82,983.694 2093.17,1181.04 2095.52,954.634 2097.87,907.738 2100.22,1026.57 2102.57,785.688 2104.92,935.369 2107.27,989.601 2109.62,948.759 2111.97,834.186 2114.32,1137.67 2116.67,885.022 2119.02,766.692 2121.37,787.13 2123.72,1049.82 2126.07,1045.61 2128.42,817.574 2130.77,1142.67 2133.12,1022.05 2135.47,663.166 2137.83,1010.57 2140.18,940.191 2142.53,809.627 2144.88,1040.84 2147.23,990.845 2149.58,882.768 2151.93,991.252 2154.28,891.775 2156.63,868.969 2158.98,944.88 2161.33,983.403 2163.68,980.415 2166.03,885.227 2168.38,983.18 2170.73,906.238 2173.08,861.813 2175.43,988.575 2177.78,812.625 2180.13,1017.67 2182.48,843.205 2184.83,1013.03 2187.19,968.061 2189.54,963.692 2191.89,1076.21 2194.24,992.477 2196.59,1041.64 2198.94,1081.08 2201.29,905.378 2203.64,931.469 2205.99,870.6 2208.34,776.864 2210.69,845.259 2213.04,934.911 2215.39,980.096 2217.74,883.629 2220.09,893.981 2222.44,1044.39 2224.79,805.844 2227.14,1024.46 2229.49,1064.26 2231.84,905.128 2234.19,971.204 2236.55,881.755 2238.9,1163.6 2241.25,1047.92 2243.6,1007.26 2245.95,1030.04 2248.3,931.341 2250.65,1037.68 2253,884.473 2255.35,1035.81 2257.7,874.015 2260.05,853.73 2262.4,1130.51 2264.75,768.296 2267.1,897.205 2269.45,850.342 2271.8,828.625 2274.15,813.586 2276.5,995.614 2278.85,835.681 2281.2,1004.77 2283.55,937.188 2285.91,815.676 2288.26,999.479 2290.61,936.315 2292.96,1027.88 2295.31,935.24 2297.66,900.003 2300.01,922.529 2302.36,970.615 2304.71,920.555 2307.06,951.709 2309.41,903.569 2311.76,881.561 2314.11,800.802 2316.46,926.709 2318.81,1089.3 2321.16,1201.59 2323.51,753.937 2325.86,897.899 2328.21,893.548 2330.56,924.634 2332.91,865.266 2335.27,816.972 2337.62,886.124 2339.97,958.948 2342.32,806.922 2344.67,1062.21 2347.02,905.651 2349.37,895.904 2351.72,859.971 2354.07,1047.22 2356.42,1011.37 2358.77,911.789 2361.12,1037.58 2363.47,1066.36 2365.82,983.412 2368.17,943.006 2370.52,948.8 2372.87,1055.87 2375.22,944.452 2377.57,852.208 2379.92,823.505 2382.27,1059.83 2384.62,947.689 2386.98,769.253 2389.33,781.559 2391.68,885.872 2394.03,850.816 2396.38,1035.08 2398.73,1142.99 2401.08,959.088 2403.43,1060.4 2405.78,1173.2 2408.13,911.3 2410.48,849.899 2412.83,896.997 2415.18,1040.72 2417.53,1115.04 2419.88,868.27 2422.23,762.567 2424.58,935.521 2426.93,979.449 2429.28,855.886 2431.63,918.069 2433.98,1130.44 2436.34,963.753 2438.69,999.641 2441.04,1054.08 2443.39,1118.54 2445.74,1018.48 2448.09,823.001 2450.44,863.438 2452.79,846.534 2455.14,1030.82 2457.49,995.946 2459.84,922.728 2462.19,1036.07 2464.54,871.979 2466.89,957.604 2469.24,762.489 2471.59,1013.03 2473.94,1072.22 2476.29,922.066 2478.64,972.712 2480.99,1004.21 2483.34,856.061 2485.7,995.334 2488.05,913.614 2490.4,814.286 2492.75,963.143 2495.1,1052.92 2497.45,928.401 2499.8,961.684 2502.15,886.131 2504.5,710.496 2506.85,1039.28 2509.2,878.184 2511.55,890.481 2513.9,817.16 2516.25,857.825 2518.6,883.306 2520.95,1027.12 2523.3,1040.66 2525.65,949.405 2528,973.413 2530.35,887.823 2532.7,768.139 2535.06,1073.71 2537.41,978.046 2539.76,923.268 2542.11,862.495 2544.46,903.53 2546.81,955.053 2549.16,986.501 2551.51,1089.73 2553.86,1041.3 2556.21,975.249 2558.56,951.451 2560.91,1054.34 2563.26,990.781 2565.61,898.485 2567.96,869.057 2570.31,1047.15 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,750.79 224.541,413.562 226.891,454.989 229.242,466.325 231.592,361.979 233.943,444.803 236.293,372.228 238.644,644.806 240.994,343.218 243.345,419.773 245.695,618.052 248.046,409.525 250.396,455.125 252.747,560.013 255.097,382.128 257.448,516.454 259.798,519.75 262.148,505.671 264.499,428.176 266.849,446.585 269.2,425.298 271.55,600.632 273.901,388.598 276.251,692.428 278.602,538.118 280.952,311.756 283.303,508.809 285.653,576.205 288.004,531.239 290.354,511.835 292.705,643.633 295.055,495.723 297.406,309.596 299.756,567.757 302.107,575.752 304.457,572.75 306.807,219.783 309.158,391.224 311.508,380.397 313.859,240.957 316.209,566.06 318.56,513.233 320.91,204.069 323.261,384.195 325.611,508.532 327.962,318.502 330.312,554.19 332.663,577.826 335.013,382.482 337.364,427.834 339.714,337.377 342.065,650.053 344.415,422.314 346.765,369.468 349.116,470.505 351.466,387.333 353.817,410.967 356.167,453.089 358.518,349.973 360.868,241.605 363.219,370.033 365.569,357.402 367.92,525.23 370.27,505.786 372.621,455.014 374.971,346.121 377.322,488.719 379.672,394.062 382.023,515.789 384.373,454.805 386.724,339.328 389.074,434.507 391.424,435.031 393.775,437.382 396.125,356.642 398.476,325.444 400.826,550.602 403.177,433.913 405.527,482.629 407.878,216.307 410.228,193.441 412.579,526.23 414.929,599.024 417.28,457.544 419.63,457.427 421.981,516.222 424.331,221.144 426.682,336.535 429.032,542.78 431.382,608.447 433.733,453.2 436.083,377.572 438.434,326.648 440.784,399.622 443.135,162.051 445.485,388.137 447.836,329.069 450.186,430.021 452.537,401.433 454.887,361.39 457.238,469.4 459.588,440.768 461.939,513.737 464.289,386.057 466.64,338.283 468.99,385.165 471.341,429.921 473.691,542.198 476.041,613.853 478.392,439.027 480.742,394.071 483.093,312.506 485.443,522.569 487.794,508.852 490.144,276.762 492.495,395.011 494.845,475.585 497.196,376.861 499.546,412.474 501.897,368.484 504.247,288.99 506.598,411.839 508.948,491.563 511.299,359.659 513.649,543.767 515.999,391.763 518.35,536.643 520.7,483.137 523.051,393.497 525.401,379.066 527.752,412.53 530.102,480.547 532.453,494.187 534.803,455.71 537.154,307.345 539.504,502.874 541.855,462.071 544.205,582.172 546.556,541.094 548.906,368.138 551.257,508.732 553.607,463.296 555.958,385.054 558.308,210.735 560.658,588.182 563.009,539.927 565.359,532.839 567.71,538.293 570.06,485.755 572.411,434.514 574.761,393.018 577.112,252.476 579.462,378.724 581.813,413.395 584.163,314.975 586.514,365.703 588.864,550.604 591.215,398.414 593.565,468.42 595.916,454.228 598.266,641.916 600.616,421.79 602.967,342.545 605.317,507.768 607.668,375.406 610.018,391.596 612.369,437.899 614.719,430.606 617.07,343.898 619.42,349.855 621.771,237.699 624.121,216.057 626.472,445.817 628.822,476.448 631.173,352.917 633.523,534.121 635.874,461.732 638.224,211.243 640.575,600.561 642.925,431.885 645.275,485.386 647.626,325.672 649.976,481.155 652.327,408.138 654.677,290.464 657.028,351.998 659.378,513.778 661.729,495.481 664.079,251.44 666.43,273.94 668.78,547.124 671.131,618.146 673.481,608.502 675.832,406.163 678.182,410.805 680.533,376.028 682.883,397.753 685.233,389.116 687.584,661.434 689.934,357.726 692.285,316.579 694.635,373.316 696.986,501.352 699.336,543.967 701.687,429.729 704.037,350.798 706.388,312.005 708.738,571.862 711.089,424.436 713.439,267.001 715.79,343.058 718.14,529.77 720.491,460.41 722.841,372.261 725.192,490.242 727.542,466.928 729.892,271.118 732.243,336.5 734.593,295.601 736.944,391.07 739.294,411.648 741.645,420.084 743.995,345.428 746.346,400.727 748.696,199.66 751.047,521.091 753.397,342.997 755.748,432.462 758.098,469.495 760.449,352.514 762.799,394.822 765.15,246.615 767.5,211.492 769.85,445.087 772.201,377.815 774.551,521.169 776.902,423.283 779.252,378.175 781.603,286.787 783.953,543.131 786.304,595.512 788.654,444.354 791.005,403.86 793.355,522.775 795.706,386.465 798.056,465.724 800.407,398.349 802.757,407.326 805.108,408.455 807.458,430.971 809.809,469.969 812.159,423.68 814.509,300.415 816.86,262.675 819.21,537.213 821.561,312.237 823.911,396.543 826.262,491.367 828.612,536.63 830.963,537.524 833.313,373.392 835.664,247.475 838.014,199.239 840.365,587.216 842.715,632.266 845.066,543.063 847.416,200.582 849.767,407.094 852.117,454.656 854.467,559.073 856.818,535.277 859.168,434.241 861.519,355.131 863.869,427.247 866.22,468.795 868.57,388.451 870.921,171.794 873.271,356.982 875.622,399.67 877.972,496.895 880.323,281.057 882.673,373.685 885.024,395.583 887.374,368.394 889.725,574.693 892.075,217.144 894.426,445.587 896.776,224.13 899.126,375.854 901.477,394.317 903.827,490.693 906.178,494.934 908.528,354.188 910.879,466.691 913.229,438.008 915.58,364.518 917.93,334.739 920.281,360.118 922.631,409.402 924.982,369.375 927.332,345.846 929.683,448.898 932.033,470.456 934.384,286.876 936.734,351.963 939.084,478.703 941.435,449.47 943.785,491.501 946.136,313.214 948.486,326.824 950.837,570.667 953.187,299.512 955.538,432.49 957.888,327.939 960.239,472.781 962.589,309.776 964.94,578.32 967.29,484.422 969.641,469.968 971.991,429.939 974.342,308.142 976.692,448.768 979.043,548.836 981.393,381.211 983.743,479.409 986.094,350.002 988.444,473.532 990.795,595.424 993.145,533.811 995.496,360.014 997.846,333.126 1000.2,472.689 1002.55,404.401 1004.9,266.511 1007.25,444.83 1009.6,437.519 1011.95,509.204 1014.3,513.695 1016.65,381.961 1019,542.062 1021.35,474.408 1023.7,538.933 1026.05,346.227 1028.4,416.939 1030.75,485.084 1033.1,394.613 1035.45,198.704 1037.8,352.75 1040.15,359 1042.51,450.004 1044.86,500.779 1047.21,354.91 1049.56,461.136 1051.91,440.638 1054.26,563.511 1056.61,318.144 1058.96,390.124 1061.31,343.867 1063.66,344.187 1066.01,436.317 1068.36,350.859 1070.71,533.004 1073.06,410.149 1075.41,429.082 1077.76,458.972 1080.11,238.312 1082.46,414.859 1084.81,320.128 1087.16,499.812 1089.51,424.593 1091.87,378.146 1094.22,486.669 1096.57,250.338 1098.92,558.271 1101.27,546.467 1103.62,290.812 1105.97,356.175 1108.32,422.246 1110.67,573.277 1113.02,331.094 1115.37,436 1117.72,419.794 1120.07,567.252 1122.42,562.263 1124.77,450.15 1127.12,370.101 1129.47,354.775 1131.82,555.442 1134.17,547.693 1136.52,534.396 1138.87,507.308 1141.23,498.578 1143.58,406.124 1145.93,418.018 1148.28,695.795 1150.63,470.825 1152.98,658.591 1155.33,368.294 1157.68,372.082 1160.03,299.615 1162.38,417.143 1164.73,399.675 1167.08,391.401 1169.43,357.235 1171.78,631.709 1174.13,549.292 1176.48,501.706 1178.83,380.255 1181.18,548.629 1183.53,354.329 1185.88,331.898 1188.23,321.225 1190.59,254.102 1192.94,360.777 1195.29,452.661 1197.64,328.143 1199.99,204.773 1202.34,298.39 1204.69,190.476 1207.04,156.331 1209.39,473.113 1211.74,605.957 1214.09,573.367 1216.44,510.306 1218.79,397.578 1221.14,532.964 1223.49,485.375 1225.84,312.091 1228.19,502.57 1230.54,382.267 1232.89,567.316 1235.24,315.619 1237.59,485.714 1239.94,339.126 1242.3,321.223 1244.65,612.68 1247,331.579 1249.35,432.978 1251.7,548.403 1254.05,608.242 1256.4,200.107 1258.75,352.798 1261.1,553.919 1263.45,606.003 1265.8,495.394 1268.15,401.117 1270.5,449.292 1272.85,398.905 1275.2,577.757 1277.55,343.856 1279.9,298.333 1282.25,274.86 1284.6,491.663 1286.95,541.654 1289.3,361.629 1291.66,325.552 1294.01,490.68 1296.36,465.083 1298.71,533.866 1301.06,477.103 1303.41,607.887 1305.76,435.416 1308.11,571.545 1310.46,340.339 1312.81,457.169 1315.16,324.365 1317.51,436.508 1319.86,346.016 1322.21,547.34 1324.56,399.473 1326.91,309.091 1329.26,406.048 1331.61,554.325 1333.96,276.079 1336.31,513.279 1338.66,449.323 1341.02,583.884 1343.37,448.574 1345.72,633.748 1348.07,489.761 1350.42,399.88 1352.77,411.053 1355.12,359.224 1357.47,394.931 1359.82,451.942 1362.17,311.498 1364.52,480.894 1366.87,392.258 1369.22,548.633 1371.57,533.446 1373.92,420.537 1376.27,543.321 1378.62,431.252 1380.97,322.579 1383.32,330.627 1385.67,356.744 1388.02,322.704 1390.38,402.38 1392.73,411.398 1395.08,504.838 1397.43,720.943 1399.78,360.735 1402.13,461.892 1404.48,516.849 1406.83,418.103 1409.18,325.715 1411.53,349.54 1413.88,533.34 1416.23,416.558 1418.58,437.47 1420.93,484.523 1423.28,307.275 1425.63,349.385 1427.98,332.694 1430.33,414.285 1432.68,300.172 1435.03,591.628 1437.38,542.736 1439.74,564.728 1442.09,348.173 1444.44,419.139 1446.79,397.958 1449.14,440.594 1451.49,434.4 1453.84,588.133 1456.19,592.305 1458.54,350.469 1460.89,404.301 1463.24,426.488 1465.59,531.103 1467.94,414.936 1470.29,438.352 1472.64,420.332 1474.99,361.499 1477.34,243.378 1479.69,478.749 1482.04,331.577 1484.39,476.681 1486.74,469.019 1489.1,497.45 1491.45,431.024 1493.8,351.31 1496.15,489.147 1498.5,586.514 1500.85,466.62 1503.2,334.796 1505.55,542.804 1507.9,299.922 1510.25,497.913 1512.6,460.466 1514.95,321.68 1517.3,483.938 1519.65,454.775 1522,294.765 1524.35,373.316 1526.7,307.339 1529.05,232.251 1531.4,499.704 1533.75,563.985 1536.1,249.708 1538.45,625.029 1540.81,292.832 1543.16,559.868 1545.51,418.235 1547.86,633.722 1550.21,388.713 1552.56,462.757 1554.91,308.171 1557.26,398.017 1559.61,471.267 1561.96,629.678 1564.31,472.871 1566.66,315.822 1569.01,394.974 1571.36,368.402 1573.71,447.419 1576.06,462.236 1578.41,288.321 1580.76,287.981 1583.11,366.01 1585.46,227.596 1587.81,583.91 1590.17,469.928 1592.52,533.964 1594.87,284.005 1597.22,444.945 1599.57,419.598 1601.92,504.28 1604.27,417.062 1606.62,153.696 1608.97,536.966 1611.32,335.32 1613.67,579.626 1616.02,509.116 1618.37,441.695 1620.72,515.102 1623.07,330.43 1625.42,597.886 1627.77,576.816 1630.12,632.844 1632.47,263.035 1634.82,321.957 1637.17,562.39 1639.53,484.597 1641.88,604.094 1644.23,320.485 1646.58,529.439 1648.93,379.219 1651.28,507.734 1653.63,379.624 1655.98,512.332 1658.33,297.796 1660.68,458.783 1663.03,499.827 1665.38,373.317 1667.73,334.718 1670.08,450.051 1672.43,475.498 1674.78,478.615 1677.13,415.968 1679.48,404.745 1681.83,529.438 1684.18,509.669 1686.53,446.979 1688.89,412.843 1691.24,438.158 1693.59,289.833 1695.94,245.684 1698.29,337.961 1700.64,350.013 1702.99,391.826 1705.34,393.543 1707.69,392.155 1710.04,467.978 1712.39,543.026 1714.74,508.266 1717.09,667.689 1719.44,336.6 1721.79,577.633 1724.14,465.561 1726.49,456.187 1728.84,338.576 1731.19,503.912 1733.54,497.482 1735.89,273.128 1738.25,578.778 1740.6,367.396 1742.95,544.075 1745.3,465.689 1747.65,268.177 1750,335.576 1752.35,445.477 1754.7,551.112 1757.05,394.666 1759.4,538.453 1761.75,319.983 1764.1,456.308 1766.45,435.632 1768.8,418.298 1771.15,340.835 1773.5,577.154 1775.85,194.128 1778.2,334.507 1780.55,518.044 1782.9,388.122 1785.25,388.159 1787.6,374.344 1789.96,558.22 1792.31,437.833 1794.66,401.359 1797.01,535.542 1799.36,461.316 1801.71,421.301 1804.06,287.963 1806.41,419.075 1808.76,475.869 1811.11,512.583 1813.46,479.573 1815.81,628.371 1818.16,481.912 1820.51,571.854 1822.86,447.418 1825.21,705.109 1827.56,405.116 1829.91,562.22 1832.26,335.347 1834.61,483.21 1836.96,575.616 1839.32,408.601 1841.67,397.489 1844.02,340.383 1846.37,305.77 1848.72,413.153 1851.07,587.694 1853.42,382.602 1855.77,557.018 1858.12,475.988 1860.47,290.477 1862.82,299.749 1865.17,367.536 1867.52,449.337 1869.87,454.926 1872.22,347.716 1874.57,681.466 1876.92,375.085 1879.27,245.783 1881.62,439.741 1883.97,288.495 1886.32,362.263 1888.68,503.704 1891.03,323.754 1893.38,555.949 1895.73,432.406 1898.08,560.179 1900.43,434.963 1902.78,437.13 1905.13,470.895 1907.48,446.696 1909.83,460.775 1912.18,410.553 1914.53,515.21 1916.88,498.183 1919.23,270.526 1921.58,513.353 1923.93,409.332 1926.28,499.375 1928.63,321.486 1930.98,470.967 1933.33,533.538 1935.68,481.884 1938.04,429.515 1940.39,299.236 1942.74,330.687 1945.09,490.948 1947.44,589.528 1949.79,326.374 1952.14,320.397 1954.49,335.889 1956.84,428.77 1959.19,290.47 1961.54,187.607 1963.89,486.293 1966.24,503.289 1968.59,266.357 1970.94,543.192 1973.29,419.764 1975.64,436.961 1977.99,416.778 1980.34,535.762 1982.69,242.675 1985.04,290.249 1987.4,555.972 1989.75,459.667 1992.1,490.047 1994.45,327.326 1996.8,532.413 1999.15,477.469 2001.5,576.908 2003.85,513.715 2006.2,203.483 2008.55,457.564 2010.9,300.072 2013.25,305.114 2015.6,398.324 2017.95,338.449 2020.3,484.881 2022.65,220.451 2025,610.189 2027.35,507.106 2029.7,550.985 2032.05,507.397 2034.4,397.421 2036.76,506.661 2039.11,457.146 2041.46,349.088 2043.81,650.59 2046.16,535.455 2048.51,552.28 2050.86,502.575 2053.21,329.1 2055.56,479.018 2057.91,338.627 2060.26,399.434 2062.61,512.391 2064.96,404.63 2067.31,272.286 2069.66,465.786 2072.01,328.066 2074.36,435.407 2076.71,245.601 2079.06,457.521 2081.41,496.059 2083.76,400.786 2086.11,452.693 2088.47,299.378 2090.82,280.461 2093.17,467.513 2095.52,326.342 2097.87,350.229 2100.22,430.518 2102.57,521.527 2104.92,403.209 2107.27,286.772 2109.62,427.304 2111.97,590.342 2114.32,96.8724 2116.67,478.161 2119.02,545.207 2121.37,332.225 2123.72,456.593 2126.07,391.492 2128.42,343.621 2130.77,201.136 2133.12,437.07 2135.47,327.831 2137.83,561.448 2140.18,312.002 2142.53,590.781 2144.88,598.589 2147.23,436.308 2149.58,346.028 2151.93,230.699 2154.28,416.5 2156.63,526.468 2158.98,353.783 2161.33,428.069 2163.68,331.57 2166.03,465.883 2168.38,449.388 2170.73,361.683 2173.08,356.145 2175.43,548.236 2177.78,392.687 2180.13,321.611 2182.48,336.103 2184.83,324.424 2187.19,409.906 2189.54,423.554 2191.89,464.839 2194.24,446.802 2196.59,358.614 2198.94,368.066 2201.29,465.857 2203.64,460.362 2205.99,639.025 2208.34,343.269 2210.69,227.129 2213.04,584.191 2215.39,446.469 2217.74,574.323 2220.09,398.985 2222.44,395.134 2224.79,557.595 2227.14,524.473 2229.49,490.493 2231.84,230.015 2234.19,452.239 2236.55,526.376 2238.9,534.061 2241.25,220.484 2243.6,610.44 2245.95,472.588 2248.3,422.896 2250.65,321.749 2253,412.605 2255.35,517.879 2257.7,333.363 2260.05,503.693 2262.4,662.934 2264.75,549.918 2267.1,381.38 2269.45,437.458 2271.8,401.62 2274.15,281.975 2276.5,339.606 2278.85,500.253 2281.2,606.69 2283.55,456.237 2285.91,486.195 2288.26,533.625 2290.61,355.327 2292.96,464.317 2295.31,328.037 2297.66,368.585 2300.01,471.675 2302.36,467.647 2304.71,583.82 2307.06,588.329 2309.41,556.835 2311.76,526.125 2314.11,191.72 2316.46,488.314 2318.81,568.824 2321.16,247.349 2323.51,486.885 2325.86,420.165 2328.21,503.08 2330.56,542.379 2332.91,579.54 2335.27,383.766 2337.62,421.708 2339.97,632.815 2342.32,300.629 2344.67,261.713 2347.02,535.317 2349.37,418.236 2351.72,451.238 2354.07,386.315 2356.42,455.269 2358.77,479.578 2361.12,510.908 2363.47,447.081 2365.82,330.937 2368.17,533.705 2370.52,438.922 2372.87,344.793 2375.22,524.975 2377.57,398.315 2379.92,473.692 2382.27,410.301 2384.62,313.724 2386.98,484.237 2389.33,501.612 2391.68,453.532 2394.03,479.826 2396.38,426.095 2398.73,506.9 2401.08,475.361 2403.43,532.207 2405.78,339.605 2408.13,610.569 2410.48,383.892 2412.83,460.732 2415.18,430.02 2417.53,501.16 2419.88,332.234 2422.23,446.842 2424.58,424.773 2426.93,411.855 2429.28,492.063 2431.63,475.074 2433.98,346.109 2436.34,385.39 2438.69,261.044 2441.04,560.715 2443.39,520.408 2445.74,489.129 2448.09,417.412 2450.44,597.039 2452.79,340.934 2455.14,483.515 2457.49,314.401 2459.84,374.839 2462.19,521.959 2464.54,408.708 2466.89,494.192 2469.24,466.79 2471.59,393.609 2473.94,468.451 2476.29,450.035 2478.64,534.926 2480.99,317.38 2483.34,307.495 2485.7,385.658 2488.05,280.298 2490.4,472.463 2492.75,282.604 2495.1,436.497 2497.45,396.481 2499.8,668.556 2502.15,252.538 2504.5,520.367 2506.85,420.973 2509.2,306.015 2511.55,398.968 2513.9,529.718 2516.25,314.126 2518.6,345.073 2520.95,455.702 2523.3,288.151 2525.65,616.15 2528,314.484 2530.35,408.439 2532.7,636.204 2535.06,448.358 2537.41,464.897 2539.76,277.695 2542.11,478.908 2544.46,359.693 2546.81,457.54 2549.16,422.014 2551.51,580.162 2553.86,459.094 2556.21,423.647 2558.56,328.883 2560.91,570.019 2563.26,432.248 2565.61,456.851 2567.96,454.259 2570.31,341.558 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.64394   -2.67902  -2.75338  -3.33263   …  -3.95118  -4.36944   -5.22406
  0.345461  -2.03412  -0.64877  -0.138031      1.51799   0.363022  -0.419686
  1.58522    3.78606   4.86249   5.99765       4.79192   4.84404    4.24701

[:, :, 2] =
 -3.43638  -4.76898   -5.07561  -5.07561  …  -4.34945   -5.61149   -5.21192
  1.76653  -0.211969  -0.21025  -0.21025      0.116998   0.188126  -0.219663
  2.02424   2.8897     4.55526   4.55526      3.3609     5.15492    6.03855

[:, :, 3] =
 -0.205     -4.15432  -3.19529   -5.71377    …  -4.0711   -4.0711   -4.32882
 -1.56238   -1.45611   0.588724   0.0752993      1.13257   1.13257   2.13894
  0.732904   3.72786   4.99524    3.02732        5.32211   5.32211   4.25995

[:, :, 4] =
 -2.40563   -4.49224  -4.63828   -4.63828   …  -4.35     -3.74945   -4.6461
 -0.550705   0.1728   -0.404499  -0.404499      1.16195   0.663247   0.602358
  2.61828    3.89317   5.16917    5.16917       4.87668   5.07808    3.38947</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01808    1.01187
  0.0100642  0.993688
  5.01258    1.00263</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.51 seconds
Compute duration  = 2.51 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9791    1.0043    0.0174   3345.9666   5317.8083    1.0001   ⋯
        x[2]   -0.0126    0.9905    0.0182   2948.6495   4799.4119    1.0005   ⋯
        x[3]    4.9892    1.0125    0.0179   3188.5784   5448.3457    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9559   -5.6568   -4.9820   -4.3132   -2.9987
        x[2]   -1.9407   -0.6813   -0.0222    0.6566    1.9362
        x[3]    2.9977    4.3136    4.9933    5.6606    6.9950</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.5 seconds
Compute duration  = 1.5 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4977    0.1884    0.0028   4367.6213   5723.0926    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1435    0.3604    0.4993    0.6341    0.8502</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.26 seconds
Compute duration  = 0.26 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk   ess_tail      rhat    ⋯
      Symbol   Float64   Float64   Float64     Float64    Float64   Float64    ⋯

           x    0.1555    0.0409    0.0013   1024.4160        NaN    1.0008    ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1567    0.1567    0.1567    0.1567    0.1567</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-1.4958665807626441, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -1.4958665807626441:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/oGEEM/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/93t4P/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/93t4P/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/93t4P/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:341
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:224
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/93t4P/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/93t4P/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:274 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:265 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:262 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.69 seconds
Compute duration  = 1.69 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8175    0.5506    0.0311   157.0466    52.1096    1.0007     ⋯
           x   -0.0304    0.9406    0.0488   464.9347   440.3683    1.0067     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0511    0.3838    0.7050    1.1656    2.1133
           x   -1.9658   -0.4299   -0.0027    0.3691    2.0758</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.02 seconds
Compute duration  = 3.02 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8450    0.5453    0.0218   478.4321   197.6038    1.0017     ⋯
           x   -0.0015    0.9657    0.0447   592.6464   594.7945    1.0028     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1304    0.4073    0.7352    1.1770    2.0989
           x   -2.0546   -0.4038   -0.0031    0.4543    1.8749</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>