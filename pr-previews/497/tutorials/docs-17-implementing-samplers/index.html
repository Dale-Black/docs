<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.33" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.33</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.33">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-31.130830019121376</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-31.130830019121376</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.24436   -1.89166  -7.18043   -6.15217  …  -5.08857  -4.93141   -4.86551
  0.652769   1.22487   0.624513  -0.22298     -1.25863  -0.641085  -1.05095
  3.04862    4.77079   4.94469    5.83331      3.05766   2.5981     3.50123</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00418     1.00296
 -0.00571828  0.992589
  4.98298     1.01744</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip090">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip090)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip091">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip090)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip092">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip090)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1524.36 2640.76,1524.36 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1218.01 2640.76,1218.01 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,911.653 2640.76,911.653 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,605.297 2640.76,605.297 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,298.942 2640.76,298.942 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1524.36 170.644,1524.36 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1218.01 170.644,1218.01 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,911.653 170.644,911.653 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,605.297 170.644,605.297 "></polyline>
<polyline clip-path="url(#clip090)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,298.942 170.644,298.942 "></polyline>
<path clip-path="url(#clip090)" d="M49.5521 1524.81 L79.2279 1524.81 L79.2279 1528.75 L49.5521 1528.75 L49.5521 1524.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M99.8991 1522.5 Q96.7509 1522.5 94.8991 1524.65 Q93.0704 1526.81 93.0704 1530.56 Q93.0704 1534.28 94.8991 1536.46 Q96.7509 1538.61 99.8991 1538.61 Q103.047 1538.61 104.876 1536.46 Q106.728 1534.28 106.728 1530.56 Q106.728 1526.81 104.876 1524.65 Q103.047 1522.5 99.8991 1522.5 M109.181 1507.85 L109.181 1512.11 Q107.422 1511.27 105.617 1510.83 Q103.834 1510.39 102.075 1510.39 Q97.4454 1510.39 94.9917 1513.52 Q92.5612 1516.64 92.2139 1522.96 Q93.5797 1520.95 95.6398 1519.88 Q97.7 1518.8 100.177 1518.8 Q105.385 1518.8 108.394 1521.97 Q111.427 1525.12 111.427 1530.56 Q111.427 1535.88 108.279 1539.1 Q105.131 1542.31 99.8991 1542.31 Q93.9037 1542.31 90.7325 1537.73 Q87.5612 1533.12 87.5612 1524.4 Q87.5612 1516.2 91.45 1511.34 Q95.3389 1506.46 101.89 1506.46 Q103.649 1506.46 105.431 1506.81 Q107.237 1507.15 109.181 1507.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M50.3623 1218.46 L80.0381 1218.46 L80.0381 1222.39 L50.3623 1222.39 L50.3623 1218.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M104.297 1216.65 Q107.654 1217.37 109.529 1219.64 Q111.427 1221.91 111.427 1225.24 Q111.427 1230.36 107.908 1233.16 Q104.39 1235.96 97.9083 1235.96 Q95.7324 1235.96 93.4176 1235.52 Q91.126 1235.1 88.6723 1234.25 L88.6723 1229.73 Q90.6167 1230.87 92.9315 1231.45 Q95.2463 1232.02 97.7695 1232.02 Q102.168 1232.02 104.459 1230.29 Q106.774 1228.55 106.774 1225.24 Q106.774 1222.19 104.621 1220.47 Q102.492 1218.74 98.6722 1218.74 L94.6445 1218.74 L94.6445 1214.89 L98.8574 1214.89 Q102.306 1214.89 104.135 1213.53 Q105.964 1212.14 105.964 1209.55 Q105.964 1206.89 104.066 1205.47 Q102.191 1204.04 98.6722 1204.04 Q96.7509 1204.04 94.5519 1204.45 Q92.3528 1204.87 89.7139 1205.75 L89.7139 1201.58 Q92.376 1200.84 94.6908 1200.47 Q97.0287 1200.1 99.0889 1200.1 Q104.413 1200.1 107.515 1202.53 Q110.617 1204.94 110.617 1209.06 Q110.617 1211.93 108.973 1213.92 Q107.33 1215.89 104.297 1216.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M99.4824 897.451 Q95.8713 897.451 94.0426 901.016 Q92.2371 904.558 92.2371 911.687 Q92.2371 918.794 94.0426 922.358 Q95.8713 925.9 99.4824 925.9 Q103.117 925.9 104.922 922.358 Q106.751 918.794 106.751 911.687 Q106.751 904.558 104.922 901.016 Q103.117 897.451 99.4824 897.451 M99.4824 893.748 Q105.293 893.748 108.348 898.354 Q111.427 902.937 111.427 911.687 Q111.427 920.414 108.348 925.021 Q105.293 929.604 99.4824 929.604 Q93.6723 929.604 90.5936 925.021 Q87.538 920.414 87.538 911.687 Q87.538 902.937 90.5936 898.354 Q93.6723 893.748 99.4824 893.748 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M104.297 603.943 Q107.654 604.661 109.529 606.929 Q111.427 609.198 111.427 612.531 Q111.427 617.647 107.908 620.448 Q104.39 623.248 97.9083 623.248 Q95.7324 623.248 93.4176 622.809 Q91.126 622.392 88.6723 621.535 L88.6723 617.022 Q90.6167 618.156 92.9315 618.735 Q95.2463 619.313 97.7695 619.313 Q102.168 619.313 104.459 617.577 Q106.774 615.841 106.774 612.531 Q106.774 609.475 104.621 607.762 Q102.492 606.026 98.6722 606.026 L94.6445 606.026 L94.6445 602.184 L98.8574 602.184 Q102.306 602.184 104.135 600.818 Q105.964 599.429 105.964 596.837 Q105.964 594.174 104.066 592.762 Q102.191 591.327 98.6722 591.327 Q96.7509 591.327 94.5519 591.744 Q92.3528 592.161 89.7139 593.04 L89.7139 588.874 Q92.376 588.133 94.6908 587.762 Q97.0287 587.392 99.0889 587.392 Q104.413 587.392 107.515 589.823 Q110.617 592.23 110.617 596.35 Q110.617 599.221 108.973 601.211 Q107.33 603.179 104.297 603.943 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip090)" d="M99.8991 297.078 Q96.7509 297.078 94.8991 299.231 Q93.0704 301.384 93.0704 305.134 Q93.0704 308.861 94.8991 311.037 Q96.7509 313.189 99.8991 313.189 Q103.047 313.189 104.876 311.037 Q106.728 308.861 106.728 305.134 Q106.728 301.384 104.876 299.231 Q103.047 297.078 99.8991 297.078 M109.181 282.426 L109.181 286.685 Q107.422 285.852 105.617 285.412 Q103.834 284.972 102.075 284.972 Q97.4454 284.972 94.9917 288.097 Q92.5612 291.222 92.2139 297.541 Q93.5797 295.527 95.6398 294.463 Q97.7 293.375 100.177 293.375 Q105.385 293.375 108.394 296.546 Q111.427 299.694 111.427 305.134 Q111.427 310.458 108.279 313.675 Q105.131 316.893 99.8991 316.893 Q93.9037 316.893 90.7325 312.31 Q87.5612 307.703 87.5612 298.976 Q87.5612 290.782 91.45 285.921 Q95.3389 281.037 101.89 281.037 Q103.649 281.037 105.431 281.384 Q107.237 281.731 109.181 282.426 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip092)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1038.72 224.541,1317.83 226.891,1339.82 229.242,1425.24 231.592,1361.64 233.943,1592.07 236.293,1319.2 238.644,1405.71 240.994,1315.38 243.345,1563.88 245.695,1352.62 248.046,1731.97 250.396,1529.83 252.747,1306.85 255.097,1338.58 257.448,1297.05 259.798,1295.18 262.148,1516.96 264.499,1327.21 266.849,1413.58 269.2,1657.97 271.55,1398.04 273.901,1532.28 276.251,1713.63 278.602,1324.44 280.952,1357.2 283.303,1325.2 285.653,1378.22 288.004,1450.96 290.354,1413.26 292.705,1411.22 295.055,1597.8 297.406,1570.27 299.756,1576.86 302.107,1484.95 304.457,1270.56 306.807,1399.13 309.158,1279.66 311.508,1311.85 313.859,1268.08 316.209,1535.97 318.56,1462.99 320.91,1287.47 323.261,1557.87 325.611,1473.54 327.962,1303.02 330.312,1337.28 332.663,1385.73 335.013,1357.62 337.364,1364.63 339.714,1338.23 342.065,1274.49 344.415,1487.94 346.765,1481.36 349.116,1409.76 351.466,1444.1 353.817,1398.13 356.167,1473.07 358.518,1375.36 360.868,1381.98 363.219,1448.84 365.569,1331.11 367.92,1376.84 370.27,1393.18 372.621,1356.51 374.971,1431.95 377.322,1449.1 379.672,1344.13 382.023,1451.68 384.373,1471.85 386.724,1355.17 389.074,1518.38 391.424,1581.76 393.775,1434.46 396.125,1285.22 398.476,1449.23 400.826,1444.62 403.177,1333.25 405.527,1299.77 407.878,1476.89 410.228,1525.2 412.579,1514.17 414.929,1389.39 417.28,1377.47 419.63,1588.32 421.981,1567.13 424.331,1283.29 426.682,1438.41 429.032,1301.85 431.382,1377.54 433.733,1398.2 436.083,1382.86 438.434,1552.93 440.784,1263.58 443.135,1473.6 445.485,1420.62 447.836,1234.9 450.186,1350.51 452.537,1160.08 454.887,1520.06 457.238,1402.9 459.588,1324.82 461.939,1383.51 464.289,1433.63 466.64,1475.04 468.99,1261.48 471.341,1425.42 473.691,1361.5 476.041,1394.18 478.392,1355.48 480.742,1354.8 483.093,1308.93 485.443,1422.6 487.794,1294.29 490.144,1205.69 492.495,1419.12 494.845,1252.76 497.196,1552.47 499.546,1379.53 501.897,1283.13 504.247,1475.21 506.598,1371.94 508.948,1494.25 511.299,1394.47 513.649,1503.58 515.999,1411.88 518.35,1448.13 520.7,1278.26 523.051,1372.52 525.401,1315.11 527.752,1331.19 530.102,1318.46 532.453,1508.16 534.803,1403.17 537.154,1455.69 539.504,1512.39 541.855,1489.83 544.205,1466.09 546.556,1230.26 548.906,1390.48 551.257,1338.28 553.607,1545.59 555.958,1547.5 558.308,1529.82 560.658,1417.41 563.009,1491.55 565.359,1464.29 567.71,1410.54 570.06,1470.78 572.411,1535.07 574.761,1437.58 577.112,1256.95 579.462,1371.56 581.813,1231.36 584.163,1177.72 586.514,1448.52 588.864,1524.94 591.215,1438.32 593.565,1546.56 595.916,1510.72 598.266,1357.2 600.616,1259.75 602.967,1408.17 605.317,1396.89 607.668,1456.4 610.018,1328.13 612.369,1475.91 614.719,1284.38 617.07,1327.14 619.42,1347.29 621.771,1436.96 624.121,1397.65 626.472,1382.81 628.822,1384.83 631.173,1461.7 633.523,1439.94 635.874,1638.6 638.224,1218.04 640.575,1367.31 642.925,1297.19 645.275,1526.5 647.626,1594.52 649.976,1484.96 652.327,1506.6 654.677,1586.04 657.028,1433.23 659.378,1373.58 661.729,1531.19 664.079,1483.29 666.43,1412.22 668.78,1407.46 671.131,1600.33 673.481,1597.79 675.832,1357.52 678.182,1532.23 680.533,1705.91 682.883,1399.54 685.233,1414.17 687.584,1325.51 689.934,1477.56 692.285,1525.94 694.635,1590.33 696.986,1272.12 699.336,1411.52 701.687,1253.29 704.037,1573.88 706.388,1493.41 708.738,1507.69 711.089,1430.39 713.439,1473.05 715.79,1526.55 718.14,1416.8 720.491,1344.49 722.841,1296.38 725.192,1302.7 727.542,1366.75 729.892,1406.89 732.243,1453.52 734.593,1461.35 736.944,1556.18 739.294,1417.25 741.645,1302.08 743.995,1214.4 746.346,1331.24 748.696,1473.17 751.047,1437.04 753.397,1508.87 755.748,1510.73 758.098,1400.98 760.449,1596.4 762.799,1347.65 765.15,1463.23 767.5,1338.95 769.85,1485.11 772.201,1336.5 774.551,1357.72 776.902,1499.02 779.252,1533.37 781.603,1615.62 783.953,1403.53 786.304,1358.1 788.654,1459.79 791.005,1519.46 793.355,1443.61 795.706,1423.71 798.056,1388.55 800.407,1208.53 802.757,1427.7 805.108,1612.31 807.458,1344.56 809.809,1402.68 812.159,1445.23 814.509,1574.93 816.86,1412.51 819.21,1331.86 821.561,1476.23 823.911,1470.81 826.262,1523.06 828.612,1513.33 830.963,1362.14 833.313,1466.72 835.664,1566.26 838.014,1390.13 840.365,1496.87 842.715,1431.36 845.066,1384.58 847.416,1470.1 849.767,1346.44 852.117,1268.47 854.467,1286.52 856.818,1424.29 859.168,1407.83 861.519,1389.06 863.869,1439.95 866.22,1268.94 868.57,1574.39 870.921,1400.92 873.271,1295.05 875.622,1301.8 877.972,1442.89 880.323,1451.37 882.673,1495.12 885.024,1340.06 887.374,1426.29 889.725,1347.34 892.075,1391.48 894.426,1597.72 896.776,1425.15 899.126,1446.36 901.477,1245.6 903.827,1416.84 906.178,1441.8 908.528,1426.71 910.879,1571.81 913.229,1580.36 915.58,1212.19 917.93,1337.45 920.281,1570.1 922.631,1495.65 924.982,1343.32 927.332,1287.23 929.683,1458.66 932.033,1459.3 934.384,1223.69 936.734,1472.08 939.084,1409.47 941.435,1627.27 943.785,1512.56 946.136,1399.55 948.486,1418.52 950.837,1453.17 953.187,1351.28 955.538,1388.47 957.888,1494.76 960.239,1626.25 962.589,1527.52 964.94,1456.56 967.29,1396.58 969.641,1354.59 971.991,1268.44 974.342,1601.74 976.692,1448.07 979.043,1267.37 981.393,1484.96 983.743,1600.36 986.094,1319.48 988.444,1364.22 990.795,1570.01 993.145,1442.44 995.496,1457.28 997.846,1416.05 1000.2,1655.46 1002.55,1580.04 1004.9,1325.93 1007.25,1520.79 1009.6,1474.36 1011.95,1472.53 1014.3,1361.46 1016.65,1213.9 1019,1214.31 1021.35,1436.32 1023.7,1497.33 1026.05,1312.39 1028.4,1465.63 1030.75,1294.64 1033.1,1454.42 1035.45,1376.16 1037.8,1349.02 1040.15,1342.9 1042.51,1578.91 1044.86,1518.75 1047.21,1286.83 1049.56,1488.84 1051.91,1384.43 1054.26,1496.23 1056.61,1350.04 1058.96,1233.93 1061.31,1431.92 1063.66,1332.73 1066.01,1375.05 1068.36,1355.52 1070.71,1458.96 1073.06,1450.46 1075.41,1324.43 1077.76,1443.01 1080.11,1264.88 1082.46,1492.46 1084.81,1401.62 1087.16,1512.36 1089.51,1476.63 1091.87,1385.79 1094.22,1513.33 1096.57,1384.76 1098.92,1517.01 1101.27,1485.52 1103.62,1467.47 1105.97,1187.52 1108.32,1379.21 1110.67,1474.43 1113.02,1344.85 1115.37,1416.94 1117.72,1333.78 1120.07,1357.44 1122.42,1495.18 1124.77,1229.43 1127.12,1663.79 1129.47,1355.5 1131.82,1426.39 1134.17,1515.61 1136.52,1451.98 1138.87,1583.06 1141.23,1431.33 1143.58,1306.63 1145.93,1487.2 1148.28,1573.58 1150.63,1662.78 1152.98,1456.9 1155.33,1412.89 1157.68,1396.22 1160.03,1437.51 1162.38,1340.18 1164.73,1593.17 1167.08,1509.09 1169.43,1452.77 1171.78,1492.76 1174.13,1489.22 1176.48,1393.1 1178.83,1616.74 1181.18,1561.43 1183.53,1461.87 1185.88,1502.85 1188.23,1279.7 1190.59,1363.38 1192.94,1439.67 1195.29,1238.09 1197.64,1391.85 1199.99,1490.2 1202.34,1584.03 1204.69,1591.09 1207.04,1250.47 1209.39,1654.43 1211.74,1361.91 1214.09,1402.83 1216.44,1525.73 1218.79,1549.27 1221.14,1218.05 1223.49,1450.34 1225.84,1108.16 1228.19,1347.43 1230.54,1415.46 1232.89,1325.27 1235.24,1302.81 1237.59,1448.63 1239.94,1439.42 1242.3,1455.49 1244.65,1492.32 1247,1358.97 1249.35,1276.54 1251.7,1410.38 1254.05,1477.45 1256.4,1244.83 1258.75,1489.69 1261.1,1309.94 1263.45,1276.85 1265.8,1443.97 1268.15,1382.93 1270.5,1502.47 1272.85,1359.74 1275.2,1283.22 1277.55,1542.74 1279.9,1425.39 1282.25,1574.34 1284.6,1341.15 1286.95,1474 1289.3,1646.99 1291.66,1321.13 1294.01,1452.63 1296.36,1504.18 1298.71,1358.04 1301.06,1454.95 1303.41,1276.41 1305.76,1307.55 1308.11,1427.24 1310.46,1368.71 1312.81,1403.14 1315.16,1486.57 1317.51,1421.98 1319.86,1479.75 1322.21,1486.95 1324.56,1332.32 1326.91,1342.59 1329.26,1337.03 1331.61,1458.2 1333.96,1486.05 1336.31,1474.97 1338.66,1435.02 1341.02,1445.4 1343.37,1532.45 1345.72,1373.89 1348.07,1483.41 1350.42,1511.69 1352.77,1604.42 1355.12,1598.73 1357.47,1533.68 1359.82,1232.76 1362.17,1465.85 1364.52,1523.81 1366.87,1496.36 1369.22,1428.77 1371.57,1387.47 1373.92,1389.47 1376.27,1424.52 1378.62,1565.17 1380.97,1333 1383.32,1419.64 1385.67,1557.24 1388.02,1367.49 1390.38,1326.17 1392.73,1370.75 1395.08,1368.21 1397.43,1543.37 1399.78,1421.67 1402.13,1483.39 1404.48,1547.81 1406.83,1587.45 1409.18,1353.96 1411.53,1327.31 1413.88,1340.74 1416.23,1410.44 1418.58,1300.54 1420.93,1333.16 1423.28,1486.41 1425.63,1408.85 1427.98,1352.17 1430.33,1537.46 1432.68,1344.67 1435.03,1437.22 1437.38,1164.93 1439.74,1470.33 1442.09,1388.61 1444.44,1382.32 1446.79,1414.47 1449.14,1424.64 1451.49,1347.67 1453.84,1502.6 1456.19,1368.92 1458.54,1541.5 1460.89,1417.67 1463.24,1483.08 1465.59,1494.97 1467.94,1226.33 1470.29,1663.63 1472.64,1302.77 1474.99,1235.04 1477.34,1529.56 1479.69,1528.31 1482.04,1436.3 1484.39,1475.7 1486.74,1429.17 1489.1,1378.41 1491.45,1500.79 1493.8,1271.25 1496.15,1302.09 1498.5,1389.23 1500.85,1331.21 1503.2,1476.57 1505.55,1492.89 1507.9,1384.25 1510.25,1463.91 1512.6,1249.43 1514.95,1455.5 1517.3,1488.03 1519.65,1654.9 1522,1349.41 1524.35,1412.04 1526.7,1381.15 1529.05,1403.62 1531.4,1338.82 1533.75,1340.81 1536.1,1615.23 1538.45,1443.89 1540.81,1421.87 1543.16,1345.07 1545.51,1485.37 1547.86,1488.65 1550.21,1383.61 1552.56,1433.61 1554.91,1306.33 1557.26,1502.4 1559.61,1511.48 1561.96,1312.18 1564.31,1386.89 1566.66,1499.04 1569.01,1451.96 1571.36,1305.94 1573.71,1292.3 1576.06,1412.32 1578.41,1300.48 1580.76,1395.87 1583.11,1297.83 1585.46,1583.34 1587.81,1367.35 1590.17,1289.73 1592.52,1576.43 1594.87,1751.15 1597.22,1270.78 1599.57,1290.67 1601.92,1382.08 1604.27,1319.92 1606.62,1399.32 1608.97,1507 1611.32,1635.51 1613.67,1425.68 1616.02,1620.67 1618.37,1394.02 1620.72,1516.26 1623.07,1314.52 1625.42,1292.2 1627.77,1510.06 1630.12,1667.71 1632.47,1578.8 1634.82,1373.29 1637.17,1298.43 1639.53,1505.79 1641.88,1680.29 1644.23,1397.49 1646.58,1386.99 1648.93,1292.23 1651.28,1435.93 1653.63,1402.18 1655.98,1665.31 1658.33,1325.35 1660.68,1449.11 1663.03,1369.13 1665.38,1443.47 1667.73,1509.58 1670.08,1444.79 1672.43,1418.88 1674.78,1482.82 1677.13,1509.63 1679.48,1614.99 1681.83,1623.14 1684.18,1451.42 1686.53,1348.88 1688.89,1610.01 1691.24,1354.9 1693.59,1402.19 1695.94,1525.58 1698.29,1381.11 1700.64,1396.54 1702.99,1240.41 1705.34,1430.45 1707.69,1452.34 1710.04,1536.49 1712.39,1376.27 1714.74,1266.15 1717.09,1486.33 1719.44,1401.62 1721.79,1423.38 1724.14,1364.3 1726.49,1296.66 1728.84,1593.39 1731.19,1330.88 1733.54,1345.45 1735.89,1398.31 1738.25,1499.04 1740.6,1395.84 1742.95,1518.54 1745.3,1419.87 1747.65,1441.2 1750,1364.91 1752.35,1495 1754.7,1559.67 1757.05,1309.03 1759.4,1280.46 1761.75,1232.56 1764.1,1440.66 1766.45,1440.28 1768.8,1537.79 1771.15,1369.95 1773.5,1564.35 1775.85,1476.53 1778.2,1456.94 1780.55,1466.77 1782.9,1458.45 1785.25,1454.8 1787.6,1591.42 1789.96,1420.05 1792.31,1218.16 1794.66,1309.89 1797.01,1685.2 1799.36,1310.89 1801.71,1559.99 1804.06,1595.8 1806.41,1477.05 1808.76,1388.58 1811.11,1442.3 1813.46,1377.13 1815.81,1423.47 1818.16,1450.61 1820.51,1351.66 1822.86,1338.8 1825.21,1468.78 1827.56,1465.01 1829.91,1454.1 1832.26,1543.99 1834.61,1426.95 1836.96,1434.49 1839.32,1267.47 1841.67,1462.87 1844.02,1302.57 1846.37,1374.71 1848.72,1274.95 1851.07,1608.9 1853.42,1427.5 1855.77,1279.24 1858.12,1394.39 1860.47,1392.69 1862.82,1412.42 1865.17,1637.68 1867.52,1403.05 1869.87,1257.97 1872.22,1533.39 1874.57,1402.75 1876.92,1260.28 1879.27,1269.96 1881.62,1442.5 1883.97,1422.52 1886.32,1212.25 1888.68,1410.05 1891.03,1346.45 1893.38,1437.93 1895.73,1346.51 1898.08,1436.47 1900.43,1590.52 1902.78,1412.2 1905.13,1566.02 1907.48,1455.79 1909.83,1549.79 1912.18,1130.03 1914.53,1451.52 1916.88,1423 1919.23,1291.11 1921.58,1348.07 1923.93,1585.06 1926.28,1290.13 1928.63,1477.87 1930.98,1403.33 1933.33,1259.9 1935.68,1373.21 1938.04,1371.88 1940.39,1504.2 1942.74,1606.76 1945.09,1434.5 1947.44,1381.64 1949.79,1440.81 1952.14,1406.89 1954.49,1531.43 1956.84,1486.36 1959.19,1659.83 1961.54,1482.2 1963.89,1265.24 1966.24,1507.47 1968.59,1323.33 1970.94,1396.74 1973.29,1433.1 1975.64,1359.05 1977.99,1644.78 1980.34,1364.21 1982.69,1464.96 1985.04,1497.61 1987.4,1517.64 1989.75,1456.31 1992.1,1476.99 1994.45,1610.37 1996.8,1215.72 1999.15,1372.93 2001.5,1441.24 2003.85,1436.34 2006.2,1430.64 2008.55,1420.27 2010.9,1416.74 2013.25,1412.78 2015.6,1291.03 2017.95,1269.07 2020.3,1659.35 2022.65,1358.77 2025,1413.86 2027.35,1506.9 2029.7,1360.5 2032.05,1558.05 2034.4,1338.17 2036.76,1197.37 2039.11,1322.87 2041.46,1385.31 2043.81,1522.3 2046.16,1436.9 2048.51,1195.43 2050.86,1296.41 2053.21,1395.03 2055.56,1312.98 2057.91,1435.88 2060.26,1529.82 2062.61,1659.69 2064.96,1399.91 2067.31,1480.69 2069.66,1363.28 2072.01,1257.45 2074.36,1360.1 2076.71,1600.29 2079.06,1364.28 2081.41,1459.34 2083.76,1471.6 2086.11,1329.79 2088.47,1283.1 2090.82,1398.38 2093.17,1627.98 2095.52,1343.74 2097.87,1362.07 2100.22,1423.49 2102.57,1412.59 2104.92,1532.56 2107.27,1441.28 2109.62,1452.65 2111.97,1451.96 2114.32,1453.4 2116.67,1458.11 2119.02,1232.65 2121.37,1540.44 2123.72,1330.12 2126.07,1339.22 2128.42,1530.24 2130.77,1384.89 2133.12,1339.29 2135.47,1224.62 2137.83,1408.3 2140.18,1243.18 2142.53,1307.33 2144.88,1326.55 2147.23,1411.96 2149.58,1516.14 2151.93,1422.91 2154.28,1326.79 2156.63,1502 2158.98,1550.51 2161.33,1376.03 2163.68,1312.87 2166.03,1296.78 2168.38,1550.96 2170.73,1498.55 2173.08,1469.97 2175.43,1435.71 2177.78,1324.22 2180.13,1477.54 2182.48,1397.71 2184.83,1476.8 2187.19,1384.55 2189.54,1247.01 2191.89,1380.93 2194.24,1449.07 2196.59,1332.34 2198.94,1199.18 2201.29,1321.1 2203.64,1496.73 2205.99,1217.36 2208.34,1585.36 2210.69,1473.44 2213.04,1474.81 2215.39,1413.97 2217.74,1547.48 2220.09,1386.47 2222.44,1584.81 2224.79,1353.58 2227.14,1359.84 2229.49,1291.76 2231.84,1578.92 2234.19,1569.33 2236.55,1277.53 2238.9,1548.24 2241.25,1439.76 2243.6,1304.4 2245.95,1575.5 2248.3,1406.77 2250.65,1599.98 2253,1321.67 2255.35,1346.51 2257.7,1444.08 2260.05,1437.13 2262.4,1585.82 2264.75,1589.69 2267.1,1463.78 2269.45,1318.83 2271.8,1489.76 2274.15,1318.66 2276.5,1455.68 2278.85,1353.37 2281.2,1333.85 2283.55,1486.3 2285.91,1287.61 2288.26,1316.08 2290.61,1411.22 2292.96,1364.72 2295.31,1502.33 2297.66,1444.53 2300.01,1336.83 2302.36,1294.69 2304.71,1551.13 2307.06,1352.4 2309.41,1341.01 2311.76,1466.12 2314.11,1438.93 2316.46,1438.61 2318.81,1501.58 2321.16,1341.83 2323.51,1394.42 2325.86,1421.43 2328.21,1511.03 2330.56,1395.46 2332.91,1315.7 2335.27,1304.38 2337.62,1479.07 2339.97,1369.36 2342.32,1368.57 2344.67,1449.25 2347.02,1447.3 2349.37,1642.79 2351.72,1249.56 2354.07,1412.73 2356.42,1199.28 2358.77,1383.4 2361.12,1349.31 2363.47,1359.17 2365.82,1436.83 2368.17,1346.83 2370.52,1541.57 2372.87,1408.63 2375.22,1582.25 2377.57,1478.93 2379.92,1449.13 2382.27,1479.69 2384.62,1372.92 2386.98,1430.3 2389.33,1386.22 2391.68,1433.77 2394.03,1302.47 2396.38,1419.93 2398.73,1373.93 2401.08,1653.42 2403.43,1440.85 2405.78,1330.16 2408.13,1432.41 2410.48,1420.02 2412.83,1504 2415.18,1644.13 2417.53,1475.84 2419.88,1442.26 2422.23,1400.61 2424.58,1516.49 2426.93,1395.38 2429.28,1329.85 2431.63,1439.26 2433.98,1472.85 2436.34,1489.78 2438.69,1538.68 2441.04,1331.84 2443.39,1519.64 2445.74,1400.82 2448.09,1284.62 2450.44,1492.45 2452.79,1464.39 2455.14,1472.6 2457.49,1444.1 2459.84,1453.33 2462.19,1410.66 2464.54,1447.77 2466.89,1458.78 2469.24,1401.91 2471.59,1316.29 2473.94,1384.41 2476.29,1403.49 2478.64,1229.38 2480.99,1399.88 2483.34,1352.09 2485.7,1467.53 2488.05,1357.61 2490.4,1327.91 2492.75,1450.23 2495.1,1215.67 2497.45,1426.91 2499.8,1386.31 2502.15,1303.23 2504.5,1501.46 2506.85,1434.31 2509.2,1415.32 2511.55,1362.98 2513.9,1432.68 2516.25,1346.42 2518.6,1507.43 2520.95,1383.77 2523.3,1450.16 2525.65,1407.97 2528,1375.88 2530.35,1364.23 2532.7,1368.88 2535.06,1369.07 2537.41,1276.23 2539.76,1436.98 2542.11,1485.63 2544.46,1559.72 2546.81,1367.3 2549.16,1573.09 2551.51,1285.69 2553.86,1365.98 2556.21,1344 2558.56,1274.24 2560.91,1438.28 2563.26,1584.71 2565.61,1437.61 2567.96,1586.3 2570.31,1530.94 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,844.993 224.541,971.781 226.891,930.057 229.242,887.473 231.592,890.63 233.943,811.229 236.293,1047.58 238.644,1029.28 240.994,912.893 243.345,1118.59 245.695,1061.23 248.046,948.17 250.396,923.681 252.747,1005.2 255.097,1007.19 257.448,932.524 259.798,780.461 262.148,761.701 264.499,1068.52 266.849,879.54 269.2,1055.96 271.55,860.798 273.901,848.386 276.251,960.49 278.602,1001.05 280.952,880.998 283.303,941.299 285.653,926.124 288.004,903.291 290.354,908.071 292.705,877.094 295.055,861.502 297.406,828.095 299.756,980.96 302.107,897.57 304.457,933.199 306.807,1000.28 309.158,996.578 311.508,1057.23 313.859,746.952 316.209,883.41 318.56,952.226 320.91,854.441 323.261,718.062 325.611,893.987 327.962,898.808 330.312,810.071 332.663,906.456 335.013,809.045 337.364,809.002 339.714,858.915 342.065,1036.34 344.415,925.15 346.765,891.517 349.116,827.33 351.466,940.787 353.817,1068.04 356.167,816.256 358.518,789.176 360.868,969.022 363.219,884.304 365.569,866.536 367.92,906.389 370.27,1084.59 372.621,938.163 374.971,958.122 377.322,865.141 379.672,964.898 382.023,995.848 384.373,1003.68 386.724,868.414 389.074,682.68 391.424,850.033 393.775,872.292 396.125,907.836 398.476,854.013 400.826,888.374 403.177,962.485 405.527,771.222 407.878,955.352 410.228,941.205 412.579,906.993 414.929,759.865 417.28,995.279 419.63,919.73 421.981,911.646 424.331,903.245 426.682,709.614 429.032,799.116 431.382,818.316 433.733,907.527 436.083,1010.72 438.434,1047.96 440.784,885.138 443.135,1058.63 445.485,796.882 447.836,978.929 450.186,886.331 452.537,935.714 454.887,1109.71 457.238,1002.93 459.588,840.682 461.939,883.982 464.289,724.817 466.64,939.515 468.99,1031.11 471.341,915.099 473.691,882.221 476.041,847.769 478.392,849.084 480.742,948.943 483.093,876.002 485.443,1018.81 487.794,826.759 490.144,1025.91 492.495,943.167 494.845,864.652 497.196,1157.64 499.546,992.6 501.897,980.693 504.247,770.634 506.598,806.068 508.948,992.864 511.299,1035.12 513.649,975.856 515.999,925.529 518.35,990.476 520.7,998.958 523.051,995.943 525.401,1133 527.752,922.178 530.102,817.188 532.453,1111.66 534.803,1048.22 537.154,1014.06 539.504,923.21 541.855,873.058 544.205,900.874 546.556,1086.42 548.906,923.506 551.257,943.843 553.607,941.485 555.958,927.383 558.308,964.186 560.658,1035.95 563.009,896.123 565.359,705.143 567.71,876.26 570.06,1068.92 572.411,950.05 574.761,992.385 577.112,1087.25 579.462,857.878 581.813,855.09 584.163,1227.75 586.514,953.346 588.864,865.229 591.215,865.887 593.565,1003.5 595.916,929.44 598.266,727.132 600.616,905.817 602.967,965.955 605.317,925.995 607.668,785.616 610.018,918.872 612.369,1004.93 614.719,867.444 617.07,793.315 619.42,946.897 621.771,886.913 624.121,1019.37 626.472,1097.1 628.822,942.59 631.173,924.039 633.523,876.056 635.874,780.331 638.224,843.615 640.575,848.808 642.925,1017.04 645.275,981.016 647.626,951.666 649.976,1011.13 652.327,708.488 654.677,783.89 657.028,908.976 659.378,960.537 661.729,921.099 664.079,733.846 666.43,744.662 668.78,992.204 671.131,832.847 673.481,925.75 675.832,895.273 678.182,1000.28 680.533,1101.4 682.883,863.111 685.233,936.978 687.584,912.431 689.934,840.648 692.285,873.001 694.635,752.581 696.986,792.341 699.336,823.432 701.687,875.909 704.037,1004.73 706.388,953.904 708.738,782.129 711.089,807.407 713.439,1042.38 715.79,869.896 718.14,762.264 720.491,896.305 722.841,966.174 725.192,681.241 727.542,713.15 729.892,842.576 732.243,764.01 734.593,989.81 736.944,799.381 739.294,884.169 741.645,803.889 743.995,892.126 746.346,984.531 748.696,994.165 751.047,986.633 753.397,1000.6 755.748,815.598 758.098,814.441 760.449,754.855 762.799,959.986 765.15,862.705 767.5,936.812 769.85,863.846 772.201,736.399 774.551,748.317 776.902,1067.34 779.252,952.914 781.603,1021.48 783.953,829.257 786.304,870.912 788.654,914.06 791.005,923.035 793.355,929.89 795.706,1076.11 798.056,897.3 800.407,988.678 802.757,852.988 805.108,1056.76 807.458,858.34 809.809,874.539 812.159,990.193 814.509,847.163 816.86,1040.2 819.21,896.723 821.561,714.262 823.911,911.599 826.262,960.32 828.612,869.527 830.963,932.384 833.313,925.337 835.664,1017.97 838.014,783.384 840.365,1015.47 842.715,860.912 845.066,1150.54 847.416,839.203 849.767,922.39 852.117,691.428 854.467,960.903 856.818,797.929 859.168,719.614 861.519,898.512 863.869,879.614 866.22,1008.04 868.57,1109.41 870.921,878.8 873.271,944.113 875.622,721.108 877.972,831.141 880.323,926.356 882.673,954.444 885.024,934.282 887.374,915.65 889.725,872.065 892.075,934.269 894.426,870.64 896.776,913.617 899.126,990.807 901.477,974.922 903.827,806.442 906.178,914.632 908.528,881.8 910.879,846.125 913.229,931.596 915.58,1032.94 917.93,904.59 920.281,830.756 922.631,739.942 924.982,924.998 927.332,985.214 929.683,1074.39 932.033,824.943 934.384,1005.87 936.734,953.728 939.084,863.996 941.435,794.059 943.785,855.747 946.136,901.866 948.486,851.314 950.837,751.45 953.187,800.999 955.538,866.1 957.888,943.343 960.239,977.259 962.589,750.693 964.94,779.947 967.29,947.021 969.641,843.358 971.991,740.944 974.342,908.61 976.692,983.964 979.043,952.748 981.393,898.942 983.743,912.668 986.094,905.415 988.444,1016.62 990.795,1038.8 993.145,1047.41 995.496,843.943 997.846,863.414 1000.2,802.993 1002.55,923.958 1004.9,992.203 1007.25,938.808 1009.6,906.964 1011.95,997.619 1014.3,853.329 1016.65,879.364 1019,886.111 1021.35,846.647 1023.7,917.603 1026.05,887.283 1028.4,986.775 1030.75,921.319 1033.1,1110.7 1035.45,914.925 1037.8,832.767 1040.15,898.603 1042.51,852.204 1044.86,997.013 1047.21,725.943 1049.56,1082.15 1051.91,860.761 1054.26,777.938 1056.61,827.486 1058.96,1021.96 1061.31,860.372 1063.66,795.328 1066.01,721.505 1068.36,774.274 1070.71,911.5 1073.06,949.534 1075.41,1048.6 1077.76,906.96 1080.11,895.786 1082.46,975.863 1084.81,1015.2 1087.16,983.098 1089.51,833.823 1091.87,882.19 1094.22,1011.68 1096.57,827.533 1098.92,883.354 1101.27,945.944 1103.62,812.746 1105.97,682.744 1108.32,974.925 1110.67,917.375 1113.02,780.645 1115.37,986.429 1117.72,860.692 1120.07,653.526 1122.42,791.231 1124.77,824.364 1127.12,970.901 1129.47,924.179 1131.82,787.984 1134.17,966.274 1136.52,871.938 1138.87,850.469 1141.23,930.383 1143.58,759.812 1145.93,978.37 1148.28,929.244 1150.63,1099.4 1152.98,869.973 1155.33,844.428 1157.68,996.467 1160.03,842.619 1162.38,916.839 1164.73,926.158 1167.08,1177.41 1169.43,881.761 1171.78,871.824 1174.13,972.703 1176.48,907.783 1178.83,853.237 1181.18,825.326 1183.53,877.522 1185.88,696.154 1188.23,873.467 1190.59,887.356 1192.94,1016.2 1195.29,920.807 1197.64,1084.74 1199.99,963.811 1202.34,1022.96 1204.69,873.043 1207.04,775.871 1209.39,771.566 1211.74,899.146 1214.09,924.383 1216.44,1023.2 1218.79,841.674 1221.14,970.914 1223.49,877.673 1225.84,618.91 1228.19,856.17 1230.54,963.161 1232.89,948.17 1235.24,960.379 1237.59,790.717 1239.94,1165.1 1242.3,839.282 1244.65,978.326 1247,827.791 1249.35,1088.38 1251.7,689.779 1254.05,972.231 1256.4,1170.14 1258.75,974.717 1261.1,946.485 1263.45,953.905 1265.8,716.469 1268.15,990.699 1270.5,876.011 1272.85,924.625 1275.2,1080.21 1277.55,947.55 1279.9,672.44 1282.25,1070.3 1284.6,754.386 1286.95,1054.93 1289.3,681.998 1291.66,929.231 1294.01,899.237 1296.36,808.119 1298.71,790.316 1301.06,901.389 1303.41,912.936 1305.76,990.267 1308.11,814.807 1310.46,912.437 1312.81,936.594 1315.16,1087.45 1317.51,919.92 1319.86,779.893 1322.21,919.215 1324.56,787.338 1326.91,829.716 1329.26,953.326 1331.61,828.447 1333.96,757.22 1336.31,1106.09 1338.66,728.179 1341.02,1041.66 1343.37,923.143 1345.72,816.149 1348.07,913.808 1350.42,1035.63 1352.77,943.93 1355.12,1030.03 1357.47,771.274 1359.82,826.555 1362.17,966.136 1364.52,878.84 1366.87,945.22 1369.22,832.255 1371.57,704.431 1373.92,913.759 1376.27,882.579 1378.62,842.855 1380.97,975.617 1383.32,982.871 1385.67,938.433 1388.02,786.844 1390.38,978.38 1392.73,1087.7 1395.08,915.975 1397.43,1030.66 1399.78,876.965 1402.13,898.718 1404.48,953.814 1406.83,1023.39 1409.18,858.045 1411.53,1156.77 1413.88,962.821 1416.23,822.511 1418.58,996.09 1420.93,1098.73 1423.28,902.432 1425.63,923.498 1427.98,788.796 1430.33,1036.57 1432.68,952.705 1435.03,797.843 1437.38,885.288 1439.74,986.536 1442.09,1074.21 1444.44,917.006 1446.79,888.999 1449.14,759.868 1451.49,990.617 1453.84,944.848 1456.19,1129.31 1458.54,988.173 1460.89,872.853 1463.24,966.587 1465.59,869.295 1467.94,1001.79 1470.29,927.514 1472.64,792.613 1474.99,900.622 1477.34,901.921 1479.69,954.298 1482.04,788.614 1484.39,952.037 1486.74,844.306 1489.1,920.536 1491.45,992.296 1493.8,920.952 1496.15,976.996 1498.5,690.93 1500.85,854.549 1503.2,977.65 1505.55,998.878 1507.9,945.486 1510.25,788.267 1512.6,1056.29 1514.95,812.56 1517.3,966.094 1519.65,743.61 1522,933.653 1524.35,939.058 1526.7,768.874 1529.05,920.807 1531.4,850.482 1533.75,877.054 1536.1,900.895 1538.45,753.147 1540.81,803.52 1543.16,861.152 1545.51,920.535 1547.86,711.396 1550.21,864.918 1552.56,820.301 1554.91,823.369 1557.26,870.104 1559.61,1039.94 1561.96,978.654 1564.31,829.487 1566.66,895.007 1569.01,759.549 1571.36,1025.16 1573.71,821.605 1576.06,1171.34 1578.41,1014.55 1580.76,925.796 1583.11,805.063 1585.46,1003.05 1587.81,817.648 1590.17,768.739 1592.52,881.554 1594.87,943.507 1597.22,990.281 1599.57,802.612 1601.92,803.008 1604.27,931.305 1606.62,911.325 1608.97,1008.51 1611.32,793.105 1613.67,963.961 1616.02,952.465 1618.37,945.534 1620.72,1024.34 1623.07,897.106 1625.42,732.921 1627.77,935.95 1630.12,1058 1632.47,918.987 1634.82,969.874 1637.17,959.095 1639.53,803.361 1641.88,737.826 1644.23,1086.08 1646.58,929.077 1648.93,839.427 1651.28,1060.4 1653.63,920.832 1655.98,871.583 1658.33,873.338 1660.68,968.551 1663.03,986.554 1665.38,788.74 1667.73,1039.29 1670.08,1112.49 1672.43,1035.08 1674.78,1178.14 1677.13,782.718 1679.48,947.853 1681.83,807.352 1684.18,774.109 1686.53,960.544 1688.89,709.41 1691.24,808.752 1693.59,998.136 1695.94,969.924 1698.29,905.63 1700.64,863.329 1702.99,751.969 1705.34,1059.69 1707.69,827.758 1710.04,900.551 1712.39,766.655 1714.74,897.28 1717.09,823.265 1719.44,873.881 1721.79,811.172 1724.14,731.825 1726.49,937.107 1728.84,982.598 1731.19,934.203 1733.54,869.738 1735.89,805.891 1738.25,1023.04 1740.6,949.805 1742.95,923.051 1745.3,911.832 1747.65,1080.33 1750,1025.23 1752.35,984.442 1754.7,1062.22 1757.05,1006.43 1759.4,1176.88 1761.75,840.018 1764.1,948.574 1766.45,940.339 1768.8,1041.93 1771.15,895.574 1773.5,865.453 1775.85,769.135 1778.2,857.888 1780.55,883.317 1782.9,1023.11 1785.25,806.488 1787.6,756.831 1789.96,970.133 1792.31,1138.52 1794.66,995.884 1797.01,836.991 1799.36,974.788 1801.71,839.799 1804.06,1027.46 1806.41,894.779 1808.76,1065.09 1811.11,898.619 1813.46,964.254 1815.81,1016.63 1818.16,1015.24 1820.51,934.444 1822.86,944.026 1825.21,788.392 1827.56,807.51 1829.91,1135.25 1832.26,881.435 1834.61,973.575 1836.96,929.555 1839.32,1023.04 1841.67,908.73 1844.02,935.701 1846.37,1019.23 1848.72,778.645 1851.07,934.976 1853.42,995.981 1855.77,940.925 1858.12,878.787 1860.47,806.891 1862.82,839.153 1865.17,894.201 1867.52,1115.26 1869.87,941.209 1872.22,854.609 1874.57,872.989 1876.92,829.48 1879.27,765.265 1881.62,892.834 1883.97,1041.96 1886.32,820.479 1888.68,1006.62 1891.03,1025.24 1893.38,978.183 1895.73,883.004 1898.08,913.182 1900.43,867.093 1902.78,872.867 1905.13,1000.16 1907.48,909.304 1909.83,828.196 1912.18,855.67 1914.53,905.35 1916.88,939.049 1919.23,1001.14 1921.58,769.201 1923.93,944.981 1926.28,803.621 1928.63,871.209 1930.98,824.879 1933.33,794.785 1935.68,814.479 1938.04,1041.28 1940.39,934.571 1942.74,610.162 1945.09,1271.92 1947.44,994.487 1949.79,991.276 1952.14,881.225 1954.49,1074.9 1956.84,655.079 1959.19,870.296 1961.54,936.067 1963.89,1018.75 1966.24,792.994 1968.59,989.482 1970.94,902.273 1973.29,1075.22 1975.64,895.635 1977.99,917.014 1980.34,944.855 1982.69,800.998 1985.04,1118.89 1987.4,982.305 1989.75,822.895 1992.1,919.647 1994.45,986.877 1996.8,897.905 1999.15,705.297 2001.5,945.782 2003.85,914.578 2006.2,742.753 2008.55,841.178 2010.9,1018.69 2013.25,973.075 2015.6,887.371 2017.95,958.599 2020.3,867.943 2022.65,1046.04 2025,1025.97 2027.35,928.054 2029.7,749.141 2032.05,964.048 2034.4,1044.79 2036.76,980.063 2039.11,1018.22 2041.46,880.852 2043.81,800.931 2046.16,991.232 2048.51,963.746 2050.86,902.626 2053.21,1062.53 2055.56,869.795 2057.91,941.313 2060.26,878.584 2062.61,917.025 2064.96,1067 2067.31,892.947 2069.66,830.885 2072.01,928.434 2074.36,1120.61 2076.71,853.199 2079.06,922.743 2081.41,845.111 2083.76,1011.04 2086.11,796.592 2088.47,898.139 2090.82,955.286 2093.17,984.83 2095.52,931.927 2097.87,1034.05 2100.22,869.689 2102.57,878.336 2104.92,1089.14 2107.27,994.74 2109.62,921.462 2111.97,1027.38 2114.32,968.268 2116.67,1011.46 2119.02,884.154 2121.37,898.576 2123.72,915.161 2126.07,799.98 2128.42,718.896 2130.77,836.822 2133.12,822.685 2135.47,895.135 2137.83,828.51 2140.18,886.719 2142.53,860.228 2144.88,786.823 2147.23,758.546 2149.58,955.138 2151.93,1073.71 2154.28,1064.64 2156.63,869.186 2158.98,862.666 2161.33,931.397 2163.68,703.446 2166.03,775.444 2168.38,941.64 2170.73,972.194 2173.08,768.902 2175.43,880.07 2177.78,855.397 2180.13,637.592 2182.48,915.23 2184.83,851.028 2187.19,767.212 2189.54,821.981 2191.89,907.309 2194.24,912.299 2196.59,789.609 2198.94,1066.81 2201.29,939.425 2203.64,908.577 2205.99,913.738 2208.34,844.11 2210.69,899.254 2213.04,964.938 2215.39,700.373 2217.74,884.88 2220.09,903.027 2222.44,976.925 2224.79,827.319 2227.14,1164.29 2229.49,1088.47 2231.84,985.761 2234.19,928.35 2236.55,803.659 2238.9,859.674 2241.25,955.786 2243.6,960.238 2245.95,994.136 2248.3,824.958 2250.65,891.109 2253,961.367 2255.35,1123.79 2257.7,986.355 2260.05,930.61 2262.4,1133.37 2264.75,963.831 2267.1,764.226 2269.45,899.774 2271.8,782.192 2274.15,891.627 2276.5,1141.12 2278.85,798.945 2281.2,1046.15 2283.55,1037.89 2285.91,836.91 2288.26,987.89 2290.61,942.259 2292.96,900.081 2295.31,869.946 2297.66,896.722 2300.01,877.787 2302.36,823.506 2304.71,1134.29 2307.06,887.26 2309.41,760.309 2311.76,898.907 2314.11,1068.41 2316.46,927.969 2318.81,1063.45 2321.16,804.395 2323.51,928.886 2325.86,936.262 2328.21,953.591 2330.56,1058.48 2332.91,843.115 2335.27,825.594 2337.62,766.506 2339.97,778.209 2342.32,1024.99 2344.67,779.525 2347.02,937.862 2349.37,964.438 2351.72,1053.83 2354.07,820.269 2356.42,1069.31 2358.77,895.171 2361.12,785.364 2363.47,956.172 2365.82,879.449 2368.17,957.057 2370.52,959.429 2372.87,847.952 2375.22,821.468 2377.57,877.618 2379.92,842.505 2382.27,927.934 2384.62,1163.81 2386.98,924.533 2389.33,947.39 2391.68,810.447 2394.03,921.971 2396.38,1117.86 2398.73,961.017 2401.08,973.863 2403.43,808.199 2405.78,911.18 2408.13,892.35 2410.48,1006.23 2412.83,956.343 2415.18,950.859 2417.53,972.551 2419.88,817.372 2422.23,735.856 2424.58,1046.28 2426.93,909.624 2429.28,784.516 2431.63,724.581 2433.98,960.655 2436.34,1022.88 2438.69,697.056 2441.04,786.184 2443.39,916.026 2445.74,1012.24 2448.09,1056.16 2450.44,812.893 2452.79,875.605 2455.14,1033.4 2457.49,1055.87 2459.84,707.786 2462.19,1074.71 2464.54,974.861 2466.89,977.899 2469.24,969.113 2471.59,781.776 2473.94,1069.27 2476.29,957.002 2478.64,824.495 2480.99,1009.47 2483.34,1049.71 2485.7,949.735 2488.05,1047.82 2490.4,999.769 2492.75,869.386 2495.1,898.249 2497.45,941.206 2499.8,987.251 2502.15,940.353 2504.5,1009.81 2506.85,1078.67 2509.2,932.401 2511.55,768.267 2513.9,964 2516.25,1055.11 2518.6,917.253 2520.95,921.671 2523.3,1093.35 2525.65,824.198 2528,826.645 2530.35,969.994 2532.7,955.628 2535.06,1077.36 2537.41,993.769 2539.76,938.802 2542.11,946.419 2544.46,917.805 2546.81,710.144 2549.16,963.369 2551.51,764.889 2553.86,921.197 2556.21,813.485 2558.56,908.831 2560.91,1043.11 2563.26,756.786 2565.61,945.694 2567.96,1076.05 2570.31,954.462 "></polyline>
<polyline clip-path="url(#clip092)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,600.332 224.541,434.685 226.891,304.771 229.242,348.654 231.592,411.426 233.943,505.279 236.293,414.532 238.644,380.339 240.994,340.045 243.345,282.852 245.695,421.619 248.046,262.823 250.396,617.377 252.747,464.266 255.097,437.72 257.448,589.313 259.798,512.041 262.148,331.607 264.499,289.299 266.849,396.265 269.2,612.291 271.55,461.306 273.901,326.57 276.251,448.13 278.602,273.14 280.952,505.581 283.303,387.91 285.653,528.161 288.004,394.251 290.354,222.781 292.705,502.439 295.055,320.273 297.406,333.07 299.756,257.866 302.107,476.827 304.457,464.612 306.807,343.845 309.158,608.834 311.508,355.969 313.859,428.233 316.209,415.99 318.56,363.292 320.91,403.875 323.261,456.947 325.611,393.401 327.962,492.614 330.312,445.599 332.663,268.701 335.013,352.187 337.364,251.799 339.714,366.786 342.065,432.134 344.415,507.017 346.765,453.221 349.116,549.276 351.466,313.605 353.817,355.744 356.167,496.075 358.518,523.163 360.868,149.84 363.219,295.124 365.569,333.005 367.92,406.028 370.27,253.295 372.621,334.243 374.971,428.133 377.322,540.299 379.672,330.338 382.023,416.677 384.373,363.047 386.724,505.562 389.074,322.916 391.424,657.922 393.775,388.866 396.125,475.089 398.476,284.327 400.826,317.583 403.177,360.175 405.527,362.372 407.878,542.738 410.228,303.57 412.579,422.072 414.929,415.347 417.28,366.387 419.63,385.08 421.981,360.765 424.331,591.164 426.682,363.837 429.032,392.819 431.382,370.75 433.733,402.967 436.083,456.048 438.434,223.016 440.784,543.444 443.135,402.966 445.485,260.217 447.836,618.154 450.186,397.567 452.537,401.33 454.887,507.454 457.238,457.562 459.588,392.914 461.939,186.651 464.289,402.203 466.64,494.635 468.99,406.904 471.341,407.221 473.691,604.209 476.041,505.712 478.392,434.455 480.742,426.352 483.093,543.916 485.443,442.149 487.794,567.372 490.144,510.308 492.495,574.907 494.845,505.783 497.196,334.616 499.546,446.094 501.897,384.426 504.247,343.302 506.598,418.509 508.948,515.911 511.299,169.133 513.649,354.654 515.999,306.708 518.35,248.403 520.7,476.708 523.051,408.37 525.401,326.368 527.752,489.241 530.102,411.599 532.453,426.852 534.803,229.98 537.154,307.255 539.504,293.458 541.855,204.403 544.205,230.831 546.556,494.489 548.906,258.189 551.257,546.401 553.607,248.563 555.958,311.847 558.308,433.335 560.658,417.942 563.009,294.358 565.359,436.357 567.71,183.273 570.06,451.552 572.411,369.662 574.761,577.669 577.112,533.016 579.462,516.752 581.813,338.794 584.163,449.334 586.514,367.444 588.864,305.971 591.215,300.327 593.565,516.831 595.916,454.691 598.266,369.556 600.616,294.855 602.967,222.168 605.317,392.311 607.668,507.005 610.018,402.163 612.369,439.904 614.719,501.027 617.07,427.639 619.42,237.332 621.771,361.523 624.121,327.92 626.472,461.168 628.822,273.447 631.173,579.033 633.523,416.39 635.874,322.37 638.224,393.66 640.575,479.182 642.925,375.263 645.275,393.844 647.626,342.186 649.976,444.278 652.327,231.675 654.677,394.292 657.028,378.924 659.378,429.479 661.729,490.61 664.079,218.613 666.43,131.226 668.78,303.814 671.131,138.272 673.481,551.38 675.832,505.307 678.182,327.077 680.533,260.694 682.883,583.654 685.233,368.397 687.584,449.865 689.934,445.999 692.285,509.274 694.635,269.854 696.986,387.845 699.336,361.749 701.687,638.403 704.037,600.752 706.388,430.111 708.738,237.842 711.089,285.535 713.439,490.548 715.79,440.482 718.14,415.572 720.491,470.803 722.841,469.518 725.192,371.989 727.542,547.442 729.892,257.575 732.243,323.067 734.593,377.134 736.944,299.132 739.294,463.832 741.645,300.412 743.995,693.094 746.346,270.547 748.696,358.233 751.047,535.775 753.397,394.357 755.748,424.678 758.098,229.947 760.449,451.289 762.799,469.797 765.15,580.392 767.5,430.781 769.85,439.29 772.201,415.907 774.551,544.588 776.902,499.628 779.252,555.297 781.603,389.599 783.953,316.051 786.304,438.631 788.654,414.134 791.005,262.058 793.355,387.666 795.706,320.889 798.056,388.031 800.407,476.854 802.757,325.817 805.108,333.599 807.458,440.957 809.809,518.114 812.159,427.442 814.509,449.253 816.86,394.33 819.21,482.956 821.561,511.603 823.911,468.783 826.262,500.882 828.612,315.305 830.963,543.022 833.313,560.872 835.664,428.88 838.014,383.669 840.365,283.797 842.715,425.683 845.066,160.804 847.416,385.533 849.767,470.359 852.117,447.55 854.467,360.527 856.818,163.414 859.168,355.922 861.519,463.114 863.869,443.717 866.22,487.224 868.57,598.223 870.921,350.745 873.271,555.409 875.622,466.363 877.972,384.204 880.323,381.754 882.673,619.007 885.024,396.842 887.374,357.973 889.725,482.096 892.075,440.833 894.426,118.824 896.776,333.6 899.126,489.56 901.477,495.655 903.827,476.528 906.178,471.938 908.528,489.403 910.879,587.501 913.229,511.448 915.58,406.249 917.93,373.402 920.281,309.947 922.631,469.277 924.982,382.942 927.332,426.22 929.683,608.371 932.033,360.486 934.384,549.421 936.734,422.544 939.084,485.881 941.435,402.364 943.785,252.404 946.136,406.402 948.486,478.058 950.837,541.342 953.187,364.139 955.538,426.155 957.888,328.967 960.239,511.195 962.589,253.715 964.94,311.059 967.29,449.535 969.641,390.568 971.991,376.724 974.342,491.535 976.692,393.268 979.043,380.088 981.393,655.372 983.743,532.885 986.094,323.571 988.444,680.546 990.795,200.893 993.145,342.211 995.496,503.609 997.846,526.632 1000.2,360.017 1002.55,325.39 1004.9,498.12 1007.25,462.275 1009.6,365.758 1011.95,384.979 1014.3,376.651 1016.65,546.879 1019,300.639 1021.35,434.912 1023.7,438.146 1026.05,391.76 1028.4,639.381 1030.75,502.874 1033.1,531.135 1035.45,369.806 1037.8,272.02 1040.15,432.296 1042.51,446.168 1044.86,246.931 1047.21,380.897 1049.56,166.363 1051.91,458.05 1054.26,234.991 1056.61,358.739 1058.96,384.441 1061.31,356.928 1063.66,517.238 1066.01,367.84 1068.36,550.771 1070.71,396.063 1073.06,578.226 1075.41,589.118 1077.76,203.941 1080.11,251.087 1082.46,354.4 1084.81,432.093 1087.16,445.63 1089.51,324.372 1091.87,364.119 1094.22,404.31 1096.57,451.882 1098.92,579.258 1101.27,501.398 1103.62,510.664 1105.97,452.23 1108.32,472.933 1110.67,459.55 1113.02,412.662 1115.37,418.788 1117.72,390.191 1120.07,322.756 1122.42,251.752 1124.77,475.806 1127.12,500.666 1129.47,479.27 1131.82,442.927 1134.17,412.728 1136.52,342.559 1138.87,346.704 1141.23,513.621 1143.58,446.961 1145.93,533.22 1148.28,599.54 1150.63,291.35 1152.98,370.818 1155.33,428.258 1157.68,535.147 1160.03,381.735 1162.38,452.729 1164.73,395.896 1167.08,401.04 1169.43,358.986 1171.78,474.649 1174.13,410.495 1176.48,458.497 1178.83,455.99 1181.18,177.494 1183.53,409.74 1185.88,300.28 1188.23,384.249 1190.59,627.269 1192.94,471.257 1195.29,467.262 1197.64,417.417 1199.99,410.918 1202.34,262.186 1204.69,372.078 1207.04,314.442 1209.39,245.106 1211.74,456.282 1214.09,409.099 1216.44,317.73 1218.79,354.729 1221.14,505.397 1223.49,467.567 1225.84,387.395 1228.19,467.454 1230.54,217.037 1232.89,328.008 1235.24,402.699 1237.59,363.218 1239.94,385.141 1242.3,362.851 1244.65,540.585 1247,226.257 1249.35,359.556 1251.7,378.239 1254.05,502.804 1256.4,486.648 1258.75,358.966 1261.1,475.644 1263.45,347.303 1265.8,401.182 1268.15,514.181 1270.5,162.131 1272.85,455.452 1275.2,440.421 1277.55,502.672 1279.9,364.249 1282.25,485.502 1284.6,286.514 1286.95,340.316 1289.3,402.513 1291.66,467.027 1294.01,387.161 1296.36,358.488 1298.71,408.257 1301.06,566.641 1303.41,494.648 1305.76,438.465 1308.11,528.46 1310.46,317.832 1312.81,369.267 1315.16,414.513 1317.51,249.781 1319.86,316.534 1322.21,524.872 1324.56,347.832 1326.91,412.213 1329.26,295.989 1331.61,204.342 1333.96,462.678 1336.31,336.749 1338.66,300.955 1341.02,465.724 1343.37,273.411 1345.72,365.134 1348.07,430.311 1350.42,427.251 1352.77,307.987 1355.12,403.467 1357.47,595.95 1359.82,619.274 1362.17,518.307 1364.52,126.564 1366.87,668.701 1369.22,338.373 1371.57,475.365 1373.92,488.259 1376.27,679.66 1378.62,447.182 1380.97,530.457 1383.32,463.912 1385.67,478.984 1388.02,527.14 1390.38,355.872 1392.73,437.916 1395.08,325.439 1397.43,245.967 1399.78,493.438 1402.13,443.157 1404.48,396.214 1406.83,127.017 1409.18,377.219 1411.53,429.445 1413.88,370.126 1416.23,334.013 1418.58,396.673 1420.93,404.332 1423.28,259.322 1425.63,492.713 1427.98,370 1430.33,403.518 1432.68,395.874 1435.03,500.803 1437.38,376.54 1439.74,426.958 1442.09,551.586 1444.44,430.055 1446.79,322.08 1449.14,492.93 1451.49,568.668 1453.84,245.332 1456.19,513.156 1458.54,273.525 1460.89,527.727 1463.24,468.868 1465.59,316.707 1467.94,331.487 1470.29,233.719 1472.64,319.089 1474.99,422.18 1477.34,307.454 1479.69,384.224 1482.04,369.994 1484.39,463.715 1486.74,453.268 1489.1,371.47 1491.45,300.82 1493.8,359.872 1496.15,468.252 1498.5,369.933 1500.85,441.982 1503.2,378.946 1505.55,590.83 1507.9,444.075 1510.25,210.395 1512.6,345.355 1514.95,525.814 1517.3,445.227 1519.65,448.36 1522,558.175 1524.35,309.961 1526.7,360.328 1529.05,235.347 1531.4,500.579 1533.75,431.258 1536.1,434.142 1538.45,395.954 1540.81,504.622 1543.16,551.371 1545.51,452.479 1547.86,391.942 1550.21,236.301 1552.56,485.153 1554.91,324.004 1557.26,278.399 1559.61,320.757 1561.96,498.167 1564.31,559.135 1566.66,167.557 1569.01,449.933 1571.36,298.952 1573.71,221.178 1576.06,374.966 1578.41,442.368 1580.76,517.732 1583.11,406.407 1585.46,127.717 1587.81,472.153 1590.17,331.403 1592.52,411.101 1594.87,422.487 1597.22,338.123 1599.57,359.741 1601.92,147.546 1604.27,319.613 1606.62,469.47 1608.97,299.79 1611.32,460.38 1613.67,411.428 1616.02,316.652 1618.37,287.101 1620.72,546.052 1623.07,550.646 1625.42,553.847 1627.77,384.316 1630.12,433.768 1632.47,364.478 1634.82,394.859 1637.17,296.796 1639.53,390.353 1641.88,224.672 1644.23,453.694 1646.58,266.857 1648.93,330.291 1651.28,436.239 1653.63,542.589 1655.98,357.738 1658.33,137.802 1660.68,467.559 1663.03,300.24 1665.38,253.744 1667.73,339.085 1670.08,193.238 1672.43,199.234 1674.78,456.874 1677.13,343.783 1679.48,434.697 1681.83,576.382 1684.18,380.281 1686.53,441.324 1688.89,382.245 1691.24,370.31 1693.59,488.285 1695.94,566.482 1698.29,423.894 1700.64,407.881 1702.99,295.563 1705.34,362.593 1707.69,421.209 1710.04,564.807 1712.39,370.225 1714.74,396.312 1717.09,420.142 1719.44,319.616 1721.79,430.307 1724.14,367.697 1726.49,96.8724 1728.84,371.992 1731.19,600.133 1733.54,224.23 1735.89,381.818 1738.25,359.525 1740.6,374.511 1742.95,262.48 1745.3,535.215 1747.65,355.789 1750,357.526 1752.35,295.512 1754.7,392.664 1757.05,252.297 1759.4,467.47 1761.75,454.936 1764.1,511.69 1766.45,316.919 1768.8,475.813 1771.15,294.945 1773.5,363.788 1775.85,560.954 1778.2,215.966 1780.55,389.476 1782.9,542.792 1785.25,330.16 1787.6,423.153 1789.96,381.072 1792.31,205.015 1794.66,395.82 1797.01,392.814 1799.36,419.574 1801.71,418.518 1804.06,548.449 1806.41,414.908 1808.76,551.917 1811.11,294.102 1813.46,317.212 1815.81,493.05 1818.16,414.812 1820.51,411.916 1822.86,385.113 1825.21,537.819 1827.56,351.797 1829.91,352.406 1832.26,320.77 1834.61,327.861 1836.96,371.188 1839.32,512.236 1841.67,380.825 1844.02,318.465 1846.37,319.594 1848.72,224.283 1851.07,364.943 1853.42,302.897 1855.77,358.897 1858.12,354.627 1860.47,453.255 1862.82,371.207 1865.17,430.05 1867.52,373.069 1869.87,376.379 1872.22,582.618 1874.57,364.541 1876.92,470.01 1879.27,458.295 1881.62,455.201 1883.97,445.544 1886.32,424.05 1888.68,447.2 1891.03,355.892 1893.38,471.051 1895.73,447.318 1898.08,347.876 1900.43,334.55 1902.78,378.586 1905.13,279.854 1907.48,556.692 1909.83,549.19 1912.18,476.874 1914.53,442.831 1916.88,428.863 1919.23,396.449 1921.58,417.93 1923.93,407.302 1926.28,378.471 1928.63,398.049 1930.98,472.564 1933.33,392.318 1935.68,504.748 1938.04,504.9 1940.39,458.612 1942.74,427.26 1945.09,356.383 1947.44,372.017 1949.79,265.357 1952.14,507.155 1954.49,520.004 1956.84,438.801 1959.19,356.436 1961.54,362.101 1963.89,328.029 1966.24,483.221 1968.59,352.813 1970.94,413.134 1973.29,521.812 1975.64,369.634 1977.99,389.501 1980.34,463.338 1982.69,367.638 1985.04,505.884 1987.4,428.516 1989.75,513.172 1992.1,331.916 1994.45,247.208 1996.8,384.336 1999.15,424.049 2001.5,304.097 2003.85,242.072 2006.2,274.126 2008.55,165.742 2010.9,369.373 2013.25,340.318 2015.6,387.449 2017.95,342.219 2020.3,359.408 2022.65,398.673 2025,398.085 2027.35,345.873 2029.7,410.742 2032.05,613.121 2034.4,181.432 2036.76,318.715 2039.11,400.483 2041.46,283.985 2043.81,416.53 2046.16,433.034 2048.51,206.645 2050.86,360.087 2053.21,416.673 2055.56,430.692 2057.91,268.147 2060.26,439.057 2062.61,467.569 2064.96,477.172 2067.31,445.804 2069.66,267.842 2072.01,414.482 2074.36,490.443 2076.71,340.43 2079.06,531.241 2081.41,321.484 2083.76,288.302 2086.11,490.627 2088.47,495.267 2090.82,424.401 2093.17,227.454 2095.52,383.511 2097.87,560.804 2100.22,330.979 2102.57,345.093 2104.92,546.884 2107.27,483.599 2109.62,439.912 2111.97,525.611 2114.32,284.857 2116.67,231.508 2119.02,672.098 2121.37,466.112 2123.72,240.764 2126.07,569 2128.42,504.679 2130.77,224.218 2133.12,389.014 2135.47,591.497 2137.83,280.102 2140.18,360.432 2142.53,407.284 2144.88,414.68 2147.23,205.111 2149.58,409.716 2151.93,423.465 2154.28,558.961 2156.63,451.315 2158.98,521.942 2161.33,237.66 2163.68,499.266 2166.03,402.534 2168.38,496.041 2170.73,512.731 2173.08,450.12 2175.43,209.783 2177.78,403.444 2180.13,500.276 2182.48,323.943 2184.83,396.943 2187.19,445.579 2189.54,226.293 2191.89,331.399 2194.24,319.432 2196.59,461.379 2198.94,631.121 2201.29,342.53 2203.64,243.757 2205.99,500.918 2208.34,348.542 2210.69,441.358 2213.04,399.803 2215.39,364.168 2217.74,324.577 2220.09,566.509 2222.44,380.275 2224.79,310.582 2227.14,371.478 2229.49,631.076 2231.84,396.814 2234.19,221.086 2236.55,432.191 2238.9,545.114 2241.25,378.801 2243.6,698.19 2245.95,423.75 2248.3,318.541 2250.65,345.861 2253,577.923 2255.35,549.263 2257.7,524.617 2260.05,324.591 2262.4,321.135 2264.75,301.58 2267.1,483.52 2269.45,342.458 2271.8,304.182 2274.15,621.883 2276.5,568.358 2278.85,310.747 2281.2,205.643 2283.55,415.644 2285.91,485.036 2288.26,500.06 2290.61,372.496 2292.96,378.396 2295.31,227.481 2297.66,539.623 2300.01,324.534 2302.36,450.975 2304.71,435.742 2307.06,238.327 2309.41,341.522 2311.76,355.705 2314.11,371.993 2316.46,396.331 2318.81,442.834 2321.16,499.988 2323.51,406.604 2325.86,532.155 2328.21,340.128 2330.56,388.348 2332.91,506.287 2335.27,299.828 2337.62,440.165 2339.97,455.231 2342.32,452.369 2344.67,267.581 2347.02,437.228 2349.37,521.977 2351.72,480.695 2354.07,397.17 2356.42,318.682 2358.77,592.704 2361.12,252.026 2363.47,599.064 2365.82,508.197 2368.17,342.7 2370.52,464.501 2372.87,387.382 2375.22,532.636 2377.57,351.348 2379.92,401.247 2382.27,387.817 2384.62,423.315 2386.98,495.805 2389.33,250.299 2391.68,293.317 2394.03,426.753 2396.38,508.141 2398.73,362.393 2401.08,427.511 2403.43,460.434 2405.78,345.154 2408.13,488.767 2410.48,259.556 2412.83,543.378 2415.18,291.389 2417.53,524.856 2419.88,523.89 2422.23,509.86 2424.58,491.008 2426.93,437.896 2429.28,511.582 2431.63,386.733 2433.98,641.182 2436.34,271.401 2438.69,493.434 2441.04,361.055 2443.39,411.79 2445.74,298.225 2448.09,277.501 2450.44,359.139 2452.79,505.108 2455.14,193.591 2457.49,392.349 2459.84,579.075 2462.19,350.717 2464.54,546.973 2466.89,705.655 2469.24,324.913 2471.59,498.866 2473.94,198.65 2476.29,297.261 2478.64,376.179 2480.99,382.233 2483.34,486.675 2485.7,399.389 2488.05,528.268 2490.4,377.055 2492.75,366.946 2495.1,387.215 2497.45,517.855 2499.8,451.154 2502.15,510.002 2504.5,399.205 2506.85,300.339 2509.2,437.783 2511.55,342.258 2513.9,467.005 2516.25,388.594 2518.6,195.742 2520.95,412.49 2523.3,508.722 2525.65,551.023 2528,473.737 2530.35,399.884 2532.7,490.46 2535.06,430.53 2537.41,395.847 2539.76,470.449 2542.11,467.758 2544.46,476.19 2546.81,461.527 2549.16,513.781 2551.51,280.794 2553.86,609.557 2556.21,379.706 2558.56,425.873 2560.91,366.166 2563.26,402.84 2565.61,421.779 2567.96,414.937 2570.31,140.516 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.49436   -3.33693   -3.33693   …  -6.35018   -5.28652   -5.00048
 -0.708837  -0.881721  -0.881721      0.533146   0.280891   0.0760523
  3.67761    6.76736    6.76736       5.99236    4.73352    3.23937

[:, :, 2] =
 -3.23128  -4.63701  -5.19597   …  -6.26256   -8.0211    -5.98898
  2.13908  -0.58236   0.211759     -0.428333   0.338404   0.0755484
  2.75518   4.6013    3.74018       5.31032    5.35523    5.75841

[:, :, 3] =
 -4.25745   -3.67851   -2.08507  -3.72605   …  -4.20023  -4.6698   -4.18605
 -0.3499    -0.485326  -1.02343   0.372638     -1.01085  -1.54425  -1.85013
  0.224734   3.00022    4.95372   5.32009       5.33145   3.56344   4.58621

[:, :, 4] =
 -0.724458  -1.98501  -4.41413  -3.45952  …  -4.73509   -6.21778  -5.90985
  0.828458  -1.12734  -1.43765  -1.51763     -0.382274  -2.5306   -1.25651
  3.33083    5.43566   3.60759   4.61621      4.07434    3.98997   5.05393</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.04155    0.996042
 -0.0272807  0.989425
  5.00831    0.993109</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.53 seconds
Compute duration  = 2.53 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9784    1.0110    0.0178   3218.9391   5142.8029    1.0015   ⋯
        x[2]    0.0132    1.0031    0.0178   3179.1533   4449.2191    1.0003   ⋯
        x[3]    4.9756    1.0031    0.0175   3271.2677   5273.3100    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9264   -5.6661   -4.9866   -4.2977   -3.0011
        x[2]   -1.9418   -0.6807    0.0198    0.7035    1.9676
        x[3]    2.9947    4.2922    4.9794    5.6695    6.9029</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.48 seconds
Compute duration  = 1.48 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5011    0.1902    0.0029   4264.0594   5729.1840    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1449    0.3608    0.5019    0.6433    0.8549</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.9720    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.9720    0.9720    0.9720    0.9720    0.9720</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-2.0274443469397796, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -2.0274443469397796:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/ji8PW/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/Lj3Lu/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/Lj3Lu/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Lj3Lu/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/Lj3Lu/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Lj3Lu/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Lj3Lu/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/axR9Q/src/mcmc/Inference.jl:341
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/axR9Q/src/mcmc/Inference.jl:224
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/axR9Q/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/axR9Q/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/axR9Q/src/mcmc/abstractmcmc.jl:178
 [18] step
    @ ~/.julia/packages/Turing/axR9Q/src/mcmc/abstractmcmc.jl:133 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Lj3Lu/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/Lj3Lu/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/axR9Q/src/mcmc/Inference.jl:274 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/axR9Q/src/mcmc/Inference.jl:265 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/axR9Q/src/mcmc/Inference.jl:262 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.61 seconds
Compute duration  = 1.61 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8146    0.5724    0.0389   273.2478   210.1551    1.0041     ⋯
           x    0.0929    1.0963    0.1124    93.3270   300.7608    1.0197     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1420    0.3850    0.6457    1.1548    2.2518
           x   -2.6155   -0.3291    0.0833    0.7674    2.0053</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.9 seconds
Compute duration  = 2.9 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8815    0.5414    0.0261   355.2964   199.3795    1.0007     ⋯
           x    0.0142    1.0626    0.0618   416.8689   280.7593    1.0002     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1648    0.4448    0.7740    1.2409    2.0764
           x   -2.4083   -0.3897    0.0123    0.4531    2.2050</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>