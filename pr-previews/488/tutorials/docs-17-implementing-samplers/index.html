<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.1">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.31" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.31</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.31">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-37.05590269609623</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-37.05590269609623</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.78278  -4.13367  -5.68879   …  -3.47171   -5.16638   -5.12906
 -1.10107  -1.84306   0.188861      0.638975   0.450465  -0.0722107
  1.26035   2.91182   3.92924       6.78755    4.97132    2.82473</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0188     0.971507
 -0.0161385  0.991921
  4.98162    1.00555</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip340">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip340)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip341">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip340)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip342">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip340)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1552.52 2640.76,1552.52 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1244.15 2640.76,1244.15 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,935.786 2640.76,935.786 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,627.421 2640.76,627.421 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,319.056 2640.76,319.056 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1552.52 170.644,1552.52 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1244.15 170.644,1244.15 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,935.786 170.644,935.786 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,627.421 170.644,627.421 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,319.056 170.644,319.056 "></polyline>
<path clip-path="url(#clip340)" d="M49.5521 1552.97 L79.2279 1552.97 L79.2279 1556.9 L49.5521 1556.9 L49.5521 1552.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M99.8991 1550.65 Q96.7509 1550.65 94.8991 1552.81 Q93.0704 1554.96 93.0704 1558.71 Q93.0704 1562.44 94.8991 1564.61 Q96.7509 1566.76 99.8991 1566.76 Q103.047 1566.76 104.876 1564.61 Q106.728 1562.44 106.728 1558.71 Q106.728 1554.96 104.876 1552.81 Q103.047 1550.65 99.8991 1550.65 M109.181 1536 L109.181 1540.26 Q107.422 1539.43 105.617 1538.99 Q103.834 1538.55 102.075 1538.55 Q97.4454 1538.55 94.9917 1541.67 Q92.5612 1544.8 92.2139 1551.12 Q93.5797 1549.1 95.6398 1548.04 Q97.7 1546.95 100.177 1546.95 Q105.385 1546.95 108.394 1550.12 Q111.427 1553.27 111.427 1558.71 Q111.427 1564.03 108.279 1567.25 Q105.131 1570.47 99.8991 1570.47 Q93.9037 1570.47 90.7325 1565.89 Q87.5612 1561.28 87.5612 1552.55 Q87.5612 1544.36 91.45 1539.5 Q95.3389 1534.61 101.89 1534.61 Q103.649 1534.61 105.431 1534.96 Q107.237 1535.31 109.181 1536 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M50.3623 1244.6 L80.0381 1244.6 L80.0381 1248.54 L50.3623 1248.54 L50.3623 1244.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M104.297 1242.8 Q107.654 1243.52 109.529 1245.78 Q111.427 1248.05 111.427 1251.39 Q111.427 1256.5 107.908 1259.3 Q104.39 1262.1 97.9083 1262.1 Q95.7324 1262.1 93.4176 1261.66 Q91.126 1261.25 88.6723 1260.39 L88.6723 1255.88 Q90.6167 1257.01 92.9315 1257.59 Q95.2463 1258.17 97.7695 1258.17 Q102.168 1258.17 104.459 1256.43 Q106.774 1254.7 106.774 1251.39 Q106.774 1248.33 104.621 1246.62 Q102.492 1244.88 98.6722 1244.88 L94.6445 1244.88 L94.6445 1241.04 L98.8574 1241.04 Q102.306 1241.04 104.135 1239.67 Q105.964 1238.28 105.964 1235.69 Q105.964 1233.03 104.066 1231.62 Q102.191 1230.18 98.6722 1230.18 Q96.7509 1230.18 94.5519 1230.6 Q92.3528 1231.02 89.7139 1231.9 L89.7139 1227.73 Q92.376 1226.99 94.6908 1226.62 Q97.0287 1226.25 99.0889 1226.25 Q104.413 1226.25 107.515 1228.68 Q110.617 1231.08 110.617 1235.21 Q110.617 1238.08 108.973 1240.07 Q107.33 1242.03 104.297 1242.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M99.4824 921.585 Q95.8713 921.585 94.0426 925.15 Q92.2371 928.692 92.2371 935.821 Q92.2371 942.928 94.0426 946.492 Q95.8713 950.034 99.4824 950.034 Q103.117 950.034 104.922 946.492 Q106.751 942.928 106.751 935.821 Q106.751 928.692 104.922 925.15 Q103.117 921.585 99.4824 921.585 M99.4824 917.881 Q105.293 917.881 108.348 922.488 Q111.427 927.071 111.427 935.821 Q111.427 944.548 108.348 949.154 Q105.293 953.738 99.4824 953.738 Q93.6723 953.738 90.5936 949.154 Q87.538 944.548 87.538 935.821 Q87.538 927.071 90.5936 922.488 Q93.6723 917.881 99.4824 917.881 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M104.297 626.067 Q107.654 626.784 109.529 629.053 Q111.427 631.321 111.427 634.655 Q111.427 639.771 107.908 642.571 Q104.39 645.372 97.9083 645.372 Q95.7324 645.372 93.4176 644.933 Q91.126 644.516 88.6723 643.659 L88.6723 639.146 Q90.6167 640.28 92.9315 640.858 Q95.2463 641.437 97.7695 641.437 Q102.168 641.437 104.459 639.701 Q106.774 637.965 106.774 634.655 Q106.774 631.599 104.621 629.886 Q102.492 628.15 98.6722 628.15 L94.6445 628.15 L94.6445 624.308 L98.8574 624.308 Q102.306 624.308 104.135 622.942 Q105.964 621.553 105.964 618.96 Q105.964 616.298 104.066 614.886 Q102.191 613.451 98.6722 613.451 Q96.7509 613.451 94.5519 613.868 Q92.3528 614.285 89.7139 615.164 L89.7139 610.998 Q92.376 610.257 94.6908 609.886 Q97.0287 609.516 99.0889 609.516 Q104.413 609.516 107.515 611.947 Q110.617 614.354 110.617 618.474 Q110.617 621.345 108.973 623.335 Q107.33 625.303 104.297 626.067 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M99.8991 317.192 Q96.7509 317.192 94.8991 319.345 Q93.0704 321.498 93.0704 325.248 Q93.0704 328.975 94.8991 331.15 Q96.7509 333.303 99.8991 333.303 Q103.047 333.303 104.876 331.15 Q106.728 328.975 106.728 325.248 Q106.728 321.498 104.876 319.345 Q103.047 317.192 99.8991 317.192 M109.181 302.539 L109.181 306.799 Q107.422 305.965 105.617 305.526 Q103.834 305.086 102.075 305.086 Q97.4454 305.086 94.9917 308.211 Q92.5612 311.336 92.2139 317.655 Q93.5797 315.641 95.6398 314.576 Q97.7 313.489 100.177 313.489 Q105.385 313.489 108.394 316.66 Q111.427 319.808 111.427 325.248 Q111.427 330.572 108.279 333.789 Q105.131 337.007 99.8991 337.007 Q93.9037 337.007 90.7325 332.424 Q87.5612 327.817 87.5612 319.09 Q87.5612 310.896 91.45 306.035 Q95.3389 301.151 101.89 301.151 Q103.649 301.151 105.431 301.498 Q107.237 301.845 109.181 302.539 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip342)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1221.82 224.541,1518.17 226.891,1614.35 229.242,1605.06 231.592,1665.43 233.943,1317.49 236.293,1521.74 238.644,1455.86 240.994,1410.64 243.345,1506.28 245.695,1326.53 248.046,1565.95 250.396,1516.52 252.747,1492.69 255.097,1502.85 257.448,1575.53 259.798,1638.52 262.148,1443.04 264.499,1445.56 266.849,1395.36 269.2,1494.2 271.55,1454.48 273.901,1572.75 276.251,1398.11 278.602,1420.14 280.952,1501.87 283.303,1454.99 285.653,1303 288.004,1617.95 290.354,1603.32 292.705,1500.56 295.055,1587.82 297.406,1539.99 299.756,1536.39 302.107,1646.52 304.457,1488.92 306.807,1400.46 309.158,1570.19 311.508,1438.94 313.859,1445.24 316.209,1234.75 318.56,1387.29 320.91,1589.47 323.261,1519.18 325.611,1420.51 327.962,1477.39 330.312,1537.65 332.663,1490.95 335.013,1464.19 337.364,1449.21 339.714,1389.44 342.065,1372.38 344.415,1456.4 346.765,1497.35 349.116,1483.9 351.466,1618.66 353.817,1431.07 356.167,1501.85 358.518,1315.22 360.868,1598.25 363.219,1219.32 365.569,1370.53 367.92,1450.97 370.27,1354.37 372.621,1490.13 374.971,1417.72 377.322,1393.12 379.672,1739 382.023,1426.22 384.373,1510.37 386.724,1282.8 389.074,1483.49 391.424,1471.7 393.775,1375.4 396.125,1556.55 398.476,1469.59 400.826,1421.46 403.177,1505.34 405.527,1347.29 407.878,1213.55 410.228,1395.65 412.579,1399.1 414.929,1459.06 417.28,1588.62 419.63,1512.02 421.981,1547.06 424.331,1503.58 426.682,1363.55 429.032,1580.53 431.382,1411.31 433.733,1493.58 436.083,1478.68 438.434,1395.95 440.784,1479.84 443.135,1543.23 445.485,1457.96 447.836,1367.7 450.186,1262.22 452.537,1534.28 454.887,1255.52 457.238,1519.96 459.588,1568.54 461.939,1420.53 464.289,1406.52 466.64,1614.71 468.99,1352.39 471.341,1481.02 473.691,1416.95 476.041,1509.67 478.392,1449.26 480.742,1555.86 483.093,1332.14 485.443,1501.34 487.794,1234.48 490.144,1561.16 492.495,1481.8 494.845,1574.41 497.196,1473.42 499.546,1379.39 501.897,1463.84 504.247,1556.37 506.598,1412.51 508.948,1408.83 511.299,1508.26 513.649,1676.05 515.999,1420.23 518.35,1528.54 520.7,1724.06 523.051,1404.81 525.401,1454.42 527.752,1498.12 530.102,1427.89 532.453,1295.78 534.803,1458.3 537.154,1414.78 539.504,1210.51 541.855,1660.8 544.205,1639.56 546.556,1327.08 548.906,1473.31 551.257,1439.55 553.607,1418.81 555.958,1256.34 558.308,1437.04 560.658,1547.57 563.009,1481.89 565.359,1704.42 567.71,1465.52 570.06,1383.42 572.411,1596.02 574.761,1332.56 577.112,1369.8 579.462,1475.78 581.813,1546.96 584.163,1395.74 586.514,1388.97 588.864,1384.99 591.215,1571.52 593.565,1479.07 595.916,1362.04 598.266,1397.99 600.616,1456.36 602.967,1257.24 605.317,1492.28 607.668,1428.07 610.018,1407.02 612.369,1329.37 614.719,1491.59 617.07,1391.44 619.42,1523.49 621.771,1484.01 624.121,1323.58 626.472,1416.26 628.822,1349.2 631.173,1465.3 633.523,1447.85 635.874,1539.22 638.224,1342.3 640.575,1468.29 642.925,1236.52 645.275,1403.22 647.626,1462.91 649.976,1448.4 652.327,1319.65 654.677,1406.19 657.028,1587.75 659.378,1465.96 661.729,1534.03 664.079,1431.76 666.43,1372.19 668.78,1401.27 671.131,1352.43 673.481,1621.15 675.832,1582.75 678.182,1648.5 680.533,1501.39 682.883,1454.51 685.233,1443.16 687.584,1410.7 689.934,1364.45 692.285,1498.78 694.635,1475.71 696.986,1574.56 699.336,1473.98 701.687,1374.27 704.037,1490.5 706.388,1534.91 708.738,1486.21 711.089,1390.83 713.439,1504.7 715.79,1507.33 718.14,1325.44 720.491,1435.27 722.841,1332.47 725.192,1505.2 727.542,1587.43 729.892,1488.49 732.243,1329.88 734.593,1526.64 736.944,1396.24 739.294,1593.79 741.645,1489.85 743.995,1473.72 746.346,1506.66 748.696,1413.78 751.047,1609.68 753.397,1479.73 755.748,1446.67 758.098,1316.98 760.449,1520.92 762.799,1449.8 765.15,1689.11 767.5,1453.87 769.85,1398.06 772.201,1503.42 774.551,1583.87 776.902,1402.66 779.252,1631.38 781.603,1666.99 783.953,1530.72 786.304,1272.66 788.654,1445.73 791.005,1656.9 793.355,1597.23 795.706,1386.53 798.056,1499.42 800.407,1597.57 802.757,1629.13 805.108,1632.79 807.458,1579.96 809.809,1371.77 812.159,1350 814.509,1362.89 816.86,1361.14 819.21,1498.65 821.561,1632.59 823.911,1610.21 826.262,1442.13 828.612,1500.43 830.963,1483.8 833.313,1331.66 835.664,1442.37 838.014,1456.69 840.365,1572.26 842.715,1429.63 845.066,1363.09 847.416,1519.79 849.767,1380.15 852.117,1351.15 854.467,1413.91 856.818,1538.76 859.168,1461.29 861.519,1289.51 863.869,1217.01 866.22,1459.83 868.57,1464.55 870.921,1492.58 873.271,1472.88 875.622,1359.07 877.972,1440.05 880.323,1327.13 882.673,1430.35 885.024,1509.24 887.374,1466.35 889.725,1414.02 892.075,1478.3 894.426,1528.12 896.776,1312.29 899.126,1501.51 901.477,1538.25 903.827,1447.33 906.178,1449.24 908.528,1403.87 910.879,1404.51 913.229,1577.65 915.58,1523.41 917.93,1349.53 920.281,1368.42 922.631,1548.03 924.982,1418.99 927.332,1560.52 929.683,1400.08 932.033,1622.43 934.384,1481.34 936.734,1553.63 939.084,1313.95 941.435,1429.66 943.785,1530.3 946.136,1615.57 948.486,1406.85 950.837,1436.18 953.187,1366.67 955.538,1397.94 957.888,1355.73 960.239,1353.13 962.589,1387.21 964.94,1418.5 967.29,1438.95 969.641,1385.5 971.991,1411.18 974.342,1453.49 976.692,1404.76 979.043,1440.74 981.393,1415.34 983.743,1298 986.094,1376.05 988.444,1183.03 990.795,1516.88 993.145,1444.21 995.496,1279.29 997.846,1396.77 1000.2,1615.6 1002.55,1506.3 1004.9,1344.79 1007.25,1625.32 1009.6,1248.84 1011.95,1454.18 1014.3,1454.87 1016.65,1415.9 1019,1692.22 1021.35,1503.86 1023.7,1364.3 1026.05,1384.14 1028.4,1541.92 1030.75,1456.59 1033.1,1491.84 1035.45,1428.01 1037.8,1290.87 1040.15,1475.58 1042.51,1299.79 1044.86,1368.5 1047.21,1436.05 1049.56,1427.85 1051.91,1557.63 1054.26,1432.8 1056.61,1554.74 1058.96,1439.87 1061.31,1560.35 1063.66,1338.74 1066.01,1410.92 1068.36,1477.52 1070.71,1387.61 1073.06,1299.25 1075.41,1573.55 1077.76,1433.08 1080.11,1513.31 1082.46,1529.21 1084.81,1484.16 1087.16,1416.81 1089.51,1401.29 1091.87,1582.6 1094.22,1607.98 1096.57,1464.96 1098.92,1452.78 1101.27,1202.33 1103.62,1465.05 1105.97,1512.7 1108.32,1566.42 1110.67,1521.31 1113.02,1468.36 1115.37,1458.4 1117.72,1408.6 1120.07,1582.88 1122.42,1416.84 1124.77,1470.67 1127.12,1437.55 1129.47,1450.25 1131.82,1580.46 1134.17,1588.12 1136.52,1692.2 1138.87,1631.41 1141.23,1363.16 1143.58,1378.81 1145.93,1609.6 1148.28,1446.16 1150.63,1373.84 1152.98,1473.53 1155.33,1463.5 1157.68,1477.7 1160.03,1424.99 1162.38,1671.22 1164.73,1518.23 1167.08,1326.03 1169.43,1617.95 1171.78,1319.4 1174.13,1348.78 1176.48,1507.57 1178.83,1338.98 1181.18,1494.78 1183.53,1484.28 1185.88,1398.11 1188.23,1314.82 1190.59,1556.87 1192.94,1485.75 1195.29,1500.89 1197.64,1396.54 1199.99,1617.37 1202.34,1330.77 1204.69,1478.14 1207.04,1417.94 1209.39,1338.98 1211.74,1448.54 1214.09,1438.48 1216.44,1429.24 1218.79,1399.65 1221.14,1702.22 1223.49,1442.49 1225.84,1628.76 1228.19,1378.74 1230.54,1471.13 1232.89,1462.39 1235.24,1381.97 1237.59,1511.04 1239.94,1267.52 1242.3,1364.52 1244.65,1510.26 1247,1416.04 1249.35,1511.05 1251.7,1469.41 1254.05,1450.54 1256.4,1435.77 1258.75,1439.07 1261.1,1485.26 1263.45,1499.43 1265.8,1251.35 1268.15,1318.43 1270.5,1398.19 1272.85,1541.15 1275.2,1447.39 1277.55,1453.81 1279.9,1581.76 1282.25,1539.92 1284.6,1483.34 1286.95,1459.52 1289.3,1493.74 1291.66,1422.29 1294.01,1563.08 1296.36,1646.63 1298.71,1461.12 1301.06,1567.03 1303.41,1531.81 1305.76,1371.21 1308.11,1486.38 1310.46,1410.57 1312.81,1357.54 1315.16,1496.99 1317.51,1440.81 1319.86,1302.97 1322.21,1369.89 1324.56,1534.7 1326.91,1473.63 1329.26,1531.99 1331.61,1478.03 1333.96,1497.19 1336.31,1411.64 1338.66,1437.22 1341.02,1329.88 1343.37,1558.2 1345.72,1580.11 1348.07,1534.13 1350.42,1378.27 1352.77,1433.85 1355.12,1334.48 1357.47,1362.31 1359.82,1482.64 1362.17,1546.12 1364.52,1586.17 1366.87,1566.58 1369.22,1433.59 1371.57,1465.52 1373.92,1590.63 1376.27,1337.66 1378.62,1294.88 1380.97,1316.68 1383.32,1289.88 1385.67,1538.87 1388.02,1283.1 1390.38,1491.64 1392.73,1643.54 1395.08,1605.55 1397.43,1320.99 1399.78,1449.09 1402.13,1418.06 1404.48,1533.23 1406.83,1379.06 1409.18,1467.74 1411.53,1324.89 1413.88,1548.36 1416.23,1505.93 1418.58,1560.36 1420.93,1361.77 1423.28,1468.4 1425.63,1486.31 1427.98,1463.41 1430.33,1521.67 1432.68,1319.43 1435.03,1401.71 1437.38,1429.28 1439.74,1376.8 1442.09,1390.44 1444.44,1497.25 1446.79,1486.68 1449.14,1461.82 1451.49,1406.83 1453.84,1551.9 1456.19,1335.51 1458.54,1490.58 1460.89,1520.67 1463.24,1508.94 1465.59,1420.34 1467.94,1361.9 1470.29,1580.21 1472.64,1546.82 1474.99,1531.21 1477.34,1400.78 1479.69,1380.55 1482.04,1560.03 1484.39,1480.68 1486.74,1337.57 1489.1,1388.63 1491.45,1469.3 1493.8,1386.39 1496.15,1441.41 1498.5,1384.15 1500.85,1482.59 1503.2,1470.63 1505.55,1285.01 1507.9,1310.01 1510.25,1489.67 1512.6,1612.93 1514.95,1325.1 1517.3,1354.35 1519.65,1341.65 1522,1348.46 1524.35,1399.03 1526.7,1570.49 1529.05,1340 1531.4,1605.86 1533.75,1389.76 1536.1,1466.46 1538.45,1247.61 1540.81,1349.79 1543.16,1577.5 1545.51,1382.61 1547.86,1401.64 1550.21,1512.63 1552.56,1345.57 1554.91,1292.29 1557.26,1377.61 1559.61,1323.37 1561.96,1297.1 1564.31,1515.66 1566.66,1396.62 1569.01,1291.36 1571.36,1484.52 1573.71,1316.06 1576.06,1582.57 1578.41,1306.75 1580.76,1456.62 1583.11,1235.62 1585.46,1318.69 1587.81,1522.05 1590.17,1570.71 1592.52,1588.21 1594.87,1461.08 1597.22,1564.97 1599.57,1335.82 1601.92,1509.26 1604.27,1415.39 1606.62,1448.94 1608.97,1371.67 1611.32,1427.99 1613.67,1418.73 1616.02,1393.78 1618.37,1682.17 1620.72,1352.59 1623.07,1454.83 1625.42,1385.75 1627.77,1441.23 1630.12,1486.09 1632.47,1463.61 1634.82,1529.22 1637.17,1464.49 1639.53,1244.15 1641.88,1346.62 1644.23,1535.32 1646.58,1440.62 1648.93,1246.24 1651.28,1404.23 1653.63,1591.43 1655.98,1526.74 1658.33,1170.42 1660.68,1322.89 1663.03,1398.71 1665.38,1474.07 1667.73,1464.05 1670.08,1341.38 1672.43,1353.51 1674.78,1432.29 1677.13,1503.97 1679.48,1358.31 1681.83,1421.43 1684.18,1424.14 1686.53,1379.61 1688.89,1462.45 1691.24,1371.16 1693.59,1458.73 1695.94,1690.44 1698.29,1489.48 1700.64,1565.96 1702.99,1529.23 1705.34,1532.84 1707.69,1593.81 1710.04,1390.05 1712.39,1367.54 1714.74,1575.15 1717.09,1534.44 1719.44,1319.7 1721.79,1444.65 1724.14,1409.37 1726.49,1511.95 1728.84,1607.53 1731.19,1301.41 1733.54,1539.78 1735.89,1624.26 1738.25,1413.09 1740.6,1536.22 1742.95,1421.32 1745.3,1448.52 1747.65,1404.82 1750,1449.5 1752.35,1468.13 1754.7,1542.35 1757.05,1390.97 1759.4,1390.83 1761.75,1387.97 1764.1,1395.05 1766.45,1476.71 1768.8,1280.35 1771.15,1461.67 1773.5,1536.65 1775.85,1459.08 1778.2,1458.36 1780.55,1391.22 1782.9,1451.68 1785.25,1665.44 1787.6,1345.86 1789.96,1527.33 1792.31,1573.34 1794.66,1410.73 1797.01,1376.37 1799.36,1402.42 1801.71,1468.06 1804.06,1439.34 1806.41,1535.16 1808.76,1411.28 1811.11,1527.07 1813.46,1513.09 1815.81,1402.77 1818.16,1559.84 1820.51,1358.58 1822.86,1476.54 1825.21,1563.25 1827.56,1478.33 1829.91,1431.34 1832.26,1339.7 1834.61,1302.2 1836.96,1598.63 1839.32,1353.5 1841.67,1492.18 1844.02,1540.81 1846.37,1353.38 1848.72,1452.75 1851.07,1580.05 1853.42,1550.26 1855.77,1433.61 1858.12,1336.37 1860.47,1637.4 1862.82,1569.79 1865.17,1274.61 1867.52,1348.14 1869.87,1474.28 1872.22,1388.55 1874.57,1470.56 1876.92,1518.08 1879.27,1308.34 1881.62,1463.96 1883.97,1399.69 1886.32,1382.46 1888.68,1251.31 1891.03,1489.17 1893.38,1308.71 1895.73,1514.33 1898.08,1325.57 1900.43,1370.42 1902.78,1525.22 1905.13,1490.6 1907.48,1522.16 1909.83,1500.42 1912.18,1423.67 1914.53,1351.94 1916.88,1521.17 1919.23,1369.02 1921.58,1513.31 1923.93,1399.84 1926.28,1456.24 1928.63,1431.68 1930.98,1529.26 1933.33,1575.67 1935.68,1546.03 1938.04,1431.7 1940.39,1532.47 1942.74,1337.83 1945.09,1281.07 1947.44,1241.18 1949.79,1575.11 1952.14,1447.85 1954.49,1487.64 1956.84,1538.92 1959.19,1449.72 1961.54,1429.63 1963.89,1518.64 1966.24,1670.01 1968.59,1348.52 1970.94,1379.86 1973.29,1488.67 1975.64,1707.43 1977.99,1329.59 1980.34,1435.73 1982.69,1450.95 1985.04,1485.92 1987.4,1650.19 1989.75,1286.29 1992.1,1485.3 1994.45,1564.87 1996.8,1547.44 1999.15,1547.61 2001.5,1371.3 2003.85,1522.97 2006.2,1374.18 2008.55,1416.89 2010.9,1674.82 2013.25,1452.64 2015.6,1385.3 2017.95,1379.34 2020.3,1740.13 2022.65,1439.3 2025,1341.74 2027.35,1499.04 2029.7,1325.89 2032.05,1196.65 2034.4,1402.42 2036.76,1491.63 2039.11,1400.01 2041.46,1304.98 2043.81,1306.32 2046.16,1371.99 2048.51,1372.26 2050.86,1450.39 2053.21,1517.75 2055.56,1401.6 2057.91,1437.94 2060.26,1526.84 2062.61,1361.86 2064.96,1381.84 2067.31,1354.93 2069.66,1542.67 2072.01,1574.32 2074.36,1459.12 2076.71,1363.56 2079.06,1541.82 2081.41,1431.42 2083.76,1590.44 2086.11,1411.75 2088.47,1359.21 2090.82,1374.99 2093.17,1461.25 2095.52,1504.72 2097.87,1621.4 2100.22,1489.7 2102.57,1483.26 2104.92,1357.35 2107.27,1424.47 2109.62,1361.82 2111.97,1397.77 2114.32,1412.79 2116.67,1542.81 2119.02,1444.57 2121.37,1409.9 2123.72,1293.96 2126.07,1427.12 2128.42,1373.81 2130.77,1373.85 2133.12,1433.37 2135.47,1617.32 2137.83,1511.58 2140.18,1515.16 2142.53,1632.34 2144.88,1503.21 2147.23,1369.71 2149.58,1501.82 2151.93,1579.29 2154.28,1169.36 2156.63,1490.4 2158.98,1441.59 2161.33,1613.28 2163.68,1350.77 2166.03,1461.91 2168.38,1463.41 2170.73,1512.06 2173.08,1550.53 2175.43,1555.65 2177.78,1326.13 2180.13,1521.77 2182.48,1288.42 2184.83,1352.01 2187.19,1590.56 2189.54,1293.63 2191.89,1425.04 2194.24,1605.93 2196.59,1415.66 2198.94,1285.64 2201.29,1531.55 2203.64,1455.67 2205.99,1487.75 2208.34,1387.18 2210.69,1453.98 2213.04,1484.72 2215.39,1453.14 2217.74,1433.91 2220.09,1220.37 2222.44,1394.38 2224.79,1379.23 2227.14,1292.32 2229.49,1476.82 2231.84,1378.23 2234.19,1565.42 2236.55,1387.42 2238.9,1467.46 2241.25,1433.6 2243.6,1536.67 2245.95,1348.67 2248.3,1412.52 2250.65,1331.25 2253,1520.86 2255.35,1321.17 2257.7,1328.58 2260.05,1444.91 2262.4,1336.69 2264.75,1604.36 2267.1,1395.84 2269.45,1432.22 2271.8,1258.89 2274.15,1543.7 2276.5,1408.69 2278.85,1398.34 2281.2,1500.72 2283.55,1465.13 2285.91,1442.28 2288.26,1401.22 2290.61,1357.07 2292.96,1566.45 2295.31,1391.37 2297.66,1326.56 2300.01,1609.47 2302.36,1328.11 2304.71,1409.36 2307.06,1367.48 2309.41,1404.03 2311.76,1602.67 2314.11,1436.64 2316.46,1455.57 2318.81,1571.04 2321.16,1576.08 2323.51,1308.24 2325.86,1482.59 2328.21,1495.31 2330.56,1570.65 2332.91,1444.25 2335.27,1352.17 2337.62,1354.24 2339.97,1475.83 2342.32,1413.12 2344.67,1552.07 2347.02,1384.79 2349.37,1427.5 2351.72,1466.97 2354.07,1378.8 2356.42,1475.75 2358.77,1332.45 2361.12,1493.24 2363.47,1369.13 2365.82,1268.34 2368.17,1388.75 2370.52,1378.83 2372.87,1438.01 2375.22,1483.41 2377.57,1306.88 2379.92,1373.98 2382.27,1606.63 2384.62,1335.35 2386.98,1301.76 2389.33,1450.35 2391.68,1554.9 2394.03,1255.29 2396.38,1425.13 2398.73,1361.27 2401.08,1423.57 2403.43,1399.6 2405.78,1486.01 2408.13,1336.75 2410.48,1431.75 2412.83,1401.46 2415.18,1322.19 2417.53,1518.11 2419.88,1569.53 2422.23,1608.77 2424.58,1389.64 2426.93,1299.87 2429.28,1238.01 2431.63,1512.49 2433.98,1511.67 2436.34,1388.96 2438.69,1394.09 2441.04,1751.15 2443.39,1445.68 2445.74,1448.56 2448.09,1214.95 2450.44,1426.76 2452.79,1678.12 2455.14,1292.38 2457.49,1634.48 2459.84,1447.18 2462.19,1485.83 2464.54,1404.73 2466.89,1361.42 2469.24,1297.36 2471.59,1585.1 2473.94,1431.62 2476.29,1611.83 2478.64,1385.18 2480.99,1584.62 2483.34,1576.04 2485.7,1436.62 2488.05,1444.05 2490.4,1565.29 2492.75,1486.04 2495.1,1513.25 2497.45,1186.13 2499.8,1564.28 2502.15,1467.54 2504.5,1399.41 2506.85,1483.11 2509.2,1461.84 2511.55,1194.9 2513.9,1689.36 2516.25,1408.05 2518.6,1332.16 2520.95,1559.32 2523.3,1562.94 2525.65,1362.53 2528,1413.32 2530.35,1468.22 2532.7,1517.4 2535.06,1461.09 2537.41,1474.88 2539.76,1481.3 2542.11,1411.3 2544.46,1558.43 2546.81,1522.33 2549.16,1324.57 2551.51,1399.16 2553.86,1574.63 2556.21,1489.09 2558.56,1372.39 2560.91,1438.99 2563.26,1557.58 2565.61,1420.34 2567.96,1677.72 2570.31,1297.67 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1048.96 224.541,757.036 226.891,803.499 229.242,1049.14 231.592,817.833 233.943,994.171 236.293,855.029 238.644,940.485 240.994,989.25 243.345,873.013 245.695,892.086 248.046,887.632 250.396,926.272 252.747,875.124 255.097,1038.77 257.448,880.148 259.798,1143.08 262.148,991.595 264.499,996.413 266.849,923.219 269.2,828.194 271.55,939.301 273.901,1121.76 276.251,927.699 278.602,1030.38 280.952,1025.99 283.303,1077.72 285.653,913.428 288.004,1023.21 290.354,976.141 292.705,808.728 295.055,945.076 297.406,966.774 299.756,903.076 302.107,973.771 304.457,685.45 306.807,963.226 309.158,1075.52 311.508,1037.15 313.859,1213.79 316.209,1018.49 318.56,919.725 320.91,921.548 323.261,1130.36 325.611,966.208 327.962,845.06 330.312,819.968 332.663,943.629 335.013,765.013 337.364,836.723 339.714,928.411 342.065,914.158 344.415,888.106 346.765,1048.64 349.116,998.788 351.466,960.576 353.817,988.154 356.167,988.834 358.518,977.418 360.868,773.371 363.219,1058.54 365.569,830.42 367.92,959.232 370.27,1013.94 372.621,870.461 374.971,895.142 377.322,926.432 379.672,918.384 382.023,807.477 384.373,883.821 386.724,985.833 389.074,940.816 391.424,906.743 393.775,783.254 396.125,1006.68 398.476,1099.11 400.826,903.914 403.177,995.099 405.527,916.697 407.878,962.535 410.228,1002.27 412.579,861.757 414.929,1154.81 417.28,1110.83 419.63,1014.77 421.981,851.135 424.331,1041.98 426.682,931.323 429.032,1185.2 431.382,777.838 433.733,1161.15 436.083,860.664 438.434,951.474 440.784,853.545 443.135,1165.29 445.485,758.287 447.836,798.46 450.186,880.239 452.537,962.219 454.887,849.474 457.238,943.302 459.588,1014.74 461.939,867.422 464.289,1061.2 466.64,911.98 468.99,1014.26 471.341,819.266 473.691,813.34 476.041,948.91 478.392,1149.98 480.742,801.386 483.093,972.878 485.443,1054.84 487.794,1026.33 490.144,836.08 492.495,948.709 494.845,990.394 497.196,939.1 499.546,1072.23 501.897,872.905 504.247,1032.6 506.598,921.444 508.948,1061.41 511.299,742.141 513.649,823.904 515.999,984.312 518.35,908.314 520.7,954.7 523.051,953.619 525.401,750.877 527.752,943.429 530.102,1080.57 532.453,991.683 534.803,927.091 537.154,1164.39 539.504,1027.81 541.855,1083.05 544.205,704.963 546.556,1145.47 548.906,889.66 551.257,1141.13 553.607,1017.19 555.958,987.045 558.308,1091.43 560.658,993.799 563.009,904.287 565.359,802.876 567.71,985.539 570.06,952.094 572.411,886.47 574.761,920.407 577.112,1022.99 579.462,1022.51 581.813,949.489 584.163,740.877 586.514,1193.77 588.864,957.916 591.215,1016.04 593.565,716.741 595.916,1128.05 598.266,865.226 600.616,988.629 602.967,1017.07 605.317,1010.51 607.668,1014.74 610.018,851.939 612.369,911.901 614.719,989.856 617.07,1026.67 619.42,786.763 621.771,908.486 624.121,922.602 626.472,869.357 628.822,837.462 631.173,890.403 633.523,1116.54 635.874,1036.14 638.224,976.55 640.575,900.694 642.925,1025.6 645.275,1090.35 647.626,838.816 649.976,787.426 652.327,699.403 654.677,939.121 657.028,1020.83 659.378,1019.31 661.729,819.886 664.079,897.929 666.43,783.029 668.78,1013.31 671.131,952.032 673.481,889.072 675.832,1013.39 678.182,940.789 680.533,915.383 682.883,973.479 685.233,903.054 687.584,968.79 689.934,1001.68 692.285,1017.44 694.635,958.966 696.986,959.787 699.336,961.192 701.687,802.487 704.037,798.673 706.388,953.942 708.738,752.68 711.089,891.559 713.439,1046.8 715.79,1048.75 718.14,848.08 720.491,971.421 722.841,993.877 725.192,942.771 727.542,1039.79 729.892,974.263 732.243,1098.46 734.593,903.595 736.944,1011.92 739.294,956.745 741.645,1053.09 743.995,834.061 746.346,1037.93 748.696,988.619 751.047,1064.08 753.397,717.801 755.748,979.411 758.098,850.8 760.449,995.727 762.799,943.532 765.15,986.573 767.5,892.056 769.85,1072.29 772.201,1090.49 774.551,956.902 776.902,1158.24 779.252,940.228 781.603,909.394 783.953,1114.25 786.304,1053.14 788.654,956.325 791.005,920.719 793.355,1135.2 795.706,931.359 798.056,875.792 800.407,1033.41 802.757,860.823 805.108,1130.02 807.458,1013.16 809.809,955.538 812.159,855.476 814.509,1150.26 816.86,884.499 819.21,800.327 821.561,878.64 823.911,718.792 826.262,941.035 828.612,954.298 830.963,884.153 833.313,795.102 835.664,1001.01 838.014,1041.16 840.365,999.599 842.715,1119.16 845.066,874.255 847.416,1008.72 849.767,996.224 852.117,997.449 854.467,993.519 856.818,1008.97 859.168,913.729 861.519,796.765 863.869,775.83 866.22,884.415 868.57,995.237 870.921,843.726 873.271,978.747 875.622,993.903 877.972,814.116 880.323,824.122 882.673,839.145 885.024,937.611 887.374,918.331 889.725,915.762 892.075,900.678 894.426,868.584 896.776,775.021 899.126,772.482 901.477,1037.35 903.827,927.644 906.178,1019.88 908.528,1027.04 910.879,961.066 913.229,820.938 915.58,844.333 917.93,1051.45 920.281,1055.67 922.631,881.625 924.982,1043.11 927.332,979.915 929.683,1056.43 932.033,1001.53 934.384,923.571 936.734,1015.14 939.084,804.929 941.435,782.148 943.785,957.341 946.136,758.162 948.486,1058.18 950.837,867.099 953.187,749.039 955.538,828.064 957.888,678.365 960.239,830.222 962.589,1003.58 964.94,852.647 967.29,766.483 969.641,971.992 971.991,817.227 974.342,1104.61 976.692,1016.61 979.043,773.681 981.393,1046.14 983.743,890.233 986.094,619.074 988.444,874.765 990.795,762.045 993.145,865.365 995.496,885.634 997.846,1210.8 1000.2,1014.57 1002.55,1006.27 1004.9,1016.49 1007.25,1038.83 1009.6,1011.82 1011.95,1087.7 1014.3,937.462 1016.65,981.1 1019,908.909 1021.35,1000.17 1023.7,935.778 1026.05,1054.35 1028.4,963.286 1030.75,924.34 1033.1,933.171 1035.45,906.952 1037.8,896.138 1040.15,925.126 1042.51,896.523 1044.86,966.256 1047.21,945.79 1049.56,696.456 1051.91,887.948 1054.26,940.335 1056.61,898.047 1058.96,920.232 1061.31,1027.45 1063.66,670.683 1066.01,968.706 1068.36,786.228 1070.71,806.036 1073.06,1020.27 1075.41,997.088 1077.76,905.739 1080.11,1024.82 1082.46,882.221 1084.81,1021.48 1087.16,881.885 1089.51,934.533 1091.87,1049.06 1094.22,969.024 1096.57,983.658 1098.92,960.548 1101.27,823.67 1103.62,884.635 1105.97,735.742 1108.32,855.828 1110.67,889.045 1113.02,1083.18 1115.37,968.381 1117.72,852.078 1120.07,902.821 1122.42,1069.71 1124.77,897.288 1127.12,1101.21 1129.47,990.888 1131.82,898.527 1134.17,880.016 1136.52,769.012 1138.87,1009.04 1141.23,1092.1 1143.58,1042.6 1145.93,911.633 1148.28,794.944 1150.63,970.824 1152.98,973.005 1155.33,939.807 1157.68,820.919 1160.03,865.623 1162.38,883.563 1164.73,803.221 1167.08,995.591 1169.43,694.831 1171.78,968.082 1174.13,895.8 1176.48,956.069 1178.83,1212.01 1181.18,947.578 1183.53,736.953 1185.88,1071.57 1188.23,906.868 1190.59,739.913 1192.94,899.771 1195.29,809.338 1197.64,772.214 1199.99,894.572 1202.34,1002.14 1204.69,900.335 1207.04,935.572 1209.39,1120.03 1211.74,1030.95 1214.09,1008.49 1216.44,971.848 1218.79,1074.96 1221.14,956.984 1223.49,881.969 1225.84,907.344 1228.19,752.421 1230.54,896.569 1232.89,941.95 1235.24,988.974 1237.59,999.406 1239.94,857.473 1242.3,914.141 1244.65,1047.66 1247,827.855 1249.35,954.163 1251.7,876.624 1254.05,909.899 1256.4,862.148 1258.75,938.677 1261.1,882.714 1263.45,1059.88 1265.8,917.594 1268.15,934.373 1270.5,768.697 1272.85,1117.27 1275.2,1080.8 1277.55,813.118 1279.9,946.686 1282.25,841.017 1284.6,813.706 1286.95,886.497 1289.3,889.763 1291.66,1038.19 1294.01,936.763 1296.36,844.237 1298.71,1039.63 1301.06,901.388 1303.41,899.401 1305.76,971.664 1308.11,912.139 1310.46,921.937 1312.81,953.795 1315.16,947.62 1317.51,894.074 1319.86,974.497 1322.21,930.477 1324.56,1006.72 1326.91,722.68 1329.26,889.218 1331.61,915.033 1333.96,796.289 1336.31,982.543 1338.66,1085.81 1341.02,819.11 1343.37,1169.13 1345.72,971.83 1348.07,785.932 1350.42,963.575 1352.77,1139.21 1355.12,851.095 1357.47,1078.14 1359.82,968.204 1362.17,890.961 1364.52,925.02 1366.87,947.259 1369.22,719.26 1371.57,718.006 1373.92,1017.45 1376.27,1135.37 1378.62,1024.77 1380.97,845.489 1383.32,929.901 1385.67,936.43 1388.02,881.867 1390.38,807.159 1392.73,947.477 1395.08,841.058 1397.43,855.014 1399.78,894.277 1402.13,1003.09 1404.48,982.731 1406.83,1110.08 1409.18,927.56 1411.53,794.874 1413.88,861.205 1416.23,936.201 1418.58,936.413 1420.93,787.521 1423.28,819.094 1425.63,913.903 1427.98,1196.52 1430.33,801.924 1432.68,914.377 1435.03,935.904 1437.38,746.052 1439.74,883.348 1442.09,899.634 1444.44,899.276 1446.79,835.222 1449.14,896.824 1451.49,674.099 1453.84,884.824 1456.19,796.748 1458.54,795.292 1460.89,1172.09 1463.24,958.56 1465.59,1087.86 1467.94,1010.39 1470.29,947.626 1472.64,819.722 1474.99,1009.69 1477.34,782.203 1479.69,789.262 1482.04,1087.35 1484.39,907.274 1486.74,889.497 1489.1,1001.06 1491.45,801.808 1493.8,912.786 1496.15,1026.67 1498.5,1053 1500.85,1084.59 1503.2,961.18 1505.55,1107.32 1507.9,918.275 1510.25,985.829 1512.6,924.863 1514.95,1271.22 1517.3,938.139 1519.65,908.431 1522,1195.45 1524.35,853.554 1526.7,891.409 1529.05,980.819 1531.4,1017 1533.75,834.038 1536.1,907.162 1538.45,832.347 1540.81,912.301 1543.16,999.375 1545.51,820.608 1547.86,820.801 1550.21,1089.27 1552.56,927.841 1554.91,769.213 1557.26,912.567 1559.61,945.678 1561.96,804.238 1564.31,966.502 1566.66,960.581 1569.01,917.254 1571.36,816.247 1573.71,895.63 1576.06,1243.01 1578.41,892.492 1580.76,776.295 1583.11,1018.98 1585.46,818.127 1587.81,1160.84 1590.17,1093.65 1592.52,845.608 1594.87,675.053 1597.22,1007.5 1599.57,1023.29 1601.92,1051.81 1604.27,956.542 1606.62,921.221 1608.97,885.721 1611.32,927.19 1613.67,769.785 1616.02,883.294 1618.37,785.981 1620.72,1002.03 1623.07,926.705 1625.42,961.867 1627.77,900.333 1630.12,882.582 1632.47,1084.27 1634.82,1111.19 1637.17,827.553 1639.53,1046.02 1641.88,1116.16 1644.23,823.173 1646.58,1034.27 1648.93,977.793 1651.28,881 1653.63,969.889 1655.98,752.519 1658.33,1040.77 1660.68,919.76 1663.03,1000 1665.38,1019.13 1667.73,864.987 1670.08,763.032 1672.43,859.108 1674.78,769.395 1677.13,792.912 1679.48,1065.22 1681.83,867.533 1684.18,1007.35 1686.53,955.795 1688.89,1042.44 1691.24,1085.46 1693.59,971.747 1695.94,919.211 1698.29,1112.61 1700.64,903.585 1702.99,999.04 1705.34,959.903 1707.69,849.102 1710.04,1080.18 1712.39,991.963 1714.74,869.454 1717.09,876.041 1719.44,864.804 1721.79,925.545 1724.14,1089.55 1726.49,1001.87 1728.84,900.592 1731.19,1002.53 1733.54,1032.02 1735.89,890.714 1738.25,1042 1740.6,925.522 1742.95,1001.01 1745.3,997.67 1747.65,878.467 1750,1004.05 1752.35,999.817 1754.7,917.492 1757.05,1057.92 1759.4,975.089 1761.75,876.421 1764.1,874.455 1766.45,960.264 1768.8,689.291 1771.15,1072.34 1773.5,978.392 1775.85,850.448 1778.2,851.597 1780.55,983.338 1782.9,1050.28 1785.25,854.715 1787.6,1079.58 1789.96,922.984 1792.31,894.676 1794.66,930.408 1797.01,1072.13 1799.36,821.169 1801.71,948.915 1804.06,1072.2 1806.41,932.171 1808.76,853.009 1811.11,930.256 1813.46,942.276 1815.81,998.912 1818.16,704.217 1820.51,886.088 1822.86,731.1 1825.21,935.767 1827.56,895.449 1829.91,860.515 1832.26,945.834 1834.61,1047.97 1836.96,1091.81 1839.32,842.526 1841.67,1051.48 1844.02,967.991 1846.37,863.478 1848.72,1016.63 1851.07,940.976 1853.42,874.835 1855.77,968.886 1858.12,1120.04 1860.47,932.95 1862.82,963.128 1865.17,813.254 1867.52,847.371 1869.87,943.61 1872.22,919.707 1874.57,1014.08 1876.92,1043.8 1879.27,767.538 1881.62,1062.8 1883.97,939.359 1886.32,881.619 1888.68,1014.22 1891.03,948.412 1893.38,881.388 1895.73,891.126 1898.08,1032.36 1900.43,977.037 1902.78,800.095 1905.13,848.782 1907.48,960.742 1909.83,789.792 1912.18,946.08 1914.53,950.043 1916.88,980.168 1919.23,908.103 1921.58,706.098 1923.93,896.171 1926.28,1037.1 1928.63,927.33 1930.98,904.977 1933.33,757.635 1935.68,1038.85 1938.04,998.263 1940.39,956.47 1942.74,967.345 1945.09,977.491 1947.44,997.496 1949.79,974.688 1952.14,856.803 1954.49,939.783 1956.84,1053.29 1959.19,1082.94 1961.54,677.964 1963.89,902.598 1966.24,933.91 1968.59,1059.54 1970.94,882.863 1973.29,798.361 1975.64,721.805 1977.99,945.862 1980.34,805.122 1982.69,907.266 1985.04,1048.78 1987.4,1043.4 1989.75,827.313 1992.1,1131.2 1994.45,972.305 1996.8,897.762 1999.15,1070.71 2001.5,814.862 2003.85,977.966 2006.2,772.533 2008.55,1010.57 2010.9,1084.71 2013.25,885.846 2015.6,1073.6 2017.95,844.286 2020.3,943.472 2022.65,874.708 2025,795.36 2027.35,892.865 2029.7,957.479 2032.05,803.27 2034.4,910.094 2036.76,726.452 2039.11,1021.45 2041.46,914.023 2043.81,954.322 2046.16,878.455 2048.51,917.709 2050.86,969.598 2053.21,859.933 2055.56,874.245 2057.91,1015.84 2060.26,996.675 2062.61,849.032 2064.96,813.905 2067.31,977.957 2069.66,883.609 2072.01,907.485 2074.36,761.441 2076.71,973.064 2079.06,981.228 2081.41,961.173 2083.76,1000.41 2086.11,842.268 2088.47,1056.94 2090.82,1016.41 2093.17,970.193 2095.52,1055.8 2097.87,958.166 2100.22,908.122 2102.57,1052.42 2104.92,940.397 2107.27,983.029 2109.62,983.442 2111.97,965.889 2114.32,836.42 2116.67,995.614 2119.02,921.847 2121.37,1007.15 2123.72,909.142 2126.07,862.152 2128.42,958.344 2130.77,1043.59 2133.12,875.87 2135.47,816.451 2137.83,1026.37 2140.18,974.8 2142.53,739.473 2144.88,933.159 2147.23,1035.03 2149.58,1155.33 2151.93,882.817 2154.28,901.478 2156.63,955.079 2158.98,910.405 2161.33,983.045 2163.68,1000.58 2166.03,1035.36 2168.38,775.672 2170.73,1146.94 2173.08,1117.55 2175.43,791.234 2177.78,1036.18 2180.13,878.15 2182.48,1021.7 2184.83,958.729 2187.19,1145.63 2189.54,958.439 2191.89,972.862 2194.24,1025.49 2196.59,939.459 2198.94,823.21 2201.29,799.206 2203.64,843.976 2205.99,1089.75 2208.34,884.968 2210.69,930.832 2213.04,842.667 2215.39,1029.18 2217.74,1013.3 2220.09,836.448 2222.44,891.634 2224.79,916.025 2227.14,1024.96 2229.49,1054.01 2231.84,1003.56 2234.19,925.949 2236.55,900.265 2238.9,923.812 2241.25,881.588 2243.6,847.046 2245.95,1028.38 2248.3,958.008 2250.65,997.044 2253,891.168 2255.35,942.258 2257.7,884.63 2260.05,1041.6 2262.4,1053.91 2264.75,1050.55 2267.1,736.745 2269.45,1070.58 2271.8,860.752 2274.15,877.648 2276.5,1027.71 2278.85,968.366 2281.2,785.952 2283.55,1026.6 2285.91,1029.35 2288.26,1042.05 2290.61,1051.48 2292.96,879.221 2295.31,987.039 2297.66,1112.73 2300.01,1022.14 2302.36,783.49 2304.71,788.993 2307.06,1047.7 2309.41,979.925 2311.76,933.462 2314.11,825.251 2316.46,879.932 2318.81,1002.11 2321.16,956.5 2323.51,1106.51 2325.86,927.5 2328.21,775.122 2330.56,721.416 2332.91,984.05 2335.27,1007.79 2337.62,836.55 2339.97,876.787 2342.32,975.618 2344.67,922.936 2347.02,845.576 2349.37,744.757 2351.72,908.9 2354.07,950.091 2356.42,856.033 2358.77,969.016 2361.12,1008.69 2363.47,858.697 2365.82,1037.28 2368.17,982.105 2370.52,944.433 2372.87,1012.7 2375.22,826.931 2377.57,879.787 2379.92,929.492 2382.27,881.375 2384.62,915.164 2386.98,980.701 2389.33,967.062 2391.68,814.22 2394.03,935.722 2396.38,822.431 2398.73,1048.56 2401.08,1119.27 2403.43,940.283 2405.78,976.911 2408.13,1028.07 2410.48,746.857 2412.83,821.121 2415.18,1106.75 2417.53,952.564 2419.88,981.321 2422.23,1014.84 2424.58,961.33 2426.93,1035.15 2429.28,790.717 2431.63,976.812 2433.98,822.713 2436.34,1026.58 2438.69,830.298 2441.04,999.193 2443.39,854.916 2445.74,872.943 2448.09,942.254 2450.44,973.785 2452.79,941.108 2455.14,1043.19 2457.49,801.482 2459.84,830.985 2462.19,916.199 2464.54,850.047 2466.89,1059.29 2469.24,879.27 2471.59,972.915 2473.94,946.615 2476.29,1014.95 2478.64,1024.91 2480.99,844.43 2483.34,835.108 2485.7,820.717 2488.05,873.792 2490.4,890.236 2492.75,1072.19 2495.1,1003.96 2497.45,841.381 2499.8,751.505 2502.15,915.012 2504.5,958.888 2506.85,903.687 2509.2,1088.32 2511.55,981.619 2513.9,1010.47 2516.25,913.941 2518.6,1026.93 2520.95,965.063 2523.3,1040.11 2525.65,822.811 2528,761.862 2530.35,963.093 2532.7,806.871 2535.06,816.302 2537.41,974.057 2539.76,1151.25 2542.11,1004.55 2544.46,899.087 2546.81,1023.77 2549.16,1054.09 2551.51,937.341 2553.86,730.706 2556.21,869.257 2558.56,862.13 2560.91,796.451 2563.26,938.319 2565.61,823.064 2567.96,998.865 2570.31,828.07 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,806.237 224.541,385.256 226.891,394.126 229.242,478.404 231.592,452.099 233.943,318.363 236.293,538.318 238.644,273.948 240.994,333.913 243.345,148.825 245.695,463.521 248.046,366.505 250.396,473.1 252.747,326.878 255.097,407.891 257.448,444.547 259.798,282.726 262.148,316.732 264.499,397.819 266.849,486.816 269.2,425.145 271.55,494.966 273.901,502.431 276.251,556.913 278.602,556.82 280.952,699.848 283.303,463.496 285.653,317.982 288.004,352.697 290.354,445.472 292.705,486.747 295.055,406.279 297.406,411.994 299.756,359.252 302.107,350.219 304.457,398.14 306.807,408.797 309.158,524.014 311.508,572.704 313.859,346.878 316.209,583.118 318.56,636.933 320.91,417.264 323.261,292.362 325.611,399.05 327.962,594.274 330.312,542.935 332.663,376.99 335.013,212.656 337.364,454.912 339.714,453.499 342.065,456.789 344.415,425.635 346.765,546.51 349.116,469.306 351.466,495.074 353.817,277.196 356.167,579.069 358.518,528.286 360.868,341.476 363.219,418.636 365.569,520.642 367.92,505.057 370.27,454.27 372.621,270.391 374.971,359.349 377.322,334.488 379.672,490.843 382.023,439.05 384.373,524.288 386.724,581.212 389.074,362.847 391.424,467.693 393.775,518.61 396.125,391.646 398.476,527.675 400.826,504.03 403.177,478.006 405.527,609.307 407.878,592.094 410.228,621.938 412.579,635.445 414.929,351.226 417.28,344.398 419.63,202.776 421.981,465.354 424.331,477.137 426.682,317.745 429.032,376.183 431.382,480.719 433.733,527.2 436.083,334.342 438.434,548.888 440.784,446.286 443.135,328.773 445.485,485.838 447.836,755.565 450.186,429.93 452.537,331.326 454.887,240.264 457.238,467.62 459.588,335.984 461.939,455.21 464.289,609.419 466.64,376.784 468.99,428.482 471.341,467.616 473.691,390.692 476.041,378.597 478.392,375.094 480.742,529.374 483.093,387.889 485.443,633.052 487.794,435.596 490.144,405.622 492.495,507.439 494.845,308.444 497.196,296.31 499.546,443.575 501.897,476.061 504.247,597.65 506.598,477.294 508.948,276.789 511.299,237.956 513.649,441.801 515.999,294.672 518.35,263.016 520.7,386.455 523.051,490.5 525.401,500.231 527.752,304.999 530.102,481.778 532.453,585.498 534.803,364.643 537.154,563.719 539.504,674.484 541.855,301.903 544.205,446.788 546.556,543.805 548.906,320.41 551.257,763.842 553.607,352.873 555.958,298.091 558.308,161.772 560.658,421.155 563.009,376.191 565.359,379.761 567.71,216.348 570.06,583.784 572.411,342.249 574.761,430.864 577.112,549.342 579.462,233.925 581.813,449.471 584.163,469.463 586.514,320.928 588.864,236.965 591.215,384.929 593.565,438.109 595.916,474.448 598.266,375.514 600.616,530.707 602.967,437.1 605.317,446.495 607.668,423.795 610.018,348.939 612.369,404.44 614.719,411.015 617.07,453.15 619.42,356.014 621.771,420.268 624.121,462.312 626.472,440.647 628.822,505.509 631.173,428.645 633.523,472.565 635.874,354.247 638.224,334.963 640.575,453.303 642.925,473.489 645.275,368.402 647.626,689.886 649.976,551.613 652.327,426.915 654.677,485.148 657.028,472.957 659.378,363 661.729,438.527 664.079,289.326 666.43,362.134 668.78,323.005 671.131,313.365 673.481,369.922 675.832,480.518 678.182,314.65 680.533,396.869 682.883,327.196 685.233,440.337 687.584,321.446 689.934,602.603 692.285,495.28 694.635,495.541 696.986,476.606 699.336,318.518 701.687,407.853 704.037,380.369 706.388,408.494 708.738,401.715 711.089,470.797 713.439,511.77 715.79,390.896 718.14,478.745 720.491,566.547 722.841,623.389 725.192,285.408 727.542,445.612 729.892,727.673 732.243,317.3 734.593,379.572 736.944,370.317 739.294,433.809 741.645,380.052 743.995,319.349 746.346,402.108 748.696,388.128 751.047,337.32 753.397,213.005 755.748,415.435 758.098,444.105 760.449,475.635 762.799,372.348 765.15,522.478 767.5,420.931 769.85,423.967 772.201,203.861 774.551,383.083 776.902,504.456 779.252,503.723 781.603,282.733 783.953,366.769 786.304,140.088 788.654,489.911 791.005,330.613 793.355,485.338 795.706,343.157 798.056,383.174 800.407,580.431 802.757,368.79 805.108,504.371 807.458,272.193 809.809,429.996 812.159,421.098 814.509,416.89 816.86,585.324 819.21,438.991 821.561,346.499 823.911,355.443 826.262,239.379 828.612,568.01 830.963,529.376 833.313,443.114 835.664,503.262 838.014,401.343 840.365,403.434 842.715,537.89 845.066,305.155 847.416,399.855 849.767,607.865 852.117,490.906 854.467,336.982 856.818,500.532 859.168,568.11 861.519,374.767 863.869,482.963 866.22,364.183 868.57,345.432 870.921,333.353 873.271,593.252 875.622,465.885 877.972,343.48 880.323,353.725 882.673,691.431 885.024,396.805 887.374,243.688 889.725,473.344 892.075,507.917 894.426,267.979 896.776,323.324 899.126,477.373 901.477,539.628 903.827,390.425 906.178,391.114 908.528,364.332 910.879,460.169 913.229,340.953 915.58,557.147 917.93,437.212 920.281,453.828 922.631,281.965 924.982,367.388 927.332,371.728 929.683,464.544 932.033,465.408 934.384,263.694 936.734,546.608 939.084,420.97 941.435,384.964 943.785,430.522 946.136,440.122 948.486,488.861 950.837,434.414 953.187,435.773 955.538,537.104 957.888,521.981 960.239,282.251 962.589,663.983 964.94,352.893 967.29,556.297 969.641,317.408 971.991,345.382 974.342,532.437 976.692,337.737 979.043,455.053 981.393,442.686 983.743,317.718 986.094,442.604 988.444,536.171 990.795,297.199 993.145,261.711 995.496,328.251 997.846,280.801 1000.2,394.599 1002.55,579.548 1004.9,257.398 1007.25,381.189 1009.6,372.586 1011.95,385.941 1014.3,343.398 1016.65,391.976 1019,434.894 1021.35,369.95 1023.7,429.341 1026.05,336.071 1028.4,421.177 1030.75,340.962 1033.1,460.47 1035.45,393.639 1037.8,438.358 1040.15,411.452 1042.51,324.138 1044.86,321.362 1047.21,306.121 1049.56,388.33 1051.91,230.82 1054.26,397.042 1056.61,397.939 1058.96,479.302 1061.31,274.439 1063.66,499.141 1066.01,531.078 1068.36,361.622 1070.71,518.93 1073.06,437.23 1075.41,490.295 1077.76,361.629 1080.11,363.83 1082.46,358.004 1084.81,458.055 1087.16,270.623 1089.51,275.884 1091.87,587.143 1094.22,325.773 1096.57,499.528 1098.92,477.477 1101.27,302.851 1103.62,409.284 1105.97,374.17 1108.32,596.882 1110.67,428.206 1113.02,401.129 1115.37,309.32 1117.72,508.595 1120.07,395.934 1122.42,545.937 1124.77,381.941 1127.12,357.501 1129.47,450.102 1131.82,392.236 1134.17,342.376 1136.52,391.06 1138.87,444.1 1141.23,372.259 1143.58,523.329 1145.93,416.214 1148.28,369.478 1150.63,260.253 1152.98,269.679 1155.33,445.695 1157.68,385.043 1160.03,375.785 1162.38,450.135 1164.73,360.246 1167.08,485.752 1169.43,420.664 1171.78,351.287 1174.13,334.518 1176.48,715.282 1178.83,503.995 1181.18,474.572 1183.53,457.953 1185.88,541.437 1188.23,353.217 1190.59,581.604 1192.94,411.02 1195.29,354.365 1197.64,559.541 1199.99,434.08 1202.34,213.756 1204.69,536.173 1207.04,298.427 1209.39,460.271 1211.74,512.722 1214.09,345.24 1216.44,635.648 1218.79,555.082 1221.14,406.394 1223.49,388.25 1225.84,262.292 1228.19,646.321 1230.54,524.223 1232.89,461.277 1235.24,310.66 1237.59,292.328 1239.94,483.491 1242.3,382.872 1244.65,341.207 1247,401.165 1249.35,479.287 1251.7,475.753 1254.05,487.889 1256.4,238.297 1258.75,533.059 1261.1,528.738 1263.45,528.663 1265.8,546.17 1268.15,580.033 1270.5,276.866 1272.85,391.688 1275.2,162.728 1277.55,351.997 1279.9,410.81 1282.25,518.677 1284.6,392.926 1286.95,387.608 1289.3,692.321 1291.66,306.413 1294.01,382.005 1296.36,324.006 1298.71,430.825 1301.06,324.466 1303.41,400.434 1305.76,510.778 1308.11,582.207 1310.46,535.756 1312.81,364.179 1315.16,483.875 1317.51,469.456 1319.86,477.341 1322.21,428.413 1324.56,351.487 1326.91,356.042 1329.26,427.507 1331.61,415.109 1333.96,329.896 1336.31,423.342 1338.66,475.163 1341.02,431.409 1343.37,289.713 1345.72,389.329 1348.07,394.313 1350.42,489.217 1352.77,395.049 1355.12,432.401 1357.47,361.099 1359.82,390.577 1362.17,355.456 1364.52,230.174 1366.87,281.993 1369.22,473.495 1371.57,405.399 1373.92,627.73 1376.27,365.188 1378.62,368.832 1380.97,437.632 1383.32,307.228 1385.67,503.505 1388.02,455.046 1390.38,536.633 1392.73,531.626 1395.08,415.037 1397.43,496.833 1399.78,473.266 1402.13,564.454 1404.48,447.743 1406.83,597.087 1409.18,354.569 1411.53,175.183 1413.88,400.795 1416.23,433.41 1418.58,505.989 1420.93,427.582 1423.28,540.469 1425.63,369.057 1427.98,455.127 1430.33,579.906 1432.68,237.913 1435.03,306.073 1437.38,460.933 1439.74,459.952 1442.09,555.038 1444.44,443.606 1446.79,405.716 1449.14,407.63 1451.49,537.74 1453.84,581.613 1456.19,361.14 1458.54,499.427 1460.89,512.866 1463.24,513.17 1465.59,410.463 1467.94,346.654 1470.29,494.79 1472.64,497.278 1474.99,519.272 1477.34,443.097 1479.69,272.66 1482.04,250.198 1484.39,329.504 1486.74,462.221 1489.1,531.957 1491.45,249.603 1493.8,413.922 1496.15,454.989 1498.5,239.09 1500.85,454.278 1503.2,348.838 1505.55,483.886 1507.9,397.969 1510.25,630.774 1512.6,532.129 1514.95,363.589 1517.3,436.397 1519.65,256.715 1522,338.434 1524.35,491.438 1526.7,372.36 1529.05,326.615 1531.4,371.869 1533.75,444.948 1536.1,372.726 1538.45,448.81 1540.81,317.029 1543.16,411.184 1545.51,428.753 1547.86,359.921 1550.21,578.827 1552.56,256.184 1554.91,435.137 1557.26,422.47 1559.61,248.67 1561.96,399.102 1564.31,399.211 1566.66,405.566 1569.01,375.761 1571.36,599.437 1573.71,446.415 1576.06,466.683 1578.41,432.612 1580.76,327.346 1583.11,604.932 1585.46,340.557 1587.81,345.394 1590.17,367.145 1592.52,397.505 1594.87,415.363 1597.22,614.982 1599.57,487.316 1601.92,363.612 1604.27,398.673 1606.62,335.014 1608.97,236.702 1611.32,491.387 1613.67,324.874 1616.02,598.242 1618.37,397.631 1620.72,484.272 1623.07,424.462 1625.42,590.721 1627.77,537.268 1630.12,313.248 1632.47,413.547 1634.82,525.54 1637.17,345.374 1639.53,374.526 1641.88,451.312 1644.23,549.304 1646.58,474.393 1648.93,376.997 1651.28,428.027 1653.63,285.783 1655.98,390.117 1658.33,392.479 1660.68,468.99 1663.03,249.597 1665.38,329.904 1667.73,312.655 1670.08,364.706 1672.43,466.664 1674.78,591.669 1677.13,359.522 1679.48,509.334 1681.83,527.543 1684.18,472.22 1686.53,568.252 1688.89,468.989 1691.24,406.722 1693.59,529.134 1695.94,552.95 1698.29,261.882 1700.64,350.458 1702.99,461.04 1705.34,346.107 1707.69,542.007 1710.04,652.598 1712.39,388.194 1714.74,495.38 1717.09,449.286 1719.44,558.44 1721.79,505.04 1724.14,353.434 1726.49,96.8724 1728.84,653.023 1731.19,206.804 1733.54,664.724 1735.89,574.157 1738.25,482.565 1740.6,502.197 1742.95,588.99 1745.3,399.342 1747.65,338.752 1750,444.205 1752.35,380.951 1754.7,402.842 1757.05,395.697 1759.4,622.784 1761.75,404.547 1764.1,485.943 1766.45,276.658 1768.8,367.796 1771.15,529.524 1773.5,403.673 1775.85,389.306 1778.2,382.01 1780.55,321.537 1782.9,270.035 1785.25,601.984 1787.6,375.044 1789.96,259.525 1792.31,515.772 1794.66,425.031 1797.01,177.748 1799.36,421.571 1801.71,374.252 1804.06,377.234 1806.41,367.664 1808.76,439.855 1811.11,514.943 1813.46,515.435 1815.81,423.221 1818.16,392.43 1820.51,416.258 1822.86,385.025 1825.21,376.547 1827.56,559.398 1829.91,249.679 1832.26,317.991 1834.61,412.097 1836.96,582.401 1839.32,494.07 1841.67,311.763 1844.02,483.56 1846.37,376.368 1848.72,354.892 1851.07,322.622 1853.42,594.408 1855.77,362.341 1858.12,286.296 1860.47,584.583 1862.82,296.799 1865.17,288.948 1867.52,386.102 1869.87,493.994 1872.22,330.267 1874.57,441.547 1876.92,447.297 1879.27,377.164 1881.62,477.37 1883.97,471.337 1886.32,317.02 1888.68,588.078 1891.03,466.133 1893.38,518.851 1895.73,323.733 1898.08,391.658 1900.43,534.347 1902.78,478.543 1905.13,715.375 1907.48,301.026 1909.83,275.953 1912.18,365.781 1914.53,258.11 1916.88,378.525 1919.23,569.019 1921.58,329.186 1923.93,525.861 1926.28,414.031 1928.63,467.514 1930.98,471.107 1933.33,603.208 1935.68,409.992 1938.04,603.241 1940.39,457.672 1942.74,285.497 1945.09,387.872 1947.44,530.151 1949.79,444.696 1952.14,397.615 1954.49,346.674 1956.84,446.928 1959.19,465.128 1961.54,394.45 1963.89,403.403 1966.24,454.729 1968.59,194.962 1970.94,191.815 1973.29,278.941 1975.64,562.866 1977.99,428.118 1980.34,403.771 1982.69,325.927 1985.04,576.715 1987.4,393.752 1989.75,505.346 1992.1,473.461 1994.45,540.672 1996.8,543.448 1999.15,484.358 2001.5,448.707 2003.85,279.653 2006.2,516.405 2008.55,455.15 2010.9,470.496 2013.25,555.018 2015.6,445.921 2017.95,392.299 2020.3,303.194 2022.65,291.133 2025,331.069 2027.35,396.727 2029.7,517.709 2032.05,397.443 2034.4,429.946 2036.76,452.361 2039.11,417.44 2041.46,467.405 2043.81,161.947 2046.16,556.953 2048.51,304.743 2050.86,475.586 2053.21,546.793 2055.56,500.035 2057.91,406.952 2060.26,489.081 2062.61,332.948 2064.96,729.061 2067.31,513.88 2069.66,328.235 2072.01,306.065 2074.36,388.104 2076.71,570.944 2079.06,396.708 2081.41,528.928 2083.76,419.983 2086.11,438.042 2088.47,404.98 2090.82,678.157 2093.17,362.579 2095.52,438.179 2097.87,425.888 2100.22,561.212 2102.57,250.518 2104.92,244.993 2107.27,497.018 2109.62,515.5 2111.97,344.341 2114.32,455.955 2116.67,387.253 2119.02,379.578 2121.37,412.789 2123.72,220.976 2126.07,454.197 2128.42,490.165 2130.77,422.705 2133.12,337.182 2135.47,392.353 2137.83,555.6 2140.18,381.155 2142.53,571.68 2144.88,375.696 2147.23,557.663 2149.58,374.078 2151.93,479.629 2154.28,367.092 2156.63,450.338 2158.98,608.597 2161.33,393.936 2163.68,551.046 2166.03,498.687 2168.38,528.587 2170.73,313.15 2173.08,405.128 2175.43,261.203 2177.78,540.46 2180.13,571.79 2182.48,558.322 2184.83,501.212 2187.19,547.54 2189.54,333.269 2191.89,271.201 2194.24,408.683 2196.59,456.179 2198.94,446.533 2201.29,567.151 2203.64,285.446 2205.99,360.567 2208.34,719.523 2210.69,371.193 2213.04,475.735 2215.39,384.261 2217.74,392.141 2220.09,448.395 2222.44,472.413 2224.79,382.166 2227.14,605.293 2229.49,457.74 2231.84,389.97 2234.19,367.762 2236.55,463.789 2238.9,326.059 2241.25,485.479 2243.6,315.564 2245.95,345.563 2248.3,598.937 2250.65,372.064 2253,494.202 2255.35,418.814 2257.7,403.666 2260.05,395.141 2262.4,503.736 2264.75,368.914 2267.1,558.409 2269.45,395.789 2271.8,441.396 2274.15,503.683 2276.5,393.839 2278.85,725.846 2281.2,540.143 2283.55,317.377 2285.91,273.118 2288.26,397.45 2290.61,396.478 2292.96,352.737 2295.31,339.039 2297.66,407.11 2300.01,568.814 2302.36,518.404 2304.71,351.612 2307.06,262.15 2309.41,433.942 2311.76,324.996 2314.11,371.546 2316.46,433.657 2318.81,378.556 2321.16,546.014 2323.51,439.831 2325.86,411.829 2328.21,369.296 2330.56,227.915 2332.91,549.389 2335.27,437.993 2337.62,296.696 2339.97,382.101 2342.32,451.58 2344.67,541.118 2347.02,346.489 2349.37,424.722 2351.72,302.875 2354.07,489.518 2356.42,389.991 2358.77,559.94 2361.12,315.102 2363.47,217.187 2365.82,681.205 2368.17,287.701 2370.52,497.25 2372.87,413.614 2375.22,453.061 2377.57,250.095 2379.92,404.487 2382.27,399.91 2384.62,289.179 2386.98,419.131 2389.33,186.264 2391.68,347.031 2394.03,327.156 2396.38,477.461 2398.73,403.507 2401.08,484.014 2403.43,516.138 2405.78,429.661 2408.13,477.775 2410.48,408.859 2412.83,584.442 2415.18,387.149 2417.53,686.419 2419.88,589.904 2422.23,456.48 2424.58,444.54 2426.93,303.383 2429.28,362.311 2431.63,397.227 2433.98,329.031 2436.34,311.851 2438.69,405.081 2441.04,477.979 2443.39,511.444 2445.74,453.884 2448.09,396.105 2450.44,432.579 2452.79,363.574 2455.14,295.51 2457.49,239.977 2459.84,628.744 2462.19,503.414 2464.54,413.262 2466.89,611.144 2469.24,429.781 2471.59,567.488 2473.94,664.531 2476.29,444.468 2478.64,446.375 2480.99,466.817 2483.34,119.759 2485.7,546.472 2488.05,481.647 2490.4,437.581 2492.75,463.451 2495.1,382.236 2497.45,280.111 2499.8,447.595 2502.15,668.082 2504.5,403.862 2506.85,498.238 2509.2,327.641 2511.55,369.976 2513.9,501.759 2516.25,392.717 2518.6,400.41 2520.95,246.218 2523.3,547.635 2525.65,371.974 2528,305.279 2530.35,404.616 2532.7,375.05 2535.06,479.687 2537.41,477.928 2539.76,340.595 2542.11,491.258 2544.46,363.986 2546.81,413.804 2549.16,420.454 2551.51,538.929 2553.86,706.31 2556.21,375.068 2558.56,427.17 2560.91,318.516 2563.26,446.676 2565.61,390.318 2567.96,271.38 2570.31,419.716 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.66818   -3.32735   -6.00457  -4.66665   …  -5.0119   -6.1992   -6.21395
 -0.241267  -0.503414  -0.9682   -0.100187      1.31836   1.36903  -0.313069
  1.60503    2.28402    4.3039    6.80373       4.17528   4.57181   5.16708

[:, :, 2] =
 -3.17241   -4.82932   -5.75602    …  -5.72496   -5.72496   -6.37789
  0.103616  -0.213427   0.0309451     -0.692598  -0.692598  -0.470064
  1.95452    3.62377    3.16469        3.88005    3.88005    3.26456

[:, :, 3] =
 -3.27622    -6.11942  -6.11942  -6.11942  …  -4.90242  -2.80257  -5.92178
  0.0407916  -1.10107  -1.10107  -1.10107      1.35053   4.11327   0.959433
  2.9382      4.64376   4.64376   4.64376      4.87952   5.23964   3.97176

[:, :, 4] =
 -1.93132  -2.48145  -3.15684   -6.34088  …  -5.86344  -5.86344  -5.07002
  1.95368   1.08849  -0.515951  -1.78653     -1.21146  -1.21146  -2.09424
  3.94861   3.66815   3.39297    3.93798      5.52444   5.52444   5.39758</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00611   1.01307
 -0.031821  1.01648
  4.99231   0.994078</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.55 seconds
Compute duration  = 2.55 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -5.0197    0.9924    0.0167   3527.3273   5615.0537    1.0001   ⋯
        x[2]   -0.0096    1.0072    0.0176   3269.9207   5023.6311    1.0003   ⋯
        x[3]    5.0025    1.0030    0.0176   3267.1832   5872.3409    1.0004   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -6.9861   -5.6827   -5.0031   -4.3370   -3.1142
        x[2]   -1.9885   -0.6730   -0.0034    0.6726    1.9583
        x[3]    3.0575    4.3226    4.9918    5.6778    6.9625
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.67 seconds
Compute duration  = 1.67 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.4961    0.1873    0.0027   4673.6242   6036.3048    1.0000   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1466    0.3557    0.4946    0.6379    0.8481
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.5068    0.1374    0.0114   122.8752    68.7605    1.0175     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.2429    0.4061    0.5085    0.6198    0.7424
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-1.1918306148166926,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:454</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:952</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:887</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:303</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:274</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:456</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.7810    0.5625    0.0468    98.2899   106.2617    1.0232     ⋯
           x   -0.1341    1.0288    0.1068   135.5003    35.7944    1.0240     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.0658    0.2780    0.7228    1.1230    2.1449
           x   -2.2802   -0.4395   -0.0294    0.3548    1.9635
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.3613    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.8822    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.3613    0.3613    0.3613    0.3613    0.3613
           x    1.8822    1.8822    1.8822    1.8822    1.8822
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>