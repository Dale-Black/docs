<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step. To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.462451025547658</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.462451025547658</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>We currently have two things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reprodicibility.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers which wants to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_new.x, state_new</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([0.0, 0.0, 0.0], MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.62312   -3.60498    -4.21189  -5.01861   …  -5.0278   -4.67019   -6.13147
  0.334419  -0.0199864  -1.53702  -0.935628     -1.47513  -0.504525  -1.11195
  3.37552    3.81707     5.06578   3.79266       5.57398   6.25001    6.57652</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98949     1.05205
 -0.00412362  1.04912
  5.00063     1.06788</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip110">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip110)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip111">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip110)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip112">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip110)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1721.35 2640.76,1721.35 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1471.12 2640.76,1471.12 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1220.89 2640.76,1220.89 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,970.662 2640.76,970.662 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,720.432 2640.76,720.432 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,470.202 2640.76,470.202 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,219.973 2640.76,219.973 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1721.35 215.714,1721.35 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1471.12 215.714,1471.12 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1220.89 215.714,1220.89 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,970.662 215.714,970.662 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,720.432 215.714,720.432 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,470.202 215.714,470.202 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,219.973 215.714,219.973 "></polyline>
<path clip-path="url(#clip110)" d="M50.5475 1721.8 L80.2233 1721.8 L80.2233 1725.74 L50.5475 1725.74 L50.5475 1721.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M89.1352 1704.07 L111.357 1704.07 L111.357 1706.06 L98.8111 1738.63 L93.9269 1738.63 L105.732 1708.01 L89.1352 1708.01 L89.1352 1704.07 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M120.478 1732.75 L125.362 1732.75 L125.362 1738.63 L120.478 1738.63 L120.478 1732.75 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M135.593 1704.07 L153.95 1704.07 L153.95 1708.01 L139.876 1708.01 L139.876 1716.48 Q140.894 1716.13 141.913 1715.97 Q142.931 1715.78 143.95 1715.78 Q149.737 1715.78 153.116 1718.96 Q156.496 1722.13 156.496 1727.54 Q156.496 1733.12 153.024 1736.22 Q149.552 1739.3 143.232 1739.3 Q141.056 1739.3 138.788 1738.93 Q136.542 1738.56 134.135 1737.82 L134.135 1733.12 Q136.218 1734.26 138.441 1734.81 Q140.663 1735.37 143.14 1735.37 Q147.144 1735.37 149.482 1733.26 Q151.82 1731.15 151.82 1727.54 Q151.82 1723.93 149.482 1721.83 Q147.144 1719.72 143.14 1719.72 Q141.265 1719.72 139.39 1720.14 Q137.538 1720.55 135.593 1721.43 L135.593 1704.07 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M49.5521 1471.57 L79.2279 1471.57 L79.2279 1475.51 L49.5521 1475.51 L49.5521 1471.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M89.3667 1453.84 L107.723 1453.84 L107.723 1457.78 L93.6491 1457.78 L93.6491 1466.25 Q94.6676 1465.9 95.6861 1465.74 Q96.7047 1465.55 97.7232 1465.55 Q103.51 1465.55 106.89 1468.73 Q110.269 1471.9 110.269 1477.31 Q110.269 1482.89 106.797 1485.99 Q103.325 1489.07 97.0056 1489.07 Q94.8297 1489.07 92.5612 1488.7 Q90.3158 1488.33 87.9084 1487.59 L87.9084 1482.89 Q89.9917 1484.03 92.2139 1484.58 Q94.4361 1485.14 96.913 1485.14 Q100.918 1485.14 103.256 1483.03 Q105.593 1480.92 105.593 1477.31 Q105.593 1473.7 103.256 1471.6 Q100.918 1469.49 96.913 1469.49 Q95.038 1469.49 93.163 1469.91 Q91.3112 1470.32 89.3667 1471.2 L89.3667 1453.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M119.482 1482.52 L124.367 1482.52 L124.367 1488.4 L119.482 1488.4 L119.482 1482.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M144.552 1456.92 Q140.941 1456.92 139.112 1460.48 Q137.306 1464.03 137.306 1471.16 Q137.306 1478.26 139.112 1481.83 Q140.941 1485.37 144.552 1485.37 Q148.186 1485.37 149.991 1481.83 Q151.82 1478.26 151.82 1471.16 Q151.82 1464.03 149.991 1460.48 Q148.186 1456.92 144.552 1456.92 M144.552 1453.22 Q150.362 1453.22 153.417 1457.82 Q156.496 1462.41 156.496 1471.16 Q156.496 1479.88 153.417 1484.49 Q150.362 1489.07 144.552 1489.07 Q138.741 1489.07 135.663 1484.49 Q132.607 1479.88 132.607 1471.16 Q132.607 1462.41 135.663 1457.82 Q138.741 1453.22 144.552 1453.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M50.5475 1221.34 L80.2233 1221.34 L80.2233 1225.28 L50.5475 1225.28 L50.5475 1221.34 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M94.3436 1234.24 L110.663 1234.24 L110.663 1238.17 L88.7186 1238.17 L88.7186 1234.24 Q91.3806 1231.48 95.9639 1226.85 Q100.57 1222.2 101.751 1220.86 Q103.996 1218.33 104.876 1216.6 Q105.779 1214.84 105.779 1213.15 Q105.779 1210.39 103.834 1208.66 Q101.913 1206.92 98.8111 1206.92 Q96.6121 1206.92 94.1584 1207.69 Q91.7278 1208.45 88.9501 1210 L88.9501 1205.28 Q91.7741 1204.14 94.2278 1203.57 Q96.6815 1202.99 98.7185 1202.99 Q104.089 1202.99 107.283 1205.67 Q110.478 1208.36 110.478 1212.85 Q110.478 1214.98 109.668 1216.9 Q108.881 1218.8 106.774 1221.39 Q106.195 1222.06 103.094 1225.28 Q99.9917 1228.47 94.3436 1234.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M120.478 1232.29 L125.362 1232.29 L125.362 1238.17 L120.478 1238.17 L120.478 1232.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M135.593 1203.61 L153.95 1203.61 L153.95 1207.55 L139.876 1207.55 L139.876 1216.02 Q140.894 1215.67 141.913 1215.51 Q142.931 1215.32 143.95 1215.32 Q149.737 1215.32 153.116 1218.5 Q156.496 1221.67 156.496 1227.08 Q156.496 1232.66 153.024 1235.76 Q149.552 1238.84 143.232 1238.84 Q141.056 1238.84 138.788 1238.47 Q136.542 1238.1 134.135 1237.36 L134.135 1232.66 Q136.218 1233.8 138.441 1234.35 Q140.663 1234.91 143.14 1234.91 Q147.144 1234.91 149.482 1232.8 Q151.82 1230.69 151.82 1227.08 Q151.82 1223.47 149.482 1221.37 Q147.144 1219.26 143.14 1219.26 Q141.265 1219.26 139.39 1219.68 Q137.538 1220.09 135.593 1220.97 L135.593 1203.61 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M99.3204 956.461 Q95.7093 956.461 93.8806 960.025 Q92.075 963.567 92.075 970.697 Q92.075 977.803 93.8806 981.368 Q95.7093 984.909 99.3204 984.909 Q102.955 984.909 104.76 981.368 Q106.589 977.803 106.589 970.697 Q106.589 963.567 104.76 960.025 Q102.955 956.461 99.3204 956.461 M99.3204 952.757 Q105.131 952.757 108.186 957.363 Q111.265 961.947 111.265 970.697 Q111.265 979.423 108.186 984.03 Q105.131 988.613 99.3204 988.613 Q93.5102 988.613 90.4315 984.03 Q87.376 979.423 87.376 970.697 Q87.376 961.947 90.4315 957.363 Q93.5102 952.757 99.3204 952.757 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M119.482 982.062 L124.367 982.062 L124.367 987.942 L119.482 987.942 L119.482 982.062 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M144.552 956.461 Q140.941 956.461 139.112 960.025 Q137.306 963.567 137.306 970.697 Q137.306 977.803 139.112 981.368 Q140.941 984.909 144.552 984.909 Q148.186 984.909 149.991 981.368 Q151.82 977.803 151.82 970.697 Q151.82 963.567 149.991 960.025 Q148.186 956.461 144.552 956.461 M144.552 952.757 Q150.362 952.757 153.417 957.363 Q156.496 961.947 156.496 970.697 Q156.496 979.423 153.417 984.03 Q150.362 988.613 144.552 988.613 Q138.741 988.613 135.663 984.03 Q132.607 979.423 132.607 970.697 Q132.607 961.947 135.663 957.363 Q138.741 952.757 144.552 952.757 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M94.3436 733.777 L110.663 733.777 L110.663 737.712 L88.7186 737.712 L88.7186 733.777 Q91.3806 731.022 95.9639 726.393 Q100.57 721.74 101.751 720.397 Q103.996 717.874 104.876 716.138 Q105.779 714.379 105.779 712.689 Q105.779 709.934 103.834 708.198 Q101.913 706.462 98.8111 706.462 Q96.6121 706.462 94.1584 707.226 Q91.7278 707.99 88.9501 709.541 L88.9501 704.819 Q91.7741 703.685 94.2278 703.106 Q96.6815 702.527 98.7185 702.527 Q104.089 702.527 107.283 705.212 Q110.478 707.897 110.478 712.388 Q110.478 714.518 109.668 716.439 Q108.881 718.337 106.774 720.93 Q106.195 721.601 103.094 724.819 Q99.9917 728.013 94.3436 733.777 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M120.478 731.833 L125.362 731.833 L125.362 737.712 L120.478 737.712 L120.478 731.833 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M135.593 703.152 L153.95 703.152 L153.95 707.087 L139.876 707.087 L139.876 715.559 Q140.894 715.212 141.913 715.05 Q142.931 714.865 143.95 714.865 Q149.737 714.865 153.116 718.036 Q156.496 721.208 156.496 726.624 Q156.496 732.203 153.024 735.305 Q149.552 738.383 143.232 738.383 Q141.056 738.383 138.788 738.013 Q136.542 737.643 134.135 736.902 L134.135 732.203 Q136.218 733.337 138.441 733.893 Q140.663 734.448 143.14 734.448 Q147.144 734.448 149.482 732.342 Q151.82 730.235 151.82 726.624 Q151.82 723.013 149.482 720.907 Q147.144 718.8 143.14 718.8 Q141.265 718.8 139.39 719.217 Q137.538 719.633 135.593 720.513 L135.593 703.152 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M89.3667 452.922 L107.723 452.922 L107.723 456.858 L93.6491 456.858 L93.6491 465.33 Q94.6676 464.982 95.6861 464.82 Q96.7047 464.635 97.7232 464.635 Q103.51 464.635 106.89 467.807 Q110.269 470.978 110.269 476.394 Q110.269 481.973 106.797 485.075 Q103.325 488.154 97.0056 488.154 Q94.8297 488.154 92.5612 487.783 Q90.3158 487.413 87.9084 486.672 L87.9084 481.973 Q89.9917 483.107 92.2139 483.663 Q94.4361 484.218 96.913 484.218 Q100.918 484.218 103.256 482.112 Q105.593 480.006 105.593 476.394 Q105.593 472.783 103.256 470.677 Q100.918 468.57 96.913 468.57 Q95.038 468.57 93.163 468.987 Q91.3112 469.404 89.3667 470.283 L89.3667 452.922 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M119.482 481.603 L124.367 481.603 L124.367 487.482 L119.482 487.482 L119.482 481.603 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M144.552 456.001 Q140.941 456.001 139.112 459.566 Q137.306 463.107 137.306 470.237 Q137.306 477.344 139.112 480.908 Q140.941 484.45 144.552 484.45 Q148.186 484.45 149.991 480.908 Q151.82 477.344 151.82 470.237 Q151.82 463.107 149.991 459.566 Q148.186 456.001 144.552 456.001 M144.552 452.297 Q150.362 452.297 153.417 456.904 Q156.496 461.487 156.496 470.237 Q156.496 478.964 153.417 483.57 Q150.362 488.154 144.552 488.154 Q138.741 488.154 135.663 483.57 Q132.607 478.964 132.607 470.237 Q132.607 461.487 135.663 456.904 Q138.741 452.297 144.552 452.297 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M89.1352 202.693 L111.357 202.693 L111.357 204.683 L98.8111 237.253 L93.9269 237.253 L105.732 206.628 L89.1352 206.628 L89.1352 202.693 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M120.478 231.373 L125.362 231.373 L125.362 237.253 L120.478 237.253 L120.478 231.373 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M135.593 202.693 L153.95 202.693 L153.95 206.628 L139.876 206.628 L139.876 215.1 Q140.894 214.753 141.913 214.591 Q142.931 214.406 143.95 214.406 Q149.737 214.406 153.116 217.577 Q156.496 220.748 156.496 226.165 Q156.496 231.743 153.024 234.845 Q149.552 237.924 143.232 237.924 Q141.056 237.924 138.788 237.554 Q136.542 237.183 134.135 236.442 L134.135 231.743 Q136.218 232.878 138.441 233.433 Q140.663 233.989 143.14 233.989 Q147.144 233.989 149.482 231.882 Q151.82 229.776 151.82 226.165 Q151.82 222.554 149.482 220.447 Q147.144 218.341 143.14 218.341 Q141.265 218.341 139.39 218.757 Q137.538 219.174 135.593 220.054 L135.593 202.693 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip112)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1233.21 268.292,1352.27 270.6,1678.22 272.908,1352.63 275.216,1395.51 277.524,1321.66 279.832,1371.38 282.139,1450.68 284.447,1498.55 286.755,1577.11 289.063,1655.31 291.371,1554.63 293.679,1453.54 295.987,1369.15 298.295,1472.58 300.603,1619.7 302.911,1451.46 305.219,1450.04 307.527,1471.77 309.834,1508.32 312.142,1490.21 314.45,1390.8 316.758,1406.64 319.066,1443.13 321.374,1557.5 323.682,1398.3 325.99,1591.58 328.298,1689.76 330.606,1350.72 332.914,1509.14 335.221,1581.12 337.529,1565.37 339.837,1586.7 342.145,1499.13 344.453,1625.32 346.761,1404.4 349.069,1677.69 351.377,1559.44 353.685,1489.83 355.993,1524.68 358.301,1381.97 360.608,1378.91 362.916,1286.84 365.224,1444.01 367.532,1390.52 369.84,1423.46 372.148,1628.23 374.456,1477.94 376.764,1594.2 379.072,1459 381.38,1331.58 383.688,1428.97 385.996,1523.75 388.303,1469.81 390.611,1440.43 392.919,1418.02 395.227,1522.54 397.535,1326.7 399.843,1446.41 402.151,1366.08 404.459,1391.31 406.767,1364 409.075,1420.52 411.383,1421.52 413.69,1651.87 415.998,1480.15 418.306,1452.85 420.614,1392.93 422.922,1310.55 425.23,1564.64 427.538,1429.9 429.846,1512.5 432.154,1463.05 434.462,1635.57 436.77,1489.69 439.077,1449.02 441.385,1547.67 443.693,1536.43 446.001,1445.62 448.309,1282.18 450.617,1478.91 452.925,1538.83 455.233,1666.63 457.541,1519.1 459.849,1516.68 462.157,1368.43 464.465,1393.79 466.772,1605.79 469.08,1579.41 471.388,1447.26 473.696,1610.62 476.004,1464.5 478.312,1584.62 480.62,1326.75 482.928,1397.48 485.236,1436.57 487.544,1484.89 489.852,1565.82 492.159,1671.05 494.467,1339.01 496.775,1463.92 499.083,1605.78 501.391,1245.2 503.699,1413.35 506.007,1469.59 508.315,1558.34 510.623,1669.56 512.931,1413.37 515.239,1399.31 517.546,1496.03 519.854,1401.34 522.162,1660.84 524.47,1426.89 526.778,1274.33 529.086,1519.98 531.394,1248.89 533.702,1592.97 536.01,1502.31 538.318,1421.89 540.626,1530.11 542.933,1407.69 545.241,1375.8 547.549,1589.88 549.857,1468.97 552.165,1267.37 554.473,1564.87 556.781,1638.12 559.089,1316.68 561.397,1345.31 563.705,1396.62 566.013,1354.49 568.321,1296.95 570.628,1423.04 572.936,1508.32 575.244,1462.4 577.552,1565.49 579.86,1340.18 582.168,1558.52 584.476,1547.65 586.784,1484.38 589.092,1628.71 591.4,1421.34 593.708,1360.9 596.015,1484.07 598.323,1411.56 600.631,1483.17 602.939,1430.64 605.247,1579.13 607.555,1360.47 609.863,1319.04 612.171,1586.86 614.479,1419.01 616.787,1442.62 619.095,1405.05 621.402,1492.44 623.71,1399.97 626.018,1649.79 628.326,1387.85 630.634,1504.38 632.942,1417.5 635.25,1393.54 637.558,1462.74 639.866,1399.81 642.174,1615.21 644.482,1476.31 646.79,1464.62 649.097,1602.49 651.405,1660.97 653.713,1429.27 656.021,1463.46 658.329,1327.49 660.637,1421.17 662.945,1544.12 665.253,1410.9 667.561,1475.33 669.869,1614.5 672.177,1554.09 674.484,1452.6 676.792,1369.62 679.1,1671.96 681.408,1634.8 683.716,1407.84 686.024,1407.95 688.332,1479.18 690.64,1359.69 692.948,1722.82 695.256,1414.71 697.564,1524.54 699.871,1447.25 702.179,1439.81 704.487,1538.19 706.795,1524.84 709.103,1543.15 711.411,1296.92 713.719,1522.67 716.027,1470.77 718.335,1558.45 720.643,1371.87 722.951,1484.64 725.259,1424.69 727.566,1415.55 729.874,1615.5 732.182,1453.18 734.49,1319.7 736.798,1504.97 739.106,1511.35 741.414,1259.52 743.722,1543.68 746.03,1566.99 748.338,1520.44 750.646,1490.74 752.953,1469.38 755.261,1415.68 757.569,1630.24 759.877,1610.83 762.185,1488.91 764.493,1498.82 766.801,1419.34 769.109,1305.41 771.417,1321.49 773.725,1602.31 776.033,1520.28 778.34,1328.72 780.648,1547.94 782.956,1413.59 785.264,1391.49 787.572,1534.9 789.88,1516.82 792.188,1295.76 794.496,1415.89 796.804,1690.7 799.112,1336.8 801.42,1528.67 803.728,1375.54 806.035,1460.45 808.343,1559.63 810.651,1450.35 812.959,1312.1 815.267,1641.26 817.575,1475.22 819.883,1481.28 822.191,1480.82 824.499,1497.67 826.807,1446.7 829.115,1492.14 831.422,1248.65 833.73,1491.75 836.038,1581.84 838.346,1530.93 840.654,1645.21 842.962,1541.22 845.27,1680.45 847.578,1565.14 849.886,1530.8 852.194,1620.99 854.502,1334.82 856.809,1751.15 859.117,1605.58 861.425,1268.6 863.733,1740.95 866.041,1312.85 868.349,1575.35 870.657,1376 872.965,1494.19 875.273,1511.44 877.581,1361.74 879.889,1599.19 882.197,1369.23 884.504,1653.09 886.812,1330.6 889.12,1363.73 891.428,1600.54 893.736,1633.11 896.044,1657.46 898.352,1606.49 900.66,1507.22 902.968,1412.05 905.276,1369.28 907.584,1452.06 909.891,1494.97 912.199,1512.77 914.507,1438.6 916.815,1596.7 919.123,1623.54 921.431,1368.68 923.739,1451.74 926.047,1202.27 928.355,1479.79 930.663,1328.02 932.971,1562.05 935.278,1346.98 937.586,1368.27 939.894,1644.44 942.202,1597.46 944.51,1518.1 946.818,1558.42 949.126,1529.36 951.434,1448.4 953.742,1518.69 956.05,1408.38 958.358,1427.05 960.665,1641.55 962.973,1554.8 965.281,1486.08 967.589,1488.52 969.897,1698.7 972.205,1533.09 974.513,1281.48 976.821,1590.8 979.129,1512.65 981.437,1641.08 983.745,1611.99 986.053,1484.92 988.36,1474.33 990.668,1571.98 992.976,1489.32 995.284,1626.91 997.592,1568.91 999.9,1382.48 1002.21,1616.48 1004.52,1396.08 1006.82,1431.63 1009.13,1435.81 1011.44,1425.12 1013.75,1489.09 1016.06,1484.28 1018.36,1393.08 1020.67,1725.23 1022.98,1439.88 1025.29,1547.07 1027.59,1501.18 1029.9,1331.4 1032.21,1497.22 1034.52,1377.74 1036.83,1445.35 1039.13,1313.9 1041.44,1324.08 1043.75,1614.56 1046.06,1238.05 1048.37,1297.32 1050.67,1549.51 1052.98,1460.95 1055.29,1460.97 1057.6,1467.18 1059.91,1452.36 1062.21,1317.95 1064.52,1446.32 1066.83,1419.29 1069.14,1575.99 1071.45,1355.76 1073.75,1428.56 1076.06,1361.35 1078.37,1494.08 1080.68,1301.18 1082.98,1374.79 1085.29,1369.45 1087.6,1530.22 1089.91,1359.92 1092.22,1369.71 1094.52,1366.27 1096.83,1506.53 1099.14,1641.5 1101.45,1416.15 1103.76,1523.24 1106.06,1615.82 1108.37,1562.25 1110.68,1441.76 1112.99,1457.21 1115.3,1483.84 1117.6,1560.87 1119.91,1390.71 1122.22,1542.49 1124.53,1586.26 1126.84,1266.49 1129.14,1346.97 1131.45,1581.69 1133.76,1443.95 1136.07,1263.13 1138.37,1359.33 1140.68,1501.64 1142.99,1584.43 1145.3,1410.9 1147.61,1488.93 1149.91,1375.8 1152.22,1406.57 1154.53,1511.62 1156.84,1522.63 1159.15,1476.65 1161.45,1519.62 1163.76,1510.22 1166.07,1442.64 1168.38,1609.87 1170.69,1360.11 1172.99,1401.13 1175.3,1318.46 1177.61,1464.37 1179.92,1578.4 1182.23,1503.05 1184.53,1411.18 1186.84,1417.56 1189.15,1400.7 1191.46,1393.44 1193.76,1613.86 1196.07,1216.67 1198.38,1396.81 1200.69,1459.37 1203,1653.76 1205.3,1450.44 1207.61,1543.5 1209.92,1418.93 1212.23,1556.01 1214.54,1540.94 1216.84,1431.32 1219.15,1528.49 1221.46,1374.73 1223.77,1555.57 1226.08,1549.2 1228.38,1301.82 1230.69,1550.14 1233,1417.01 1235.31,1401.78 1237.61,1474.87 1239.92,1387.82 1242.23,1408.59 1244.54,1538.94 1246.85,1293.11 1249.15,1543.24 1251.46,1406.23 1253.77,1475.25 1256.08,1426.6 1258.39,1453.52 1260.69,1522.3 1263,1490.82 1265.31,1407.26 1267.62,1313.12 1269.93,1359.83 1272.23,1575.22 1274.54,1512.81 1276.85,1451.98 1279.16,1487.83 1281.47,1551.83 1283.77,1565.28 1286.08,1644.58 1288.39,1384.07 1290.7,1534.84 1293,1496.99 1295.31,1438.82 1297.62,1384.11 1299.93,1548.26 1302.24,1412.56 1304.54,1483.47 1306.85,1662.84 1309.16,1480.16 1311.47,1491.96 1313.78,1455.22 1316.08,1452.58 1318.39,1457.73 1320.7,1513.12 1323.01,1425.72 1325.32,1393.65 1327.62,1588.66 1329.93,1554.99 1332.24,1404.52 1334.55,1509.73 1336.86,1509.67 1339.16,1470.05 1341.47,1479.4 1343.78,1474.76 1346.09,1449.68 1348.39,1418.01 1350.7,1325.19 1353.01,1558.85 1355.32,1604.64 1357.63,1577.01 1359.93,1466.65 1362.24,1402.61 1364.55,1203.89 1366.86,1510.14 1369.17,1530.63 1371.47,1304.76 1373.78,1585.21 1376.09,1434.27 1378.4,1476.52 1380.71,1365.54 1383.01,1337.62 1385.32,1369.14 1387.63,1494 1389.94,1575.77 1392.24,1493.87 1394.55,1377.6 1396.86,1591.48 1399.17,1522.73 1401.48,1529.89 1403.78,1387.81 1406.09,1427.93 1408.4,1438.75 1410.71,1547.45 1413.02,1466.53 1415.32,1563.85 1417.63,1381.62 1419.94,1392.53 1422.25,1491.79 1424.56,1557.82 1426.86,1491.6 1429.17,1364.32 1431.48,1688.13 1433.79,1373.35 1436.1,1410 1438.4,1548.05 1440.71,1567.1 1443.02,1365.32 1445.33,1472.26 1447.63,1289.77 1449.94,1482.08 1452.25,1587.68 1454.56,1596.46 1456.87,1585.35 1459.17,1237.13 1461.48,1576.64 1463.79,1634.56 1466.1,1591.99 1468.41,1537.47 1470.71,1452.62 1473.02,1581.23 1475.33,1632.15 1477.64,1300.9 1479.95,1337.22 1482.25,1336.41 1484.56,1417.04 1486.87,1490.63 1489.18,1367.48 1491.49,1396.11 1493.79,1353.06 1496.1,1498.96 1498.41,1524.03 1500.72,1402.23 1503.02,1466.24 1505.33,1304.91 1507.64,1296.77 1509.95,1508.31 1512.26,1502.31 1514.56,1444.13 1516.87,1508.05 1519.18,1339.66 1521.49,1335.02 1523.8,1409.03 1526.1,1586.03 1528.41,1374.75 1530.72,1700.31 1533.03,1534.95 1535.34,1574.89 1537.64,1306.91 1539.95,1375.81 1542.26,1499.42 1544.57,1247.03 1546.88,1450.75 1549.18,1361.86 1551.49,1649.52 1553.8,1271 1556.11,1354.26 1558.41,1604.28 1560.72,1467.53 1563.03,1385.66 1565.34,1430.89 1567.65,1451.3 1569.95,1433.26 1572.26,1394.52 1574.57,1332.38 1576.88,1287.54 1579.19,1416.68 1581.49,1498.09 1583.8,1479.45 1586.11,1713.58 1588.42,1473.2 1590.73,1601.39 1593.03,1422.33 1595.34,1576.46 1597.65,1447.96 1599.96,1406.8 1602.26,1650.44 1604.57,1234.9 1606.88,1434.82 1609.19,1265.91 1611.5,1353.38 1613.8,1498.72 1616.11,1543.13 1618.42,1433.22 1620.73,1373.02 1623.04,1455.65 1625.34,1376.4 1627.65,1490.79 1629.96,1459.91 1632.27,1413.67 1634.58,1469.04 1636.88,1376.42 1639.19,1728.21 1641.5,1461.83 1643.81,1505.06 1646.12,1495.17 1648.42,1584.45 1650.73,1472.4 1653.04,1406.72 1655.35,1463.93 1657.65,1656.34 1659.96,1575.97 1662.27,1412.41 1664.58,1487.73 1666.89,1505.04 1669.19,1161.81 1671.5,1704.12 1673.81,1497.3 1676.12,1561.79 1678.43,1440.64 1680.73,1489.36 1683.04,1570.96 1685.35,1418.61 1687.66,1397.62 1689.97,1427.69 1692.27,1304.38 1694.58,1224.18 1696.89,1388.85 1699.2,1430.65 1701.51,1559.15 1703.81,1411.67 1706.12,1704.36 1708.43,1435.51 1710.74,1613.92 1713.04,1566.09 1715.35,1637.47 1717.66,1341.83 1719.97,1454.92 1722.28,1383.39 1724.58,1640.23 1726.89,1529.83 1729.2,1329.05 1731.51,1431.38 1733.82,1559.69 1736.12,1537.27 1738.43,1398.17 1740.74,1512.47 1743.05,1244.48 1745.36,1466.13 1747.66,1409.81 1749.97,1351.23 1752.28,1584.12 1754.59,1537.81 1756.9,1430.95 1759.2,1441.94 1761.51,1484.44 1763.82,1492.28 1766.13,1563.88 1768.43,1590.13 1770.74,1598 1773.05,1649.19 1775.36,1467.51 1777.67,1621.46 1779.97,1369.41 1782.28,1531.32 1784.59,1553.92 1786.9,1523.43 1789.21,1507.39 1791.51,1495.64 1793.82,1469.85 1796.13,1665.37 1798.44,1362.82 1800.75,1737.16 1803.05,1273.7 1805.36,1495.5 1807.67,1453.73 1809.98,1577.09 1812.28,1402.25 1814.59,1304.63 1816.9,1557.29 1819.21,1363.32 1821.52,1621.47 1823.82,1446.36 1826.13,1506.22 1828.44,1362.84 1830.75,1476.06 1833.06,1364.1 1835.36,1441.84 1837.67,1311.29 1839.98,1523.7 1842.29,1365.95 1844.6,1520.41 1846.9,1498.31 1849.21,1652.53 1851.52,1315.99 1853.83,1357.69 1856.14,1487.51 1858.44,1686.97 1860.75,1490.66 1863.06,1576.03 1865.37,1471.32 1867.67,1505.92 1869.98,1526.95 1872.29,1431.26 1874.6,1453.65 1876.91,1419.95 1879.21,1502.46 1881.52,1448.14 1883.83,1428.4 1886.14,1670.63 1888.45,1368.1 1890.75,1318.75 1893.06,1501.76 1895.37,1480.44 1897.68,1515.02 1899.99,1548.37 1902.29,1410.07 1904.6,1414.04 1906.91,1537.38 1909.22,1501.11 1911.53,1566.46 1913.83,1435.85 1916.14,1559.17 1918.45,1438.72 1920.76,1377.79 1923.06,1603.71 1925.37,1379.67 1927.68,1600.24 1929.99,1461.25 1932.3,1515.45 1934.6,1298.3 1936.91,1374.1 1939.22,1357.9 1941.53,1496.21 1943.84,1537.34 1946.14,1563.24 1948.45,1599.45 1950.76,1302.67 1953.07,1508.49 1955.38,1517.49 1957.68,1366.2 1959.99,1647.57 1962.3,1670.77 1964.61,1375.22 1966.91,1477.97 1969.22,1319.22 1971.53,1360.55 1973.84,1463.72 1976.15,1521.47 1978.45,1408.97 1980.76,1378.49 1983.07,1510.38 1985.38,1286.12 1987.69,1586.69 1989.99,1595.01 1992.3,1472.8 1994.61,1414.13 1996.92,1477.92 1999.23,1491.5 2001.53,1462.98 2003.84,1505.3 2006.15,1334.32 2008.46,1676.35 2010.77,1534.51 2013.07,1641.98 2015.38,1506.78 2017.69,1436.61 2020,1395.97 2022.3,1688.68 2024.61,1475.48 2026.92,1590.44 2029.23,1379.39 2031.54,1614.58 2033.84,1315.91 2036.15,1485.07 2038.46,1561.43 2040.77,1604.27 2043.08,1553.17 2045.38,1305.76 2047.69,1393.4 2050,1390.53 2052.31,1576.16 2054.62,1372.3 2056.92,1392.91 2059.23,1590.57 2061.54,1632.53 2063.85,1187.36 2066.16,1476.36 2068.46,1383.09 2070.77,1378.09 2073.08,1286.93 2075.39,1592.3 2077.69,1497.33 2080,1403.55 2082.31,1606.73 2084.62,1546.54 2086.93,1297.22 2089.23,1375.71 2091.54,1592.66 2093.85,1337.17 2096.16,1421.97 2098.47,1547.19 2100.77,1511.69 2103.08,1507.54 2105.39,1404.69 2107.7,1501.36 2110.01,1597.98 2112.31,1351.46 2114.62,1514.91 2116.93,1424.18 2119.24,1484.44 2121.55,1395.5 2123.85,1395.36 2126.16,1534.32 2128.47,1420.6 2130.78,1419.44 2133.08,1445.16 2135.39,1337.78 2137.7,1444.22 2140.01,1382.9 2142.32,1490.06 2144.62,1425.08 2146.93,1341.6 2149.24,1456.52 2151.55,1417.15 2153.86,1621.93 2156.16,1318.04 2158.47,1299.89 2160.78,1361.55 2163.09,1444.26 2165.4,1421.98 2167.7,1490.27 2170.01,1492.79 2172.32,1413.52 2174.63,1421.66 2176.93,1404.27 2179.24,1355.87 2181.55,1526.39 2183.86,1377.9 2186.17,1507.52 2188.47,1334.43 2190.78,1661.29 2193.09,1408.49 2195.4,1531.62 2197.71,1416 2200.01,1551.04 2202.32,1447.66 2204.63,1490.84 2206.94,1620.96 2209.25,1405.26 2211.55,1299.09 2213.86,1545.06 2216.17,1595.79 2218.48,1587.27 2220.79,1654.36 2223.09,1604.27 2225.4,1489.25 2227.71,1386.67 2230.02,1543.2 2232.32,1509.82 2234.63,1475.08 2236.94,1623.24 2239.25,1534.78 2241.56,1278.63 2243.86,1565.86 2246.17,1316.77 2248.48,1563.52 2250.79,1273.55 2253.1,1599.24 2255.4,1335.66 2257.71,1497.52 2260.02,1628.25 2262.33,1468.14 2264.64,1539.88 2266.94,1447.93 2269.25,1540.59 2271.56,1290.95 2273.87,1531.87 2276.18,1612.85 2278.48,1647.07 2280.79,1514.39 2283.1,1596.91 2285.41,1450.18 2287.71,1440.52 2290.02,1567.98 2292.33,1349.79 2294.64,1380.05 2296.95,1560.77 2299.25,1555 2301.56,1461.65 2303.87,1527.9 2306.18,1599.7 2308.49,1615.8 2310.79,1525.15 2313.1,1394.88 2315.41,1430.64 2317.72,1450.6 2320.03,1549.28 2322.33,1528.83 2324.64,1459.49 2326.95,1476.81 2329.26,1504.95 2331.56,1490.26 2333.87,1529.16 2336.18,1373.72 2338.49,1560.05 2340.8,1498.96 2343.1,1507.7 2345.41,1746.69 2347.72,1554.87 2350.03,1483.34 2352.34,1411.4 2354.64,1514.7 2356.95,1636.71 2359.26,1546.49 2361.57,1471.89 2363.88,1558.13 2366.18,1507.55 2368.49,1571.49 2370.8,1508.8 2373.11,1179.55 2375.42,1341.67 2377.72,1379.72 2380.03,1405.38 2382.34,1634.38 2384.65,1523 2386.95,1374.35 2389.26,1348.81 2391.57,1498.81 2393.88,1286.23 2396.19,1602.35 2398.49,1331.42 2400.8,1493.59 2403.11,1377.23 2405.42,1602.72 2407.73,1569.6 2410.03,1548.92 2412.34,1509.71 2414.65,1415.15 2416.96,1479.2 2419.27,1656.75 2421.57,1515.1 2423.88,1421.18 2426.19,1669.55 2428.5,1381.74 2430.81,1465.86 2433.11,1469.21 2435.42,1356.28 2437.73,1557.94 2440.04,1534.72 2442.34,1652.61 2444.65,1453.31 2446.96,1508.94 2449.27,1339.68 2451.58,1471.05 2453.88,1607.61 2456.19,1533.09 2458.5,1499.52 2460.81,1440.32 2463.12,1374.29 2465.42,1551.45 2467.73,1355.25 2470.04,1551.68 2472.35,1625.53 2474.66,1349.25 2476.96,1507.15 2479.27,1423.11 2481.58,1467.59 2483.89,1405.97 2486.2,1701.71 2488.5,1410.67 2490.81,1605.36 2493.12,1383.47 2495.43,1349.45 2497.73,1558.18 2500.04,1493.33 2502.35,1440.25 2504.66,1425.68 2506.97,1446.86 2509.27,1594.29 2511.58,1373.93 2513.89,1459.69 2516.2,1325.53 2518.51,1379.47 2520.81,1570.08 2523.12,1575.1 2525.43,1558.01 2527.74,1521.55 2530.05,1535.58 2532.35,1552.47 2534.66,1568.05 2536.97,1417.07 2539.28,1283.46 2541.58,1488.34 2543.89,1530 2546.2,1384.87 2548.51,1384.95 2550.82,1495.28 2553.12,1317.44 2555.43,1516.46 2557.74,1304.06 2560.05,1410.41 2562.36,1418.21 2564.66,1466.19 2566.97,1547.02 2569.28,1465.27 2571.59,1414.45 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,937.189 268.292,920.291 270.6,1005.55 272.908,867.537 275.216,1109.48 277.524,1022.07 279.832,1017.97 282.139,994.843 284.447,847.872 286.755,985.98 289.063,828.579 291.371,1010.1 293.679,832.673 295.987,979.731 298.295,829.171 300.603,957.883 302.911,1012.15 305.219,1058.77 307.527,913.355 309.834,1035.79 312.142,976.618 314.45,996.679 316.758,965.5 319.066,1079.35 321.374,1076.4 323.682,877.741 325.99,985.13 328.298,975.882 330.606,911.961 332.914,1099.01 335.221,867.815 337.529,830.006 339.837,858.773 342.145,1029.58 344.453,999.105 346.761,1045.74 349.069,803.23 351.377,1036.95 353.685,1029.42 355.993,1039.05 358.301,991.318 360.608,1006.44 362.916,1036.53 365.224,1025.97 367.532,983.531 369.84,1010.61 372.148,911.024 374.456,828.278 376.764,883.341 379.072,939.038 381.38,1090.72 383.688,1075.92 385.996,1138.01 388.303,1113.19 390.611,965.833 392.919,1073.64 395.227,1064.5 397.535,754.681 399.843,976.807 402.151,920.641 404.459,1102.93 406.767,1064.42 409.075,904.86 411.383,986.125 413.69,789.538 415.998,979.612 418.306,837.909 420.614,1002.48 422.922,1005.95 425.23,1025.61 427.538,869.866 429.846,817.198 432.154,1037.71 434.462,1007.89 436.77,961.978 439.077,924.97 441.385,989.325 443.693,943.308 446.001,887.168 448.309,984.671 450.617,832.38 452.925,867.353 455.233,853.263 457.541,932.306 459.849,902.49 462.157,1263.78 464.465,1044.77 466.772,892.737 469.08,1088.22 471.388,957.463 473.696,877.181 476.004,878.487 478.312,1013.92 480.62,885.479 482.928,895.138 485.236,1158.33 487.544,993.995 489.852,916.283 492.159,997.986 494.467,846.538 496.775,1103.74 499.083,1049.76 501.391,947.88 503.699,1102.11 506.007,688.523 508.315,820.28 510.623,941.438 512.931,808.582 515.239,847.679 517.546,899.952 519.854,1056.93 522.162,911.485 524.47,965.275 526.778,977.061 529.086,1095.9 531.394,928.705 533.702,1071.39 536.01,919.402 538.318,913.918 540.626,1001.87 542.933,1090.73 545.241,948.945 547.549,967.8 549.857,982.708 552.165,1021.91 554.473,923.848 556.781,870.228 559.089,1032.28 561.397,896.814 563.705,998.309 566.013,981.79 568.321,963.448 570.628,998.864 572.936,979.184 575.244,882.582 577.552,966.21 579.86,938.858 582.168,936.597 584.476,945.221 586.784,898 589.092,710.588 591.4,1111.25 593.708,773.788 596.015,954.11 598.323,770.162 600.631,780.33 602.939,1065.28 605.247,810.843 607.555,1114.65 609.863,900.78 612.171,983.016 614.479,1018.24 616.787,1003.4 619.095,915.932 621.402,993.383 623.71,1039.5 626.018,1043.91 628.326,919.481 630.634,929.153 632.942,979.908 635.25,1112.36 637.558,937.487 639.866,906.85 642.174,897.718 644.482,974.249 646.79,1005.97 649.097,937.169 651.405,816.044 653.713,935.198 656.021,1041.57 658.329,968.664 660.637,998.926 662.945,1030.05 665.253,898.518 667.561,930.877 669.869,1051.34 672.177,828.04 674.484,947.115 676.792,858.82 679.1,1068.51 681.408,885.014 683.716,1014.85 686.024,903.661 688.332,1040.82 690.64,1036.32 692.948,1009.17 695.256,1048.04 697.564,764.764 699.871,993.531 702.179,1090.32 704.487,855.487 706.795,887.446 709.103,822.723 711.411,1011.08 713.719,919.48 716.027,889.12 718.335,1082.08 720.643,935.032 722.951,792.967 725.259,892.278 727.566,805.983 729.874,1038.06 732.182,928.217 734.49,1049.49 736.798,754.289 739.106,1022.84 741.414,1047.63 743.722,1023.1 746.03,936.121 748.338,623.376 750.646,767.703 752.953,874.072 755.261,837.661 757.569,1051.97 759.877,808.358 762.185,876.147 764.493,872.848 766.801,1004.18 769.109,971.822 771.417,878.743 773.725,867.467 776.033,1111.71 778.34,800.104 780.648,1112.66 782.956,932.336 785.264,865.261 787.572,856.067 789.88,998.398 792.188,1115.94 794.496,1089.71 796.804,819.896 799.112,865.267 801.42,951.471 803.728,969.19 806.035,1130.11 808.343,833.783 810.651,1023.12 812.959,837.209 815.267,823.039 817.575,775.05 819.883,825.3 822.191,950.406 824.499,937.26 826.807,897.615 829.115,1009.02 831.422,818.094 833.73,921.962 836.038,914.263 838.346,1045.77 840.654,777.562 842.962,1026.83 845.27,1014.12 847.578,891.387 849.886,892.926 852.194,879.164 854.502,807.573 856.809,896.206 859.117,918.411 861.425,975.356 863.733,872.077 866.041,973.837 868.349,1027.08 870.657,1009.07 872.965,1096.91 875.273,1017.77 877.581,950.578 879.889,1093.7 882.197,1017.55 884.504,1055.22 886.812,1077.66 889.12,1025.97 891.428,939.981 893.736,1192.46 896.044,826.609 898.352,1023.8 900.66,1024.13 902.968,945.341 905.276,791.38 907.584,936.898 909.891,940.96 912.199,1010.44 914.507,1039.77 916.815,1013.05 919.123,972.417 921.431,1108.06 923.739,931.798 926.047,1022.22 928.355,1036.96 930.663,899.397 932.971,917.657 935.278,951.5 937.586,818.52 939.894,937.501 942.202,942.178 944.51,1014.71 946.818,928.375 949.126,1121.28 951.434,968.886 953.742,1042.86 956.05,802.438 958.358,972.433 960.665,842.23 962.973,991.781 965.281,1090.6 967.589,891.868 969.897,915.405 972.205,1175.28 974.513,847.249 976.821,1099.51 979.129,1000.41 981.437,1103.75 983.745,1105.61 986.053,910.505 988.36,960.341 990.668,899.651 992.976,878.098 995.284,1001.84 997.592,907.833 999.9,684.4 1002.21,1017.78 1004.52,1158.07 1006.82,1129.1 1009.13,1099.54 1011.44,936.229 1013.75,1016.29 1016.06,982.847 1018.36,1016.22 1020.67,981.175 1022.98,1070.23 1025.29,909.34 1027.59,1042.67 1029.9,950.093 1032.21,1070.87 1034.52,972.086 1036.83,1137.27 1039.13,1093.01 1041.44,854.153 1043.75,1070.4 1046.06,885.212 1048.37,917.305 1050.67,1147.34 1052.98,972.559 1055.29,970.76 1057.6,1050.21 1059.91,894.44 1062.21,975.209 1064.52,823.371 1066.83,1086.92 1069.14,919.296 1071.45,945.419 1073.75,1271.8 1076.06,1030.95 1078.37,827.757 1080.68,1010.82 1082.98,790.577 1085.29,1003.4 1087.6,980.764 1089.91,1192.47 1092.22,1117.22 1094.52,951.138 1096.83,881.858 1099.14,994.395 1101.45,908.319 1103.76,876.548 1106.06,931.939 1108.37,967.64 1110.68,1003.83 1112.99,979.104 1115.3,1051.95 1117.6,1086.52 1119.91,980.868 1122.22,915.428 1124.53,1070.37 1126.84,933.816 1129.14,1126.72 1131.45,977.509 1133.76,1132.99 1136.07,1028.83 1138.37,970.405 1140.68,1181.16 1142.99,740.706 1145.3,1156.45 1147.61,790.69 1149.91,844.905 1152.22,734.301 1154.53,1007.43 1156.84,939.359 1159.15,1079.05 1161.45,786.974 1163.76,1052.16 1166.07,841.471 1168.38,976.037 1170.69,916.551 1172.99,981.839 1175.3,1177.99 1177.61,992.967 1179.92,1077.22 1182.23,972.482 1184.53,820.456 1186.84,1004.62 1189.15,1104.83 1191.46,935.766 1193.76,1004.12 1196.07,875.597 1198.38,1097.65 1200.69,928.881 1203,1037.07 1205.3,1037.85 1207.61,1003.96 1209.92,883.085 1212.23,803.128 1214.54,1178.61 1216.84,951.625 1219.15,1112.45 1221.46,988.158 1223.77,980.978 1226.08,976.872 1228.38,942.249 1230.69,951.095 1233,965.403 1235.31,1171.94 1237.61,1016.85 1239.92,1022.55 1242.23,858.824 1244.54,1041.57 1246.85,998.952 1249.15,1161.34 1251.46,813.463 1253.77,1124.33 1256.08,769.013 1258.39,761.695 1260.69,991.122 1263,1065.95 1265.31,1029.13 1267.62,932.921 1269.93,967.435 1272.23,1201.16 1274.54,833.497 1276.85,950.084 1279.16,1039.47 1281.47,973.959 1283.77,985.407 1286.08,992.261 1288.39,835.628 1290.7,1071.3 1293,1037.6 1295.31,812.487 1297.62,973.394 1299.93,979.71 1302.24,872.585 1304.54,866.345 1306.85,941.489 1309.16,811.005 1311.47,1050.78 1313.78,960.125 1316.08,1050.06 1318.39,969.578 1320.7,843.242 1323.01,1040.45 1325.32,811.667 1327.62,1047.8 1329.93,861.05 1332.24,925.216 1334.55,795.197 1336.86,1003.17 1339.16,1036.09 1341.47,1028.3 1343.78,889.409 1346.09,953.157 1348.39,893.261 1350.7,857.665 1353.01,967.864 1355.32,1003.51 1357.63,1041.45 1359.93,858.917 1362.24,1001.59 1364.55,878.944 1366.86,890.423 1369.17,938.657 1371.47,962.401 1373.78,1067.32 1376.09,753.542 1378.4,920.466 1380.71,952.484 1383.01,947.213 1385.32,711.915 1387.63,1099.82 1389.94,811.429 1392.24,1063.82 1394.55,841.08 1396.86,1008.78 1399.17,853.065 1401.48,929.2 1403.78,1086.46 1406.09,879.738 1408.4,1007.9 1410.71,1044.51 1413.02,1089.36 1415.32,817.178 1417.63,1116.41 1419.94,999.097 1422.25,929.705 1424.56,800.464 1426.86,973.604 1429.17,1201.54 1431.48,916.524 1433.79,835.103 1436.1,848.472 1438.4,1085.89 1440.71,923.167 1443.02,1000.95 1445.33,1019.37 1447.63,835.642 1449.94,1006.24 1452.25,1021.96 1454.56,1174.71 1456.87,896.453 1459.17,1110.35 1461.48,953.01 1463.79,719.421 1466.1,1021.41 1468.41,951.548 1470.71,802.539 1473.02,969.555 1475.33,945.941 1477.64,886.279 1479.95,767.731 1482.25,858.133 1484.56,847.733 1486.87,729.931 1489.18,786.136 1491.49,1020.5 1493.79,888.338 1496.1,1247.02 1498.41,996.953 1500.72,957.851 1503.02,983.69 1505.33,1192.92 1507.64,1120.91 1509.95,836.9 1512.26,966.556 1514.56,967.578 1516.87,855.974 1519.18,711.271 1521.49,818.947 1523.8,1164.72 1526.1,973.038 1528.41,1116.49 1530.72,1055.16 1533.03,1058.3 1535.34,754.933 1537.64,930.908 1539.95,860.896 1542.26,928.287 1544.57,1054.74 1546.88,981.429 1549.18,973.203 1551.49,1034.25 1553.8,814.573 1556.11,859.638 1558.41,908.604 1560.72,1173.26 1563.03,968.569 1565.34,1058.7 1567.65,1094.07 1569.95,908.676 1572.26,1045.58 1574.57,1094.39 1576.88,886.32 1579.19,891.656 1581.49,963.267 1583.8,744.452 1586.11,955.941 1588.42,906.136 1590.73,1026.81 1593.03,885.849 1595.34,940.303 1597.65,834.36 1599.96,765.12 1602.26,1042.51 1604.57,891.59 1606.88,886.637 1609.19,952.044 1611.5,1053.75 1613.8,949.539 1616.11,1127.31 1618.42,873.64 1620.73,937.167 1623.04,991.856 1625.34,935.071 1627.65,956.747 1629.96,1037.39 1632.27,913.691 1634.58,932.632 1636.88,1055.17 1639.19,965.369 1641.5,984.45 1643.81,938.029 1646.12,1068.12 1648.42,911.757 1650.73,1162.56 1653.04,958.669 1655.35,875.024 1657.65,869.09 1659.96,818.545 1662.27,894.017 1664.58,1032.41 1666.89,952.921 1669.19,959.693 1671.5,1120.69 1673.81,984.973 1676.12,890.768 1678.43,890.93 1680.73,1061.96 1683.04,813.32 1685.35,1076.83 1687.66,855.54 1689.97,1162.12 1692.27,954.035 1694.58,796.215 1696.89,1043.48 1699.2,964.331 1701.51,960.009 1703.81,961.154 1706.12,978.808 1708.43,894.177 1710.74,993.157 1713.04,862.78 1715.35,1109.12 1717.66,1062.52 1719.97,1272.81 1722.28,1050.05 1724.58,1002.08 1726.89,861.17 1729.2,979.135 1731.51,883.172 1733.82,888.019 1736.12,1060.01 1738.43,937.397 1740.74,1109.02 1743.05,1146.68 1745.36,969.163 1747.66,1141.4 1749.97,973.865 1752.28,1063.17 1754.59,724.439 1756.9,835.525 1759.2,1037.16 1761.51,839.817 1763.82,943.928 1766.13,945.537 1768.43,926.609 1770.74,749.283 1773.05,989.539 1775.36,858.753 1777.67,1044.62 1779.97,1125.42 1782.28,970.81 1784.59,937.006 1786.9,970.095 1789.21,924.228 1791.51,1038.95 1793.82,1253.98 1796.13,899.267 1798.44,994.333 1800.75,1101.08 1803.05,883.832 1805.36,906.701 1807.67,845.072 1809.98,891.266 1812.28,990.157 1814.59,894.845 1816.9,834.348 1819.21,1055.75 1821.52,1000.03 1823.82,757.98 1826.13,878.595 1828.44,994.664 1830.75,1063.78 1833.06,845.552 1835.36,989.824 1837.67,965.878 1839.98,943.551 1842.29,896.932 1844.6,997.948 1846.9,848.39 1849.21,1069.74 1851.52,1178.27 1853.83,1077.49 1856.14,913.673 1858.44,960.581 1860.75,939.2 1863.06,1045.16 1865.37,892.018 1867.67,1027.46 1869.98,978.794 1872.29,1009.62 1874.6,1043.83 1876.91,1049.13 1879.21,1133.92 1881.52,934.837 1883.83,962.508 1886.14,932.158 1888.45,869.184 1890.75,1088.11 1893.06,986.231 1895.37,1070.9 1897.68,948.156 1899.99,909.494 1902.29,879.192 1904.6,697.936 1906.91,817.033 1909.22,1048.22 1911.53,947.669 1913.83,852.764 1916.14,905.557 1918.45,1085.38 1920.76,901.422 1923.06,981.516 1925.37,994.862 1927.68,965.512 1929.99,872.187 1932.3,1149.1 1934.6,865.377 1936.91,856.187 1939.22,953.205 1941.53,841.234 1943.84,959.099 1946.14,720.001 1948.45,1031.01 1950.76,918.755 1953.07,1046.15 1955.38,907.749 1957.68,812.562 1959.99,871.694 1962.3,962.73 1964.61,1167.29 1966.91,992.774 1969.22,1005.93 1971.53,1018.37 1973.84,1178.75 1976.15,1139.79 1978.45,1129.86 1980.76,986.422 1983.07,1060.05 1985.38,892.484 1987.69,854.651 1989.99,856.939 1992.3,1094.21 1994.61,1120.72 1996.92,1046.87 1999.23,1084.65 2001.53,1096.9 2003.84,1006.03 2006.15,896.552 2008.46,1072.58 2010.77,1058.61 2013.07,1024.11 2015.38,1127.13 2017.69,1159.08 2020,940.395 2022.3,808.988 2024.61,811.484 2026.92,1013.87 2029.23,1169.73 2031.54,931.74 2033.84,943.056 2036.15,1041.57 2038.46,967.246 2040.77,910.501 2043.08,1219.21 2045.38,981.49 2047.69,935.757 2050,887.92 2052.31,906.674 2054.62,908.26 2056.92,936.664 2059.23,866.398 2061.54,966.517 2063.85,956.182 2066.16,1019.17 2068.46,961.902 2070.77,910.612 2073.08,1085.52 2075.39,991.161 2077.69,938.784 2080,871.405 2082.31,960.098 2084.62,1010.34 2086.93,912.992 2089.23,987.338 2091.54,845.438 2093.85,918.124 2096.16,882.889 2098.47,892.123 2100.77,1060.92 2103.08,821.792 2105.39,856.517 2107.7,810.279 2110.01,1076.16 2112.31,965.898 2114.62,1139.28 2116.93,950.316 2119.24,972.431 2121.55,1047.02 2123.85,814.822 2126.16,1028.31 2128.47,1023.94 2130.78,1029.73 2133.08,1091.59 2135.39,1120.3 2137.7,962.458 2140.01,1001.74 2142.32,1098.43 2144.62,833.65 2146.93,905.274 2149.24,935.711 2151.55,1194.09 2153.86,880.362 2156.16,998.032 2158.47,1072.99 2160.78,1014.17 2163.09,1061.86 2165.4,1104.7 2167.7,942.466 2170.01,1047.53 2172.32,902.5 2174.63,981.675 2176.93,986.716 2179.24,1040.63 2181.55,1021.72 2183.86,1121.09 2186.17,1069.85 2188.47,947.359 2190.78,1068.99 2193.09,798.659 2195.4,1015.58 2197.71,744.221 2200.01,961.845 2202.32,1053.53 2204.63,810.112 2206.94,939.821 2209.25,1105.02 2211.55,1099.19 2213.86,860.618 2216.17,1122.98 2218.48,955.609 2220.79,925.611 2223.09,824.018 2225.4,892.065 2227.71,962.025 2230.02,866.436 2232.32,904.47 2234.63,1009.69 2236.94,786.536 2239.25,967.27 2241.56,905.314 2243.86,1024.6 2246.17,1143.19 2248.48,826.438 2250.79,989.035 2253.1,969.395 2255.4,1010.42 2257.71,912.023 2260.02,1027.01 2262.33,990.129 2264.64,967.78 2266.94,1120.84 2269.25,1016.94 2271.56,952.915 2273.87,1100.57 2276.18,935.476 2278.48,1065.37 2280.79,764.305 2283.1,947.776 2285.41,946.47 2287.71,1045.46 2290.02,1183.96 2292.33,827.451 2294.64,1049.08 2296.95,1083.5 2299.25,896.147 2301.56,1064.33 2303.87,1065.8 2306.18,942.332 2308.49,1008.76 2310.79,1049.15 2313.1,878.813 2315.41,1086.15 2317.72,932.066 2320.03,1028 2322.33,1047.49 2324.64,1043.68 2326.95,878.666 2329.26,891.411 2331.56,840.652 2333.87,1092.24 2336.18,1005.85 2338.49,787.395 2340.8,1049.29 2343.1,929.705 2345.41,1129.41 2347.72,1128.94 2350.03,1104.98 2352.34,1166 2354.64,1229.38 2356.95,1054.55 2359.26,1045.17 2361.57,1157.44 2363.88,953.695 2366.18,895.473 2368.49,984.066 2370.8,950.772 2373.11,1021.79 2375.42,1076.73 2377.72,838.814 2380.03,822.323 2382.34,809.318 2384.65,1128.15 2386.95,898.555 2389.26,910.625 2391.57,959.16 2393.88,1088.27 2396.19,983.565 2398.49,1102.68 2400.8,1068.54 2403.11,1110.18 2405.42,810.6 2407.73,982.31 2410.03,910.756 2412.34,763.747 2414.65,828.405 2416.96,991.879 2419.27,1004.28 2421.57,893.65 2423.88,1055.05 2426.19,892.59 2428.5,991.027 2430.81,969.178 2433.11,1270.06 2435.42,896.918 2437.73,997.72 2440.04,986.256 2442.34,967.526 2444.65,906.016 2446.96,951.584 2449.27,1074.87 2451.58,851.213 2453.88,1107.84 2456.19,872.549 2458.5,908.053 2460.81,1101.93 2463.12,983.359 2465.42,1100.56 2467.73,975.769 2470.04,1039.02 2472.35,888.439 2474.66,997.479 2476.96,933.742 2479.27,841.263 2481.58,901.292 2483.89,1027.14 2486.2,1176.92 2488.5,886.986 2490.81,1030.28 2493.12,1016.29 2495.43,903.564 2497.73,1103.58 2500.04,969.859 2502.35,919.849 2504.66,955.74 2506.97,990.931 2509.27,783.868 2511.58,855.075 2513.89,957.568 2516.2,1070.38 2518.51,1159.34 2520.81,1069.05 2523.12,937.45 2525.43,932.386 2527.74,1013.74 2530.05,1123.82 2532.35,1029.18 2534.66,1107.48 2536.97,898.257 2539.28,1190.9 2541.58,1085.5 2543.89,898.384 2546.2,979.169 2548.51,1031.54 2550.82,1080.45 2553.12,895.937 2555.43,964.569 2557.74,871.034 2560.05,920.884 2562.36,1105.16 2564.66,987.806 2566.97,906.621 2569.28,1109.06 2571.59,1114.07 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,632.8 268.292,210.516 270.6,424.26 272.908,374.114 275.216,427.773 277.524,463.487 279.832,656.292 282.139,239.741 284.447,460.748 286.755,316.887 289.063,559.217 291.371,517.519 293.679,443.193 295.987,292.032 298.295,363.097 300.603,423.188 302.911,446.757 305.219,559.582 307.527,470.781 309.834,429.335 312.142,374.112 314.45,543.807 316.758,303.545 319.066,599.696 321.374,408.492 323.682,597.07 325.99,407.377 328.298,461.11 330.606,388.952 332.914,407.747 335.221,355.17 337.529,502.749 339.837,571.262 342.145,398.903 344.453,432.059 346.761,572.812 349.069,375.808 351.377,594.35 353.685,315.974 355.993,443.326 358.301,591.568 360.608,429.181 362.916,522.072 365.224,674.643 367.532,621.014 369.84,626.53 372.148,529.813 374.456,508.096 376.764,264.315 379.072,434.297 381.38,437.395 383.688,341.421 385.996,483.868 388.303,461.113 390.611,345.705 392.919,275.599 395.227,554.872 397.535,372.323 399.843,278.809 402.151,459.743 404.459,376.067 406.767,484.071 409.075,568.503 411.383,249.331 413.69,516.725 415.998,501.627 418.306,381.85 420.614,473.65 422.922,471.36 425.23,252.831 427.538,379.35 429.846,372.535 432.154,511.712 434.462,551.407 436.77,576.761 439.077,448.496 441.385,544.908 443.693,547.026 446.001,531.256 448.309,431.54 450.617,398.188 452.925,539.046 455.233,390.167 457.541,467.511 459.849,577.458 462.157,475.834 464.465,570.737 466.772,398.16 469.08,278.667 471.388,487.987 473.696,339.735 476.004,430.718 478.312,325.465 480.62,513.013 482.928,536.025 485.236,460.139 487.544,502.559 489.852,453.936 492.159,443.895 494.467,501.684 496.775,434.882 499.083,577.672 501.391,460.896 503.699,324.081 506.007,521.946 508.315,401.696 510.623,288.46 512.931,741.906 515.239,390.838 517.546,533.683 519.854,519.944 522.162,484.092 524.47,563.904 526.778,530.547 529.086,456.341 531.394,573.178 533.702,363.321 536.01,468.858 538.318,429.387 540.626,616.354 542.933,508.634 545.241,625.27 547.549,561.135 549.857,112.058 552.165,444.965 554.473,529.165 556.781,610.973 559.089,627.992 561.397,515.261 563.705,453.15 566.013,440.82 568.321,615.13 570.628,537.156 572.936,225.88 575.244,485.71 577.552,486.519 579.86,448.566 582.168,469.639 584.476,503.333 586.784,428.372 589.092,473.75 591.4,471.333 593.708,479.111 596.015,593.998 598.323,571.081 600.631,392.634 602.939,590.697 605.247,404.056 607.555,372.645 609.863,665.426 612.171,531.797 614.479,204.062 616.787,661.664 619.095,470.781 621.402,538.454 623.71,218.578 626.018,544.958 628.326,305.896 630.634,376.999 632.942,440.559 635.25,399.072 637.558,303.763 639.866,447.86 642.174,449.659 644.482,412.864 646.79,508.489 649.097,385.056 651.405,493.376 653.713,587.25 656.021,394.757 658.329,503.283 660.637,428.613 662.945,581.707 665.253,278.921 667.561,428.453 669.869,422.162 672.177,484.95 674.484,253.745 676.792,369.109 679.1,403.116 681.408,324.346 683.716,650.19 686.024,472.751 688.332,413.71 690.64,395.747 692.948,450.281 695.256,389.712 697.564,295.752 699.871,535.009 702.179,607.537 704.487,460.388 706.795,580.717 709.103,597.229 711.411,357.339 713.719,449.742 716.027,558.043 718.335,445.192 720.643,473.148 722.951,387.703 725.259,420.077 727.566,427.297 729.874,345.256 732.182,397.126 734.49,499.423 736.798,481.265 739.106,519.485 741.414,390.515 743.722,460.363 746.03,439.329 748.338,448.628 750.646,377.32 752.953,431.046 755.261,239.733 757.569,513.119 759.877,632.595 762.185,439.716 764.493,616.936 766.801,468.589 769.109,549.375 771.417,570.804 773.725,493.527 776.033,605.745 778.34,519.707 780.648,291.528 782.956,366.829 785.264,666.554 787.572,504.175 789.88,559.403 792.188,477.73 794.496,674.543 796.804,370.917 799.112,460.523 801.42,611.249 803.728,605.547 806.035,447.007 808.343,437.09 810.651,494.698 812.959,450.319 815.267,364.642 817.575,471.806 819.883,601.033 822.191,435.688 824.499,388.319 826.807,489.052 829.115,515.792 831.422,532.468 833.73,465.213 836.038,591.498 838.346,476.677 840.654,305.813 842.962,320.158 845.27,225.952 847.578,511.77 849.886,601.763 852.194,374.334 854.502,441.573 856.809,401.263 859.117,632.014 861.425,553.504 863.733,190.875 866.041,468.322 868.349,471.951 870.657,420.292 872.965,393.949 875.273,772.479 877.581,524.407 879.889,459.253 882.197,287.098 884.504,646.576 886.812,283.56 889.12,438.35 891.428,480.923 893.736,450.876 896.044,601.193 898.352,472.065 900.66,498.876 902.968,533.42 905.276,601.998 907.584,490.054 909.891,450.798 912.199,404.572 914.507,452.908 916.815,431.154 919.123,545.094 921.431,359.283 923.739,390.696 926.047,406.688 928.355,707.872 930.663,508.001 932.971,531.31 935.278,504.663 937.586,528.221 939.894,403.639 942.202,171.695 944.51,446.758 946.818,420.839 949.126,481.454 951.434,688.563 953.742,527.138 956.05,386.133 958.358,547.539 960.665,538.852 962.973,400.212 965.281,537.194 967.589,651.989 969.897,479.244 972.205,630.84 974.513,456.787 976.821,485.594 979.129,433.828 981.437,403.091 983.745,608.664 986.053,444.589 988.36,430.481 990.668,363.571 992.976,642.696 995.284,371.121 997.592,530.053 999.9,399.244 1002.21,445.127 1004.52,223.184 1006.82,303.421 1009.13,524.011 1011.44,467.029 1013.75,476.546 1016.06,381.472 1018.36,461.729 1020.67,731.631 1022.98,515.17 1025.29,406.334 1027.59,423.699 1029.9,497.44 1032.21,451.21 1034.52,493.969 1036.83,509.53 1039.13,534.248 1041.44,389.264 1043.75,282.18 1046.06,393.067 1048.37,417.042 1050.67,470.089 1052.98,553.807 1055.29,487.445 1057.6,383.501 1059.91,447.083 1062.21,205.328 1064.52,618.789 1066.83,506.313 1069.14,271.835 1071.45,440.346 1073.75,531.116 1076.06,674.186 1078.37,475.25 1080.68,562.069 1082.98,580.669 1085.29,250.312 1087.6,460.237 1089.91,592.032 1092.22,465.426 1094.52,345.129 1096.83,524.777 1099.14,507.95 1101.45,479.046 1103.76,619.913 1106.06,517.97 1108.37,472.665 1110.68,579.447 1112.99,350.236 1115.3,599.752 1117.6,426.303 1119.91,546.667 1122.22,658.276 1124.53,442.41 1126.84,546.87 1129.14,556.359 1131.45,446.29 1133.76,468.803 1136.07,573.314 1138.37,340.796 1140.68,440.946 1142.99,478.88 1145.3,291.69 1147.61,506.927 1149.91,419.178 1152.22,430.182 1154.53,555.009 1156.84,476.484 1159.15,399.907 1161.45,402.354 1163.76,508.064 1166.07,500.703 1168.38,454.17 1170.69,550.021 1172.99,521.063 1175.3,430.013 1177.61,442.306 1179.92,446.001 1182.23,295.706 1184.53,611.973 1186.84,465.027 1189.15,274.895 1191.46,562.116 1193.76,653.239 1196.07,455.574 1198.38,537.263 1200.69,515.155 1203,540.47 1205.3,306.45 1207.61,445.42 1209.92,634.405 1212.23,384.609 1214.54,549.089 1216.84,471.498 1219.15,533.162 1221.46,548.924 1223.77,430.96 1226.08,468.273 1228.38,541.061 1230.69,546.662 1233,484.448 1235.31,439.615 1237.61,736.627 1239.92,420.534 1242.23,595.277 1244.54,522.523 1246.85,396.466 1249.15,466.261 1251.46,476.668 1253.77,628.537 1256.08,500.578 1258.39,501.716 1260.69,426.268 1263,405.35 1265.31,580.155 1267.62,423.423 1269.93,353.554 1272.23,430.016 1274.54,302.774 1276.85,398.022 1279.16,210.752 1281.47,310.237 1283.77,462.24 1286.08,563.945 1288.39,448.397 1290.7,525.515 1293,365.19 1295.31,536.904 1297.62,370.81 1299.93,562.809 1302.24,503.932 1304.54,511.276 1306.85,365.778 1309.16,335.125 1311.47,450.724 1313.78,480.307 1316.08,484.856 1318.39,622.457 1320.7,359.923 1323.01,583.707 1325.32,478.102 1327.62,436.855 1329.93,482.946 1332.24,566.263 1334.55,272.961 1336.86,428.52 1339.16,528.397 1341.47,338.667 1343.78,451.286 1346.09,627.83 1348.39,365.483 1350.7,608.304 1353.01,596.289 1355.32,515.269 1357.63,648.765 1359.93,304.745 1362.24,282.729 1364.55,522.284 1366.86,467.611 1369.17,600.495 1371.47,390.358 1373.78,456.699 1376.09,471.325 1378.4,375.603 1380.71,525.908 1383.01,576.441 1385.32,507.327 1387.63,106.865 1389.94,364.954 1392.24,509.487 1394.55,536.832 1396.86,455.826 1399.17,619.532 1401.48,489.922 1403.78,440.907 1406.09,499.765 1408.4,286.022 1410.71,445.542 1413.02,461.256 1415.32,376.712 1417.63,594.115 1419.94,435.443 1422.25,282.247 1424.56,514.963 1426.86,374.784 1429.17,546.021 1431.48,513.638 1433.79,622.968 1436.1,618.819 1438.4,459.745 1440.71,490.351 1443.02,489.774 1445.33,583.655 1447.63,555.898 1449.94,438.473 1452.25,463.321 1454.56,353.481 1456.87,381.51 1459.17,573.43 1461.48,461.502 1463.79,513.771 1466.1,612.955 1468.41,520.645 1470.71,311.57 1473.02,629.214 1475.33,443.069 1477.64,405.624 1479.95,488.986 1482.25,464.822 1484.56,410.817 1486.87,429.732 1489.18,386.132 1491.49,380.969 1493.79,392.823 1496.1,528.017 1498.41,506.516 1500.72,425.335 1503.02,581.644 1505.33,457.716 1507.64,542.453 1509.95,378.264 1512.26,505.242 1514.56,383.672 1516.87,466.074 1519.18,470.606 1521.49,506.366 1523.8,268.567 1526.1,554.117 1528.41,348.543 1530.72,594.603 1533.03,386.916 1535.34,521.659 1537.64,489.43 1539.95,537.034 1542.26,398.873 1544.57,434.7 1546.88,545.225 1549.18,712.172 1551.49,514.462 1553.8,536.86 1556.11,487.973 1558.41,433.067 1560.72,522.47 1563.03,540.803 1565.34,424.141 1567.65,373.875 1569.95,557.65 1572.26,407.192 1574.57,486.488 1576.88,565.102 1579.19,546.412 1581.49,460.356 1583.8,426.09 1586.11,553.902 1588.42,467.862 1590.73,542.224 1593.03,530.276 1595.34,510.966 1597.65,578.631 1599.96,520.093 1602.26,579.731 1604.57,463.286 1606.88,508.519 1609.19,472.513 1611.5,297.153 1613.8,414.96 1616.11,499.726 1618.42,446.375 1620.73,336.003 1623.04,448.678 1625.34,663.093 1627.65,382.897 1629.96,468.897 1632.27,307.821 1634.58,625.578 1636.88,428.738 1639.19,233.075 1641.5,531.097 1643.81,222.76 1646.12,376.125 1648.42,597.598 1650.73,485.97 1653.04,317.115 1655.35,604.108 1657.65,427.568 1659.96,506.687 1662.27,397.464 1664.58,314.953 1666.89,540.428 1669.19,610.737 1671.5,499.709 1673.81,603.513 1676.12,522.142 1678.43,680.396 1680.73,479.516 1683.04,544.624 1685.35,537.3 1687.66,417.814 1689.97,575.825 1692.27,414.064 1694.58,498.862 1696.89,464.887 1699.2,252.781 1701.51,452.734 1703.81,305.635 1706.12,424.811 1708.43,377.692 1710.74,294.559 1713.04,658.12 1715.35,417.459 1717.66,544.241 1719.97,294.052 1722.28,550.806 1724.58,424.785 1726.89,355.106 1729.2,504.008 1731.51,395.741 1733.82,393.802 1736.12,416.591 1738.43,489.41 1740.74,359.954 1743.05,410.651 1745.36,438.418 1747.66,399.063 1749.97,630.517 1752.28,472.302 1754.59,510.13 1756.9,415.482 1759.2,488.885 1761.51,705.669 1763.82,483.534 1766.13,496.365 1768.43,627.833 1770.74,574.222 1773.05,688.848 1775.36,282.489 1777.67,540.145 1779.97,653.842 1782.28,443.361 1784.59,515.262 1786.9,497.734 1789.21,276.107 1791.51,504.572 1793.82,422.07 1796.13,440.555 1798.44,411.75 1800.75,405.201 1803.05,647.441 1805.36,319.917 1807.67,686.573 1809.98,553.349 1812.28,761.236 1814.59,618.015 1816.9,444.123 1819.21,562.527 1821.52,528.394 1823.82,503.049 1826.13,490.951 1828.44,307.553 1830.75,436.276 1833.06,520.311 1835.36,532.271 1837.67,413.267 1839.98,253.247 1842.29,523.688 1844.6,418.242 1846.9,604.416 1849.21,282.105 1851.52,633.004 1853.83,404.545 1856.14,468.416 1858.44,561.239 1860.75,617.857 1863.06,427.681 1865.37,325.507 1867.67,370.718 1869.98,597.633 1872.29,403.727 1874.6,407.523 1876.91,385.11 1879.21,572.041 1881.52,590.372 1883.83,531.288 1886.14,591.583 1888.45,715.479 1890.75,229.954 1893.06,435.549 1895.37,329.468 1897.68,440.203 1899.99,686.123 1902.29,570.634 1904.6,596.486 1906.91,533.77 1909.22,486.324 1911.53,430.061 1913.83,358.882 1916.14,539.884 1918.45,484.455 1920.76,282.753 1923.06,528.392 1925.37,543.981 1927.68,455.553 1929.99,642.622 1932.3,545.534 1934.6,589.614 1936.91,461.097 1939.22,528.162 1941.53,433.045 1943.84,560.786 1946.14,394.213 1948.45,423.079 1950.76,393.528 1953.07,546.627 1955.38,671.19 1957.68,316.426 1959.99,406.659 1962.3,575.745 1964.61,515.725 1966.91,567.392 1969.22,383.899 1971.53,393.053 1973.84,246.526 1976.15,584.537 1978.45,424.318 1980.76,618.543 1983.07,391.504 1985.38,379.689 1987.69,468.039 1989.99,514.975 1992.3,483.715 1994.61,487.309 1996.92,303.435 1999.23,559.205 2001.53,464.682 2003.84,351.45 2006.15,581.009 2008.46,548.569 2010.77,462.542 2013.07,462.76 2015.38,537.426 2017.69,376.3 2020,477.149 2022.3,422.93 2024.61,438.888 2026.92,272.976 2029.23,673.448 2031.54,412.524 2033.84,504.104 2036.15,571.469 2038.46,257.713 2040.77,315.626 2043.08,547.042 2045.38,452.474 2047.69,635.276 2050,579.631 2052.31,719.887 2054.62,486.902 2056.92,380.455 2059.23,583.532 2061.54,486.736 2063.85,504.678 2066.16,423.783 2068.46,466.97 2070.77,475.003 2073.08,595.498 2075.39,449.45 2077.69,540.048 2080,508.037 2082.31,397.24 2084.62,630.036 2086.93,502.822 2089.23,465.606 2091.54,497.486 2093.85,440.354 2096.16,459.7 2098.47,405.818 2100.77,475.104 2103.08,446.895 2105.39,513.242 2107.7,461.731 2110.01,334.417 2112.31,359.17 2114.62,453.352 2116.93,623.908 2119.24,659.675 2121.55,516.594 2123.85,326.023 2126.16,518.129 2128.47,229.177 2130.78,473.616 2133.08,476.943 2135.39,449.419 2137.7,752.793 2140.01,287.35 2142.32,513.845 2144.62,498.551 2146.93,437.084 2149.24,434.572 2151.55,470.572 2153.86,653.501 2156.16,577.142 2158.47,464.71 2160.78,450.046 2163.09,588.86 2165.4,619.825 2167.7,401.846 2170.01,622.469 2172.32,462.588 2174.63,478.808 2176.93,404.532 2179.24,366.683 2181.55,317.469 2183.86,577.033 2186.17,457.545 2188.47,552.199 2190.78,470.587 2193.09,434.402 2195.4,483.38 2197.71,516.836 2200.01,477.434 2202.32,191.48 2204.63,363.21 2206.94,481.785 2209.25,255.509 2211.55,568.126 2213.86,256.474 2216.17,557.225 2218.48,444.519 2220.79,459.569 2223.09,343.122 2225.4,382.528 2227.71,516.339 2230.02,526.505 2232.32,409.107 2234.63,426.4 2236.94,417.602 2239.25,514.548 2241.56,350.491 2243.86,396.794 2246.17,504.797 2248.48,400.329 2250.79,464.94 2253.1,258.321 2255.4,662.016 2257.71,515.679 2260.02,423.177 2262.33,409.215 2264.64,510.526 2266.94,515.41 2269.25,628.361 2271.56,398.124 2273.87,343.835 2276.18,642.963 2278.48,348.516 2280.79,649.765 2283.1,455.476 2285.41,644.043 2287.71,504.856 2290.02,557.732 2292.33,512.284 2294.64,588.71 2296.95,419.301 2299.25,448.791 2301.56,543.734 2303.87,406.871 2306.18,528.713 2308.49,472.882 2310.79,531.746 2313.1,414.453 2315.41,515.24 2317.72,532.275 2320.03,426.182 2322.33,321.761 2324.64,599.363 2326.95,586.235 2329.26,184.311 2331.56,308.006 2333.87,537.966 2336.18,442.708 2338.49,241.887 2340.8,471.075 2343.1,637.724 2345.41,366.338 2347.72,314.267 2350.03,675.3 2352.34,489.196 2354.64,375.073 2356.95,424.887 2359.26,456.382 2361.57,631.143 2363.88,436.577 2366.18,682.279 2368.49,360.864 2370.8,562.569 2373.11,541.38 2375.42,353.238 2377.72,557.718 2380.03,522.068 2382.34,245.149 2384.65,404.343 2386.95,543.092 2389.26,239.009 2391.57,456.09 2393.88,817.557 2396.19,480.868 2398.49,670.215 2400.8,603.634 2403.11,537.989 2405.42,188.565 2407.73,412.782 2410.03,400.06 2412.34,333.904 2414.65,500.037 2416.96,397.921 2419.27,591.615 2421.57,394.329 2423.88,556.553 2426.19,521.753 2428.5,451.099 2430.81,484.658 2433.11,565.866 2435.42,453.96 2437.73,408.582 2440.04,402.505 2442.34,496.923 2444.65,529.105 2446.96,447.841 2449.27,410.268 2451.58,319.676 2453.88,576.905 2456.19,453.781 2458.5,559.232 2460.81,312.289 2463.12,450.634 2465.42,346.831 2467.73,383.22 2470.04,568.566 2472.35,590.778 2474.66,507.81 2476.96,426.636 2479.27,364.67 2481.58,383.748 2483.89,428.207 2486.2,543.78 2488.5,397.031 2490.81,271.997 2493.12,96.8724 2495.43,328.585 2497.73,588.18 2500.04,693.735 2502.35,462.518 2504.66,564.575 2506.97,571.414 2509.27,540.99 2511.58,589.379 2513.89,440.208 2516.2,635.418 2518.51,485.56 2520.81,452.969 2523.12,354.744 2525.43,441.808 2527.74,579.355 2530.05,587.865 2532.35,498.006 2534.66,614.255 2536.97,485.287 2539.28,341.735 2541.58,448.045 2543.89,511.988 2546.2,340.351 2548.51,508.985 2550.82,284.296 2553.12,495.352 2555.43,352.428 2557.74,455.665 2560.05,484.254 2562.36,366.744 2564.66,285.93 2566.97,393.122 2569.28,503.262 2571.59,439.497 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(stack, samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:310</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.99099   -4.37851   -4.73189  -2.67535    …  -6.33482   -5.91312  -4.70049
  0.221412  -0.340816   1.81071  -0.0732752      0.829825   2.49229   2.72526
  0.980455   3.17925    3.83001   4.69347        2.53959    2.36672   3.58937

[:, :, 2] =
 -3.95946  -4.28902   -4.06018   …  -3.87445   -4.06902   -4.63998
 -0.13092   0.163593  -0.896277      0.656909   0.188983  -0.928076
  1.79637   3.69298    3.55583       5.48991    4.95838    5.22839

[:, :, 3] =
 -4.37321   -4.80745  -4.43768  -4.66539   …  -2.6691    -4.60973   -4.30429
 -0.272663  -1.0392   -1.13148   0.494429      0.053515  -0.539384   0.497503
  2.5709     2.92398   2.52945   3.97227       3.65726    4.50347    4.25417

[:, :, 4] =
 -3.75745   -3.52496   -3.9111   -5.56039  …  -5.25514  -4.38077  -3.16495
 -0.905348  -0.538181  -1.46363  -2.30434     -1.89485  -1.684    -0.966141
  4.95657    4.45966    4.81395   5.27297      5.97496   5.33533   4.4551</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97021     1.05867
 -0.00620763  1.04643
  5.0181      1.06558</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is just a <code>Vector{&lt;:Real}</code>, so we just need the following line:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>) <span class="op">=</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.66 seconds
Compute duration  = 2.66 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -5.0104    1.0504    0.0184   3274.5199   5905.8901    1.0006   ⋯
        x[2]   -0.0433    1.0679    0.0179   3540.8528   5265.5373    0.9999   ⋯
        x[3]    4.9709    1.0496    0.0172   3727.7536   5723.9887    0.9999   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -7.0410   -5.7280   -5.0102   -4.2995   -2.9605
        x[2]   -2.1273   -0.7505   -0.0401    0.6709    2.0629
        x[3]    2.9364    4.2657    4.9715    5.6827    7.0599
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.72 seconds
Compute duration  = 1.72 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.5011    0.1927    0.0027   4856.3854   6167.9224    1.0000   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1468    0.3526    0.5035    0.6467    0.8582
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.7589    0.1309    0.0234    31.7448    43.4286    1.0223     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.2962    0.8012    0.8012    0.8012    0.8012
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.7564579742119015,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:443</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadunsafe!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:889</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:291</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:262</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:244</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:445</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.54 seconds
Compute duration  = 0.54 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    6.0582    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -1.9850    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    6.0582    6.0582    6.0582    6.0582    6.0582
           x   -1.9850   -1.9850   -1.9850   -1.9850   -1.9850
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ReverseDiff.jl</a>:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.97 seconds
Compute duration  = 2.97 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8511    0.4990    0.0226   393.4699   254.0097    1.0143     ⋯
           x    0.3941    1.4186    0.2317    44.4678    38.0267    1.0056     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1153    0.4993    0.7625    1.1101    2.1136
           x   -3.2431   -0.2452    0.1475    1.6594    2.9253
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li><ol type="1">
<li>and (2) makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol></li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>