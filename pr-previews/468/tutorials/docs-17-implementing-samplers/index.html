<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.49026719121701</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.49026719121701</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.89961  -1.83937   -2.58177   -3.74216   …  -4.62686  -4.28482  -6.14304
  1.09033   0.198659  -0.735641   0.422315      1.08027   1.50001  -0.985183
  2.75737   3.83123    5.30714    4.8921        4.12373   6.58946   7.47467</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99736     1.0055
 -0.00893341  1.00048
  5.03492     0.992608</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip380">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip381">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip382">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip380)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1561.9 2640.76,1561.9 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1250 2640.76,1250 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,938.105 2640.76,938.105 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,626.206 2640.76,626.206 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,314.307 2640.76,314.307 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1561.9 170.644,1561.9 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1250 170.644,1250 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,938.105 170.644,938.105 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,626.206 170.644,626.206 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,314.307 170.644,314.307 "></polyline>
<path clip-path="url(#clip380)" d="M49.5521 1562.35 L79.2279 1562.35 L79.2279 1566.29 L49.5521 1566.29 L49.5521 1562.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.8991 1560.04 Q96.7509 1560.04 94.8991 1562.19 Q93.0704 1564.35 93.0704 1568.1 Q93.0704 1571.82 94.8991 1574 Q96.7509 1576.15 99.8991 1576.15 Q103.047 1576.15 104.876 1574 Q106.728 1571.82 106.728 1568.1 Q106.728 1564.35 104.876 1562.19 Q103.047 1560.04 99.8991 1560.04 M109.181 1545.39 L109.181 1549.65 Q107.422 1548.81 105.617 1548.37 Q103.834 1547.93 102.075 1547.93 Q97.4454 1547.93 94.9917 1551.06 Q92.5612 1554.18 92.2139 1560.5 Q93.5797 1558.49 95.6398 1557.42 Q97.7 1556.34 100.177 1556.34 Q105.385 1556.34 108.394 1559.51 Q111.427 1562.66 111.427 1568.1 Q111.427 1573.42 108.279 1576.64 Q105.131 1579.85 99.8991 1579.85 Q93.9037 1579.85 90.7325 1575.27 Q87.5612 1570.67 87.5612 1561.94 Q87.5612 1553.74 91.45 1548.88 Q95.3389 1544 101.89 1544 Q103.649 1544 105.431 1544.35 Q107.237 1544.69 109.181 1545.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M50.3623 1250.46 L80.0381 1250.46 L80.0381 1254.39 L50.3623 1254.39 L50.3623 1250.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M104.297 1248.65 Q107.654 1249.37 109.529 1251.64 Q111.427 1253.9 111.427 1257.24 Q111.427 1262.35 107.908 1265.15 Q104.39 1267.96 97.9083 1267.96 Q95.7324 1267.96 93.4176 1267.52 Q91.126 1267.1 88.6723 1266.24 L88.6723 1261.73 Q90.6167 1262.86 92.9315 1263.44 Q95.2463 1264.02 97.7695 1264.02 Q102.168 1264.02 104.459 1262.28 Q106.774 1260.55 106.774 1257.24 Q106.774 1254.18 104.621 1252.47 Q102.492 1250.73 98.6722 1250.73 L94.6445 1250.73 L94.6445 1246.89 L98.8574 1246.89 Q102.306 1246.89 104.135 1245.53 Q105.964 1244.14 105.964 1241.54 Q105.964 1238.88 104.066 1237.47 Q102.191 1236.03 98.6722 1236.03 Q96.7509 1236.03 94.5519 1236.45 Q92.3528 1236.87 89.7139 1237.75 L89.7139 1233.58 Q92.376 1232.84 94.6908 1232.47 Q97.0287 1232.1 99.0889 1232.1 Q104.413 1232.1 107.515 1234.53 Q110.617 1236.94 110.617 1241.06 Q110.617 1243.93 108.973 1245.92 Q107.33 1247.89 104.297 1248.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.4824 923.904 Q95.8713 923.904 94.0426 927.469 Q92.2371 931.01 92.2371 938.14 Q92.2371 945.247 94.0426 948.811 Q95.8713 952.353 99.4824 952.353 Q103.117 952.353 104.922 948.811 Q106.751 945.247 106.751 938.14 Q106.751 931.01 104.922 927.469 Q103.117 923.904 99.4824 923.904 M99.4824 920.2 Q105.293 920.2 108.348 924.807 Q111.427 929.39 111.427 938.14 Q111.427 946.867 108.348 951.473 Q105.293 956.057 99.4824 956.057 Q93.6723 956.057 90.5936 951.473 Q87.538 946.867 87.538 938.14 Q87.538 929.39 90.5936 924.807 Q93.6723 920.2 99.4824 920.2 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M104.297 624.852 Q107.654 625.57 109.529 627.838 Q111.427 630.107 111.427 633.44 Q111.427 638.556 107.908 641.357 Q104.39 644.158 97.9083 644.158 Q95.7324 644.158 93.4176 643.718 Q91.126 643.301 88.6723 642.445 L88.6723 637.931 Q90.6167 639.065 92.9315 639.644 Q95.2463 640.222 97.7695 640.222 Q102.168 640.222 104.459 638.486 Q106.774 636.75 106.774 633.44 Q106.774 630.384 104.621 628.672 Q102.492 626.935 98.6722 626.935 L94.6445 626.935 L94.6445 623.093 L98.8574 623.093 Q102.306 623.093 104.135 621.727 Q105.964 620.338 105.964 617.746 Q105.964 615.084 104.066 613.672 Q102.191 612.236 98.6722 612.236 Q96.7509 612.236 94.5519 612.653 Q92.3528 613.07 89.7139 613.949 L89.7139 609.783 Q92.376 609.042 94.6908 608.672 Q97.0287 608.301 99.0889 608.301 Q104.413 608.301 107.515 610.732 Q110.617 613.139 110.617 617.26 Q110.617 620.13 108.973 622.121 Q107.33 624.088 104.297 624.852 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.8991 312.444 Q96.7509 312.444 94.8991 314.597 Q93.0704 316.749 93.0704 320.499 Q93.0704 324.226 94.8991 326.402 Q96.7509 328.555 99.8991 328.555 Q103.047 328.555 104.876 326.402 Q106.728 324.226 106.728 320.499 Q106.728 316.749 104.876 314.597 Q103.047 312.444 99.8991 312.444 M109.181 297.791 L109.181 302.05 Q107.422 301.217 105.617 300.777 Q103.834 300.337 102.075 300.337 Q97.4454 300.337 94.9917 303.462 Q92.5612 306.587 92.2139 312.907 Q93.5797 310.893 95.6398 309.828 Q97.7 308.74 100.177 308.74 Q105.385 308.74 108.394 311.911 Q111.427 315.06 111.427 320.499 Q111.427 325.823 108.279 329.041 Q105.131 332.258 99.8991 332.258 Q93.9037 332.258 90.7325 327.675 Q87.5612 323.069 87.5612 314.342 Q87.5612 306.148 91.45 301.286 Q95.3389 296.402 101.89 296.402 Q103.649 296.402 105.431 296.749 Q107.237 297.097 109.181 297.791 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip382)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1135.6 224.541,1417.03 226.891,1576.51 229.242,1610.27 231.592,1395.72 233.943,1354.36 236.293,1473.33 238.644,1535.6 240.994,1390.18 243.345,1605.09 245.695,1390.57 248.046,1449.45 250.396,1573.13 252.747,1574.3 255.097,1326.21 257.448,1433 259.798,1566.23 262.148,1450.13 264.499,1474.87 266.849,1421.82 269.2,1497.72 271.55,1247.19 273.901,1404.75 276.251,1538.55 278.602,1379.46 280.952,1426.72 283.303,1497.28 285.653,1493.4 288.004,1390.25 290.354,1658.6 292.705,1574.39 295.055,1439.13 297.406,1379.51 299.756,1443.55 302.107,1476.17 304.457,1435.78 306.807,1506.71 309.158,1498.81 311.508,1524.39 313.859,1498.64 316.209,1476.48 318.56,1342.01 320.91,1422.83 323.261,1399.64 325.611,1474.17 327.962,1547.97 330.312,1431.67 332.663,1488.43 335.013,1309.23 337.364,1297.76 339.714,1429.11 342.065,1504.11 344.415,1550.83 346.765,1287.27 349.116,1498.99 351.466,1297.86 353.817,1489.53 356.167,1308.97 358.518,1349.6 360.868,1465.52 363.219,1551.23 365.569,1444.02 367.92,1476.32 370.27,1289.64 372.621,1305.42 374.971,1471.77 377.322,1523.67 379.672,1357.43 382.023,1563.19 384.373,1629.37 386.724,1455.79 389.074,1629.69 391.424,1547.81 393.775,1577.01 396.125,1477.66 398.476,1446.9 400.826,1490.63 403.177,1379.21 405.527,1533.06 407.878,1476.3 410.228,1273.13 412.579,1458.33 414.929,1553.79 417.28,1558.98 419.63,1555.2 421.981,1425.25 424.331,1472.09 426.682,1488.65 429.032,1594.48 431.382,1347.79 433.733,1480.1 436.083,1401.75 438.434,1655.27 440.784,1598.6 443.135,1342.84 445.485,1541.85 447.836,1371.18 450.186,1488.86 452.537,1445.42 454.887,1332.81 457.238,1449.19 459.588,1479.11 461.939,1582.58 464.289,1659.98 466.64,1382.45 468.99,1384.57 471.341,1301.86 473.691,1626.52 476.041,1624.67 478.392,1497.76 480.742,1399.01 483.093,1558.61 485.443,1268.62 487.794,1574.19 490.144,1388.12 492.495,1282.6 494.845,1442 497.196,1592.87 499.546,1481.95 501.897,1497.24 504.247,1353.58 506.598,1497.74 508.948,1466.91 511.299,1456.79 513.649,1580.95 515.999,1365.02 518.35,1208.63 520.7,1330.68 523.051,1138.3 525.401,1417.88 527.752,1301.05 530.102,1621.23 532.453,1423.86 534.803,1566.11 537.154,1517.53 539.504,1446.84 541.855,1442.37 544.205,1384.12 546.556,1545.78 548.906,1489.48 551.257,1550.35 553.607,1432.9 555.958,1278.76 558.308,1315.85 560.658,1571.52 563.009,1660.73 565.359,1375.67 567.71,1413.87 570.06,1377.78 572.411,1510.11 574.761,1636.91 577.112,1626.99 579.462,1395.94 581.813,1524.6 584.163,1409.55 586.514,1409.32 588.864,1630.06 591.215,1429.6 593.565,1454.71 595.916,1416.71 598.266,1535.1 600.616,1508.78 602.967,1473.29 605.317,1389.04 607.668,1501.28 610.018,1493.91 612.369,1472.6 614.719,1420.31 617.07,1381.96 619.42,1530.09 621.771,1488.16 624.121,1360.86 626.472,1392.42 628.822,1275.81 631.173,1682.02 633.523,1218.31 635.874,1481.69 638.224,1516.52 640.575,1354.71 642.925,1299.1 645.275,1522.89 647.626,1404.71 649.976,1476.57 652.327,1438.27 654.677,1491.76 657.028,1518.24 659.378,1514.08 661.729,1557.73 664.079,1540.3 666.43,1399.27 668.78,1414.24 671.131,1424.41 673.481,1427.03 675.832,1299.94 678.182,1420.72 680.533,1463.94 682.883,1358.93 685.233,1605.86 687.584,1478.83 689.934,1589.2 692.285,1424.42 694.635,1536.96 696.986,1442.36 699.336,1361.8 701.687,1433.71 704.037,1319.2 706.388,1432.67 708.738,1593.77 711.089,1535.76 713.439,1443.96 715.79,1380.88 718.14,1666.2 720.491,1499.87 722.841,1246.48 725.192,1455.69 727.542,1489.03 729.892,1590.06 732.243,1263.11 734.593,1547.92 736.944,1475.44 739.294,1424.65 741.645,1346.33 743.995,1426.44 746.346,1569.23 748.696,1394.49 751.047,1460.05 753.397,1411.39 755.748,1192.98 758.098,1504.65 760.449,1649.82 762.799,1506.42 765.15,1601.72 767.5,1558.42 769.85,1411.74 772.201,1556.56 774.551,1517.14 776.902,1503.4 779.252,1441.09 781.603,1401 783.953,1658.3 786.304,1506.81 788.654,1310.23 791.005,1396.17 793.355,1318.82 795.706,1565.89 798.056,1503.69 800.407,1431.95 802.757,1599.76 805.108,1372.08 807.458,1300.37 809.809,1417.97 812.159,1484.21 814.509,1514.94 816.86,1602.26 819.21,1416.19 821.561,1411.15 823.911,1383.35 826.262,1326.3 828.612,1414.08 830.963,1543.63 833.313,1528.98 835.664,1456.08 838.014,1306.43 840.365,1500.54 842.715,1437.58 845.066,1574.25 847.416,1531.77 849.767,1355.96 852.117,1393.54 854.467,1423.88 856.818,1203.01 859.168,1538.73 861.519,1396.17 863.869,1457.12 866.22,1458.47 868.57,1527.39 870.921,1344.69 873.271,1585.56 875.622,1441.5 877.972,1366.72 880.323,1341.56 882.673,1598.07 885.024,1495.65 887.374,1482.44 889.725,1566.95 892.075,1531.54 894.426,1503.39 896.776,1352.89 899.126,1439.7 901.477,1389.02 903.827,1304.13 906.178,1353 908.528,1477.44 910.879,1510.05 913.229,1514.84 915.58,1592.11 917.93,1542.85 920.281,1378.94 922.631,1349 924.982,1402.82 927.332,1369.54 929.683,1299.21 932.033,1383.17 934.384,1369.46 936.734,1651.29 939.084,1498.82 941.435,1427.88 943.785,1353.49 946.136,1378.74 948.486,1460.62 950.837,1438.65 953.187,1500.96 955.538,1415.27 957.888,1489.6 960.239,1552.85 962.589,1651.27 964.94,1392.85 967.29,1429.04 969.641,1437.4 971.991,1458.72 974.342,1442.42 976.692,1507.06 979.043,1292.62 981.393,1482.18 983.743,1228.05 986.094,1466.95 988.444,1551.66 990.795,1427.4 993.145,1399.52 995.496,1375.68 997.846,1636.14 1000.2,1387.88 1002.55,1369.82 1004.9,1377.85 1007.25,1481.79 1009.6,1532.54 1011.95,1454.85 1014.3,1347.49 1016.65,1468.93 1019,1540.22 1021.35,1475.54 1023.7,1518.5 1026.05,1402.68 1028.4,1674.93 1030.75,1412.15 1033.1,1457.9 1035.45,1486.58 1037.8,1469.43 1040.15,1194.61 1042.51,1494.32 1044.86,1566.82 1047.21,1588.81 1049.56,1359.92 1051.91,1452.37 1054.26,1331.2 1056.61,1315.12 1058.96,1584.41 1061.31,1499.88 1063.66,1472.31 1066.01,1437.46 1068.36,1563.42 1070.71,1465.55 1073.06,1567.79 1075.41,1559.6 1077.76,1521.73 1080.11,1483.51 1082.46,1426.22 1084.81,1470.41 1087.16,1463.4 1089.51,1540.77 1091.87,1603.37 1094.22,1489.52 1096.57,1507.2 1098.92,1426.75 1101.27,1432.59 1103.62,1251.88 1105.97,1483.38 1108.32,1473.43 1110.67,1356.39 1113.02,1347.7 1115.37,1410.14 1117.72,1552.36 1120.07,1487.57 1122.42,1592.15 1124.77,1431.85 1127.12,1428.6 1129.47,1415.57 1131.82,1433.81 1134.17,1460.03 1136.52,1300.29 1138.87,1492.96 1141.23,1498.28 1143.58,1453.12 1145.93,1325.17 1148.28,1451.58 1150.63,1556.11 1152.98,1388.63 1155.33,1398.76 1157.68,1294.39 1160.03,1607.31 1162.38,1507.05 1164.73,1447.23 1167.08,1508.11 1169.43,1411.43 1171.78,1571.79 1174.13,1580.11 1176.48,1462.84 1178.83,1485.17 1181.18,1471.98 1183.53,1491.99 1185.88,1285.35 1188.23,1554.89 1190.59,1501.87 1192.94,1511.22 1195.29,1466.56 1197.64,1446.56 1199.99,1424.04 1202.34,1542.87 1204.69,1319.9 1207.04,1389.72 1209.39,1321.37 1211.74,1378.17 1214.09,1387.3 1216.44,1291.44 1218.79,1661.8 1221.14,1334.49 1223.49,1387.16 1225.84,1528.8 1228.19,1384.29 1230.54,1434.08 1232.89,1525.61 1235.24,1299.93 1237.59,1478.95 1239.94,1401.17 1242.3,1425.67 1244.65,1449.33 1247,1450.28 1249.35,1677.79 1251.7,1363.24 1254.05,1538.5 1256.4,1602.29 1258.75,1426.9 1261.1,1615.58 1263.45,1547.49 1265.8,1503.85 1268.15,1472.28 1270.5,1251.47 1272.85,1497.45 1275.2,1386.41 1277.55,1537.26 1279.9,1574.4 1282.25,1464.36 1284.6,1467.33 1286.95,1615.24 1289.3,1520.89 1291.66,1309.62 1294.01,1551.6 1296.36,1495.05 1298.71,1625.62 1301.06,1272.55 1303.41,1497.97 1305.76,1480.83 1308.11,1539.49 1310.46,1351.29 1312.81,1488.19 1315.16,1480.35 1317.51,1403.7 1319.86,1514.11 1322.21,1402.87 1324.56,1424.41 1326.91,1373.73 1329.26,1418.88 1331.61,1447.33 1333.96,1413.38 1336.31,1498.45 1338.66,1526.4 1341.02,1523.46 1343.37,1447.35 1345.72,1463.07 1348.07,1504.63 1350.42,1556.51 1352.77,1342.92 1355.12,1314.77 1357.47,1585.53 1359.82,1363.66 1362.17,1420.39 1364.52,1676.68 1366.87,1562.85 1369.22,1594.37 1371.57,1383.5 1373.92,1285.27 1376.27,1534.1 1378.62,1475.98 1380.97,1569.73 1383.32,1540.52 1385.67,1472.44 1388.02,1480.89 1390.38,1510.86 1392.73,1446.18 1395.08,1504.86 1397.43,1594.99 1399.78,1637.24 1402.13,1493.85 1404.48,1476.72 1406.83,1515.11 1409.18,1543.62 1411.53,1355.82 1413.88,1490.31 1416.23,1362.7 1418.58,1303.25 1420.93,1481.85 1423.28,1567.25 1425.63,1570.74 1427.98,1358 1430.33,1383.89 1432.68,1478.08 1435.03,1668.7 1437.38,1404.37 1439.74,1390.18 1442.09,1521.04 1444.44,1517.49 1446.79,1632.2 1449.14,1410.6 1451.49,1325.54 1453.84,1304.37 1456.19,1462.23 1458.54,1539.42 1460.89,1452 1463.24,1514.78 1465.59,1632.54 1467.94,1532.91 1470.29,1150.99 1472.64,1400.17 1474.99,1530.66 1477.34,1570.39 1479.69,1469.99 1482.04,1596.56 1484.39,1315.54 1486.74,1481.99 1489.1,1735.76 1491.45,1405.07 1493.8,1733.53 1496.15,1478.69 1498.5,1398.52 1500.85,1511.26 1503.2,1333.89 1505.55,1498.81 1507.9,1269.84 1510.25,1448.66 1512.6,1553.41 1514.95,1489.69 1517.3,1606.57 1519.65,1553.23 1522,1333.38 1524.35,1358.85 1526.7,1441.16 1529.05,1480 1531.4,1459.55 1533.75,1348.48 1536.1,1564.2 1538.45,1375.58 1540.81,1469.3 1543.16,1567.63 1545.51,1370.13 1547.86,1376.02 1550.21,1391.95 1552.56,1431.04 1554.91,1338.5 1557.26,1519.87 1559.61,1491.96 1561.96,1564.1 1564.31,1506.91 1566.66,1546.81 1569.01,1540.95 1571.36,1504.44 1573.71,1424.33 1576.06,1416.15 1578.41,1556.55 1580.76,1478.73 1583.11,1521.59 1585.46,1481.29 1587.81,1493.32 1590.17,1572.72 1592.52,1327.9 1594.87,1535.4 1597.22,1435.9 1599.57,1401.83 1601.92,1370.09 1604.27,1527.58 1606.62,1700.17 1608.97,1621.8 1611.32,1407.36 1613.67,1502.31 1616.02,1414.63 1618.37,1367.27 1620.72,1332.83 1623.07,1424.12 1625.42,1341.78 1627.77,1286.42 1630.12,1372.47 1632.47,1605.03 1634.82,1610.23 1637.17,1434.1 1639.53,1605.49 1641.88,1536.46 1644.23,1572.32 1646.58,1530.47 1648.93,1716.55 1651.28,1577.8 1653.63,1499.53 1655.98,1369.55 1658.33,1558.45 1660.68,1464.42 1663.03,1416.14 1665.38,1605.69 1667.73,1341.5 1670.08,1524.02 1672.43,1550.78 1674.78,1357.66 1677.13,1461.88 1679.48,1615.6 1681.83,1267.41 1684.18,1425.33 1686.53,1528.18 1688.89,1455.55 1691.24,1630.54 1693.59,1491.94 1695.94,1570.87 1698.29,1477.22 1700.64,1437.81 1702.99,1390.97 1705.34,1248.34 1707.69,1577.89 1710.04,1153.56 1712.39,1414.6 1714.74,1593.96 1717.09,1370.9 1719.44,1676.73 1721.79,1556.16 1724.14,1645.34 1726.49,1550.44 1728.84,1250.9 1731.19,1479.4 1733.54,1488.25 1735.89,1384.26 1738.25,1578.37 1740.6,1611.94 1742.95,1558.94 1745.3,1497.88 1747.65,1470.37 1750,1613.08 1752.35,1520.84 1754.7,1517.96 1757.05,1505.71 1759.4,1434.39 1761.75,1372.24 1764.1,1564.31 1766.45,1452.39 1768.8,1626.38 1771.15,1213.64 1773.5,1544.63 1775.85,1502.28 1778.2,1443.43 1780.55,1455.84 1782.9,1413.64 1785.25,1619.68 1787.6,1427.49 1789.96,1493.04 1792.31,1258.19 1794.66,1510.8 1797.01,1396.46 1799.36,1246.87 1801.71,1507.87 1804.06,1341.64 1806.41,1322.28 1808.76,1508.41 1811.11,1487.03 1813.46,1290.11 1815.81,1432.18 1818.16,1252.55 1820.51,1255.75 1822.86,1586.23 1825.21,1448.91 1827.56,1514.6 1829.91,1420.98 1832.26,1605.09 1834.61,1434.77 1836.96,1552.44 1839.32,1510.12 1841.67,1354.05 1844.02,1519.43 1846.37,1443.69 1848.72,1292.6 1851.07,1364.81 1853.42,1587.03 1855.77,1724.45 1858.12,1464.29 1860.47,1489.01 1862.82,1663.23 1865.17,1502.53 1867.52,1515.35 1869.87,1460.28 1872.22,1473.86 1874.57,1443.99 1876.92,1582.02 1879.27,1380.76 1881.62,1466.13 1883.97,1671.31 1886.32,1378.33 1888.68,1262.11 1891.03,1445.17 1893.38,1433.51 1895.73,1723.56 1898.08,1413.89 1900.43,1561.45 1902.78,1440.07 1905.13,1525.25 1907.48,1461.33 1909.83,1555.45 1912.18,1500.51 1914.53,1431.61 1916.88,1369.68 1919.23,1434.39 1921.58,1441.11 1923.93,1562.01 1926.28,1333.98 1928.63,1464.46 1930.98,1318.62 1933.33,1457.34 1935.68,1542.21 1938.04,1474.12 1940.39,1410.22 1942.74,1406.51 1945.09,1363.7 1947.44,1346.34 1949.79,1311.96 1952.14,1394.89 1954.49,1574.89 1956.84,1450.27 1959.19,1546.82 1961.54,1270.96 1963.89,1435.17 1966.24,1623.39 1968.59,1507.16 1970.94,1392.91 1973.29,1578.45 1975.64,1407.17 1977.99,1443.87 1980.34,1407.1 1982.69,1508.48 1985.04,1530.01 1987.4,1596.28 1989.75,1597.95 1992.1,1432.26 1994.45,1381.92 1996.8,1561.33 1999.15,1585.11 2001.5,1357.11 2003.85,1500.01 2006.2,1440.56 2008.55,1403.27 2010.9,1602.61 2013.25,1398.03 2015.6,1603.29 2017.95,1485.05 2020.3,1417.99 2022.65,1539.18 2025,1465.56 2027.35,1594.3 2029.7,1618.09 2032.05,1192.19 2034.4,1440.76 2036.76,1492.38 2039.11,1489.34 2041.46,1568.55 2043.81,1474.59 2046.16,1740.73 2048.51,1608.44 2050.86,1333.75 2053.21,1548.75 2055.56,1396.4 2057.91,1453.03 2060.26,1635.68 2062.61,1616.9 2064.96,1578.61 2067.31,1470 2069.66,1594.54 2072.01,1687.58 2074.36,1461.4 2076.71,1471.63 2079.06,1331.82 2081.41,1564.58 2083.76,1228.39 2086.11,1414.04 2088.47,1499.81 2090.82,1455.1 2093.17,1586.07 2095.52,1452.92 2097.87,1356.69 2100.22,1689.12 2102.57,1356.68 2104.92,1507.53 2107.27,1751.15 2109.62,1549.96 2111.97,1449.12 2114.32,1323.23 2116.67,1538.11 2119.02,1507.63 2121.37,1423.16 2123.72,1645.75 2126.07,1348.42 2128.42,1344.11 2130.77,1537.84 2133.12,1526.48 2135.47,1544.12 2137.83,1704.56 2140.18,1470.88 2142.53,1428.34 2144.88,1287.2 2147.23,1357.85 2149.58,1346.87 2151.93,1509.64 2154.28,1538.47 2156.63,1263.12 2158.98,1302.63 2161.33,1457.81 2163.68,1351.8 2166.03,1615.31 2168.38,1382.93 2170.73,1325.83 2173.08,1452.89 2175.43,1423.24 2177.78,1261.35 2180.13,1474.31 2182.48,1553.6 2184.83,1547.81 2187.19,1500.82 2189.54,1258.48 2191.89,1513.59 2194.24,1397.26 2196.59,1424.68 2198.94,1222.21 2201.29,1647.39 2203.64,1463.62 2205.99,1388.53 2208.34,1731.22 2210.69,1344.42 2213.04,1426.57 2215.39,1158.49 2217.74,1425.53 2220.09,1460.62 2222.44,1558.71 2224.79,1667 2227.14,1542.35 2229.49,1673.32 2231.84,1565.91 2234.19,1474.75 2236.55,1543.64 2238.9,1338.34 2241.25,1561.55 2243.6,1313.02 2245.95,1529.29 2248.3,1446.74 2250.65,1229.82 2253,1393.75 2255.35,1263.27 2257.7,1630.32 2260.05,1438.6 2262.4,1388.11 2264.75,1383.79 2267.1,1441.1 2269.45,1564.39 2271.8,1594.68 2274.15,1395.1 2276.5,1232.15 2278.85,1511.47 2281.2,1341.3 2283.55,1333.43 2285.91,1438.82 2288.26,1269.71 2290.61,1478.75 2292.96,1291.54 2295.31,1482.86 2297.66,1486.23 2300.01,1411.54 2302.36,1482.44 2304.71,1492.33 2307.06,1532.01 2309.41,1601.97 2311.76,1621.38 2314.11,1502.81 2316.46,1632.55 2318.81,1453.5 2321.16,1608.43 2323.51,1342.3 2325.86,1506.89 2328.21,1431.31 2330.56,1444.9 2332.91,1486.79 2335.27,1508.71 2337.62,1635.61 2339.97,1548.5 2342.32,1358.57 2344.67,1420.97 2347.02,1443.05 2349.37,1467.69 2351.72,1625.67 2354.07,1391.71 2356.42,1493.09 2358.77,1328.76 2361.12,1449.12 2363.47,1465.11 2365.82,1651.96 2368.17,1483.08 2370.52,1493.88 2372.87,1443.56 2375.22,1363.63 2377.57,1579.59 2379.92,1575.79 2382.27,1400.96 2384.62,1470.88 2386.98,1391.16 2389.33,1273.46 2391.68,1498.61 2394.03,1558.63 2396.38,1575.23 2398.73,1546.25 2401.08,1444.26 2403.43,1333.94 2405.78,1391.27 2408.13,1414.05 2410.48,1401.46 2412.83,1523.3 2415.18,1607.46 2417.53,1484.87 2419.88,1232.1 2422.23,1446.75 2424.58,1368.5 2426.93,1448.52 2429.28,1400.85 2431.63,1454.1 2433.98,1336.98 2436.34,1267.14 2438.69,1241.48 2441.04,1283.98 2443.39,1400.09 2445.74,1495.38 2448.09,1475.58 2450.44,1537.41 2452.79,1281.93 2455.14,1646.71 2457.49,1631.5 2459.84,1444.2 2462.19,1267.6 2464.54,1221.95 2466.89,1521.15 2469.24,1411.36 2471.59,1335.59 2473.94,1433.83 2476.29,1527.67 2478.64,1375.59 2480.99,1234.8 2483.34,1505.5 2485.7,1459.64 2488.05,1471.91 2490.4,1416.03 2492.75,1409.9 2495.1,1529.81 2497.45,1500.88 2499.8,1457.94 2502.15,1391.44 2504.5,1460.1 2506.85,1485.01 2509.2,1421.63 2511.55,1488.15 2513.9,1590.17 2516.25,1567.54 2518.6,1372.11 2520.95,1320.63 2523.3,1363.83 2525.65,1546.38 2528,1441.53 2530.35,1451.37 2532.7,1468.02 2535.06,1478.35 2537.41,1465.47 2539.76,1632.77 2542.11,1504.97 2544.46,1533.41 2546.81,1564.12 2549.16,1406.75 2551.51,1517.27 2553.86,1524.44 2556.21,1470.69 2558.56,1507.15 2560.91,1514.02 2563.26,1456.65 2565.61,1461.61 2567.96,1509.19 2570.31,1420.34 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,824.748 224.541,1060.77 226.891,798.649 229.242,939.38 231.592,703.017 233.943,739.144 236.293,912.099 238.644,899.622 240.994,923.388 243.345,896.487 245.695,1048.81 248.046,921.138 250.396,913.012 252.747,857.451 255.097,1035.18 257.448,908.241 259.798,856.976 262.148,825.521 264.499,922.187 266.849,923.184 269.2,932.882 271.55,1026.61 273.901,1006.56 276.251,843.09 278.602,904.919 280.952,1003.86 283.303,918.397 285.653,842.222 288.004,912.253 290.354,956.551 292.705,1075.61 295.055,974.471 297.406,899.183 299.756,1068 302.107,805.653 304.457,864.744 306.807,907.584 309.158,804.708 311.508,809.735 313.859,876.125 316.209,848.444 318.56,1182.4 320.91,1010.04 323.261,990.476 325.611,946.888 327.962,814.589 330.312,806.885 332.663,1105.61 335.013,946.162 337.364,864.592 339.714,805.236 342.065,945.233 344.415,989.68 346.765,864.77 349.116,879.813 351.466,917.524 353.817,845.606 356.167,809.564 358.518,1117.79 360.868,1049.16 363.219,1098.95 365.569,1107.91 367.92,975.875 370.27,944.507 372.621,1023.7 374.971,733.686 377.322,698.734 379.672,841.826 382.023,755.755 384.373,974.292 386.724,874.327 389.074,1011.88 391.424,957.66 393.775,886.992 396.125,850.659 398.476,1093.55 400.826,1031.08 403.177,846.823 405.527,881.463 407.878,955.353 410.228,856.128 412.579,822.041 414.929,933.288 417.28,907.173 419.63,905.666 421.981,1023.29 424.331,913.245 426.682,959.339 429.032,915.141 431.382,928.058 433.733,706.206 436.083,1204.51 438.434,1035.44 440.784,1062.14 443.135,951.331 445.485,864.923 447.836,816.883 450.186,1078.91 452.537,876.598 454.887,907.127 457.238,799.259 459.588,1019.57 461.939,846.665 464.289,1052.06 466.64,983.107 468.99,887.335 471.341,958.934 473.691,837.758 476.041,1119.84 478.392,1145.81 480.742,880.024 483.093,871.558 485.443,1098.18 487.794,937.601 490.144,1119.9 492.495,733.411 494.845,954.737 497.196,1094.23 499.546,965.226 501.897,825.694 504.247,773.389 506.598,1023.95 508.948,789.424 511.299,1027.44 513.649,895.453 515.999,872.624 518.35,944.93 520.7,861.202 523.051,1020.38 525.401,983.835 527.752,987.282 530.102,916.573 532.453,903.97 534.803,944.279 537.154,903.148 539.504,838.237 541.855,890.076 544.205,847.167 546.556,877.465 548.906,954.937 551.257,971.761 553.607,992.468 555.958,854.269 558.308,964.169 560.658,890.005 563.009,1140.8 565.359,867.744 567.71,731.679 570.06,846.961 572.411,1079.03 574.761,875.906 577.112,913.842 579.462,1026.95 581.813,804.682 584.163,967.502 586.514,928.879 588.864,989.195 591.215,815.923 593.565,998.139 595.916,937.936 598.266,1078.02 600.616,921.052 602.967,891.566 605.317,1118.85 607.668,910.351 610.018,1001.23 612.369,950.857 614.719,968.993 617.07,883.758 619.42,853.722 621.771,999.015 624.121,1157.66 626.472,1067.45 628.822,761.065 631.173,1028.94 633.523,874.748 635.874,883.594 638.224,953.829 640.575,722.818 642.925,869.003 645.275,905.059 647.626,1012.51 649.976,748.521 652.327,776.484 654.677,920.062 657.028,865.134 659.378,951.533 661.729,799.473 664.079,978.884 666.43,931.717 668.78,1038.19 671.131,954.673 673.481,926.67 675.832,906.651 678.182,907.499 680.533,827.49 682.883,751.73 685.233,995.476 687.584,950.914 689.934,785.401 692.285,879.992 694.635,1076.33 696.986,968.316 699.336,922.294 701.687,973.417 704.037,1064.1 706.388,930.006 708.738,1058.78 711.089,1050.07 713.439,1072.8 715.79,920.25 718.14,839.986 720.491,984.087 722.841,970.243 725.192,816.454 727.542,930.664 729.892,939.752 732.243,840.576 734.593,960.242 736.944,896.9 739.294,832.29 741.645,780.388 743.995,913.672 746.346,951.884 748.696,956.29 751.047,1012.16 753.397,1017.93 755.748,924.728 758.098,979.754 760.449,1026.66 762.799,887.307 765.15,1060.69 767.5,864.889 769.85,879.858 772.201,864.023 774.551,906.379 776.902,1006.51 779.252,923.822 781.603,870.349 783.953,929.612 786.304,920.527 788.654,1049.59 791.005,959.131 793.355,907.81 795.706,961.412 798.056,909.215 800.407,1013.15 802.757,938.263 805.108,732.765 807.458,1245.3 809.809,990.919 812.159,853.739 814.509,834.504 816.86,976.23 819.21,864.279 821.561,1058.2 823.911,958.833 826.262,924.815 828.612,753.766 830.963,860.577 833.313,1123.42 835.664,1130.04 838.014,836.529 840.365,974.962 842.715,868.295 845.066,805.295 847.416,965.323 849.767,990.631 852.117,880.02 854.467,1005.45 856.818,1029.46 859.168,827.708 861.519,858.181 863.869,763.832 866.22,924.846 868.57,1079.98 870.921,894.403 873.271,972.111 875.622,970.109 877.972,888.143 880.323,911.558 882.673,796.879 885.024,1043.2 887.374,809.661 889.725,1132.47 892.075,848.703 894.426,1000.79 896.776,1037.18 899.126,904.185 901.477,1072.35 903.827,954.851 906.178,979.533 908.528,907.431 910.879,973.747 913.229,919.446 915.58,962.383 917.93,962.7 920.281,981.275 922.631,1104.79 924.982,917.845 927.332,881.869 929.683,955.617 932.033,1057.12 934.384,842.368 936.734,881.07 939.084,886.849 941.435,860.72 943.785,921.395 946.136,982.077 948.486,772.37 950.837,779.527 953.187,708.658 955.538,861.794 957.888,838.549 960.239,854.584 962.589,1113.94 964.94,1193.98 967.29,992.062 969.641,950.331 971.991,944.827 974.342,885.068 976.692,771.43 979.043,1010.81 981.393,876.981 983.743,894.093 986.094,1014.31 988.444,1086.23 990.795,1048.39 993.145,808.052 995.496,783.764 997.846,752.385 1000.2,922.211 1002.55,896.684 1004.9,1015.74 1007.25,1080.12 1009.6,891.39 1011.95,785.699 1014.3,1051.42 1016.65,1003.45 1019,991.299 1021.35,1098.93 1023.7,954.673 1026.05,862.597 1028.4,1006.72 1030.75,861.772 1033.1,1037.46 1035.45,892.846 1037.8,869.797 1040.15,1160.26 1042.51,1021.73 1044.86,1097.61 1047.21,874.293 1049.56,717.783 1051.91,834.019 1054.26,1088.14 1056.61,826.59 1058.96,1030.27 1061.31,1102.41 1063.66,935.521 1066.01,1121.63 1068.36,806.214 1070.71,1005.21 1073.06,874.141 1075.41,950.963 1077.76,1051.25 1080.11,872.608 1082.46,869.348 1084.81,1054.27 1087.16,794.17 1089.51,1027.75 1091.87,673.301 1094.22,1055.6 1096.57,930.201 1098.92,988.343 1101.27,881.657 1103.62,1025.4 1105.97,935.09 1108.32,851.125 1110.67,928.303 1113.02,874.211 1115.37,955.151 1117.72,956.37 1120.07,810.519 1122.42,935.811 1124.77,1153.48 1127.12,871.831 1129.47,936.777 1131.82,787.73 1134.17,930.225 1136.52,761.95 1138.87,949.225 1141.23,889.568 1143.58,1036.56 1145.93,975.293 1148.28,1026.14 1150.63,1026.72 1152.98,1024.18 1155.33,906.395 1157.68,900.917 1160.03,807.347 1162.38,808.977 1164.73,978.006 1167.08,921.485 1169.43,809.003 1171.78,1061.44 1174.13,985.909 1176.48,893.048 1178.83,994.863 1181.18,830.54 1183.53,852.756 1185.88,773.088 1188.23,857.049 1190.59,985.886 1192.94,950.203 1195.29,1024.74 1197.64,978.518 1199.99,1155.08 1202.34,889.956 1204.69,1058.07 1207.04,975.408 1209.39,917.426 1211.74,942.379 1214.09,971.154 1216.44,857.762 1218.79,661.656 1221.14,829.572 1223.49,888.72 1225.84,803.172 1228.19,702.894 1230.54,866.709 1232.89,858.501 1235.24,1040.16 1237.59,930.46 1239.94,1011.32 1242.3,961.927 1244.65,1041.96 1247,947.569 1249.35,1005.98 1251.7,1096.18 1254.05,983.336 1256.4,999.492 1258.75,881.271 1261.1,894.201 1263.45,976.032 1265.8,701.056 1268.15,910.051 1270.5,932.446 1272.85,955.403 1275.2,974.812 1277.55,885.949 1279.9,840.28 1282.25,929.634 1284.6,901.464 1286.95,955.671 1289.3,853.235 1291.66,895.346 1294.01,952.039 1296.36,788.267 1298.71,878.774 1301.06,899.087 1303.41,905.28 1305.76,935.513 1308.11,799.964 1310.46,839.16 1312.81,913.459 1315.16,1038.09 1317.51,956.118 1319.86,901.393 1322.21,1068.2 1324.56,964.551 1326.91,974.867 1329.26,974.296 1331.61,940.335 1333.96,1144.36 1336.31,842.752 1338.66,1022.05 1341.02,935.339 1343.37,1079.86 1345.72,985.575 1348.07,966.152 1350.42,1075.27 1352.77,962.225 1355.12,961.543 1357.47,837.151 1359.82,956.373 1362.17,900.9 1364.52,848.247 1366.87,1030.57 1369.22,968.987 1371.57,998.723 1373.92,1052.43 1376.27,1032.2 1378.62,807.577 1380.97,989.98 1383.32,833.659 1385.67,934.913 1388.02,875.489 1390.38,1021 1392.73,1077.8 1395.08,1049.2 1397.43,1019.23 1399.78,858.988 1402.13,955.51 1404.48,930.833 1406.83,1011.18 1409.18,742.835 1411.53,993.046 1413.88,830.298 1416.23,918.398 1418.58,761.5 1420.93,688.655 1423.28,782.325 1425.63,1001.58 1427.98,779.933 1430.33,903.289 1432.68,955.809 1435.03,829.346 1437.38,921.853 1439.74,1224.87 1442.09,809.999 1444.44,1073.95 1446.79,810.755 1449.14,878.928 1451.49,999.816 1453.84,967.774 1456.19,805.764 1458.54,1095.72 1460.89,953.922 1463.24,688.309 1465.59,823.95 1467.94,827.794 1470.29,894.045 1472.64,972.316 1474.99,857.1 1477.34,799.26 1479.69,953.182 1482.04,877 1484.39,857.502 1486.74,1113.09 1489.1,1131.54 1491.45,906.708 1493.8,732.994 1496.15,1133.56 1498.5,893.828 1500.85,916.585 1503.2,1151.94 1505.55,946.39 1507.9,987.119 1510.25,1094.22 1512.6,1053.02 1514.95,864.663 1517.3,836.307 1519.65,972.348 1522,1035.85 1524.35,936.831 1526.7,857.447 1529.05,865.765 1531.4,924.02 1533.75,905.602 1536.1,810.496 1538.45,931.508 1540.81,1060.23 1543.16,923.379 1545.51,883.09 1547.86,951.156 1550.21,978.124 1552.56,1004.38 1554.91,883.684 1557.26,1042.7 1559.61,951.682 1561.96,1008.35 1564.31,819.213 1566.66,845.598 1569.01,1018.94 1571.36,1021.22 1573.71,1082.92 1576.06,914.054 1578.41,851.916 1580.76,833.166 1583.11,926.23 1585.46,903.291 1587.81,966.683 1590.17,757.907 1592.52,875.809 1594.87,946.121 1597.22,1035.76 1599.57,1028.52 1601.92,760.81 1604.27,900.877 1606.62,785.723 1608.97,919.24 1611.32,1069.12 1613.67,1021.72 1616.02,752.096 1618.37,953.625 1620.72,1021.04 1623.07,1068.31 1625.42,1063.72 1627.77,889.778 1630.12,884.715 1632.47,982.992 1634.82,770.331 1637.17,858.857 1639.53,1110.18 1641.88,862.748 1644.23,1070.93 1646.58,885.137 1648.93,1007.79 1651.28,853.025 1653.63,975.183 1655.98,918.753 1658.33,968.651 1660.68,945.101 1663.03,982.486 1665.38,910.049 1667.73,887.668 1670.08,896.846 1672.43,883.742 1674.78,934.781 1677.13,1030.26 1679.48,944.451 1681.83,1087.5 1684.18,963.662 1686.53,1129.09 1688.89,1066.31 1691.24,1062.58 1693.59,1008.56 1695.94,1189.59 1698.29,1057.76 1700.64,1126.62 1702.99,1063.24 1705.34,851.494 1707.69,914.652 1710.04,832.606 1712.39,1019.07 1714.74,1103.13 1717.09,1048.47 1719.44,909.967 1721.79,1017.65 1724.14,937.669 1726.49,946.936 1728.84,904.931 1731.19,1046.54 1733.54,1041 1735.89,1035.73 1738.25,845.891 1740.6,873.292 1742.95,843.1 1745.3,1043.01 1747.65,914.074 1750,1191.12 1752.35,879.742 1754.7,1020.82 1757.05,1084.73 1759.4,860.922 1761.75,1016.89 1764.1,969.475 1766.45,1017.26 1768.8,988.539 1771.15,915.998 1773.5,965.824 1775.85,902.315 1778.2,918.644 1780.55,1035.65 1782.9,837.548 1785.25,891.147 1787.6,1058.58 1789.96,1092.62 1792.31,916.453 1794.66,1155.4 1797.01,852.225 1799.36,896.154 1801.71,823.897 1804.06,1062.69 1806.41,958.319 1808.76,1018.93 1811.11,1015.4 1813.46,998.408 1815.81,949.72 1818.16,923.774 1820.51,921.286 1822.86,1069.85 1825.21,817.994 1827.56,719.978 1829.91,773.798 1832.26,1028.99 1834.61,975.314 1836.96,942.17 1839.32,1092.54 1841.67,1097.87 1844.02,959.722 1846.37,955.363 1848.72,960.813 1851.07,855.953 1853.42,943.616 1855.77,1035.02 1858.12,1033.69 1860.47,767.472 1862.82,980 1865.17,940.308 1867.52,1171.67 1869.87,954.664 1872.22,1031.82 1874.57,978.532 1876.92,1068.96 1879.27,969.605 1881.62,962.166 1883.97,995.331 1886.32,1082.59 1888.68,991.817 1891.03,994.636 1893.38,886.348 1895.73,940.77 1898.08,753.989 1900.43,961.44 1902.78,970.733 1905.13,891.947 1907.48,1002.2 1909.83,986.565 1912.18,803.857 1914.53,919.387 1916.88,991.759 1919.23,916.648 1921.58,968.697 1923.93,1008.79 1926.28,1131.11 1928.63,849.579 1930.98,921.944 1933.33,933.297 1935.68,902.386 1938.04,826.52 1940.39,925.421 1942.74,906.749 1945.09,956.106 1947.44,799.99 1949.79,869.233 1952.14,997.467 1954.49,928.24 1956.84,1056.14 1959.19,981.106 1961.54,995.776 1963.89,988.139 1966.24,953.289 1968.59,871.586 1970.94,999.298 1973.29,1019.22 1975.64,612.629 1977.99,943.544 1980.34,811.759 1982.69,946.545 1985.04,924.054 1987.4,921.254 1989.75,988.792 1992.1,933.957 1994.45,1030.55 1996.8,853.234 1999.15,1067.74 2001.5,873.644 2003.85,934.507 2006.2,1055.6 2008.55,919.541 2010.9,949.614 2013.25,959.278 2015.6,924.085 2017.95,812.543 2020.3,934.318 2022.65,1149.31 2025,1070.99 2027.35,912.451 2029.7,1021.7 2032.05,881.586 2034.4,827.213 2036.76,1002.1 2039.11,1093.95 2041.46,976.73 2043.81,868.828 2046.16,925.114 2048.51,884.421 2050.86,965.401 2053.21,905.553 2055.56,787.584 2057.91,1011.28 2060.26,938.201 2062.61,891.537 2064.96,890.491 2067.31,832.359 2069.66,938.698 2072.01,973.455 2074.36,843.065 2076.71,864.948 2079.06,913.489 2081.41,1108.26 2083.76,796.055 2086.11,1157.09 2088.47,944.975 2090.82,1072.11 2093.17,827.503 2095.52,1004.91 2097.87,1060.39 2100.22,899.04 2102.57,966.106 2104.92,975.166 2107.27,729.448 2109.62,1105.23 2111.97,991.498 2114.32,943.718 2116.67,966.96 2119.02,1072.93 2121.37,973.255 2123.72,843 2126.07,1047.81 2128.42,815.076 2130.77,884.955 2133.12,1080.05 2135.47,1020.07 2137.83,906.625 2140.18,1090.37 2142.53,1115.59 2144.88,809.572 2147.23,836.896 2149.58,943.674 2151.93,1106.88 2154.28,904.995 2156.63,745.695 2158.98,657.13 2161.33,945.281 2163.68,888.344 2166.03,885.1 2168.38,1064.9 2170.73,932.153 2173.08,1144.72 2175.43,892.795 2177.78,692.505 2180.13,975.904 2182.48,943.786 2184.83,900.996 2187.19,992.775 2189.54,913.37 2191.89,827.017 2194.24,1002.49 2196.59,935.126 2198.94,782.892 2201.29,935.185 2203.64,981.858 2205.99,861.854 2208.34,935.099 2210.69,890.409 2213.04,1050.6 2215.39,908.67 2217.74,797.753 2220.09,904.528 2222.44,1035.15 2224.79,763.34 2227.14,782.375 2229.49,796.412 2231.84,1139.51 2234.19,914.295 2236.55,1052.07 2238.9,863.695 2241.25,1079.21 2243.6,933.985 2245.95,793.497 2248.3,1103.31 2250.65,995.543 2253,993.435 2255.35,1105.01 2257.7,999.026 2260.05,826.515 2262.4,916.456 2264.75,894.134 2267.1,829.107 2269.45,910.666 2271.8,912.846 2274.15,945.811 2276.5,954.734 2278.85,1013.43 2281.2,1068.62 2283.55,826.987 2285.91,954.069 2288.26,1003.2 2290.61,1092.47 2292.96,950.014 2295.31,1181.5 2297.66,770.645 2300.01,938.71 2302.36,980.221 2304.71,883.418 2307.06,918.865 2309.41,928.669 2311.76,836.641 2314.11,996.202 2316.46,1071.83 2318.81,915.815 2321.16,862.291 2323.51,910.987 2325.86,970.655 2328.21,867.827 2330.56,847.252 2332.91,826.758 2335.27,820.436 2337.62,910.378 2339.97,1161.73 2342.32,1027.53 2344.67,922.507 2347.02,799.202 2349.37,1125.46 2351.72,768.311 2354.07,1061 2356.42,1161.23 2358.77,1010.2 2361.12,959.343 2363.47,948.409 2365.82,976.698 2368.17,719.518 2370.52,1046.61 2372.87,895.769 2375.22,907.313 2377.57,873.121 2379.92,932.469 2382.27,911.882 2384.62,838.135 2386.98,963.007 2389.33,951.253 2391.68,943.295 2394.03,858.524 2396.38,777.434 2398.73,918.068 2401.08,1093.46 2403.43,912.444 2405.78,1023.25 2408.13,911.819 2410.48,1111.38 2412.83,841.563 2415.18,977.217 2417.53,848.092 2419.88,958.803 2422.23,846.279 2424.58,866.398 2426.93,843.203 2429.28,955.876 2431.63,862.675 2433.98,777.841 2436.34,994.971 2438.69,858.898 2441.04,891.573 2443.39,860.408 2445.74,967.329 2448.09,1192.86 2450.44,1107.67 2452.79,814.125 2455.14,983.411 2457.49,677.034 2459.84,769.428 2462.19,1156.39 2464.54,899.491 2466.89,833.405 2469.24,947.733 2471.59,1039.54 2473.94,925.5 2476.29,917.118 2478.64,977.979 2480.99,907.373 2483.34,866.683 2485.7,967.066 2488.05,758.643 2490.4,951.462 2492.75,902.443 2495.1,1015.96 2497.45,915.259 2499.8,934.563 2502.15,962.805 2504.5,1008.05 2506.85,959.914 2509.2,929.186 2511.55,889.594 2513.9,802.357 2516.25,932.182 2518.6,868.121 2520.95,1017.66 2523.3,951.046 2525.65,799.01 2528,659.233 2530.35,923.092 2532.7,1006.08 2535.06,1027.09 2537.41,994.243 2539.76,1058.01 2542.11,873.407 2544.46,957.834 2546.81,879.718 2549.16,968.476 2551.51,891.916 2553.86,889.95 2556.21,1018.77 2558.56,857.601 2560.91,1054.32 2563.26,905.802 2565.61,1054.3 2567.96,895.653 2570.31,907.414 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,651.431 224.541,346.945 226.891,221.411 229.242,320.907 231.592,443.363 233.943,567.786 236.293,558.634 238.644,371.558 240.994,391.755 243.345,475.768 245.695,395.489 248.046,384.519 250.396,369.384 252.747,184.798 255.097,436.378 257.448,331.384 259.798,679.239 262.148,414.957 264.499,361.259 266.849,449.39 269.2,369.69 271.55,498.922 273.901,312.081 276.251,351.601 278.602,423.456 280.952,372.055 283.303,260.065 285.653,496.066 288.004,390.245 290.354,423.56 292.705,510.114 295.055,234.485 297.406,374.307 299.756,514.267 302.107,376.425 304.457,426.736 306.807,503.328 309.158,420.79 311.508,467.625 313.859,437.422 316.209,415.534 318.56,404.499 320.91,346.863 323.261,457.065 325.611,307.502 327.962,440.129 330.312,306.204 332.663,267.577 335.013,400.422 337.364,499.951 339.714,430.495 342.065,579.223 344.415,443.006 346.765,267.08 349.116,607.312 351.466,398.805 353.817,445.295 356.167,432.592 358.518,473.259 360.868,450.84 363.219,493.818 365.569,605.835 367.92,429.783 370.27,338.389 372.621,289.012 374.971,393.188 377.322,581.671 379.672,388.73 382.023,363.039 384.373,446.225 386.724,222.703 389.074,455.299 391.424,196.963 393.775,355.803 396.125,364.402 398.476,374.557 400.826,369.865 403.177,447.217 405.527,369.552 407.878,356.557 410.228,425.364 412.579,352.234 414.929,289.382 417.28,420.595 419.63,571.894 421.981,381.845 424.331,444.607 426.682,395.5 429.032,311.787 431.382,303.651 433.733,420.841 436.083,364.46 438.434,380.192 440.784,296.099 443.135,346.675 445.485,327.496 447.836,362.448 450.186,454.935 452.537,474.421 454.887,241.061 457.238,268.675 459.588,300.919 461.939,411.595 464.289,461.375 466.64,347.978 468.99,214.412 471.341,447.956 473.691,532.14 476.041,397.146 478.392,673.281 480.742,387.506 483.093,608.58 485.443,427.759 487.794,453.382 490.144,254.87 492.495,346.705 494.845,454.172 497.196,583.962 499.546,461.725 501.897,454.636 504.247,272.965 506.598,358.191 508.948,508.649 511.299,261.585 513.649,453.429 515.999,412.942 518.35,679.497 520.7,423.725 523.051,367.417 525.401,350.611 527.752,409.415 530.102,517.125 532.453,403.167 534.803,603.945 537.154,480.809 539.504,481.189 541.855,489.377 544.205,350.293 546.556,483.541 548.906,413.504 551.257,393.284 553.607,235.147 555.958,329.484 558.308,353.037 560.658,185.228 563.009,600.046 565.359,433.432 567.71,437.172 570.06,579.13 572.411,204.967 574.761,464.608 577.112,459.523 579.462,453.136 581.813,470.343 584.163,384.014 586.514,420.407 588.864,332.016 591.215,513.535 593.565,251.359 595.916,458.567 598.266,530.394 600.616,285.154 602.967,330.638 605.317,415.903 607.668,347.202 610.018,454.743 612.369,515.977 614.719,439.096 617.07,362.21 619.42,634.679 621.771,581.903 624.121,476.974 626.472,481.488 628.822,624.175 631.173,444.449 633.523,441.901 635.874,483.54 638.224,353.306 640.575,376.707 642.925,546.002 645.275,471.254 647.626,584.287 649.976,678.569 652.327,381.422 654.677,320.774 657.028,407.846 659.378,321.028 661.729,285.849 664.079,306.606 666.43,267.789 668.78,249.645 671.131,438.938 673.481,505.106 675.832,548.059 678.182,295.463 680.533,379.498 682.883,416.542 685.233,449.427 687.584,353.419 689.934,565.76 692.285,356.524 694.635,433.309 696.986,309.296 699.336,297.867 701.687,517.025 704.037,553.527 706.388,474.225 708.738,333.233 711.089,523.572 713.439,507.229 715.79,298.682 718.14,508.726 720.491,408.842 722.841,458.267 725.192,279.048 727.542,386.92 729.892,399.733 732.243,606.499 734.593,457.301 736.944,382.116 739.294,338.817 741.645,440.483 743.995,308.421 746.346,509.555 748.696,311.959 751.047,490.722 753.397,507.488 755.748,558.699 758.098,566.771 760.449,214.95 762.799,427.453 765.15,289.328 767.5,486.134 769.85,495.9 772.201,550.992 774.551,423.149 776.902,411.845 779.252,468.155 781.603,483.323 783.953,529.837 786.304,335.92 788.654,348.629 791.005,594.098 793.355,422.481 795.706,247.354 798.056,435.191 800.407,406.221 802.757,419.668 805.108,340.001 807.458,329.544 809.809,264.39 812.159,347.678 814.509,356.049 816.86,247.213 819.21,576.121 821.561,464.432 823.911,510.07 826.262,453.741 828.612,667.139 830.963,324.064 833.313,376.481 835.664,316.626 838.014,451.549 840.365,598.207 842.715,531.411 845.066,222.269 847.416,329.685 849.767,299.018 852.117,527.176 854.467,632.471 856.818,262.088 859.168,362.078 861.519,191.462 863.869,386.874 866.22,250.607 868.57,290.1 870.921,431.765 873.271,605.267 875.622,385.487 877.972,629.551 880.323,290.239 882.673,435.813 885.024,285.269 887.374,383.341 889.725,442.893 892.075,456.36 894.426,402.222 896.776,592.232 899.126,409.935 901.477,604.365 903.827,449.041 906.178,437.724 908.528,378.163 910.879,605.402 913.229,398.95 915.58,330.43 917.93,671.946 920.281,539.316 922.631,491.093 924.982,220.107 927.332,379.092 929.683,401.348 932.033,322.549 934.384,362.846 936.734,258.815 939.084,611.203 941.435,495.061 943.785,304.017 946.136,232.291 948.486,428.925 950.837,480.421 953.187,597.49 955.538,283.242 957.888,271.01 960.239,338.44 962.589,280.493 964.94,448.772 967.29,388.668 969.641,338.492 971.991,337.089 974.342,485.428 976.692,441.957 979.043,302.616 981.393,466.196 983.743,638.578 986.094,343.765 988.444,388.036 990.795,664.868 993.145,459.346 995.496,470.493 997.846,281.591 1000.2,426.658 1002.55,486.8 1004.9,270.605 1007.25,344.211 1009.6,339.089 1011.95,485.033 1014.3,370.809 1016.65,329.275 1019,292.109 1021.35,666.921 1023.7,304.047 1026.05,289.997 1028.4,623.417 1030.75,392.691 1033.1,487.105 1035.45,386.093 1037.8,449.807 1040.15,403.715 1042.51,532.452 1044.86,523.954 1047.21,381.391 1049.56,453.029 1051.91,341.299 1054.26,341.966 1056.61,591.065 1058.96,448.83 1061.31,344.565 1063.66,435.965 1066.01,389.096 1068.36,505.837 1070.71,373.285 1073.06,438.096 1075.41,423.237 1077.76,488.435 1080.11,419.434 1082.46,495.443 1084.81,233.307 1087.16,423.369 1089.51,368.722 1091.87,517.843 1094.22,562.83 1096.57,460.562 1098.92,352.597 1101.27,533.699 1103.62,387.602 1105.97,402.791 1108.32,504.253 1110.67,411.431 1113.02,595.798 1115.37,662.826 1117.72,268.695 1120.07,427.143 1122.42,395.613 1124.77,481.053 1127.12,272.795 1129.47,413.433 1131.82,405.654 1134.17,326.705 1136.52,452.201 1138.87,431.785 1141.23,410.08 1143.58,429.171 1145.93,230.127 1148.28,443.055 1150.63,341.063 1152.98,273.627 1155.33,464.157 1157.68,345.488 1160.03,502.065 1162.38,325.353 1164.73,491.343 1167.08,300.326 1169.43,422.114 1171.78,596.519 1174.13,416.59 1176.48,316.914 1178.83,367.413 1181.18,552.974 1183.53,334.532 1185.88,529.658 1188.23,613.329 1190.59,338.123 1192.94,223.278 1195.29,349.594 1197.64,405.885 1199.99,367.472 1202.34,401.479 1204.69,359.789 1207.04,256.212 1209.39,370.75 1211.74,369.664 1214.09,429.57 1216.44,315.732 1218.79,408.992 1221.14,315.034 1223.49,323.913 1225.84,540.557 1228.19,629.817 1230.54,225.026 1232.89,298.48 1235.24,198.262 1237.59,392.447 1239.94,583.524 1242.3,475.423 1244.65,400.353 1247,282.552 1249.35,489.957 1251.7,340.313 1254.05,247.909 1256.4,356.42 1258.75,412.407 1261.1,366.964 1263.45,388.659 1265.8,541.17 1268.15,429.706 1270.5,406.351 1272.85,227.426 1275.2,428.293 1277.55,523.869 1279.9,205.242 1282.25,410.683 1284.6,455.503 1286.95,247.281 1289.3,319.824 1291.66,287.774 1294.01,486.541 1296.36,214.365 1298.71,309.851 1301.06,548.581 1303.41,524.263 1305.76,265.363 1308.11,513.223 1310.46,203.934 1312.81,241.005 1315.16,356.897 1317.51,467.6 1319.86,364.778 1322.21,461.925 1324.56,364.761 1326.91,539.321 1329.26,452.174 1331.61,96.8724 1333.96,465.868 1336.31,311.233 1338.66,411.97 1341.02,290.178 1343.37,464.916 1345.72,286.764 1348.07,586.866 1350.42,422.105 1352.77,262.86 1355.12,211.297 1357.47,377.103 1359.82,512.293 1362.17,406.636 1364.52,467.227 1366.87,357.198 1369.22,272.646 1371.57,323.062 1373.92,320.027 1376.27,446.688 1378.62,568.13 1380.97,343.984 1383.32,431.692 1385.67,422.892 1388.02,512.264 1390.38,545.535 1392.73,621.445 1395.08,396.078 1397.43,418.356 1399.78,296.511 1402.13,480.218 1404.48,404.847 1406.83,378.429 1409.18,261.319 1411.53,385.984 1413.88,529.868 1416.23,192.508 1418.58,341.027 1420.93,461.739 1423.28,258.759 1425.63,470.485 1427.98,621.609 1430.33,406.677 1432.68,264.222 1435.03,383.517 1437.38,349.347 1439.74,332.256 1442.09,514.879 1444.44,371.875 1446.79,344.387 1449.14,270.478 1451.49,153.854 1453.84,450.539 1456.19,289.152 1458.54,339.581 1460.89,486.667 1463.24,371.474 1465.59,282.49 1467.94,572.057 1470.29,439.841 1472.64,465.408 1474.99,460.886 1477.34,444.036 1479.69,543.247 1482.04,302.295 1484.39,330.856 1486.74,384.624 1489.1,528.741 1491.45,383.927 1493.8,551.5 1496.15,368.006 1498.5,396.085 1500.85,422.088 1503.2,350.69 1505.55,428.71 1507.9,669.146 1510.25,391.418 1512.6,461.876 1514.95,405.743 1517.3,577.725 1519.65,435.331 1522,570.667 1524.35,232.078 1526.7,487.233 1529.05,254.092 1531.4,555.034 1533.75,571.433 1536.1,435.352 1538.45,477.231 1540.81,464.784 1543.16,570.789 1545.51,501.838 1547.86,337.939 1550.21,491.274 1552.56,361.163 1554.91,185.957 1557.26,390.424 1559.61,385.406 1561.96,317.769 1564.31,196.206 1566.66,333.105 1569.01,295.493 1571.36,435.749 1573.71,295.852 1576.06,578.935 1578.41,379.586 1580.76,235.566 1583.11,477.645 1585.46,458.915 1587.81,522.193 1590.17,446.689 1592.52,364.06 1594.87,597.542 1597.22,439.015 1599.57,368.743 1601.92,496.216 1604.27,495.521 1606.62,526.386 1608.97,573.901 1611.32,308.014 1613.67,451.73 1616.02,570.375 1618.37,421.02 1620.72,318.105 1623.07,358.712 1625.42,516.127 1627.77,498.779 1630.12,256.145 1632.47,118.379 1634.82,543.202 1637.17,306.427 1639.53,510.197 1641.88,471.907 1644.23,377.757 1646.58,320.002 1648.93,466.048 1651.28,386.175 1653.63,377.624 1655.98,248.572 1658.33,252.593 1660.68,525.308 1663.03,447.945 1665.38,397.069 1667.73,552.07 1670.08,410.532 1672.43,451.045 1674.78,281.544 1677.13,341.983 1679.48,500.189 1681.83,463.382 1684.18,480.012 1686.53,287.954 1688.89,474.946 1691.24,402.532 1693.59,474.814 1695.94,448.834 1698.29,418.489 1700.64,404.795 1702.99,463.843 1705.34,370.565 1707.69,370.675 1710.04,471.433 1712.39,439.893 1714.74,323.898 1717.09,356.16 1719.44,365.328 1721.79,231.354 1724.14,422.111 1726.49,348.491 1728.84,414.92 1731.19,329.213 1733.54,378.678 1735.89,538.005 1738.25,319.34 1740.6,512.622 1742.95,459.481 1745.3,372.984 1747.65,368.272 1750,661.167 1752.35,522.05 1754.7,380.577 1757.05,346.246 1759.4,470.513 1761.75,390.297 1764.1,419.561 1766.45,451.081 1768.8,438.22 1771.15,477.043 1773.5,498.794 1775.85,308.192 1778.2,156.32 1780.55,406.074 1782.9,488.204 1785.25,412.667 1787.6,240.889 1789.96,275.947 1792.31,530.951 1794.66,455.842 1797.01,359.573 1799.36,439.599 1801.71,377.167 1804.06,494.174 1806.41,382.285 1808.76,423.487 1811.11,617.512 1813.46,530.169 1815.81,451.326 1818.16,349.309 1820.51,180.788 1822.86,423.27 1825.21,484.106 1827.56,628.367 1829.91,354.504 1832.26,404.223 1834.61,447.888 1836.96,493.968 1839.32,426.8 1841.67,524.243 1844.02,395.523 1846.37,486.443 1848.72,467.596 1851.07,384.601 1853.42,387.364 1855.77,616.118 1858.12,306.271 1860.47,413.582 1862.82,458.113 1865.17,499.944 1867.52,244.208 1869.87,492.165 1872.22,391.81 1874.57,611.328 1876.92,502.913 1879.27,158.445 1881.62,386.283 1883.97,581.757 1886.32,544.919 1888.68,619.686 1891.03,415.261 1893.38,586.47 1895.73,448.004 1898.08,543.462 1900.43,382.92 1902.78,539.439 1905.13,427.707 1907.48,412.959 1909.83,416.475 1912.18,366.297 1914.53,519.191 1916.88,417.14 1919.23,578.067 1921.58,660.04 1923.93,630.754 1926.28,502.56 1928.63,391.111 1930.98,452.389 1933.33,240.478 1935.68,332.325 1938.04,425.719 1940.39,319.479 1942.74,301.377 1945.09,380.012 1947.44,344.466 1949.79,371.758 1952.14,516.153 1954.49,523.714 1956.84,453.938 1959.19,370.119 1961.54,366.408 1963.89,450.409 1966.24,398.538 1968.59,387.052 1970.94,517.432 1973.29,383.424 1975.64,466.512 1977.99,410.779 1980.34,532.967 1982.69,555.691 1985.04,401.049 1987.4,470.187 1989.75,460.923 1992.1,354.577 1994.45,360.453 1996.8,492.83 1999.15,433.038 2001.5,399.5 2003.85,438.851 2006.2,197.293 2008.55,495.537 2010.9,439.638 2013.25,421.402 2015.6,438.989 2017.95,519.323 2020.3,402.907 2022.65,385.352 2025,336.579 2027.35,364.77 2029.7,410.53 2032.05,276.642 2034.4,472.408 2036.76,326.918 2039.11,399.963 2041.46,593.667 2043.81,583.941 2046.16,544.107 2048.51,399.693 2050.86,510.182 2053.21,305.287 2055.56,340.367 2057.91,510.103 2060.26,482.726 2062.61,316.826 2064.96,480.404 2067.31,596.695 2069.66,380.396 2072.01,588.525 2074.36,506.104 2076.71,344.809 2079.06,594.052 2081.41,664.203 2083.76,407.468 2086.11,369.24 2088.47,258.834 2090.82,349.827 2093.17,557.14 2095.52,524.364 2097.87,440.466 2100.22,444.967 2102.57,493.4 2104.92,560.235 2107.27,325.137 2109.62,398.228 2111.97,522.357 2114.32,402.08 2116.67,300.931 2119.02,313.912 2121.37,546.311 2123.72,313.588 2126.07,433.863 2128.42,576.88 2130.77,432.021 2133.12,372.908 2135.47,485.916 2137.83,425.733 2140.18,347.395 2142.53,299.048 2144.88,532.289 2147.23,493.608 2149.58,425.192 2151.93,199.895 2154.28,214.152 2156.63,334.94 2158.98,587.268 2161.33,447.565 2163.68,438.747 2166.03,479.874 2168.38,333.261 2170.73,413.326 2173.08,353.575 2175.43,608.028 2177.78,446.538 2180.13,314.485 2182.48,384.704 2184.83,449.712 2187.19,395.978 2189.54,470.445 2191.89,329.86 2194.24,556.857 2196.59,215.201 2198.94,467.062 2201.29,453.406 2203.64,356.873 2205.99,465.229 2208.34,435.906 2210.69,383.771 2213.04,581.911 2215.39,490.26 2217.74,348.727 2220.09,593.672 2222.44,519.477 2224.79,278.862 2227.14,402.62 2229.49,499.05 2231.84,401.848 2234.19,422.597 2236.55,238.868 2238.9,315.06 2241.25,310.57 2243.6,541.585 2245.95,373.017 2248.3,343.535 2250.65,603.851 2253,379.112 2255.35,273.072 2257.7,654.283 2260.05,615.805 2262.4,288.084 2264.75,327.716 2267.1,373.606 2269.45,536.979 2271.8,489.68 2274.15,489.325 2276.5,497.984 2278.85,467.708 2281.2,375.564 2283.55,674.072 2285.91,385.446 2288.26,353.514 2290.61,352.98 2292.96,489.499 2295.31,446.635 2297.66,433.421 2300.01,426.026 2302.36,412.469 2304.71,439.769 2307.06,466.558 2309.41,519.155 2311.76,380.995 2314.11,347.637 2316.46,316.249 2318.81,396.744 2321.16,412.454 2323.51,464.058 2325.86,411.833 2328.21,253.235 2330.56,463.61 2332.91,277.2 2335.27,418.258 2337.62,509.808 2339.97,300.101 2342.32,524.276 2344.67,341.756 2347.02,388.858 2349.37,481.703 2351.72,350.538 2354.07,459.343 2356.42,405.884 2358.77,388.94 2361.12,455.725 2363.47,461.364 2365.82,371.697 2368.17,362.114 2370.52,469.882 2372.87,479.876 2375.22,311.785 2377.57,582.879 2379.92,293.115 2382.27,505.405 2384.62,517.103 2386.98,334.316 2389.33,278.024 2391.68,262.163 2394.03,456.643 2396.38,399.635 2398.73,185.036 2401.08,626.208 2403.43,560.794 2405.78,323.284 2408.13,369.375 2410.48,329.736 2412.83,562.359 2415.18,363.426 2417.53,350.77 2419.88,421.384 2422.23,452.258 2424.58,428.182 2426.93,564.65 2429.28,431.748 2431.63,509.217 2433.98,298.284 2436.34,650.076 2438.69,277.337 2441.04,424.407 2443.39,435.285 2445.74,199.837 2448.09,535.319 2450.44,454.635 2452.79,383.538 2455.14,616.036 2457.49,473.016 2459.84,497.99 2462.19,401.03 2464.54,500.178 2466.89,281.907 2469.24,504.806 2471.59,387.868 2473.94,469.848 2476.29,506.631 2478.64,321.867 2480.99,539.028 2483.34,350.794 2485.7,369.236 2488.05,584.305 2490.4,458.045 2492.75,368.983 2495.1,297.265 2497.45,474.042 2499.8,305.047 2502.15,463.146 2504.5,538.519 2506.85,423 2509.2,331.92 2511.55,344.759 2513.9,416.026 2516.25,373.601 2518.6,470.486 2520.95,381.093 2523.3,506.839 2525.65,302.519 2528,505.741 2530.35,246.186 2532.7,451.824 2535.06,424.043 2537.41,380.994 2539.76,207.801 2542.11,482.944 2544.46,298.576 2546.81,200.927 2549.16,435.958 2551.51,323.605 2553.86,449.298 2556.21,527.642 2558.56,224.164 2560.91,499.892 2563.26,194.664 2565.61,354.556 2567.96,542.235 2570.31,421.079 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.86518  -3.72061  -3.72061  -4.47968    …  -4.21932  -3.70718   -3.70718
 -2.16487  -1.17205  -1.17205   0.0574523      1.83727  -0.196057  -0.196057
  3.72009   5.61753   5.61753   4.98323        4.55436   4.97069    4.97069

[:, :, 2] =
 -4.83438    -3.78071   -4.5716    …  -6.82839   -5.82489   -5.92399
 -0.0158312  -0.778509  -0.916663     -0.762554  -0.726218  -0.803761
  0.651076    1.90979    1.73053       5.25826    6.05194    5.79828

[:, :, 3] =
 -3.32856   -4.39778  -4.64603  -4.83642   …  -6.11261   -6.82357   -6.102
 -0.722886  -1.13342  -2.50737  -0.459986      0.514326   0.602996   0.426851
  1.9373     3.17228   4.13603   3.15361       4.07923    4.31798    4.03083

[:, :, 4] =
  0.277266  -2.71446   -3.9552     …  -6.21965    -6.21965    -4.94754
 -0.754267  -0.106117  -0.0828236     -0.0779227  -0.0779227   0.06732
  3.00201    2.79945    3.74626        4.93547     4.93547     4.37977</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.985      1.0059
 -0.0310545  1.00147
  4.9811     1.01204</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.59 seconds
Compute duration  = 2.59 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -4.9735    1.0164    0.0183   3087.6095   5300.7002    1.0011   ⋯
        x[2]    0.0036    0.9972    0.0168   3532.4833   4966.8810    1.0005   ⋯
        x[3]    5.0081    0.9908    0.0173   3287.2754   5334.7786    1.0008   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -6.9443   -5.6612   -4.9681   -4.2810   -2.9794
        x[2]   -1.9462   -0.6629    0.0013    0.6920    1.9739
        x[3]    3.0872    4.3360    4.9998    5.6675    6.9614
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.71 seconds
Compute duration  = 1.71 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.5000    0.1900    0.0029   4319.8791   5832.9009    1.0004   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1486    0.3565    0.5011    0.6404    0.8596
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.5001    0.1553    0.0142    97.1747    39.4266    1.0145     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.2558    0.3671    0.4992    0.6329    0.7515
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.63 seconds
Compute duration  = 2.63 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.1096    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.2052    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1096    0.1096    0.1096    0.1096    0.1096
           x   -0.2052   -0.2052   -0.2052   -0.2052   -0.2052
</pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8855    0.6068    0.0419   153.3800    56.5620    1.0100     ⋯
           x   -0.0116    1.1916    0.0911   304.8058   131.8055    1.0061     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1394    0.4043    0.7368    1.2324    2.4025
           x   -2.3197   -0.5169    0.0070    0.3836    2.6777
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.1674    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.4038    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1674    0.1674    0.1674    0.1674    0.1674
           x    1.4038    1.4038    1.4038    1.4038    1.4038
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>