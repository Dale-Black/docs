<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step. To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> NormalLogDensity{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>NormalLogDensity</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">NormalLogDensity</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-10.532333841264151</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-10.532333841264151</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>NormalLogDensity</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <u>should not go in the sampler itself</u>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>We currently have two things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reprodicibility.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers which wants to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_new.x, state_new</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([-0.9768424053599853, -1.1205507349021362, -0.1586550385144983], MALAState{Vector{Float64}}([-0.9768424053599853, -1.1205507349021362, -0.1586550385144983]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.4857    -1.75451  -3.19357  -3.93667   …  -4.23484   -4.23484   -3.57694
 -0.802177   0.149     1.28227   0.939386     -0.283794  -0.283794   1.35579
  3.60033    4.76541   5.21419   4.11452       4.94747    4.94747    4.53718</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98962    1.04916
 -0.0133832  1.04893
  4.99769    1.04165</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip700">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip700)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip701">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip700)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip702">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip700)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1632.63 2640.76,1632.63 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1379.47 2640.76,1379.47 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1126.31 2640.76,1126.31 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,873.158 2640.76,873.158 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,620.002 2640.76,620.002 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,366.846 2640.76,366.846 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,113.69 2640.76,113.69 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1632.63 215.714,1632.63 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1379.47 215.714,1379.47 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1126.31 215.714,1126.31 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,873.158 215.714,873.158 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,620.002 215.714,620.002 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,366.846 215.714,366.846 "></polyline>
<polyline clip-path="url(#clip700)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,113.69 215.714,113.69 "></polyline>
<path clip-path="url(#clip700)" d="M50.5475 1633.08 L80.2233 1633.08 L80.2233 1637.01 L50.5475 1637.01 L50.5475 1633.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M89.1352 1615.35 L111.357 1615.35 L111.357 1617.34 L98.8111 1649.91 L93.9269 1649.91 L105.732 1619.28 L89.1352 1619.28 L89.1352 1615.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M120.478 1644.03 L125.362 1644.03 L125.362 1649.91 L120.478 1649.91 L120.478 1644.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M135.593 1615.35 L153.95 1615.35 L153.95 1619.28 L139.876 1619.28 L139.876 1627.75 Q140.894 1627.41 141.913 1627.25 Q142.931 1627.06 143.95 1627.06 Q149.737 1627.06 153.116 1630.23 Q156.496 1633.4 156.496 1638.82 Q156.496 1644.4 153.024 1647.5 Q149.552 1650.58 143.232 1650.58 Q141.056 1650.58 138.788 1650.21 Q136.542 1649.84 134.135 1649.1 L134.135 1644.4 Q136.218 1645.53 138.441 1646.09 Q140.663 1646.64 143.14 1646.64 Q147.144 1646.64 149.482 1644.54 Q151.82 1642.43 151.82 1638.82 Q151.82 1635.21 149.482 1633.1 Q147.144 1631 143.14 1631 Q141.265 1631 139.39 1631.41 Q137.538 1631.83 135.593 1632.71 L135.593 1615.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M49.5521 1379.92 L79.2279 1379.92 L79.2279 1383.86 L49.5521 1383.86 L49.5521 1379.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M89.3667 1362.19 L107.723 1362.19 L107.723 1366.13 L93.6491 1366.13 L93.6491 1374.6 Q94.6676 1374.25 95.6861 1374.09 Q96.7047 1373.9 97.7232 1373.9 Q103.51 1373.9 106.89 1377.07 Q110.269 1380.25 110.269 1385.66 Q110.269 1391.24 106.797 1394.34 Q103.325 1397.42 97.0056 1397.42 Q94.8297 1397.42 92.5612 1397.05 Q90.3158 1396.68 87.9084 1395.94 L87.9084 1391.24 Q89.9917 1392.38 92.2139 1392.93 Q94.4361 1393.49 96.913 1393.49 Q100.918 1393.49 103.256 1391.38 Q105.593 1389.27 105.593 1385.66 Q105.593 1382.05 103.256 1379.95 Q100.918 1377.84 96.913 1377.84 Q95.038 1377.84 93.163 1378.26 Q91.3112 1378.67 89.3667 1379.55 L89.3667 1362.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M119.482 1390.87 L124.367 1390.87 L124.367 1396.75 L119.482 1396.75 L119.482 1390.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M144.552 1365.27 Q140.941 1365.27 139.112 1368.83 Q137.306 1372.38 137.306 1379.51 Q137.306 1386.61 139.112 1390.18 Q140.941 1393.72 144.552 1393.72 Q148.186 1393.72 149.991 1390.18 Q151.82 1386.61 151.82 1379.51 Q151.82 1372.38 149.991 1368.83 Q148.186 1365.27 144.552 1365.27 M144.552 1361.57 Q150.362 1361.57 153.417 1366.17 Q156.496 1370.76 156.496 1379.51 Q156.496 1388.23 153.417 1392.84 Q150.362 1397.42 144.552 1397.42 Q138.741 1397.42 135.663 1392.84 Q132.607 1388.23 132.607 1379.51 Q132.607 1370.76 135.663 1366.17 Q138.741 1361.57 144.552 1361.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M50.5475 1126.77 L80.2233 1126.77 L80.2233 1130.7 L50.5475 1130.7 L50.5475 1126.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M94.3436 1139.66 L110.663 1139.66 L110.663 1143.59 L88.7186 1143.59 L88.7186 1139.66 Q91.3806 1136.9 95.9639 1132.28 Q100.57 1127.62 101.751 1126.28 Q103.996 1123.76 104.876 1122.02 Q105.779 1120.26 105.779 1118.57 Q105.779 1115.82 103.834 1114.08 Q101.913 1112.34 98.8111 1112.34 Q96.6121 1112.34 94.1584 1113.11 Q91.7278 1113.87 88.9501 1115.42 L88.9501 1110.7 Q91.7741 1109.57 94.2278 1108.99 Q96.6815 1108.41 98.7185 1108.41 Q104.089 1108.41 107.283 1111.09 Q110.478 1113.78 110.478 1118.27 Q110.478 1120.4 109.668 1122.32 Q108.881 1124.22 106.774 1126.81 Q106.195 1127.48 103.094 1130.7 Q99.9917 1133.9 94.3436 1139.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M120.478 1137.71 L125.362 1137.71 L125.362 1143.59 L120.478 1143.59 L120.478 1137.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M135.593 1109.03 L153.95 1109.03 L153.95 1112.97 L139.876 1112.97 L139.876 1121.44 Q140.894 1121.09 141.913 1120.93 Q142.931 1120.75 143.95 1120.75 Q149.737 1120.75 153.116 1123.92 Q156.496 1127.09 156.496 1132.51 Q156.496 1138.09 153.024 1141.19 Q149.552 1144.27 143.232 1144.27 Q141.056 1144.27 138.788 1143.9 Q136.542 1143.53 134.135 1142.78 L134.135 1138.09 Q136.218 1139.22 138.441 1139.78 Q140.663 1140.33 143.14 1140.33 Q147.144 1140.33 149.482 1138.22 Q151.82 1136.12 151.82 1132.51 Q151.82 1128.9 149.482 1126.79 Q147.144 1124.68 143.14 1124.68 Q141.265 1124.68 139.39 1125.1 Q137.538 1125.52 135.593 1126.4 L135.593 1109.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M99.3204 858.957 Q95.7093 858.957 93.8806 862.522 Q92.075 866.063 92.075 873.193 Q92.075 880.3 93.8806 883.864 Q95.7093 887.406 99.3204 887.406 Q102.955 887.406 104.76 883.864 Q106.589 880.3 106.589 873.193 Q106.589 866.063 104.76 862.522 Q102.955 858.957 99.3204 858.957 M99.3204 855.253 Q105.131 855.253 108.186 859.86 Q111.265 864.443 111.265 873.193 Q111.265 881.92 108.186 886.526 Q105.131 891.11 99.3204 891.11 Q93.5102 891.11 90.4315 886.526 Q87.376 881.92 87.376 873.193 Q87.376 864.443 90.4315 859.86 Q93.5102 855.253 99.3204 855.253 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M119.482 884.559 L124.367 884.559 L124.367 890.438 L119.482 890.438 L119.482 884.559 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M144.552 858.957 Q140.941 858.957 139.112 862.522 Q137.306 866.063 137.306 873.193 Q137.306 880.3 139.112 883.864 Q140.941 887.406 144.552 887.406 Q148.186 887.406 149.991 883.864 Q151.82 880.3 151.82 873.193 Q151.82 866.063 149.991 862.522 Q148.186 858.957 144.552 858.957 M144.552 855.253 Q150.362 855.253 153.417 859.86 Q156.496 864.443 156.496 873.193 Q156.496 881.92 153.417 886.526 Q150.362 891.11 144.552 891.11 Q138.741 891.11 135.663 886.526 Q132.607 881.92 132.607 873.193 Q132.607 864.443 135.663 859.86 Q138.741 855.253 144.552 855.253 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M94.3436 633.347 L110.663 633.347 L110.663 637.282 L88.7186 637.282 L88.7186 633.347 Q91.3806 630.592 95.9639 625.963 Q100.57 621.31 101.751 619.967 Q103.996 617.444 104.876 615.708 Q105.779 613.949 105.779 612.259 Q105.779 609.505 103.834 607.768 Q101.913 606.032 98.8111 606.032 Q96.6121 606.032 94.1584 606.796 Q91.7278 607.56 88.9501 609.111 L88.9501 604.389 Q91.7741 603.255 94.2278 602.676 Q96.6815 602.097 98.7185 602.097 Q104.089 602.097 107.283 604.782 Q110.478 607.467 110.478 611.958 Q110.478 614.088 109.668 616.009 Q108.881 617.907 106.774 620.5 Q106.195 621.171 103.094 624.389 Q99.9917 627.583 94.3436 633.347 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M120.478 631.403 L125.362 631.403 L125.362 637.282 L120.478 637.282 L120.478 631.403 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M135.593 602.722 L153.95 602.722 L153.95 606.657 L139.876 606.657 L139.876 615.129 Q140.894 614.782 141.913 614.62 Q142.931 614.435 143.95 614.435 Q149.737 614.435 153.116 617.606 Q156.496 620.778 156.496 626.194 Q156.496 631.773 153.024 634.875 Q149.552 637.953 143.232 637.953 Q141.056 637.953 138.788 637.583 Q136.542 637.213 134.135 636.472 L134.135 631.773 Q136.218 632.907 138.441 633.463 Q140.663 634.018 143.14 634.018 Q147.144 634.018 149.482 631.912 Q151.82 629.805 151.82 626.194 Q151.82 622.583 149.482 620.477 Q147.144 618.37 143.14 618.37 Q141.265 618.37 139.39 618.787 Q137.538 619.204 135.593 620.083 L135.593 602.722 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M89.3667 349.566 L107.723 349.566 L107.723 353.501 L93.6491 353.501 L93.6491 361.973 Q94.6676 361.626 95.6861 361.464 Q96.7047 361.279 97.7232 361.279 Q103.51 361.279 106.89 364.45 Q110.269 367.621 110.269 373.038 Q110.269 378.617 106.797 381.719 Q103.325 384.797 97.0056 384.797 Q94.8297 384.797 92.5612 384.427 Q90.3158 384.056 87.9084 383.316 L87.9084 378.617 Q89.9917 379.751 92.2139 380.307 Q94.4361 380.862 96.913 380.862 Q100.918 380.862 103.256 378.756 Q105.593 376.649 105.593 373.038 Q105.593 369.427 103.256 367.32 Q100.918 365.214 96.913 365.214 Q95.038 365.214 93.163 365.631 Q91.3112 366.047 89.3667 366.927 L89.3667 349.566 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M119.482 378.246 L124.367 378.246 L124.367 384.126 L119.482 384.126 L119.482 378.246 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M144.552 352.645 Q140.941 352.645 139.112 356.209 Q137.306 359.751 137.306 366.881 Q137.306 373.987 139.112 377.552 Q140.941 381.094 144.552 381.094 Q148.186 381.094 149.991 377.552 Q151.82 373.987 151.82 366.881 Q151.82 359.751 149.991 356.209 Q148.186 352.645 144.552 352.645 M144.552 348.941 Q150.362 348.941 153.417 353.547 Q156.496 358.131 156.496 366.881 Q156.496 375.607 153.417 380.214 Q150.362 384.797 144.552 384.797 Q138.741 384.797 135.663 380.214 Q132.607 375.607 132.607 366.881 Q132.607 358.131 135.663 353.547 Q138.741 348.941 144.552 348.941 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M89.1352 96.4097 L111.357 96.4097 L111.357 98.4005 L98.8111 130.97 L93.9269 130.97 L105.732 100.345 L89.1352 100.345 L89.1352 96.4097 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M120.478 125.09 L125.362 125.09 L125.362 130.97 L120.478 130.97 L120.478 125.09 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip700)" d="M135.593 96.4097 L153.95 96.4097 L153.95 100.345 L139.876 100.345 L139.876 108.817 Q140.894 108.47 141.913 108.308 Q142.931 108.123 143.95 108.123 Q149.737 108.123 153.116 111.294 Q156.496 114.465 156.496 119.882 Q156.496 125.46 153.024 128.562 Q149.552 131.641 143.232 131.641 Q141.056 131.641 138.788 131.271 Q136.542 130.9 134.135 130.16 L134.135 125.46 Q136.218 126.595 138.441 127.15 Q140.663 127.706 143.14 127.706 Q147.144 127.706 149.482 125.599 Q151.82 123.493 151.82 119.882 Q151.82 116.271 149.482 114.164 Q147.144 112.058 143.14 112.058 Q141.265 112.058 139.39 112.474 Q137.538 112.891 135.593 113.771 L135.593 96.4097 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip702)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1023.6 268.292,1217.36 270.6,1449.65 272.908,1469.77 275.216,1325.71 277.524,1426.38 279.832,1335.31 282.139,1387.89 284.447,1282 286.755,1616.58 289.063,1472.51 291.371,1446.55 293.679,1164.21 295.987,1345.78 298.295,1423.8 300.603,1534.49 302.911,1366.96 305.219,1414.11 307.527,1335.04 309.834,1168.73 312.142,1381.88 314.45,1592.91 316.758,1437.36 319.066,1547.56 321.374,1382.5 323.682,1357.11 325.99,1365.03 328.298,1331.53 330.606,1279.75 332.914,1239 335.221,1309.11 337.529,1446.54 339.837,1339.78 342.145,1459.16 344.453,1315.61 346.761,1516.96 349.069,1441.3 351.377,1348.39 353.685,1456.26 355.993,1173.13 358.301,1407.06 360.608,1751.15 362.916,1253.06 365.224,1296.27 367.532,1149.89 369.84,1413.88 372.148,1402.28 374.456,1329.93 376.764,1119.88 379.072,1525.72 381.38,1249.6 383.688,1365.9 385.996,1187.03 388.303,1322 390.611,1497.66 392.919,1443.03 395.227,1186.91 397.535,1351.94 399.843,1348 402.151,1495.22 404.459,1586.73 406.767,1432.23 409.075,1211.53 411.383,1231.69 413.69,1382.36 415.998,1425.78 418.306,1506.13 420.614,1218.62 422.922,1522.64 425.23,1410.8 427.538,1394.23 429.846,1300.68 432.154,1405.12 434.462,1438.23 436.77,1288.26 439.077,1268.08 441.385,1518.92 443.693,1328.22 446.001,1561.76 448.309,1136.91 450.617,1308.81 452.925,1455.05 455.233,1228.5 457.541,1328.66 459.849,1505.5 462.157,1417.12 464.465,1315.75 466.772,1151.21 469.08,1383.15 471.388,1358.71 473.696,1355.58 476.004,1367.53 478.312,1469.49 480.62,1322.56 482.928,1210.7 485.236,1482.7 487.544,1361.24 489.852,1393.14 492.159,1576.41 494.467,1275.39 496.775,1268.53 499.083,1211.84 501.391,1436.26 503.699,1416.66 506.007,1427.67 508.315,1467.57 510.623,1332.59 512.931,1320.98 515.239,1530.73 517.546,1244.33 519.854,1323.26 522.162,1344.83 524.47,1212.22 526.778,1526.51 529.086,1243.68 531.394,1436.81 533.702,1282.5 536.01,1409.04 538.318,1392.15 540.626,1420.22 542.933,1284.33 545.241,1311.88 547.549,1114.96 549.857,1422.51 552.165,1395.75 554.473,1433.79 556.781,1391.26 559.089,1389.91 561.397,1450.38 563.705,1446.78 566.013,1418.72 568.321,1441.6 570.628,1532.66 572.936,1622.87 575.244,1542.84 577.552,1475.8 579.86,1459 582.168,1242.48 584.476,1307.8 586.784,1386.78 589.092,1335.88 591.4,1418.36 593.708,1223.49 596.015,1543.28 598.323,1528.19 600.631,1183.79 602.939,1310.48 605.247,1573.15 607.555,1337.76 609.863,1283.35 612.171,1427.11 614.479,1246.77 616.787,1431.6 619.095,1194.13 621.402,1340.97 623.71,1441.7 626.018,1350.36 628.326,1197.76 630.634,1567.62 632.942,1492.75 635.25,1433.93 637.558,1533.44 639.866,1324.36 642.174,1562.55 644.482,1100.18 646.79,1521.27 649.097,1459.54 651.405,1324.14 653.713,1267.16 656.021,1545.75 658.329,1450.79 660.637,1307.92 662.945,1362.7 665.253,1420.58 667.561,1455.38 669.869,1468.99 672.177,1424.31 674.484,1346.95 676.792,1239.22 679.1,1392.25 681.408,1322.38 683.716,1593.8 686.024,1386.46 688.332,1332.83 690.64,1349.52 692.948,1604.57 695.256,1403.74 697.564,1465.96 699.871,1492.08 702.179,1290.26 704.487,1401.07 706.795,1288 709.103,1192.02 711.411,1386.47 713.719,1221.54 716.027,1492.8 718.335,1463.63 720.643,1493.43 722.951,1464.06 725.259,1451.02 727.566,1280.65 729.874,1376.97 732.182,1491.11 734.49,1481.11 736.798,1395.41 739.106,1261.15 741.414,1387.16 743.722,1498.34 746.03,1249.81 748.338,1459.66 750.646,1403.24 752.953,1518.44 755.261,1293.36 757.569,1432.07 759.877,1400.75 762.185,1366.78 764.493,1317.67 766.801,1292.13 769.109,1278.46 771.417,1349.06 773.725,1321.92 776.033,1445.77 778.34,1562 780.648,1346.76 782.956,1340.82 785.264,1552.1 787.572,1264.72 789.88,1529.2 792.188,1203.62 794.496,1473.13 796.804,1410.6 799.112,1500.64 801.42,1481.5 803.728,1516.14 806.035,1513.41 808.343,1603.27 810.651,1510.97 812.959,1322.98 815.267,1322.82 817.575,1516.48 819.883,1469.61 822.191,1562.44 824.499,1323.87 826.807,1419.58 829.115,1380.2 831.422,1386.29 833.73,1231.76 836.038,1594.84 838.346,1351.09 840.654,1402.64 842.962,1323.37 845.27,1404.4 847.578,1282.31 849.886,1498.25 852.194,1558.22 854.502,1439.19 856.809,1269.94 859.117,1513.18 861.425,1254.74 863.733,1481.77 866.041,1464.96 868.349,1421.28 870.657,1453.1 872.965,1538.39 875.273,1303.49 877.581,1337.53 879.889,1233.52 882.197,1166.35 884.504,1477.72 886.812,1289.17 889.12,1484.19 891.428,1300.73 893.736,1316.4 896.044,1345.28 898.352,1467.52 900.66,1237.99 902.968,1237.66 905.276,1385.48 907.584,1546.82 909.891,1300.56 912.199,1501.02 914.507,1257.78 916.815,1341.15 919.123,1605.29 921.431,1304.84 923.739,1431.67 926.047,1332.27 928.355,1328.31 930.663,1139.35 932.971,1406.03 935.278,1473.28 937.586,1350.39 939.894,1423.96 942.202,1312.95 944.51,1559.01 946.818,1403.63 949.126,1232.21 951.434,1275.03 953.742,1314.52 956.05,1423.43 958.358,1251.7 960.665,1488.29 962.973,1424.59 965.281,1318.46 967.589,1385.55 969.897,1503.84 972.205,1554.38 974.513,1455.28 976.821,1383.38 979.129,1502.1 981.437,1417.92 983.745,1341.1 986.053,1238.63 988.36,1536.98 990.668,1215.58 992.976,1226.51 995.284,1404.02 997.592,1497.09 999.9,1152.31 1002.21,1272.92 1004.52,1377.08 1006.82,1374.27 1009.13,1590.9 1011.44,1446.5 1013.75,1384.93 1016.06,1303.18 1018.36,1376.61 1020.67,1331.97 1022.98,1317.62 1025.29,1483.73 1027.59,1387.87 1029.9,1370.09 1032.21,1377.85 1034.52,1453 1036.83,1371.89 1039.13,1364.65 1041.44,1173.23 1043.75,1390.42 1046.06,1504.78 1048.37,1360.68 1050.67,1361.41 1052.98,1387.7 1055.29,1320.04 1057.6,1307.77 1059.91,1479.89 1062.21,1324.27 1064.52,1429.54 1066.83,1107.45 1069.14,1277.9 1071.45,1421.05 1073.75,1394.74 1076.06,1284.78 1078.37,1499.4 1080.68,1148.56 1082.98,1658.86 1085.29,1354.15 1087.6,1421.84 1089.91,1375.36 1092.22,1242.28 1094.52,1362.84 1096.83,1343.15 1099.14,1324.33 1101.45,1363.46 1103.76,1428.46 1106.06,1536.01 1108.37,1324.12 1110.68,1376.17 1112.99,1463.9 1115.3,1494.24 1117.6,1532.72 1119.91,1386.3 1122.22,1223.64 1124.53,1510.58 1126.84,1320.97 1129.14,1320.01 1131.45,1277.29 1133.76,1264.2 1136.07,1522.63 1138.37,1400.49 1140.68,1518.4 1142.99,1382.03 1145.3,1343.44 1147.61,1431.63 1149.91,1513.9 1152.22,1451.99 1154.53,1498.1 1156.84,1339.33 1159.15,1335.18 1161.45,1516.32 1163.76,1304.25 1166.07,1579.64 1168.38,1259.5 1170.69,1461.46 1172.99,1464.58 1175.3,1300.44 1177.61,1381.23 1179.92,1263.35 1182.23,1178.18 1184.53,1284.03 1186.84,1257.11 1189.15,1520.59 1191.46,1294.36 1193.76,1412.63 1196.07,1449.15 1198.38,1310.4 1200.69,1476.94 1203,1559.74 1205.3,1344.26 1207.61,1356.38 1209.92,1317.4 1212.23,1292.55 1214.54,1349.01 1216.84,1534.37 1219.15,1416.13 1221.46,1464.5 1223.77,1314.62 1226.08,1281.52 1228.38,1395.22 1230.69,1527.02 1233,1410.45 1235.31,1332.24 1237.61,1202.67 1239.92,1282.42 1242.23,1381.43 1244.54,1466.91 1246.85,1322.47 1249.15,1265.16 1251.46,1344.96 1253.77,1265.33 1256.08,1425.63 1258.39,1494.88 1260.69,1365.32 1263,1478.78 1265.31,1306.96 1267.62,1314.44 1269.93,1439.76 1272.23,1171.42 1274.54,1383.18 1276.85,1379.29 1279.16,1349.25 1281.47,1344.18 1283.77,1401.85 1286.08,1527.61 1288.39,1506.45 1290.7,1430.41 1293,1279.22 1295.31,1327.59 1297.62,1415.46 1299.93,1523.96 1302.24,1263.71 1304.54,1513.64 1306.85,1560.59 1309.16,1337.07 1311.47,1375.68 1313.78,1263.24 1316.08,1294.27 1318.39,1386.97 1320.7,1359.76 1323.01,1382.13 1325.32,1506.6 1327.62,1337.28 1329.93,1286.61 1332.24,1312.06 1334.55,1412.75 1336.86,1337.19 1339.16,1215.38 1341.47,1443.56 1343.78,1368.34 1346.09,1395.34 1348.39,1238.51 1350.7,1414.94 1353.01,1532.73 1355.32,1371.88 1357.63,1365.41 1359.93,1428.67 1362.24,1402.69 1364.55,1439.27 1366.86,1185.72 1369.17,1265.72 1371.47,1172.4 1373.78,1394.56 1376.09,1558.01 1378.4,1447.71 1380.71,1407.18 1383.01,1226.61 1385.32,1359.07 1387.63,1278.34 1389.94,1335.55 1392.24,1374.76 1394.55,1307.86 1396.86,1525.82 1399.17,1458.11 1401.48,1403.9 1403.78,1188.79 1406.09,1455.97 1408.4,1343.46 1410.71,1468.91 1413.02,1254.98 1415.32,1353.47 1417.63,1408.79 1419.94,1297.09 1422.25,1351.96 1424.56,1382.29 1426.86,1405.45 1429.17,1506.14 1431.48,1286.91 1433.79,1559.43 1436.1,1435.66 1438.4,1450.16 1440.71,1313.34 1443.02,1496.09 1445.33,1519.98 1447.63,1276.05 1449.94,1415.06 1452.25,1490.34 1454.56,1426.34 1456.87,1402.33 1459.17,1400.65 1461.48,1465.68 1463.79,1275.5 1466.1,1447.76 1468.41,1081.43 1470.71,1396.4 1473.02,1323.16 1475.33,1317.32 1477.64,1462.25 1479.95,1212.6 1482.25,1390.11 1484.56,1306.59 1486.87,1303.3 1489.18,1418.26 1491.49,1226.27 1493.79,1478.52 1496.1,1421.29 1498.41,1297.14 1500.72,1298.39 1503.02,1349.61 1505.33,1352.46 1507.64,1264.72 1509.95,1488.35 1512.26,1525.41 1514.56,1252.67 1516.87,1381.14 1519.18,1294.22 1521.49,1542.85 1523.8,1422.03 1526.1,1306.55 1528.41,1360.77 1530.72,1226.25 1533.03,1389.05 1535.34,1443.89 1537.64,1275.97 1539.95,1521.82 1542.26,1465.12 1544.57,1259.88 1546.88,1426.82 1549.18,1259.38 1551.49,1287.61 1553.8,1342.71 1556.11,1495.38 1558.41,1499.47 1560.72,1487.94 1563.03,1522.2 1565.34,1307.44 1567.65,1406.99 1569.95,1214.39 1572.26,1578.88 1574.57,1390.04 1576.88,1381.25 1579.19,1287.2 1581.49,1379.16 1583.8,1303.2 1586.11,1461.93 1588.42,1184.36 1590.73,1305.24 1593.03,1473.03 1595.34,1183.22 1597.65,1434.19 1599.96,1480.64 1602.26,1399.62 1604.57,1313 1606.88,1505.78 1609.19,1175.94 1611.5,1528.2 1613.8,1406.7 1616.11,1183.19 1618.42,1525.8 1620.73,1556.85 1623.04,1349.03 1625.34,1304.75 1627.65,1323.14 1629.96,1501.44 1632.27,1431 1634.58,1667.51 1636.88,1332.95 1639.19,1444.73 1641.5,1323.46 1643.81,1566.09 1646.12,1399.34 1648.42,1485.15 1650.73,1286.86 1653.04,1360.4 1655.35,1576.99 1657.65,1393.36 1659.96,1446.52 1662.27,1448.25 1664.58,1241.12 1666.89,1154.86 1669.19,1290 1671.5,1383.03 1673.81,1338.4 1676.12,1420.6 1678.43,1511.32 1680.73,1361.57 1683.04,1366.73 1685.35,1428.69 1687.66,1421.57 1689.97,1527.42 1692.27,1368.72 1694.58,1351.34 1696.89,1408.7 1699.2,1324.66 1701.51,1421.6 1703.81,1466.8 1706.12,1426.71 1708.43,1500.74 1710.74,1135.48 1713.04,1243.36 1715.35,1353.8 1717.66,1355.35 1719.97,1534.95 1722.28,1287.62 1724.58,1299.02 1726.89,1423.78 1729.2,1374.16 1731.51,1517.09 1733.82,1362.64 1736.12,1219.66 1738.43,1434.89 1740.74,1242.35 1743.05,1393.11 1745.36,1281.49 1747.66,1278.44 1749.97,1401.56 1752.28,1499.39 1754.59,1202.43 1756.9,1481.08 1759.2,1494.16 1761.51,1358.48 1763.82,1560.45 1766.13,1174.19 1768.43,1380.15 1770.74,1419.56 1773.05,1460.09 1775.36,1283.81 1777.67,1442.92 1779.97,1451.55 1782.28,1388.23 1784.59,1374.36 1786.9,1374.93 1789.21,1506.08 1791.51,1413.25 1793.82,1349.3 1796.13,1291.38 1798.44,1512.96 1800.75,1233.93 1803.05,1246.69 1805.36,1277.25 1807.67,1250.05 1809.98,1340.85 1812.28,1371.96 1814.59,1199.22 1816.9,1378.21 1819.21,1239.63 1821.52,1373.94 1823.82,1274.17 1826.13,1259.72 1828.44,1279.69 1830.75,1456.65 1833.06,1434.13 1835.36,1424.86 1837.67,1203.31 1839.98,1450.81 1842.29,1214.39 1844.6,1450.82 1846.9,1290.66 1849.21,1310.96 1851.52,1428.26 1853.83,1285.77 1856.14,1274.35 1858.44,1466.27 1860.75,1434.43 1863.06,1210.6 1865.37,1487.22 1867.67,1458.5 1869.98,1436.19 1872.29,1075.23 1874.6,1250.41 1876.91,1524.11 1879.21,1481.68 1881.52,1253.72 1883.83,1401.27 1886.14,1460.02 1888.45,1173.5 1890.75,1408.91 1893.06,1264.66 1895.37,1337.78 1897.68,1322.44 1899.99,1464.61 1902.29,1423.36 1904.6,1352.79 1906.91,1450.04 1909.22,1378.88 1911.53,1247.91 1913.83,1454.75 1916.14,1336.36 1918.45,1279.62 1920.76,1341.65 1923.06,1305.84 1925.37,1137.47 1927.68,1375.32 1929.99,1342.41 1932.3,1465.91 1934.6,1241.65 1936.91,1393.44 1939.22,1640.15 1941.53,1524.03 1943.84,1166.11 1946.14,1326.06 1948.45,1440.38 1950.76,1364.78 1953.07,1353.99 1955.38,1440.88 1957.68,1330.41 1959.99,1443.48 1962.3,1331.17 1964.61,1289.46 1966.91,1287.88 1969.22,1222.28 1971.53,1431.08 1973.84,1325.42 1976.15,1183.86 1978.45,1216.42 1980.76,1474.94 1983.07,1358.28 1985.38,1500.82 1987.69,1281.7 1989.99,1293.16 1992.3,1511.33 1994.61,1522.62 1996.92,1201.03 1999.23,1337.61 2001.53,1461.63 2003.84,1420.31 2006.15,1517.59 2008.46,1369.52 2010.77,1441.11 2013.07,1589.58 2015.38,1496.52 2017.69,1492.85 2020,1145.39 2022.3,1438.92 2024.61,1584.62 2026.92,1473.73 2029.23,1383.47 2031.54,1516.8 2033.84,1431.6 2036.15,1315.75 2038.46,1263.41 2040.77,1270.28 2043.08,1308.89 2045.38,1289.67 2047.69,1264.69 2050,1289.86 2052.31,1162.46 2054.62,1334.67 2056.92,1432.16 2059.23,1219.77 2061.54,1556.47 2063.85,1407.6 2066.16,1377.97 2068.46,1415.82 2070.77,1394.78 2073.08,1521.64 2075.39,1390.6 2077.69,1377.21 2080,1642.7 2082.31,1418.21 2084.62,1298.63 2086.93,1137.09 2089.23,1345.89 2091.54,1287.6 2093.85,1376.56 2096.16,1330.55 2098.47,1334.34 2100.77,1539.96 2103.08,1315.31 2105.39,1203.27 2107.7,1353.32 2110.01,1420.73 2112.31,1379.05 2114.62,1508.28 2116.93,1519.3 2119.24,1453.73 2121.55,1387.31 2123.85,1247.23 2126.16,1417.79 2128.47,1320.06 2130.78,1199.04 2133.08,1532.8 2135.39,1307.85 2137.7,1318.18 2140.01,1263.69 2142.32,1396.76 2144.62,1412.54 2146.93,1416.18 2149.24,1269.49 2151.55,1215.17 2153.86,1393.28 2156.16,1259.04 2158.47,1294.71 2160.78,1359.91 2163.09,1432.99 2165.4,1397.89 2167.7,1331.23 2170.01,1244.85 2172.32,1419.73 2174.63,1179.33 2176.93,1347.5 2179.24,1441.21 2181.55,1422.61 2183.86,1423.91 2186.17,1330.81 2188.47,1397.11 2190.78,1084.88 2193.09,1156.85 2195.4,1545.52 2197.71,1314.61 2200.01,1488.48 2202.32,1484.6 2204.63,1493.47 2206.94,1144.26 2209.25,1499.53 2211.55,1434.87 2213.86,1188.14 2216.17,1258.62 2218.48,1298.72 2220.79,1378.21 2223.09,1316.71 2225.4,1428.85 2227.71,1285.93 2230.02,1494 2232.32,1441.41 2234.63,1347.71 2236.94,1416.91 2239.25,1485.74 2241.56,1465.47 2243.86,1082.52 2246.17,1359.04 2248.48,1397.81 2250.79,1454.1 2253.1,1399.15 2255.4,1473.64 2257.71,1530.06 2260.02,1509.82 2262.33,1376.09 2264.64,1425.72 2266.94,1321.26 2269.25,1286.93 2271.56,1573.5 2273.87,1242.27 2276.18,1234.88 2278.48,1445.13 2280.79,1330.83 2283.1,1483.93 2285.41,1484.02 2287.71,1452.89 2290.02,1580.8 2292.33,1367.54 2294.64,1248.92 2296.95,1125.37 2299.25,1363.09 2301.56,1365.3 2303.87,1457.6 2306.18,1539.44 2308.49,1255 2310.79,1326.34 2313.1,1456.04 2315.41,1573.5 2317.72,1387.94 2320.03,1338.94 2322.33,1369.29 2324.64,1215.38 2326.95,1546.76 2329.26,1563.93 2331.56,1481.85 2333.87,1343.94 2336.18,1191.75 2338.49,1471.14 2340.8,1424.94 2343.1,1491.55 2345.41,1488.36 2347.72,1481.38 2350.03,1332.64 2352.34,1526.65 2354.64,1351.28 2356.95,1311.45 2359.26,1532.88 2361.57,1312.74 2363.88,1480.43 2366.18,1326.43 2368.49,1400.44 2370.8,1419.06 2373.11,1475.47 2375.42,1520.12 2377.72,1349.98 2380.03,1414.72 2382.34,1314.46 2384.65,1297.47 2386.95,1230.54 2389.26,1390.91 2391.57,1344.44 2393.88,1232.52 2396.19,1610.95 2398.49,1532.47 2400.8,1199.15 2403.11,1450.99 2405.42,1466.17 2407.73,1450.26 2410.03,1555.62 2412.34,1398.8 2414.65,1268.09 2416.96,1358.35 2419.27,1327 2421.57,1495.63 2423.88,1364.28 2426.19,1306.27 2428.5,1314.67 2430.81,1458.09 2433.11,1393.26 2435.42,1435.81 2437.73,1197.11 2440.04,1462.51 2442.34,1583.82 2444.65,1394.93 2446.96,1215.7 2449.27,1502.5 2451.58,1358.59 2453.88,1437.03 2456.19,1209.52 2458.5,1396.44 2460.81,1438.8 2463.12,1362.52 2465.42,1261.69 2467.73,1502.46 2470.04,1526.39 2472.35,1377.26 2474.66,1605.67 2476.96,1384.36 2479.27,1405.32 2481.58,1426.2 2483.89,1432.94 2486.2,1468.79 2488.5,1337.49 2490.81,1435.39 2493.12,1488.68 2495.43,1404.09 2497.73,1313.96 2500.04,1449.97 2502.35,1312.48 2504.66,1453.77 2506.97,1282.68 2509.27,1255.84 2511.58,1452.94 2513.89,1274.98 2516.2,1567.64 2518.51,1215.06 2520.81,1420.46 2523.12,1163.68 2525.43,1129.95 2527.74,1297.63 2530.05,1503.47 2532.35,1461.4 2534.66,1527.11 2536.97,1253.99 2539.28,1339.79 2541.58,1609.36 2543.89,1593.97 2546.2,1522.9 2548.51,1103.89 2550.82,1380.49 2553.12,1122.98 2555.43,1389.53 2557.74,1424.14 2560.05,1383.89 2562.36,1389.02 2564.66,1385.61 2566.97,1441.63 2569.28,1335.43 2571.59,1317.54 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,954.389 268.292,964.159 270.6,847.077 272.908,844.157 275.216,857.936 277.524,933.17 279.832,882.726 282.139,980.369 284.447,873.442 286.755,789.511 289.063,819.117 291.371,975.914 293.679,963.499 295.987,870.289 298.295,956.187 300.603,962.485 302.911,911.424 305.219,863.61 307.527,961.796 309.834,972.728 312.142,824.613 314.45,961.088 316.758,819.538 319.066,832.629 321.374,914.143 323.682,1020.11 325.99,1007.48 328.298,909.069 330.606,849.31 332.914,932.54 335.221,911.535 337.529,1114.85 339.837,957.223 342.145,845.863 344.453,879.339 346.761,845.556 349.069,734.845 351.377,892.559 353.685,870.108 355.993,721.035 358.301,809.504 360.608,862.976 362.916,867.134 365.224,848.835 367.532,971.934 369.84,798.382 372.148,837.409 374.456,917.366 376.764,849.629 379.072,944.797 381.38,719.295 383.688,892.714 385.996,825.905 388.303,706.56 390.611,1024.93 392.919,781.54 395.227,663.63 397.535,886.077 399.843,1037.73 402.151,798.726 404.459,770.436 406.767,957.179 409.075,882.302 411.383,844.092 413.69,979.726 415.998,823.478 418.306,860.312 420.614,1043.84 422.922,823.773 425.23,641.672 427.538,913.875 429.846,878.353 432.154,921.353 434.462,785.83 436.77,876.6 439.077,761.441 441.385,1036.93 443.693,856.462 446.001,986.164 448.309,849.225 450.617,1038 452.925,826.953 455.233,1007.91 457.541,907.48 459.849,909.134 462.157,837.983 464.465,1081.03 466.772,993.773 469.08,858.576 471.388,995.813 473.696,821.874 476.004,1087.86 478.312,841.206 480.62,918.647 482.928,849.768 485.236,976.705 487.544,925.528 489.852,693.579 492.159,885.227 494.467,919.43 496.775,749.643 499.083,718.329 501.391,908.16 503.699,838.086 506.007,983.573 508.315,849.01 510.623,777.267 512.931,806.145 515.239,828.335 517.546,911.736 519.854,959.051 522.162,882.674 524.47,785.419 526.778,923.918 529.086,937.15 531.394,665.4 533.702,871.613 536.01,835.685 538.318,854.572 540.626,676.315 542.933,857.995 545.241,839.941 547.549,914.282 549.857,987.875 552.165,862.96 554.473,754.608 556.781,755.932 559.089,981.781 561.397,833.241 563.705,936.542 566.013,638.014 568.321,865.181 570.628,845.663 572.936,924.06 575.244,726.149 577.552,1115.5 579.86,880.903 582.168,916.985 584.476,974.251 586.784,743.638 589.092,973.525 591.4,892.207 593.708,929.628 596.015,1049.52 598.323,971.729 600.631,718.112 602.939,903.619 605.247,791.911 607.555,999.413 609.863,865.985 612.171,854.347 614.479,651.888 616.787,703.451 619.095,1023.75 621.402,707.903 623.71,891.723 626.018,765.206 628.326,1007.33 630.634,942.622 632.942,834.376 635.25,841.006 637.558,831.116 639.866,942.552 642.174,974.453 644.482,785.62 646.79,978.786 649.097,793.445 651.405,1145.04 653.713,882.432 656.021,1012.64 658.329,869.653 660.637,870.348 662.945,874.625 665.253,833.729 667.561,813.793 669.869,720.14 672.177,783.824 674.484,767.977 676.792,877.654 679.1,861.316 681.408,782.277 683.716,675.057 686.024,742.842 688.332,787.311 690.64,788.823 692.948,838.149 695.256,758.505 697.564,998.034 699.871,872.204 702.179,1013.01 704.487,689.931 706.795,981.836 709.103,820.727 711.411,754.033 713.719,824.244 716.027,875.667 718.335,988.798 720.643,958.65 722.951,832.564 725.259,835.616 727.566,811.546 729.874,723.788 732.182,982.787 734.49,835.072 736.798,996.461 739.106,824.9 741.414,751.236 743.722,876.63 746.03,888.016 748.338,900.84 750.646,936.776 752.953,809.469 755.261,891.179 757.569,993.132 759.877,842.605 762.185,823.796 764.493,982.923 766.801,944.659 769.109,1004.1 771.417,895.8 773.725,896.429 776.033,829.488 778.34,810.277 780.648,913.941 782.956,1029.59 785.264,940.147 787.572,938.542 789.88,827.512 792.188,818.646 794.496,927.68 796.804,722.36 799.112,712.73 801.42,887.489 803.728,990.411 806.035,891.542 808.343,1083.06 810.651,735.325 812.959,738.89 815.267,912.276 817.575,932.423 819.883,750.675 822.191,856.834 824.499,667.584 826.807,783.968 829.115,1039.53 831.422,929.434 833.73,716.821 836.038,938.185 838.346,818.13 840.654,938.739 842.962,1005.21 845.27,738.661 847.578,874.349 849.886,962.597 852.194,990.845 854.502,1081.21 856.809,839.606 859.117,877.46 861.425,770.11 863.733,713.726 866.041,1113.46 868.349,794.75 870.657,833.004 872.965,828.003 875.273,831.637 877.581,796.208 879.889,954.64 882.197,819.5 884.504,1071.44 886.812,915.087 889.12,920.909 891.428,1054.79 893.736,891.991 896.044,817.553 898.352,895.69 900.66,850.591 902.968,799.399 905.276,829.625 907.584,1091.89 909.891,852.997 912.199,1023.81 914.507,872.808 916.815,1060.82 919.123,822.603 921.431,819.898 923.739,807.974 926.047,635.654 928.355,879.144 930.663,864.607 932.971,986.908 935.278,903.87 937.586,761.377 939.894,760.4 942.202,975.375 944.51,921.926 946.818,739.104 949.126,908.185 951.434,883.751 953.742,919.108 956.05,700.242 958.358,822.284 960.665,913.173 962.973,812.882 965.281,849.564 967.589,905.773 969.897,664.819 972.205,843.291 974.513,859.939 976.821,808.509 979.129,902.392 981.437,949.085 983.745,847.856 986.053,778.158 988.36,814.245 990.668,922.545 992.976,849.337 995.284,1050.65 997.592,1009.03 999.9,865.337 1002.21,961.428 1004.52,803.849 1006.82,841.099 1009.13,774.596 1011.44,888.461 1013.75,765.645 1016.06,757.799 1018.36,587.247 1020.67,749.272 1022.98,738.344 1025.29,868.919 1027.59,611.338 1029.9,927.732 1032.21,912.653 1034.52,995.989 1036.83,742.707 1039.13,907.662 1041.44,898.632 1043.75,809.658 1046.06,829.892 1048.37,895.268 1050.67,864.768 1052.98,1058.2 1055.29,935.436 1057.6,868.944 1059.91,937.972 1062.21,1073.17 1064.52,829.853 1066.83,810.802 1069.14,801.51 1071.45,801.81 1073.75,724.083 1076.06,873.599 1078.37,1072.33 1080.68,952.567 1082.98,771.154 1085.29,961.49 1087.6,721.093 1089.91,787.134 1092.22,638.544 1094.52,673.563 1096.83,945.18 1099.14,761.709 1101.45,862.437 1103.76,815.641 1106.06,731.652 1108.37,1007.69 1110.68,1149.47 1112.99,773.505 1115.3,834.164 1117.6,753.729 1119.91,956.811 1122.22,899.195 1124.53,721.353 1126.84,736.653 1129.14,872.541 1131.45,876.506 1133.76,917.364 1136.07,881.075 1138.37,934.383 1140.68,1136.16 1142.99,644.584 1145.3,658.021 1147.61,846.28 1149.91,926.786 1152.22,850.596 1154.53,826.161 1156.84,964.417 1159.15,835.204 1161.45,846.614 1163.76,797.369 1166.07,867.359 1168.38,859.308 1170.69,1009.68 1172.99,735.991 1175.3,1015.33 1177.61,667.897 1179.92,929.843 1182.23,699.641 1184.53,955.246 1186.84,790.724 1189.15,881.999 1191.46,888.453 1193.76,918.938 1196.07,923.616 1198.38,958.046 1200.69,928.157 1203,1006.56 1205.3,849.559 1207.61,1001.41 1209.92,799.197 1212.23,878.232 1214.54,900.586 1216.84,830.174 1219.15,988.701 1221.46,947.204 1223.77,871.478 1226.08,917.039 1228.38,940.204 1230.69,800.422 1233,982.1 1235.31,943.759 1237.61,831.962 1239.92,732.14 1242.23,773.505 1244.54,1015.21 1246.85,736.282 1249.15,630.565 1251.46,1030.42 1253.77,869.777 1256.08,956.383 1258.39,856.997 1260.69,880.168 1263,839.544 1265.31,881.483 1267.62,1009.56 1269.93,934.72 1272.23,702.285 1274.54,935.274 1276.85,737.279 1279.16,849.097 1281.47,877.083 1283.77,885.816 1286.08,869.726 1288.39,919.61 1290.7,714.784 1293,852.288 1295.31,911.558 1297.62,1075.31 1299.93,889.183 1302.24,964.841 1304.54,934.099 1306.85,796.778 1309.16,859.609 1311.47,911.568 1313.78,765.882 1316.08,985.888 1318.39,1089.73 1320.7,817.669 1323.01,953.2 1325.32,811.138 1327.62,1052.29 1329.93,801.934 1332.24,923.153 1334.55,892.387 1336.86,835.776 1339.16,833.792 1341.47,916.191 1343.78,808.34 1346.09,746.953 1348.39,1012.48 1350.7,872.138 1353.01,934.638 1355.32,911.035 1357.63,1041.53 1359.93,754.738 1362.24,898.934 1364.55,781.409 1366.86,828.613 1369.17,803.022 1371.47,809.828 1373.78,692.712 1376.09,917.771 1378.4,1066.46 1380.71,825.079 1383.01,1042.13 1385.32,851.508 1387.63,961.444 1389.94,1027.49 1392.24,968.809 1394.55,793.918 1396.86,908.455 1399.17,869.259 1401.48,832.566 1403.78,706.011 1406.09,855.286 1408.4,895.769 1410.71,910.564 1413.02,996.738 1415.32,891.569 1417.63,866.053 1419.94,1008.27 1422.25,834.551 1424.56,864.465 1426.86,837.779 1429.17,934.203 1431.48,763.425 1433.79,848.844 1436.1,823.192 1438.4,830.02 1440.71,934.894 1443.02,804.666 1445.33,1038.82 1447.63,850.263 1449.94,927.397 1452.25,764.138 1454.56,901.601 1456.87,921.172 1459.17,1020.07 1461.48,884.168 1463.79,761.741 1466.1,922.262 1468.41,1058.44 1470.71,828.22 1473.02,875.271 1475.33,941.765 1477.64,950.716 1479.95,1128.97 1482.25,847.045 1484.56,879.011 1486.87,1040.38 1489.18,1061.58 1491.49,1085.71 1493.79,814.841 1496.1,883.013 1498.41,766.435 1500.72,911.76 1503.02,980.507 1505.33,932.432 1507.64,964.328 1509.95,999.915 1512.26,936.961 1514.56,983.353 1516.87,935.378 1519.18,1029.22 1521.49,946.681 1523.8,915.041 1526.1,827.203 1528.41,930.706 1530.72,835.578 1533.03,1005.62 1535.34,709.621 1537.64,1004.85 1539.95,818.382 1542.26,858.59 1544.57,941.836 1546.88,913.773 1549.18,954.574 1551.49,747.651 1553.8,804.589 1556.11,668.052 1558.41,956.067 1560.72,763.77 1563.03,815.61 1565.34,834.724 1567.65,894.868 1569.95,923.653 1572.26,750.682 1574.57,965.339 1576.88,961.602 1579.19,783.357 1581.49,777.155 1583.8,905.575 1586.11,860.123 1588.42,980.006 1590.73,976.296 1593.03,982.795 1595.34,890.015 1597.65,1018.2 1599.96,1032.67 1602.26,762.825 1604.57,870.45 1606.88,757.178 1609.19,895.006 1611.5,652.057 1613.8,1097.14 1616.11,856.933 1618.42,975.964 1620.73,748.083 1623.04,855.75 1625.34,603.835 1627.65,753.122 1629.96,810.717 1632.27,786.732 1634.58,810.582 1636.88,879.617 1639.19,624.303 1641.5,889.561 1643.81,799.629 1646.12,565.698 1648.42,727.578 1650.73,1031.04 1653.04,1018.42 1655.35,855.844 1657.65,843.723 1659.96,833.859 1662.27,915.414 1664.58,729.503 1666.89,874.784 1669.19,794.617 1671.5,916.113 1673.81,892.116 1676.12,744.666 1678.43,633.547 1680.73,977.328 1683.04,946.438 1685.35,838.553 1687.66,845.577 1689.97,978.818 1692.27,785.433 1694.58,732.837 1696.89,857.423 1699.2,826.562 1701.51,742.95 1703.81,902.268 1706.12,933.755 1708.43,852.158 1710.74,763.625 1713.04,809.002 1715.35,886.128 1717.66,957.366 1719.97,800.214 1722.28,942.185 1724.58,963.518 1726.89,951.032 1729.2,929.182 1731.51,997.247 1733.82,876.84 1736.12,682.732 1738.43,932.397 1740.74,1041.46 1743.05,1025.15 1745.36,960.181 1747.66,1047.37 1749.97,857.101 1752.28,953.106 1754.59,732.044 1756.9,835.822 1759.2,1057.54 1761.51,1018.78 1763.82,860.061 1766.13,1019.38 1768.43,1010 1770.74,875.796 1773.05,843.35 1775.36,938.736 1777.67,967.104 1779.97,835.809 1782.28,790.234 1784.59,801.378 1786.9,778.494 1789.21,869.158 1791.51,838.505 1793.82,673.842 1796.13,874.697 1798.44,834.998 1800.75,752.802 1803.05,902.356 1805.36,910.751 1807.67,1009.36 1809.98,708.066 1812.28,768.302 1814.59,893.549 1816.9,795.246 1819.21,871.301 1821.52,833.112 1823.82,872.587 1826.13,1010.19 1828.44,821.635 1830.75,755.734 1833.06,903.574 1835.36,967.027 1837.67,879.724 1839.98,941.138 1842.29,962.968 1844.6,991.88 1846.9,756.379 1849.21,578.141 1851.52,973.317 1853.83,902.082 1856.14,878.685 1858.44,834.377 1860.75,988.465 1863.06,812.833 1865.37,785.998 1867.67,926.757 1869.98,947.223 1872.29,832.445 1874.6,876.458 1876.91,987.386 1879.21,772.489 1881.52,828.539 1883.83,719.327 1886.14,761.106 1888.45,891.8 1890.75,870.99 1893.06,931.825 1895.37,861.723 1897.68,821.676 1899.99,898.442 1902.29,1003.81 1904.6,944.366 1906.91,817.642 1909.22,1061.12 1911.53,744.89 1913.83,877.107 1916.14,691.527 1918.45,703.852 1920.76,742.985 1923.06,871.906 1925.37,817.806 1927.68,581.665 1929.99,732.517 1932.3,905.408 1934.6,988.806 1936.91,830.971 1939.22,982.079 1941.53,859.468 1943.84,789.622 1946.14,1136.28 1948.45,1065.52 1950.76,942.507 1953.07,956.841 1955.38,943.125 1957.68,799.556 1959.99,931.788 1962.3,855.462 1964.61,762.618 1966.91,833.426 1969.22,777.028 1971.53,941.14 1973.84,839.235 1976.15,970.873 1978.45,816.483 1980.76,949.819 1983.07,830.828 1985.38,832.3 1987.69,859.372 1989.99,996.03 1992.3,849.954 1994.61,819.837 1996.92,838.189 1999.23,996.268 2001.53,1044.07 2003.84,870.222 2006.15,953.629 2008.46,787.419 2010.77,983.853 2013.07,768.824 2015.38,941.389 2017.69,818.446 2020,853.722 2022.3,886.012 2024.61,817.837 2026.92,845.802 2029.23,707.035 2031.54,876.681 2033.84,868.338 2036.15,941.81 2038.46,914.109 2040.77,941.1 2043.08,1032.7 2045.38,778.246 2047.69,930.205 2050,887.929 2052.31,930.391 2054.62,1003.41 2056.92,841.071 2059.23,965.314 2061.54,601.544 2063.85,1084 2066.16,1061.35 2068.46,1079.98 2070.77,711.713 2073.08,797.731 2075.39,786.992 2077.69,831.972 2080,914.877 2082.31,838.564 2084.62,895.726 2086.93,826.298 2089.23,832.857 2091.54,625.153 2093.85,658.972 2096.16,882.551 2098.47,759.665 2100.77,858.233 2103.08,813.553 2105.39,994.41 2107.7,874.638 2110.01,1020.07 2112.31,887.54 2114.62,950.21 2116.93,896.88 2119.24,694.164 2121.55,801.889 2123.85,853.336 2126.16,732.614 2128.47,827.341 2130.78,751.203 2133.08,1032.21 2135.39,950.683 2137.7,814.733 2140.01,1069.74 2142.32,679.309 2144.62,732.23 2146.93,642.947 2149.24,604.554 2151.55,758.765 2153.86,1025.67 2156.16,915.823 2158.47,751.926 2160.78,971.959 2163.09,684.751 2165.4,982.372 2167.7,870.381 2170.01,963.6 2172.32,843.785 2174.63,1087.55 2176.93,763.158 2179.24,839.994 2181.55,774.631 2183.86,817.146 2186.17,911.527 2188.47,916.982 2190.78,753.471 2193.09,728.569 2195.4,869.053 2197.71,843.158 2200.01,764.352 2202.32,844.751 2204.63,691 2206.94,955.31 2209.25,741.146 2211.55,721.59 2213.86,919.522 2216.17,833.041 2218.48,939.848 2220.79,770.152 2223.09,959.371 2225.4,1033.49 2227.71,1059.53 2230.02,1084.9 2232.32,895.26 2234.63,810.246 2236.94,746.732 2239.25,939.866 2241.56,981.476 2243.86,708.662 2246.17,701.596 2248.48,918.828 2250.79,1020.33 2253.1,794.037 2255.4,793.153 2257.71,739.838 2260.02,969.11 2262.33,839.044 2264.64,766.711 2266.94,779.101 2269.25,1003.21 2271.56,1195.51 2273.87,788.074 2276.18,668.821 2278.48,610.564 2280.79,953.457 2283.1,1056.48 2285.41,733.317 2287.71,836.055 2290.02,984.903 2292.33,1123.21 2294.64,953.997 2296.95,886.463 2299.25,708.219 2301.56,1053.9 2303.87,894.421 2306.18,880.717 2308.49,761.737 2310.79,970.23 2313.1,796.442 2315.41,856.675 2317.72,954.474 2320.03,815.697 2322.33,864.277 2324.64,871.134 2326.95,1006.19 2329.26,810.08 2331.56,796.514 2333.87,1027.33 2336.18,831.327 2338.49,749.983 2340.8,827.339 2343.1,796.711 2345.41,948.231 2347.72,1074.09 2350.03,871.475 2352.34,1031.87 2354.64,820.696 2356.95,940.575 2359.26,1066.44 2361.57,897.113 2363.88,900.378 2366.18,866.84 2368.49,788.04 2370.8,838.378 2373.11,909.284 2375.42,706.554 2377.72,981.003 2380.03,844.616 2382.34,871.957 2384.65,856.742 2386.95,963.62 2389.26,952.017 2391.57,719.925 2393.88,910.5 2396.19,868.729 2398.49,995.335 2400.8,789.671 2403.11,781.122 2405.42,757.981 2407.73,1002.45 2410.03,905.792 2412.34,1001.75 2414.65,951.441 2416.96,734.107 2419.27,986.107 2421.57,910.389 2423.88,838.882 2426.19,908.243 2428.5,1013.82 2430.81,1131.86 2433.11,821.728 2435.42,862.714 2437.73,898.161 2440.04,868.846 2442.34,844.739 2444.65,784.787 2446.96,907.277 2449.27,903.444 2451.58,1004.57 2453.88,1004.61 2456.19,974.535 2458.5,903.076 2460.81,722.292 2463.12,879.51 2465.42,825.573 2467.73,942.89 2470.04,785.07 2472.35,786.167 2474.66,818.598 2476.96,1024.55 2479.27,913.732 2481.58,818.259 2483.89,757.595 2486.2,815.98 2488.5,1130.36 2490.81,770.064 2493.12,646.627 2495.43,960.069 2497.73,1031 2500.04,826.634 2502.35,875.277 2504.66,904.356 2506.97,916.624 2509.27,848.834 2511.58,776.411 2513.89,861.986 2516.2,990.289 2518.51,993.612 2520.81,758.183 2523.12,632.375 2525.43,611.322 2527.74,1158.92 2530.05,950.856 2532.35,1090.87 2534.66,939.552 2536.97,894.011 2539.28,900.528 2541.58,975.929 2543.89,691.172 2546.2,871.903 2548.51,988.463 2550.82,787.04 2553.12,863.593 2555.43,860.711 2557.74,808.888 2560.05,984.484 2562.36,716.133 2564.66,616.725 2566.97,887.125 2569.28,950.637 2571.59,855.639 "></polyline>
<polyline clip-path="url(#clip702)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,508.58 268.292,484.32 270.6,193.987 272.908,338.913 275.216,534.368 277.524,520.534 279.832,400.379 282.139,373.872 284.447,387.364 286.755,278.44 289.063,336.112 291.371,414.983 293.679,417.227 295.987,522.667 298.295,266.39 300.603,359.663 302.911,288.948 305.219,450.618 307.527,384.797 309.834,416.7 312.142,648.295 314.45,521.791 316.758,295.33 319.066,477.195 321.374,362.084 323.682,508.568 325.99,297.01 328.298,292.619 330.606,447.032 332.914,416.292 335.221,390.599 337.529,291.014 339.837,370.202 342.145,419.048 344.453,440.895 346.761,467.622 349.069,238.606 351.377,285.944 353.685,325.872 355.993,333.091 358.301,323.976 360.608,411.446 362.916,228.332 365.224,353.773 367.532,426.065 369.84,387.603 372.148,512.132 374.456,529.575 376.764,395.126 379.072,395.439 381.38,309.958 383.688,355.799 385.996,195.158 388.303,265.564 390.611,399.145 392.919,308.23 395.227,347.472 397.535,368.558 399.843,347.387 402.151,284.966 404.459,570.533 406.767,391.269 409.075,250.449 411.383,408.834 413.69,439.176 415.998,486.068 418.306,344.883 420.614,245.184 422.922,250.332 425.23,419.069 427.538,377.645 429.846,349.136 432.154,302.007 434.462,316.213 436.77,465.144 439.077,536.321 441.385,157.107 443.693,214.422 446.001,394.469 448.309,178.046 450.617,283.62 452.925,287.159 455.233,462.483 457.541,321.332 459.849,363.825 462.157,390.059 464.465,556.845 466.772,378.73 469.08,340.093 471.388,327.13 473.696,386.046 476.004,96.8724 478.312,422.13 480.62,363.112 482.928,284.766 485.236,359.488 487.544,421.461 489.852,606.649 492.159,421.098 494.467,316.19 496.775,306.052 499.083,184.726 501.391,730.181 503.699,223.332 506.007,502.716 508.315,456.555 510.623,442.813 512.931,224.607 515.239,515.89 517.546,429.132 519.854,378.996 522.162,336.967 524.47,398.185 526.778,471.435 529.086,377.114 531.394,301.21 533.702,130.607 536.01,349.569 538.318,455.031 540.626,317.772 542.933,418.441 545.241,315.176 547.549,497.397 549.857,484.439 552.165,317.41 554.473,396.137 556.781,413.366 559.089,349.828 561.397,315.248 563.705,264.542 566.013,378.632 568.321,193.479 570.628,361.238 572.936,391.311 575.244,291.24 577.552,296.138 579.86,187.97 582.168,444.222 584.476,357.32 586.784,436.619 589.092,274.236 591.4,217.832 593.708,395.186 596.015,485.628 598.323,364.693 600.631,350.758 602.939,435.851 605.247,525.6 607.555,248.48 609.863,472.081 612.171,365.534 614.479,253.041 616.787,358.721 619.095,318.745 621.402,296.238 623.71,431.361 626.018,456.834 628.326,224.817 630.634,496.432 632.942,349.421 635.25,137 637.558,453.501 639.866,135.245 642.174,388.053 644.482,405.165 646.79,467.675 649.097,244.78 651.405,389.74 653.713,163.877 656.021,305.019 658.329,310.476 660.637,481.558 662.945,394.359 665.253,162.646 667.561,348.581 669.869,467.893 672.177,337.364 674.484,263.061 676.792,416.395 679.1,414.124 681.408,353.416 683.716,226.516 686.024,478.841 688.332,347.521 690.64,336.564 692.948,511.236 695.256,558.083 697.564,399.275 699.871,404.049 702.179,479.069 704.487,312.96 706.795,369.05 709.103,403.038 711.411,249.304 713.719,551.117 716.027,596.594 718.335,502.627 720.643,432.748 722.951,308.808 725.259,416.875 727.566,377.719 729.874,276.713 732.182,471.051 734.49,263.087 736.798,465.463 739.106,336.927 741.414,322.626 743.722,488.458 746.03,463.398 748.338,523.98 750.646,405.495 752.953,283.759 755.261,293.003 757.569,312.172 759.877,272.714 762.185,478.162 764.493,486.491 766.801,203.889 769.109,344.76 771.417,248.273 773.725,568.773 776.033,423.162 778.34,344.262 780.648,359.85 782.956,594.409 785.264,303.429 787.572,394.492 789.88,396.643 792.188,400.049 794.496,324.461 796.804,335.85 799.112,389.835 801.42,465.703 803.728,503.587 806.035,331.177 808.343,449.949 810.651,424.939 812.959,545.115 815.267,367.262 817.575,334.068 819.883,459.2 822.191,273.876 824.499,363.88 826.807,148.396 829.115,439.018 831.422,433.839 833.73,306.321 836.038,333.672 838.346,414.783 840.654,439.932 842.962,486.559 845.27,425.882 847.578,554.979 849.886,383.589 852.194,410.129 854.502,344.607 856.809,535.02 859.117,272.355 861.425,148.129 863.733,363.305 866.041,410.755 868.349,264.409 870.657,278.649 872.965,270.71 875.273,236.192 877.581,350.173 879.889,450.185 882.197,327.517 884.504,320.002 886.812,411.104 889.12,403.598 891.428,222.317 893.736,533.918 896.044,423.237 898.352,419.808 900.66,188 902.968,352.646 905.276,425.93 907.584,482.303 909.891,319.761 912.199,386.091 914.507,332.883 916.815,389.628 919.123,414.516 921.431,298.585 923.739,396.038 926.047,593.639 928.355,416.729 930.663,251.853 932.971,435.034 935.278,332.888 937.586,442.717 939.894,219.467 942.202,339.373 944.51,242.343 946.818,428.555 949.126,448.509 951.434,331.054 953.742,309.338 956.05,292.215 958.358,332.618 960.665,217.363 962.973,399.999 965.281,363.589 967.589,334.536 969.897,691.088 972.205,286.885 974.513,415.043 976.821,283.417 979.129,331.447 981.437,353.696 983.745,330.146 986.053,363.705 988.36,457.06 990.668,390.722 992.976,441.971 995.284,468.876 997.592,256.386 999.9,602.589 1002.21,364.673 1004.52,272.73 1006.82,306.478 1009.13,356.512 1011.44,402.389 1013.75,472.777 1016.06,441.071 1018.36,504.199 1020.67,413.283 1022.98,384.409 1025.29,502.197 1027.59,171.117 1029.9,301.526 1032.21,568.445 1034.52,361.745 1036.83,373.337 1039.13,201.277 1041.44,313.002 1043.75,430.641 1046.06,406.043 1048.37,273.394 1050.67,461.795 1052.98,415.949 1055.29,268.118 1057.6,394.276 1059.91,525.121 1062.21,531.098 1064.52,356.333 1066.83,431.874 1069.14,314.455 1071.45,435.303 1073.75,232.748 1076.06,308.731 1078.37,491.312 1080.68,336.711 1082.98,496.204 1085.29,381.824 1087.6,364.39 1089.91,187.494 1092.22,428.8 1094.52,524.388 1096.83,483.063 1099.14,374.961 1101.45,385.977 1103.76,445.878 1106.06,169.205 1108.37,446.339 1110.68,353.699 1112.99,365.148 1115.3,383.471 1117.6,345.74 1119.91,405.984 1122.22,527.394 1124.53,491.045 1126.84,323.594 1129.14,326.175 1131.45,605.271 1133.76,393.099 1136.07,431.547 1138.37,457.776 1140.68,283.748 1142.99,420.946 1145.3,284.53 1147.61,371.613 1149.91,450.24 1152.22,316.583 1154.53,299.191 1156.84,208.937 1159.15,380.101 1161.45,456.481 1163.76,216.936 1166.07,354.845 1168.38,335.479 1170.69,336.79 1172.99,205.397 1175.3,371.69 1177.61,418.727 1179.92,314.171 1182.23,208.258 1184.53,335.22 1186.84,589.539 1189.15,285.79 1191.46,396.689 1193.76,365.286 1196.07,387.452 1198.38,288.32 1200.69,391.737 1203,543.556 1205.3,278.936 1207.61,168 1209.92,514.961 1212.23,105.679 1214.54,507.699 1216.84,326.846 1219.15,519.737 1221.46,291.629 1223.77,303.146 1226.08,400.181 1228.38,211.019 1230.69,545.8 1233,413.279 1235.31,432.812 1237.61,334.142 1239.92,283.289 1242.23,258.721 1244.54,119.476 1246.85,457.412 1249.15,480.624 1251.46,472.28 1253.77,248.756 1256.08,461.292 1258.39,427.131 1260.69,543.092 1263,451.863 1265.31,548.037 1267.62,386.39 1269.93,456.721 1272.23,290.463 1274.54,266.564 1276.85,396.529 1279.16,418.035 1281.47,429.918 1283.77,417.825 1286.08,312.095 1288.39,346.774 1290.7,397.846 1293,502.926 1295.31,546.869 1297.62,549.792 1299.93,482.507 1302.24,392.872 1304.54,367.352 1306.85,372.108 1309.16,475.141 1311.47,240.728 1313.78,371.211 1316.08,249.679 1318.39,646.009 1320.7,272.398 1323.01,451.037 1325.32,354.666 1327.62,358.445 1329.93,263.473 1332.24,318.192 1334.55,242.506 1336.86,341.913 1339.16,315.693 1341.47,296.339 1343.78,406.244 1346.09,232.222 1348.39,160.294 1350.7,349.252 1353.01,334.196 1355.32,423.006 1357.63,313.226 1359.93,329.125 1362.24,283.025 1364.55,547.066 1366.86,389.023 1369.17,267.515 1371.47,394.377 1373.78,356.5 1376.09,354.15 1378.4,478.014 1380.71,395.573 1383.01,507.177 1385.32,332.614 1387.63,596.792 1389.94,680.958 1392.24,389.325 1394.55,259.885 1396.86,326.618 1399.17,244.589 1401.48,329.918 1403.78,189.349 1406.09,560.389 1408.4,332.257 1410.71,408.377 1413.02,284.383 1415.32,243.633 1417.63,369.429 1419.94,346.419 1422.25,200.379 1424.56,364.027 1426.86,424.738 1429.17,451.162 1431.48,244.71 1433.79,235.12 1436.1,365.982 1438.4,300.705 1440.71,295.353 1443.02,368.133 1445.33,376.861 1447.63,375.123 1449.94,320.798 1452.25,396.065 1454.56,436.461 1456.87,439.591 1459.17,504.556 1461.48,422.906 1463.79,587.51 1466.1,392.621 1468.41,325.14 1470.71,540.44 1473.02,392.754 1475.33,359.169 1477.64,361.114 1479.95,463.888 1482.25,363.975 1484.56,394.181 1486.87,466.373 1489.18,534.119 1491.49,443.89 1493.79,167.986 1496.1,402.819 1498.41,330.808 1500.72,368.02 1503.02,348.329 1505.33,250.86 1507.64,317.184 1509.95,360.944 1512.26,321.434 1514.56,192.938 1516.87,326.275 1519.18,315.107 1521.49,159.714 1523.8,136.424 1526.1,231.609 1528.41,206.503 1530.72,311.577 1533.03,333.439 1535.34,434.481 1537.64,352.343 1539.95,242.341 1542.26,209.121 1544.57,319.882 1546.88,437.049 1549.18,342.49 1551.49,365.559 1553.8,494.65 1556.11,268.194 1558.41,153.388 1560.72,193.701 1563.03,294.695 1565.34,363.647 1567.65,418.467 1569.95,433.411 1572.26,534.79 1574.57,342.703 1576.88,521.289 1579.19,506.329 1581.49,319.356 1583.8,337.744 1586.11,451.58 1588.42,554.54 1590.73,245.059 1593.03,203.756 1595.34,408.895 1597.65,429.523 1599.96,271.287 1602.26,393.444 1604.57,366.828 1606.88,320.821 1609.19,292.785 1611.5,247.109 1613.8,334.069 1616.11,204.448 1618.42,553.359 1620.73,509.195 1623.04,419.799 1625.34,364.275 1627.65,557.334 1629.96,446.307 1632.27,188.757 1634.58,236.018 1636.88,444.854 1639.19,321.463 1641.5,418.437 1643.81,411.968 1646.12,107.649 1648.42,561.911 1650.73,389.465 1653.04,329.792 1655.35,309.219 1657.65,405.612 1659.96,124.719 1662.27,161.144 1664.58,444.775 1666.89,384.779 1669.19,303.932 1671.5,413.595 1673.81,349.302 1676.12,377.576 1678.43,275.472 1680.73,420.547 1683.04,325.752 1685.35,634.353 1687.66,360.28 1689.97,303.046 1692.27,449.003 1694.58,473.467 1696.89,358.412 1699.2,273.22 1701.51,313.617 1703.81,445.662 1706.12,387.28 1708.43,292.574 1710.74,453.565 1713.04,474.414 1715.35,358.628 1717.66,251.527 1719.97,301.174 1722.28,263.465 1724.58,398.242 1726.89,354.421 1729.2,372.479 1731.51,267.257 1733.82,633.754 1736.12,267.865 1738.43,228.102 1740.74,503.022 1743.05,243.928 1745.36,221.539 1747.66,340.493 1749.97,460.334 1752.28,484.735 1754.59,291.674 1756.9,290.697 1759.2,135.012 1761.51,267.605 1763.82,353.678 1766.13,482.857 1768.43,344.484 1770.74,559.64 1773.05,468.099 1775.36,463.577 1777.67,508.745 1779.97,323.377 1782.28,344.639 1784.59,368.328 1786.9,276.952 1789.21,528.322 1791.51,565.934 1793.82,336.343 1796.13,395.485 1798.44,365.738 1800.75,443.513 1803.05,425.091 1805.36,431.487 1807.67,127.214 1809.98,383.899 1812.28,489.552 1814.59,394.374 1816.9,339.881 1819.21,287.803 1821.52,363.321 1823.82,327.325 1826.13,357.517 1828.44,377.963 1830.75,453.693 1833.06,201.769 1835.36,256.249 1837.67,339.601 1839.98,394.876 1842.29,439.338 1844.6,374.637 1846.9,397.964 1849.21,478.878 1851.52,476.573 1853.83,327.303 1856.14,430.54 1858.44,323.363 1860.75,357.332 1863.06,374.537 1865.37,487.04 1867.67,278.299 1869.98,298.723 1872.29,368.435 1874.6,355.93 1876.91,305.87 1879.21,153.667 1881.52,522.227 1883.83,487.847 1886.14,484.985 1888.45,342.378 1890.75,469.882 1893.06,527.82 1895.37,333.349 1897.68,226.713 1899.99,565.342 1902.29,252.415 1904.6,514.901 1906.91,139.926 1909.22,342.557 1911.53,336.285 1913.83,385.581 1916.14,509.429 1918.45,534.102 1920.76,306.1 1923.06,348.521 1925.37,478.157 1927.68,241.814 1929.99,320.135 1932.3,212.209 1934.6,202.506 1936.91,269.129 1939.22,370.747 1941.53,290.221 1943.84,364.58 1946.14,371.738 1948.45,395.404 1950.76,173.25 1953.07,439.598 1955.38,360.212 1957.68,332.157 1959.99,277.188 1962.3,465.423 1964.61,406.727 1966.91,376.96 1969.22,377.051 1971.53,475.256 1973.84,361.686 1976.15,220.864 1978.45,212.69 1980.76,171.543 1983.07,348.792 1985.38,360.471 1987.69,527.71 1989.99,453.018 1992.3,256.872 1994.61,393.422 1996.92,371.238 1999.23,297.071 2001.53,364.802 2003.84,377.327 2006.15,332.312 2008.46,386 2010.77,332.277 2013.07,320.405 2015.38,293.664 2017.69,251.637 2020,218.512 2022.3,219.925 2024.61,225.157 2026.92,321.96 2029.23,558.692 2031.54,275.073 2033.84,465.164 2036.15,270.759 2038.46,452.437 2040.77,197.561 2043.08,308.369 2045.38,387.214 2047.69,399.021 2050,506.888 2052.31,305.148 2054.62,466.122 2056.92,262.508 2059.23,355.214 2061.54,448.649 2063.85,366.549 2066.16,259.122 2068.46,527.332 2070.77,352.504 2073.08,489.346 2075.39,384.983 2077.69,345.193 2080,450.411 2082.31,444.821 2084.62,345.07 2086.93,462.078 2089.23,199.582 2091.54,392.073 2093.85,291.334 2096.16,445.966 2098.47,361.04 2100.77,387.929 2103.08,543.36 2105.39,340.569 2107.7,149.5 2110.01,396.16 2112.31,349.204 2114.62,392.487 2116.93,348.817 2119.24,335.912 2121.55,373.414 2123.85,515.231 2126.16,401.495 2128.47,180.17 2130.78,475.812 2133.08,362.505 2135.39,508.074 2137.7,280.431 2140.01,321.604 2142.32,431.628 2144.62,495.841 2146.93,365.525 2149.24,458.493 2151.55,400.644 2153.86,239.587 2156.16,290.712 2158.47,481.325 2160.78,258.432 2163.09,281.542 2165.4,437.483 2167.7,364.392 2170.01,290.101 2172.32,414.166 2174.63,305.184 2176.93,498.273 2179.24,370.18 2181.55,342.328 2183.86,379.015 2186.17,213.215 2188.47,230.726 2190.78,503.265 2193.09,428.224 2195.4,359.484 2197.71,446.34 2200.01,294.56 2202.32,333.663 2204.63,257.393 2206.94,372.815 2209.25,336.557 2211.55,373.716 2213.86,432.428 2216.17,277.426 2218.48,506.945 2220.79,306.844 2223.09,221.284 2225.4,343.895 2227.71,332.193 2230.02,223.556 2232.32,403.642 2234.63,399.774 2236.94,726.084 2239.25,653.511 2241.56,360.942 2243.86,304.969 2246.17,388.56 2248.48,199.394 2250.79,277.683 2253.1,366.288 2255.4,418.686 2257.71,307.791 2260.02,473.859 2262.33,490.065 2264.64,320.043 2266.94,332.328 2269.25,498.005 2271.56,314.784 2273.87,300.466 2276.18,284.413 2278.48,188.978 2280.79,287.847 2283.1,614.258 2285.41,323.273 2287.71,350.974 2290.02,152.04 2292.33,520.392 2294.64,414.904 2296.95,477.063 2299.25,424.158 2301.56,332.543 2303.87,402.662 2306.18,280.755 2308.49,378.011 2310.79,445.034 2313.1,261.201 2315.41,459.461 2317.72,358.144 2320.03,283.991 2322.33,305.151 2324.64,360.031 2326.95,384.776 2329.26,253.79 2331.56,415.987 2333.87,455.925 2336.18,275.1 2338.49,284.649 2340.8,326.043 2343.1,478.715 2345.41,247.976 2347.72,383.27 2350.03,441.891 2352.34,297.758 2354.64,393.014 2356.95,312.792 2359.26,455.774 2361.57,443.09 2363.88,220.137 2366.18,442.756 2368.49,447.157 2370.8,416.084 2373.11,393.627 2375.42,270.137 2377.72,390.137 2380.03,357.725 2382.34,335.957 2384.65,418.364 2386.95,297.251 2389.26,376.347 2391.57,373.3 2393.88,187.184 2396.19,477.589 2398.49,298.248 2400.8,323.686 2403.11,334.471 2405.42,531.889 2407.73,314.214 2410.03,489.446 2412.34,384.411 2414.65,382.963 2416.96,385.241 2419.27,553.16 2421.57,166.827 2423.88,559.811 2426.19,255.96 2428.5,309.799 2430.81,460.522 2433.11,468.068 2435.42,262.792 2437.73,412.455 2440.04,354.652 2442.34,236.139 2444.65,342.712 2446.96,345.347 2449.27,350.334 2451.58,397.014 2453.88,356.482 2456.19,442.789 2458.5,444.144 2460.81,365.452 2463.12,328.09 2465.42,365.627 2467.73,474.008 2470.04,443.124 2472.35,370.964 2474.66,495.629 2476.96,510.75 2479.27,455.948 2481.58,341.12 2483.89,505.46 2486.2,404.539 2488.5,351.625 2490.81,369.346 2493.12,397.547 2495.43,235.413 2497.73,454.64 2500.04,346.394 2502.35,438.567 2504.66,315.637 2506.97,529.198 2509.27,242.736 2511.58,282.432 2513.89,415.21 2516.2,282.88 2518.51,110.238 2520.81,359.791 2523.12,303.068 2525.43,429.451 2527.74,309.363 2530.05,354.537 2532.35,365.476 2534.66,189.519 2536.97,537.981 2539.28,414.983 2541.58,233.151 2543.89,307.096 2546.2,340.09 2548.51,434.585 2550.82,402.264 2553.12,222.878 2555.43,326.498 2557.74,413.935 2560.05,320.193 2562.36,458.938 2564.66,266.71 2566.97,478.009 2569.28,328.709 2571.59,298.895 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(stack, samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:310</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -4.57527  -5.99279  -6.20702  -5.67268  …  -6.35334   -6.61308   -6.61308
 -1.81578  -1.08188  -0.35462  -1.86749     -0.097941   0.561966   0.561966
  3.13977   3.44431   6.73274   5.26698      7.52005    5.89227    5.89227

[:, :, 2] =
 -3.35673    -4.94901   -5.41621    …  -4.44286   -6.2105     -4.03348
  0.0232975   0.544969  -0.0966896     -0.892805  -0.0247455   0.41138
  2.29981     5.04403    5.70816        5.57213    4.8596      4.23128

[:, :, 3] =
 -1.81398   -4.6521   -3.9772   -4.393    …  -6.14252  -3.78762   -3.88309
  0.799789   1.42591   2.58844   1.34338     -0.40665  -0.144884  -0.743347
  2.29292    4.08841   3.22334   4.36301      3.77468   4.14696    3.22668

[:, :, 4] =
 -1.80937  -1.88705  -0.799678  -3.30885   …  -4.31592   -4.61311  -4.93218
  1.88683   2.37334   0.619965   0.329655      0.318686  -1.68779   0.305698
  3.99001   4.73437   3.95521    4.81532       3.49965    3.10016   5.91518</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00165    1.04714
  0.0068532  1.07205
  4.99018    1.05015</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>.</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.5 seconds
Compute duration  = 2.5 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -5.0138    1.0609    0.0182   3391.8518   4976.6052    1.0004   ⋯
        x[2]    0.0272    1.0415    0.0175   3533.3272   5769.0400    1.0005   ⋯
        x[3]    5.0124    1.0473    0.0177   3497.1278   5627.4500    1.0000   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -7.1316   -5.7143   -4.9955   -4.2931   -2.9586
        x[2]   -2.0071   -0.6503    0.0229    0.7211    2.1177
        x[3]    2.9422    4.3170    5.0165    5.7056    7.0924
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.62 seconds
Compute duration  = 1.62 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.4988    0.1926    0.0027   4966.0409   5948.6007    1.0001   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1419    0.3557    0.5012    0.6445    0.8539
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.22 seconds
Compute duration  = 0.22 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">   ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">    Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.1574    0.0102    0.0001   10000.0008        NaN    1.0000   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1575    0.1575    0.1575    0.1575    0.1575
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.10218318113875524,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:442</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadunsafe!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:889</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:291</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:262</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:244</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:444</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.52 seconds
Compute duration  = 0.52 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.9062    0.6799    0.0501   183.3293    64.5516    1.0021     ⋯
           x    0.0492    1.0408    0.0839   283.2984    65.7092    1.0014     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1056    0.3744    0.7223    1.2934    2.5999
           x   -2.2117   -0.3578    0.0023    0.3877    2.8073
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ReverseDiff.jl</a>:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.8 seconds
Compute duration  = 2.8 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8465    0.6725    0.0663    96.8097    37.0512    1.0068     ⋯
           x   -0.1142    1.0192    0.0934   191.4317    57.9778    1.0046     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.0865    0.2981    0.7004    1.2025    2.6272
           x   -2.7693   -0.3744   -0.0530    0.2997    1.8394
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li><ol type="1">
<li>and (2) makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol></li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>