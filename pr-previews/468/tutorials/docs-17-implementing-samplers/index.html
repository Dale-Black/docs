<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step. To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> NormalLogDensity{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>NormalLogDensity</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">NormalLogDensity</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-33.212338851069816</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-33.212338851069816</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>NormalLogDensity</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <u>should not go in the sampler itself</u>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>We currently have two things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reprodicibility.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers which wants to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_new.x, state_new</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([0.0, 0.0, 0.0], MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -0.657978   -4.03891  -3.83851   -3.65712   …  -5.26653  -4.65015  -5.11523
 -0.0283237  -1.17568   0.420462  -0.623793     -1.2103   -1.40298  -0.870805
  1.36821     3.73269   4.46292    4.35959       7.92134   7.06743   5.67748</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97027   1.04339
 -0.021842  1.04822
  5.00722   1.05777</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip770">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip770)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip771">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip770)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip772">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip770)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1682.59 2640.76,1682.59 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1438.17 2640.76,1438.17 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1193.75 2640.76,1193.75 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,949.335 2640.76,949.335 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,704.918 2640.76,704.918 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,460.5 2640.76,460.5 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,216.083 2640.76,216.083 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1682.59 215.714,1682.59 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1438.17 215.714,1438.17 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1193.75 215.714,1193.75 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,949.335 215.714,949.335 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,704.918 215.714,704.918 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,460.5 215.714,460.5 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,216.083 215.714,216.083 "></polyline>
<path clip-path="url(#clip770)" d="M50.5475 1683.04 L80.2233 1683.04 L80.2233 1686.97 L50.5475 1686.97 L50.5475 1683.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M89.1352 1665.31 L111.357 1665.31 L111.357 1667.3 L98.8111 1699.87 L93.9269 1699.87 L105.732 1669.24 L89.1352 1669.24 L89.1352 1665.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M120.478 1693.99 L125.362 1693.99 L125.362 1699.87 L120.478 1699.87 L120.478 1693.99 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M135.593 1665.31 L153.95 1665.31 L153.95 1669.24 L139.876 1669.24 L139.876 1677.71 Q140.894 1677.37 141.913 1677.21 Q142.931 1677.02 143.95 1677.02 Q149.737 1677.02 153.116 1680.19 Q156.496 1683.36 156.496 1688.78 Q156.496 1694.36 153.024 1697.46 Q149.552 1700.54 143.232 1700.54 Q141.056 1700.54 138.788 1700.17 Q136.542 1699.8 134.135 1699.06 L134.135 1694.36 Q136.218 1695.49 138.441 1696.05 Q140.663 1696.6 143.14 1696.6 Q147.144 1696.6 149.482 1694.5 Q151.82 1692.39 151.82 1688.78 Q151.82 1685.17 149.482 1683.06 Q147.144 1680.96 143.14 1680.96 Q141.265 1680.96 139.39 1681.37 Q137.538 1681.79 135.593 1682.67 L135.593 1665.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M49.5521 1438.62 L79.2279 1438.62 L79.2279 1442.56 L49.5521 1442.56 L49.5521 1438.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M89.3667 1420.89 L107.723 1420.89 L107.723 1424.82 L93.6491 1424.82 L93.6491 1433.3 Q94.6676 1432.95 95.6861 1432.79 Q96.7047 1432.6 97.7232 1432.6 Q103.51 1432.6 106.89 1435.77 Q110.269 1438.95 110.269 1444.36 Q110.269 1449.94 106.797 1453.04 Q103.325 1456.12 97.0056 1456.12 Q94.8297 1456.12 92.5612 1455.75 Q90.3158 1455.38 87.9084 1454.64 L87.9084 1449.94 Q89.9917 1451.07 92.2139 1451.63 Q94.4361 1452.19 96.913 1452.19 Q100.918 1452.19 103.256 1450.08 Q105.593 1447.97 105.593 1444.36 Q105.593 1440.75 103.256 1438.64 Q100.918 1436.54 96.913 1436.54 Q95.038 1436.54 93.163 1436.95 Q91.3112 1437.37 89.3667 1438.25 L89.3667 1420.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M119.482 1449.57 L124.367 1449.57 L124.367 1455.45 L119.482 1455.45 L119.482 1449.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M144.552 1423.97 Q140.941 1423.97 139.112 1427.53 Q137.306 1431.07 137.306 1438.2 Q137.306 1445.31 139.112 1448.88 Q140.941 1452.42 144.552 1452.42 Q148.186 1452.42 149.991 1448.88 Q151.82 1445.31 151.82 1438.2 Q151.82 1431.07 149.991 1427.53 Q148.186 1423.97 144.552 1423.97 M144.552 1420.26 Q150.362 1420.26 153.417 1424.87 Q156.496 1429.45 156.496 1438.2 Q156.496 1446.93 153.417 1451.54 Q150.362 1456.12 144.552 1456.12 Q138.741 1456.12 135.663 1451.54 Q132.607 1446.93 132.607 1438.2 Q132.607 1429.45 135.663 1424.87 Q138.741 1420.26 144.552 1420.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M50.5475 1194.2 L80.2233 1194.2 L80.2233 1198.14 L50.5475 1198.14 L50.5475 1194.2 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M94.3436 1207.1 L110.663 1207.1 L110.663 1211.03 L88.7186 1211.03 L88.7186 1207.1 Q91.3806 1204.34 95.9639 1199.71 Q100.57 1195.06 101.751 1193.72 Q103.996 1191.19 104.876 1189.46 Q105.779 1187.7 105.779 1186.01 Q105.779 1183.25 103.834 1181.52 Q101.913 1179.78 98.8111 1179.78 Q96.6121 1179.78 94.1584 1180.55 Q91.7278 1181.31 88.9501 1182.86 L88.9501 1178.14 Q91.7741 1177 94.2278 1176.43 Q96.6815 1175.85 98.7185 1175.85 Q104.089 1175.85 107.283 1178.53 Q110.478 1181.22 110.478 1185.71 Q110.478 1187.84 109.668 1189.76 Q108.881 1191.66 106.774 1194.25 Q106.195 1194.92 103.094 1198.14 Q99.9917 1201.33 94.3436 1207.1 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M120.478 1205.15 L125.362 1205.15 L125.362 1211.03 L120.478 1211.03 L120.478 1205.15 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M135.593 1176.47 L153.95 1176.47 L153.95 1180.41 L139.876 1180.41 L139.876 1188.88 Q140.894 1188.53 141.913 1188.37 Q142.931 1188.19 143.95 1188.19 Q149.737 1188.19 153.116 1191.36 Q156.496 1194.53 156.496 1199.94 Q156.496 1205.52 153.024 1208.62 Q149.552 1211.7 143.232 1211.7 Q141.056 1211.7 138.788 1211.33 Q136.542 1210.96 134.135 1210.22 L134.135 1205.52 Q136.218 1206.66 138.441 1207.21 Q140.663 1207.77 143.14 1207.77 Q147.144 1207.77 149.482 1205.66 Q151.82 1203.56 151.82 1199.94 Q151.82 1196.33 149.482 1194.23 Q147.144 1192.12 143.14 1192.12 Q141.265 1192.12 139.39 1192.54 Q137.538 1192.95 135.593 1193.83 L135.593 1176.47 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M99.3204 935.134 Q95.7093 935.134 93.8806 938.698 Q92.075 942.24 92.075 949.37 Q92.075 956.476 93.8806 960.041 Q95.7093 963.583 99.3204 963.583 Q102.955 963.583 104.76 960.041 Q106.589 956.476 106.589 949.37 Q106.589 942.24 104.76 938.698 Q102.955 935.134 99.3204 935.134 M99.3204 931.43 Q105.131 931.43 108.186 936.036 Q111.265 940.62 111.265 949.37 Q111.265 958.096 108.186 962.703 Q105.131 967.286 99.3204 967.286 Q93.5102 967.286 90.4315 962.703 Q87.376 958.096 87.376 949.37 Q87.376 940.62 90.4315 936.036 Q93.5102 931.43 99.3204 931.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M119.482 960.735 L124.367 960.735 L124.367 966.615 L119.482 966.615 L119.482 960.735 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M144.552 935.134 Q140.941 935.134 139.112 938.698 Q137.306 942.24 137.306 949.37 Q137.306 956.476 139.112 960.041 Q140.941 963.583 144.552 963.583 Q148.186 963.583 149.991 960.041 Q151.82 956.476 151.82 949.37 Q151.82 942.24 149.991 938.698 Q148.186 935.134 144.552 935.134 M144.552 931.43 Q150.362 931.43 153.417 936.036 Q156.496 940.62 156.496 949.37 Q156.496 958.096 153.417 962.703 Q150.362 967.286 144.552 967.286 Q138.741 967.286 135.663 962.703 Q132.607 958.096 132.607 949.37 Q132.607 940.62 135.663 936.036 Q138.741 931.43 144.552 931.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M94.3436 718.262 L110.663 718.262 L110.663 722.198 L88.7186 722.198 L88.7186 718.262 Q91.3806 715.508 95.9639 710.878 Q100.57 706.225 101.751 704.883 Q103.996 702.36 104.876 700.624 Q105.779 698.864 105.779 697.174 Q105.779 694.42 103.834 692.684 Q101.913 690.948 98.8111 690.948 Q96.6121 690.948 94.1584 691.712 Q91.7278 692.475 88.9501 694.026 L88.9501 689.304 Q91.7741 688.17 94.2278 687.591 Q96.6815 687.013 98.7185 687.013 Q104.089 687.013 107.283 689.698 Q110.478 692.383 110.478 696.874 Q110.478 699.003 109.668 700.924 Q108.881 702.823 106.774 705.415 Q106.195 706.086 103.094 709.304 Q99.9917 712.498 94.3436 718.262 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M120.478 716.318 L125.362 716.318 L125.362 722.198 L120.478 722.198 L120.478 716.318 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M135.593 687.638 L153.95 687.638 L153.95 691.573 L139.876 691.573 L139.876 700.045 Q140.894 699.698 141.913 699.536 Q142.931 699.35 143.95 699.35 Q149.737 699.35 153.116 702.522 Q156.496 705.693 156.496 711.11 Q156.496 716.688 153.024 719.79 Q149.552 722.869 143.232 722.869 Q141.056 722.869 138.788 722.498 Q136.542 722.128 134.135 721.387 L134.135 716.688 Q136.218 717.823 138.441 718.378 Q140.663 718.934 143.14 718.934 Q147.144 718.934 149.482 716.827 Q151.82 714.721 151.82 711.11 Q151.82 707.499 149.482 705.392 Q147.144 703.286 143.14 703.286 Q141.265 703.286 139.39 703.702 Q137.538 704.119 135.593 704.999 L135.593 687.638 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M89.3667 443.22 L107.723 443.22 L107.723 447.155 L93.6491 447.155 L93.6491 455.627 Q94.6676 455.28 95.6861 455.118 Q96.7047 454.933 97.7232 454.933 Q103.51 454.933 106.89 458.104 Q110.269 461.276 110.269 466.692 Q110.269 472.271 106.797 475.373 Q103.325 478.451 97.0056 478.451 Q94.8297 478.451 92.5612 478.081 Q90.3158 477.711 87.9084 476.97 L87.9084 472.271 Q89.9917 473.405 92.2139 473.961 Q94.4361 474.516 96.913 474.516 Q100.918 474.516 103.256 472.41 Q105.593 470.303 105.593 466.692 Q105.593 463.081 103.256 460.975 Q100.918 458.868 96.913 458.868 Q95.038 458.868 93.163 459.285 Q91.3112 459.701 89.3667 460.581 L89.3667 443.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M119.482 471.9 L124.367 471.9 L124.367 477.78 L119.482 477.78 L119.482 471.9 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M144.552 446.299 Q140.941 446.299 139.112 449.864 Q137.306 453.405 137.306 460.535 Q137.306 467.641 139.112 471.206 Q140.941 474.748 144.552 474.748 Q148.186 474.748 149.991 471.206 Q151.82 467.641 151.82 460.535 Q151.82 453.405 149.991 449.864 Q148.186 446.299 144.552 446.299 M144.552 442.595 Q150.362 442.595 153.417 447.202 Q156.496 451.785 156.496 460.535 Q156.496 469.262 153.417 473.868 Q150.362 478.451 144.552 478.451 Q138.741 478.451 135.663 473.868 Q132.607 469.262 132.607 460.535 Q132.607 451.785 135.663 447.202 Q138.741 442.595 144.552 442.595 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M89.1352 198.803 L111.357 198.803 L111.357 200.793 L98.8111 233.363 L93.9269 233.363 L105.732 202.738 L89.1352 202.738 L89.1352 198.803 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M120.478 227.483 L125.362 227.483 L125.362 233.363 L120.478 233.363 L120.478 227.483 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M135.593 198.803 L153.95 198.803 L153.95 202.738 L139.876 202.738 L139.876 211.21 Q140.894 210.863 141.913 210.701 Q142.931 210.516 143.95 210.516 Q149.737 210.516 153.116 213.687 Q156.496 216.858 156.496 222.275 Q156.496 227.853 153.024 230.955 Q149.552 234.034 143.232 234.034 Q141.056 234.034 138.788 233.664 Q136.542 233.293 134.135 232.552 L134.135 227.853 Q136.218 228.988 138.441 229.543 Q140.663 230.099 143.14 230.099 Q147.144 230.099 149.482 227.992 Q151.82 225.886 151.82 222.275 Q151.82 218.664 149.482 216.557 Q147.144 214.451 143.14 214.451 Q141.265 214.451 139.39 214.867 Q137.538 215.284 135.593 216.164 L135.593 198.803 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip772)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1013.66 268.292,1668.93 270.6,1465.22 272.908,1347.94 275.216,1470.27 277.524,1382.42 279.832,1543.14 282.139,1280 284.447,1377.71 286.755,1456.19 289.063,1507.19 291.371,1433.02 293.679,1539.32 295.987,1409.55 298.295,1364.37 300.603,1357.11 302.911,1474.2 305.219,1565.25 307.527,1450.17 309.834,1350.64 312.142,1411.18 314.45,1530.92 316.758,1452.65 319.066,1633.65 321.374,1748.53 323.682,1359.52 325.99,1457.78 328.298,1525.89 330.606,1456.28 332.914,1547.87 335.221,1385.74 337.529,1415.38 339.837,1490.6 342.145,1374.24 344.453,1138.35 346.761,1334.41 349.069,1296.15 351.377,1256.75 353.685,1609.01 355.993,1418.74 358.301,1347.69 360.608,1311.28 362.916,1266.48 365.224,1453.17 367.532,1486.06 369.84,1437.99 372.148,1548.26 374.456,1420 376.764,1559.81 379.072,1501.1 381.38,1621.36 383.688,1333.15 385.996,1457.33 388.303,1489.24 390.611,1331.37 392.919,1256.62 395.227,1266.28 397.535,1301.7 399.843,1435.78 402.151,1430.43 404.459,1329.29 406.767,1482.1 409.075,1273.11 411.383,1556.7 413.69,1291.34 415.998,1564.7 418.306,1441.75 420.614,1362.81 422.922,1365.92 425.23,1546.99 427.538,1305.33 429.846,1332.02 432.154,1241.41 434.462,1311.31 436.77,1513.96 439.077,1623.44 441.385,1274.77 443.693,1446.21 446.001,1455.5 448.309,1454.48 450.617,1580.15 452.925,1411.11 455.233,1367.13 457.541,1466.63 459.849,1368.43 462.157,1392 464.465,1528.82 466.772,1344.61 469.08,1622.83 471.388,1421.93 473.696,1338.22 476.004,1268.86 478.312,1344.19 480.62,1315.65 482.928,1349.51 485.236,1174.63 487.544,1431.26 489.852,1342.13 492.159,1360.22 494.467,1434.94 496.775,1375.79 499.083,1276.25 501.391,1648.07 503.699,1415.69 506.007,1323.59 508.315,1309.3 510.623,1602.48 512.931,1655.88 515.239,1627.81 517.546,1437.23 519.854,1487.8 522.162,1420.98 524.47,1595.71 526.778,1381.49 529.086,1494.84 531.394,1523.94 533.702,1443.16 536.01,1450.84 538.318,1399.53 540.626,1608.51 542.933,1401.59 545.241,1406.89 547.549,1552.64 549.857,1461.38 552.165,1552.97 554.473,1317.98 556.781,1477.83 559.089,1371.47 561.397,1515.07 563.705,1545.99 566.013,1491.55 568.321,1446.54 570.628,1562.22 572.936,1236.08 575.244,1614.79 577.552,1409.96 579.86,1306.41 582.168,1495.97 584.476,1395.66 586.784,1422.07 589.092,1639.86 591.4,1343.62 593.708,1413.15 596.015,1398.87 598.323,1496.78 600.631,1386.75 602.939,1414.46 605.247,1377.16 607.555,1432.12 609.863,1613.55 612.171,1402.52 614.479,1494.97 616.787,1633.83 619.095,1580.23 621.402,1141.59 623.71,1569.32 626.018,1470.65 628.326,1438.74 630.634,1511.79 632.942,1230.75 635.25,1382.87 637.558,1633.47 639.866,1396.55 642.174,1429.7 644.482,1300.89 646.79,1474.6 649.097,1447.17 651.405,1604.96 653.713,1738.31 656.021,1275.07 658.329,1296.41 660.637,1375.65 662.945,1574.26 665.253,1495.25 667.561,1356 669.869,1451.6 672.177,1433.99 674.484,1288 676.792,1480.9 679.1,1249.06 681.408,1399.45 683.716,1407.99 686.024,1492.7 688.332,1338.54 690.64,1605.7 692.948,1453.18 695.256,1354.2 697.564,1560.41 699.871,1373.73 702.179,1338.74 704.487,1517.9 706.795,1326.98 709.103,1436.53 711.411,1627.72 713.719,1431.98 716.027,1343.96 718.335,1547.35 720.643,1353.11 722.951,1417.71 725.259,1580.7 727.566,1546.04 729.874,1449 732.182,1461.3 734.49,1250.81 736.798,1612.21 739.106,1398.44 741.414,1386.7 743.722,1526.65 746.03,1531.8 748.338,1517.21 750.646,1340.55 752.953,1395.85 755.261,1439.47 757.569,1370.74 759.877,1350.58 762.185,1390.35 764.493,1395.08 766.801,1316.51 769.109,1503.94 771.417,1483.79 773.725,1514.91 776.033,1567.79 778.34,1508.71 780.648,1409.4 782.956,1586 785.264,1452.05 787.572,1385.56 789.88,1511.25 792.188,1379.09 794.496,1426.82 796.804,1430.48 799.112,1528.84 801.42,1447.7 803.728,1252.19 806.035,1542.98 808.343,1444.22 810.651,1446.99 812.959,1473.45 815.267,1309.31 817.575,1503.82 819.883,1522.06 822.191,1505.1 824.499,1544.98 826.807,1356.15 829.115,1623.41 831.422,1472.02 833.73,1417.86 836.038,1419.16 838.346,1414.88 840.654,1571.78 842.962,1234.22 845.27,1454.49 847.578,1620.74 849.886,1405.18 852.194,1202.54 854.502,1482.46 856.809,1368.1 859.117,1417.55 861.425,1424.04 863.733,1587.69 866.041,1479.56 868.349,1627.06 870.657,1518.53 872.965,1412.08 875.273,1579.56 877.581,1469.23 879.889,1455.04 882.197,1358.75 884.504,1324.78 886.812,1484.99 889.12,1476.59 891.428,1360.27 893.736,1355.72 896.044,1479.47 898.352,1332.38 900.66,1392.38 902.968,1412.09 905.276,1204.73 907.584,1543.4 909.891,1494.31 912.199,1333.56 914.507,1309.9 916.815,1599.64 919.123,1616.31 921.431,1382.67 923.739,1512.13 926.047,1399.22 928.355,1446.21 930.663,1288.79 932.971,1414.25 935.278,1596.65 937.586,1415.12 939.894,1551.92 942.202,1438.28 944.51,1327.86 946.818,1335.02 949.126,1444.37 951.434,1358.31 953.742,1367.74 956.05,1514.96 958.358,1544.85 960.665,1402.71 962.973,1346.38 965.281,1328.07 967.589,1291.94 969.897,1418.56 972.205,1420.07 974.513,1375.14 976.821,1498.39 979.129,1443.62 981.437,1505.43 983.745,1420.31 986.053,1497.34 988.36,1579.59 990.668,1432.04 992.976,1325.81 995.284,1328.55 997.592,1461.6 999.9,1300.37 1002.21,1493.4 1004.52,1332.3 1006.82,1501.96 1009.13,1348.85 1011.44,1450.68 1013.75,1408.88 1016.06,1314.08 1018.36,1503.95 1020.67,1463.11 1022.98,1475.59 1025.29,1453.96 1027.59,1566.12 1029.9,1542.29 1032.21,1470.72 1034.52,1549.16 1036.83,1597.72 1039.13,1423.97 1041.44,1449.91 1043.75,1529.31 1046.06,1408.43 1048.37,1326.21 1050.67,1376.99 1052.98,1537.92 1055.29,1497.58 1057.6,1205.52 1059.91,1455.63 1062.21,1409.2 1064.52,1445.39 1066.83,1245.36 1069.14,1496.95 1071.45,1641.63 1073.75,1427.61 1076.06,1502.35 1078.37,1365.88 1080.68,1392.44 1082.98,1333.55 1085.29,1390.63 1087.6,1296.98 1089.91,1155.73 1092.22,1474.88 1094.52,1404.01 1096.83,1305.43 1099.14,1442.68 1101.45,1317.22 1103.76,1454.14 1106.06,1307.39 1108.37,1549.66 1110.68,1587.63 1112.99,1278.24 1115.3,1451.23 1117.6,1429.25 1119.91,1660.31 1122.22,1515 1124.53,1615.7 1126.84,1508.66 1129.14,1234.55 1131.45,1527.59 1133.76,1417.15 1136.07,1423.61 1138.37,1371.15 1140.68,1423.86 1142.99,1373.88 1145.3,1385.88 1147.61,1357.51 1149.91,1530.28 1152.22,1437.03 1154.53,1527.7 1156.84,1410.67 1159.15,1370.45 1161.45,1443.82 1163.76,1408.33 1166.07,1326.68 1168.38,1490.91 1170.69,1434.77 1172.99,1533.32 1175.3,1507.87 1177.61,1472.09 1179.92,1225.78 1182.23,1205.41 1184.53,1488.91 1186.84,1359.14 1189.15,1413.59 1191.46,1458.43 1193.76,1424.17 1196.07,1410.06 1198.38,1592.1 1200.69,1396.89 1203,1661.81 1205.3,1334.4 1207.61,1352.51 1209.92,1510.99 1212.23,1344.29 1214.54,1404.56 1216.84,1384.09 1219.15,1337.42 1221.46,1344.11 1223.77,1456.63 1226.08,1304.8 1228.38,1306.35 1230.69,1377.15 1233,1309.97 1235.31,1524.41 1237.61,1311.88 1239.92,1391.14 1242.23,1327.24 1244.54,1417.04 1246.85,1446.84 1249.15,1387.85 1251.46,1588.36 1253.77,1356.34 1256.08,1454.46 1258.39,1368.04 1260.69,1520.58 1263,1549.6 1265.31,1510.64 1267.62,1402.09 1269.93,1514.57 1272.23,1603.99 1274.54,1399.3 1276.85,1297.26 1279.16,1616.96 1281.47,1548.21 1283.77,1437.52 1286.08,1538.9 1288.39,1440.75 1290.7,1481.52 1293,1391.51 1295.31,1352.43 1297.62,1378.24 1299.93,1437.58 1302.24,1485.59 1304.54,1397.27 1306.85,1398.19 1309.16,1379.85 1311.47,1517.04 1313.78,1447.97 1316.08,1245.26 1318.39,1426.32 1320.7,1630.5 1323.01,1359.21 1325.32,1566.33 1327.62,1364.13 1329.93,1357.82 1332.24,1434.31 1334.55,1155.56 1336.86,1715.33 1339.16,1447.84 1341.47,1376.44 1343.78,1329.9 1346.09,1454.1 1348.39,1524.15 1350.7,1478.16 1353.01,1350.29 1355.32,1335.24 1357.63,1488.13 1359.93,1405.95 1362.24,1337.15 1364.55,1718.25 1366.86,1390.8 1369.17,1444.35 1371.47,1359.63 1373.78,1346.19 1376.09,1444.1 1378.4,1240.85 1380.71,1532.7 1383.01,1390.14 1385.32,1253.35 1387.63,1342.65 1389.94,1454.21 1392.24,1549.37 1394.55,1578.58 1396.86,1516.49 1399.17,1363.42 1401.48,1510.42 1403.78,1482.43 1406.09,1331.23 1408.4,1461.82 1410.71,1401.22 1413.02,1344.45 1415.32,1477.63 1417.63,1415.8 1419.94,1160.66 1422.25,1444.61 1424.56,1291.74 1426.86,1318.46 1429.17,1386.26 1431.48,1458.12 1433.79,1522.55 1436.1,1639.79 1438.4,1343.22 1440.71,1465.87 1443.02,1299.85 1445.33,1357.73 1447.63,1435.1 1449.94,1453.14 1452.25,1231.64 1454.56,1395.88 1456.87,1409.83 1459.17,1446.09 1461.48,1545.18 1463.79,1338.27 1466.1,1488.46 1468.41,1493.12 1470.71,1561.56 1473.02,1315.45 1475.33,1586.87 1477.64,1467.62 1479.95,1460.81 1482.25,1430.15 1484.56,1508.74 1486.87,1410.39 1489.18,1424.27 1491.49,1385.4 1493.79,1587.75 1496.1,1378.48 1498.41,1419.9 1500.72,1359.15 1503.02,1259.62 1505.33,1417.67 1507.64,1480.68 1509.95,1357.5 1512.26,1268.43 1514.56,1398.08 1516.87,1342.55 1519.18,1429.86 1521.49,1459.94 1523.8,1416.98 1526.1,1495.46 1528.41,1516.74 1530.72,1364.11 1533.03,1454.34 1535.34,1434.83 1537.64,1423.84 1539.95,1662.19 1542.26,1238.73 1544.57,1407.68 1546.88,1426.77 1549.18,1245.49 1551.49,1362.59 1553.8,1583.45 1556.11,1428.03 1558.41,1575.36 1560.72,1298.04 1563.03,1408.58 1565.34,1529.94 1567.65,1557.91 1569.95,1354.4 1572.26,1417.66 1574.57,1451.17 1576.88,1315.98 1579.19,1500.13 1581.49,1437.43 1583.8,1631.06 1586.11,1317.68 1588.42,1304.55 1590.73,1460.53 1593.03,1542.71 1595.34,1272.51 1597.65,1308.73 1599.96,1518.41 1602.26,1482.94 1604.57,1414.05 1606.88,1471.13 1609.19,1313.54 1611.5,1449.99 1613.8,1306.35 1616.11,1529.76 1618.42,1392.93 1620.73,1506.75 1623.04,1481.52 1625.34,1361.38 1627.65,1517.96 1629.96,1402.3 1632.27,1431.49 1634.58,1365.05 1636.88,1393.72 1639.19,1431.47 1641.5,1484.69 1643.81,1676.65 1646.12,1645.63 1648.42,1463.76 1650.73,1460.61 1653.04,1258.83 1655.35,1528.46 1657.65,1613.68 1659.96,1596.15 1662.27,1442.5 1664.58,1460.92 1666.89,1470.39 1669.19,1529.27 1671.5,1478.1 1673.81,1319.7 1676.12,1380.87 1678.43,1393.43 1680.73,1580.78 1683.04,1534.82 1685.35,1317.19 1687.66,1459.35 1689.97,1448.6 1692.27,1237.17 1694.58,1345.54 1696.89,1447.94 1699.2,1544.06 1701.51,1453.32 1703.81,1322.31 1706.12,1409.11 1708.43,1457.81 1710.74,1500.13 1713.04,1448.02 1715.35,1396.83 1717.66,1502.91 1719.97,1292.62 1722.28,1371.95 1724.58,1261.85 1726.89,1364.56 1729.2,1619.52 1731.51,1400.18 1733.82,1504.41 1736.12,1282.82 1738.43,1377 1740.74,1530.96 1743.05,1342.63 1745.36,1520.8 1747.66,1343.44 1749.97,1475.93 1752.28,1425.37 1754.59,1367.94 1756.9,1459.22 1759.2,1340.45 1761.51,1458.44 1763.82,1343.07 1766.13,1381.3 1768.43,1535.95 1770.74,1529.2 1773.05,1478.17 1775.36,1591.8 1777.67,1410.25 1779.97,1511.63 1782.28,1469 1784.59,1400.33 1786.9,1529.87 1789.21,1405.5 1791.51,1306.35 1793.82,1495.63 1796.13,1392.75 1798.44,1499.52 1800.75,1326.68 1803.05,1371.06 1805.36,1295.26 1807.67,1373.58 1809.98,1319.37 1812.28,1534.45 1814.59,1315.97 1816.9,1194.28 1819.21,1369.36 1821.52,1663.15 1823.82,1521.29 1826.13,1614.65 1828.44,1464.52 1830.75,1537.3 1833.06,1500.29 1835.36,1518.83 1837.67,1520.11 1839.98,1317.34 1842.29,1387.96 1844.6,1402.31 1846.9,1466.99 1849.21,1303.95 1851.52,1470.54 1853.83,1532.43 1856.14,1300.57 1858.44,1547.95 1860.75,1382.33 1863.06,1257.06 1865.37,1322.16 1867.67,1197.06 1869.98,1593.53 1872.29,1470.6 1874.6,1436.23 1876.91,1436.77 1879.21,1327.45 1881.52,1374.33 1883.83,1410.93 1886.14,1513.12 1888.45,1446.63 1890.75,1141.14 1893.06,1486.91 1895.37,1490.33 1897.68,1414.62 1899.99,1549.75 1902.29,1446.86 1904.6,1301.22 1906.91,1538.77 1909.22,1361.33 1911.53,1527.67 1913.83,1458.91 1916.14,1339.15 1918.45,1491.05 1920.76,1382.45 1923.06,1223.33 1925.37,1640.29 1927.68,1559.89 1929.99,1420.3 1932.3,1371.83 1934.6,1641.16 1936.91,1430.92 1939.22,1482.17 1941.53,1446.54 1943.84,1481.15 1946.14,1220.23 1948.45,1523.21 1950.76,1411.67 1953.07,1528.67 1955.38,1307.58 1957.68,1406.66 1959.99,1334.94 1962.3,1449.74 1964.61,1265.77 1966.91,1377.66 1969.22,1488.67 1971.53,1492.56 1973.84,1654.19 1976.15,1438.2 1978.45,1362.77 1980.76,1447.27 1983.07,1614.65 1985.38,1346.21 1987.69,1487.11 1989.99,1648.49 1992.3,1361.5 1994.61,1475.47 1996.92,1262.61 1999.23,1484.93 2001.53,1485.63 2003.84,1307.71 2006.15,1253.48 2008.46,1352.88 2010.77,1336.8 2013.07,1578.49 2015.38,1328.68 2017.69,1487.04 2020,1328.98 2022.3,1371.28 2024.61,1599.3 2026.92,1466.32 2029.23,1373.89 2031.54,1504.3 2033.84,1450.55 2036.15,1205.86 2038.46,1274.82 2040.77,1312.34 2043.08,1505.75 2045.38,1319.45 2047.69,1543.45 2050,1521.19 2052.31,1527.48 2054.62,1516.84 2056.92,1436.05 2059.23,1498.32 2061.54,1405.66 2063.85,1423.9 2066.16,1434.87 2068.46,1507.82 2070.77,1311.73 2073.08,1440.64 2075.39,1418.46 2077.69,1418.82 2080,1567.92 2082.31,1524.64 2084.62,1265.37 2086.93,1214.41 2089.23,1390.73 2091.54,1532.06 2093.85,1299.81 2096.16,1334.31 2098.47,1399.41 2100.77,1484.93 2103.08,1499.57 2105.39,1368.35 2107.7,1454.93 2110.01,1312.49 2112.31,1398.09 2114.62,1391.97 2116.93,1303.3 2119.24,1368.28 2121.55,1459.19 2123.85,1361.7 2126.16,1493.49 2128.47,1401.08 2130.78,1433.63 2133.08,1442.06 2135.39,1444.85 2137.7,1355.66 2140.01,1512.33 2142.32,1334.28 2144.62,1285.32 2146.93,1413.17 2149.24,1340.57 2151.55,1437.95 2153.86,1375.29 2156.16,1584.01 2158.47,1442.47 2160.78,1688.91 2163.09,1391.11 2165.4,1487.61 2167.7,1543.51 2170.01,1483.74 2172.32,1461.24 2174.63,1305.65 2176.93,1179.81 2179.24,1485.82 2181.55,1487.21 2183.86,1500.65 2186.17,1462.72 2188.47,1486.52 2190.78,1308.64 2193.09,1429.75 2195.4,1445.55 2197.71,1508.74 2200.01,1368.48 2202.32,1446.44 2204.63,1483.05 2206.94,1271.75 2209.25,1536.47 2211.55,1391.27 2213.86,1495.99 2216.17,1288.13 2218.48,1436 2220.79,1449.54 2223.09,1458.9 2225.4,1390.95 2227.71,1523.6 2230.02,1421.72 2232.32,1257.42 2234.63,1371.46 2236.94,1346.56 2239.25,1583.5 2241.56,1531.74 2243.86,1386.01 2246.17,1483.57 2248.48,1504.99 2250.79,1341.54 2253.1,1352.47 2255.4,1375.27 2257.71,1523.03 2260.02,1412.62 2262.33,1506.77 2264.64,1318.38 2266.94,1362.09 2269.25,1401.32 2271.56,1408.31 2273.87,1534.21 2276.18,1517.98 2278.48,1480.63 2280.79,1492.03 2283.1,1257.82 2285.41,1492.36 2287.71,1580.5 2290.02,1543.01 2292.33,1359.48 2294.64,1421.69 2296.95,1645.68 2299.25,1666.85 2301.56,1428.46 2303.87,1468.77 2306.18,1423.07 2308.49,1457.52 2310.79,1751.15 2313.1,1440.09 2315.41,1551.13 2317.72,1573.56 2320.03,1409.89 2322.33,1360.97 2324.64,1321.27 2326.95,1615.11 2329.26,1348.71 2331.56,1653.97 2333.87,1489.92 2336.18,1501.08 2338.49,1510.78 2340.8,1114.9 2343.1,1253.04 2345.41,1613.06 2347.72,1332.77 2350.03,1454.8 2352.34,1537.59 2354.64,1353.84 2356.95,1266.48 2359.26,1511.04 2361.57,1342.65 2363.88,1422.08 2366.18,1383.51 2368.49,1492.18 2370.8,1395.34 2373.11,1503.72 2375.42,1429.25 2377.72,1361.04 2380.03,1631.96 2382.34,1461.01 2384.65,1303.94 2386.95,1474.55 2389.26,1370.57 2391.57,1534.72 2393.88,1471.8 2396.19,1246.76 2398.49,1590.45 2400.8,1388.52 2403.11,1509.66 2405.42,1423.48 2407.73,1458.14 2410.03,1556.32 2412.34,1289.33 2414.65,1391.37 2416.96,1249.78 2419.27,1500.23 2421.57,1414.39 2423.88,1415.38 2426.19,1398.03 2428.5,1558.48 2430.81,1408.58 2433.11,1340.58 2435.42,1430.8 2437.73,1383.04 2440.04,1323.01 2442.34,1467.45 2444.65,1507.87 2446.96,1469.07 2449.27,1455.29 2451.58,1168.1 2453.88,1539.94 2456.19,1308.17 2458.5,1369.35 2460.81,1428.54 2463.12,1363.05 2465.42,1423.73 2467.73,1561.37 2470.04,1485.03 2472.35,1431.38 2474.66,1417.51 2476.96,1606.45 2479.27,1334.04 2481.58,1523.58 2483.89,1362.53 2486.2,1357.36 2488.5,1448.29 2490.81,1355.15 2493.12,1378 2495.43,1419.16 2497.73,1466.68 2500.04,1469.46 2502.35,1361.05 2504.66,1437.62 2506.97,1409.86 2509.27,1479.75 2511.58,1280.15 2513.89,1538.58 2516.2,1520.66 2518.51,1364.24 2520.81,1583.97 2523.12,1300.46 2525.43,1602.49 2527.74,1541.73 2530.05,1553.7 2532.35,1485.49 2534.66,1471.42 2536.97,1494.48 2539.28,1287.4 2541.58,1509.15 2543.89,1348.49 2546.2,1462.01 2548.51,1423.25 2550.82,1312.41 2553.12,1388.47 2555.43,1447.02 2557.74,1732.36 2560.05,1542.21 2562.36,1420.66 2564.66,1462.19 2566.97,1373.88 2569.28,1509.2 2571.59,1475.44 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,952.104 268.292,867.803 270.6,1061.57 272.908,962.368 275.216,929.211 277.524,1014.84 279.832,926.841 282.139,988.573 284.447,1008.64 286.755,827.932 289.063,1031.83 291.371,842.336 293.679,899.882 295.987,1102.78 298.295,927.362 300.603,1090.19 302.911,933.825 305.219,1114.32 307.527,1015.19 309.834,882.211 312.142,944.138 314.45,943.59 316.758,775.173 319.066,1155.92 321.374,991.896 323.682,896.684 325.99,1003.13 328.298,1005.27 330.606,1243.28 332.914,913.559 335.221,805.453 337.529,1058.6 339.837,948.557 342.145,944.375 344.453,1109.84 346.761,769.548 349.069,733.126 351.377,1187.63 353.685,940.603 355.993,1135.41 358.301,1060.95 360.608,796.527 362.916,998.312 365.224,1098.05 367.532,1039.85 369.84,905.652 372.148,782.498 374.456,935.894 376.764,972.973 379.072,945.175 381.38,942.081 383.688,949.372 385.996,852.001 388.303,907.113 390.611,1008.75 392.919,1118.74 395.227,892.357 397.535,1082.49 399.843,926.613 402.151,882.416 404.459,1106.51 406.767,966.037 409.075,1085.62 411.383,1100.45 413.69,1043.94 415.998,1029.09 418.306,948.277 420.614,1042.51 422.922,761.957 425.23,994.872 427.538,1037.52 429.846,956.311 432.154,1028.71 434.462,1069.55 436.77,884.955 439.077,810.904 441.385,925.515 443.693,1054.04 446.001,930.85 448.309,948.263 450.617,1157.57 452.925,913.118 455.233,843.239 457.541,917.842 459.849,968.678 462.157,854.593 464.465,855.706 466.772,811.6 469.08,813.733 471.388,823.101 473.696,956.639 476.004,861.592 478.312,975.883 480.62,1112.71 482.928,1115.22 485.236,965.865 487.544,908.841 489.852,923.876 492.159,1076.26 494.467,929.916 496.775,1043.72 499.083,965.837 501.391,1072.34 503.699,863.719 506.007,830.893 508.315,824.581 510.623,992.22 512.931,801.755 515.239,986.715 517.546,1000.13 519.854,851.592 522.162,917.331 524.47,886.127 526.778,996.843 529.086,1110.65 531.394,816.272 533.702,1083.38 536.01,902.59 538.318,890.176 540.626,836.602 542.933,751.788 545.241,1055.7 547.549,884.127 549.857,962.685 552.165,835.904 554.473,1089.22 556.781,875.332 559.089,955.107 561.397,929.608 563.705,966.677 566.013,949.393 568.321,1066.68 570.628,1036.45 572.936,1089.03 575.244,956.63 577.552,1095.22 579.86,1039.45 582.168,1080.05 584.476,998.399 586.784,883.047 589.092,972.982 591.4,977.481 593.708,1026.23 596.015,801.506 598.323,950.336 600.631,954.17 602.939,887.692 605.247,973.839 607.555,985.988 609.863,833.237 612.171,948.53 614.479,650.752 616.787,966.991 619.095,967.411 621.402,955.533 623.71,858.793 626.018,721.325 628.326,1014.77 630.634,1018.64 632.942,881.754 635.25,942.068 637.558,870.316 639.866,998.55 642.174,952.617 644.482,1042.53 646.79,852.89 649.097,1174.83 651.405,895.649 653.713,822.689 656.021,846.364 658.329,763.609 660.637,943.09 662.945,1124.23 665.253,886.584 667.561,929.064 669.869,883.196 672.177,1001.19 674.484,1024.78 676.792,765.514 679.1,1178.61 681.408,984.899 683.716,926.014 686.024,1000.39 688.332,856.519 690.64,1018.96 692.948,852.735 695.256,973.666 697.564,919.774 699.871,869.743 702.179,881.251 704.487,1072.01 706.795,1054.47 709.103,933.533 711.411,967.692 713.719,1007.19 716.027,984.305 718.335,1024.88 720.643,1107.02 722.951,863.244 725.259,800.889 727.566,1281 729.874,888.843 732.182,935.67 734.49,852.294 736.798,1132.21 739.106,920.025 741.414,1007.55 743.722,903.006 746.03,1033.82 748.338,1189.08 750.646,940.045 752.953,947.381 755.261,1132.17 757.569,1034.63 759.877,748.906 762.185,1025.99 764.493,889.263 766.801,1006.55 769.109,900.27 771.417,962.628 773.725,800.679 776.033,1047.21 778.34,913.71 780.648,1041.17 782.956,984.691 785.264,964.348 787.572,888.638 789.88,1116.64 792.188,891.589 794.496,939.586 796.804,991.556 799.112,945.715 801.42,800.742 803.728,1134.29 806.035,1134.28 808.343,931.548 810.651,1042.3 812.959,965.049 815.267,1066.88 817.575,763.975 819.883,970.274 822.191,1057.46 824.499,1002.44 826.807,841.743 829.115,1038.69 831.422,1008.42 833.73,932.814 836.038,938.95 838.346,935.054 840.654,924.584 842.962,871.013 845.27,966.827 847.578,1023.78 849.886,1112.95 852.194,747.798 854.502,989.917 856.809,845.187 859.117,1031.32 861.425,944.706 863.733,963.937 866.041,847.218 868.349,1059.29 870.657,979.813 872.965,936.763 875.273,1028.71 877.581,838.674 879.889,811.068 882.197,1001.93 884.504,951.724 886.812,828.212 889.12,932.879 891.428,1047 893.736,986.915 896.044,990.667 898.352,658.057 900.66,848.816 902.968,1011.18 905.276,1089.36 907.584,885.387 909.891,1185.9 912.199,943.445 914.507,848.563 916.815,917.484 919.123,855.91 921.431,684.856 923.739,711.503 926.047,1017.48 928.355,938.503 930.663,941.586 932.971,999.742 935.278,1044.74 937.586,943.463 939.894,919.277 942.202,935.922 944.51,976.036 946.818,956.242 949.126,1042.64 951.434,873.687 953.742,942.787 956.05,1073.33 958.358,832.237 960.665,808.106 962.973,923.185 965.281,983.853 967.589,1102.99 969.897,1097.52 972.205,823.859 974.513,1049.6 976.821,917.976 979.129,957.798 981.437,810.002 983.745,899.047 986.053,927.091 988.36,815.622 990.668,856.503 992.976,891.554 995.284,916.251 997.592,822.731 999.9,966.315 1002.21,824.35 1004.52,875.489 1006.82,1061.92 1009.13,992.841 1011.44,941.28 1013.75,1145.93 1016.06,1014.62 1018.36,920.163 1020.67,759.824 1022.98,976.543 1025.29,894.908 1027.59,1067.94 1029.9,1016.44 1032.21,1046.7 1034.52,862.483 1036.83,1056.66 1039.13,1051.41 1041.44,973.604 1043.75,977.075 1046.06,929.09 1048.37,947.631 1050.67,1041.96 1052.98,891.013 1055.29,936.713 1057.6,890.767 1059.91,973.59 1062.21,897.278 1064.52,810.234 1066.83,938.447 1069.14,919.125 1071.45,1008.24 1073.75,959.181 1076.06,905.283 1078.37,852.531 1080.68,895.143 1082.98,926.328 1085.29,954.587 1087.6,766.903 1089.91,1053.21 1092.22,964.246 1094.52,996.866 1096.83,849.967 1099.14,912.104 1101.45,937.197 1103.76,870.57 1106.06,871.256 1108.37,931.531 1110.68,1111.6 1112.99,825.457 1115.3,957.714 1117.6,989.316 1119.91,848.932 1122.22,857.099 1124.53,1043.79 1126.84,1157.31 1129.14,822.112 1131.45,804.671 1133.76,1022.45 1136.07,958.801 1138.37,821.248 1140.68,771.128 1142.99,844.593 1145.3,951.556 1147.61,966.924 1149.91,779.574 1152.22,1048.7 1154.53,998.85 1156.84,935.928 1159.15,1093.58 1161.45,881.027 1163.76,952.856 1166.07,882.631 1168.38,953.188 1170.69,946.569 1172.99,969.307 1175.3,1089.01 1177.61,860.342 1179.92,891.189 1182.23,885.709 1184.53,1141.13 1186.84,880.396 1189.15,940.902 1191.46,920.779 1193.76,788.421 1196.07,948.832 1198.38,861.288 1200.69,736.984 1203,1138.72 1205.3,971.846 1207.61,897.682 1209.92,932.768 1212.23,1019.32 1214.54,806.016 1216.84,1001.67 1219.15,1047.99 1221.46,1035.59 1223.77,1187.42 1226.08,1148.71 1228.38,770.864 1230.69,1116.67 1233,992.81 1235.31,813.686 1237.61,838.169 1239.92,1060.66 1242.23,854.137 1244.54,808.148 1246.85,913.214 1249.15,1066.46 1251.46,1010.8 1253.77,950.103 1256.08,881.508 1258.39,788.612 1260.69,929.809 1263,939.394 1265.31,965.177 1267.62,996.016 1269.93,811.102 1272.23,941.214 1274.54,881.89 1276.85,921.201 1279.16,1000.37 1281.47,1062.25 1283.77,929.468 1286.08,968.018 1288.39,819.601 1290.7,919.913 1293,933.194 1295.31,856.854 1297.62,908.349 1299.93,814.321 1302.24,991.775 1304.54,853.398 1306.85,862.404 1309.16,962.267 1311.47,1038.78 1313.78,955.597 1316.08,1091.49 1318.39,866.563 1320.7,939.639 1323.01,870.222 1325.32,958.503 1327.62,871.277 1329.93,865.083 1332.24,1148.97 1334.55,1050.11 1336.86,811.72 1339.16,862.651 1341.47,1011.81 1343.78,1026.81 1346.09,1020.35 1348.39,821.286 1350.7,845.38 1353.01,1020.82 1355.32,982.403 1357.63,817.647 1359.93,885.975 1362.24,945.457 1364.55,817.304 1366.86,1017.91 1369.17,925.863 1371.47,1029.17 1373.78,879.704 1376.09,968.114 1378.4,1121.15 1380.71,1085.31 1383.01,948.797 1385.32,1001.94 1387.63,1004.73 1389.94,981.134 1392.24,907.989 1394.55,846.063 1396.86,940.224 1399.17,902.506 1401.48,945.259 1403.78,1002.94 1406.09,1117.04 1408.4,1233.89 1410.71,747.34 1413.02,1057.87 1415.32,883.172 1417.63,1039.05 1419.94,969.302 1422.25,982.827 1424.56,971.939 1426.86,724.479 1429.17,1069.66 1431.48,944.052 1433.79,915.913 1436.1,980.697 1438.4,994.445 1440.71,1070.91 1443.02,974.995 1445.33,831.456 1447.63,921.874 1449.94,773.992 1452.25,839.818 1454.56,1088.16 1456.87,811.865 1459.17,1046 1461.48,698.355 1463.79,1057.99 1466.1,957.635 1468.41,1067.21 1470.71,977.759 1473.02,887.936 1475.33,1092.78 1477.64,856.91 1479.95,756.718 1482.25,924.012 1484.56,983.065 1486.87,818.896 1489.18,891.037 1491.49,998.539 1493.79,929.771 1496.1,866.184 1498.41,1084.07 1500.72,910.552 1503.02,1054.13 1505.33,911.42 1507.64,985.155 1509.95,1131.84 1512.26,1058.5 1514.56,894.371 1516.87,769.564 1519.18,966.465 1521.49,1083.58 1523.8,1088.24 1526.1,929.595 1528.41,1088.07 1530.72,1036.25 1533.03,890.839 1535.34,956.424 1537.64,1069.26 1539.95,928.998 1542.26,1162.37 1544.57,945.506 1546.88,945.548 1549.18,849.356 1551.49,932.417 1553.8,840.464 1556.11,1011.8 1558.41,965.289 1560.72,863.933 1563.03,772.168 1565.34,805.223 1567.65,859.82 1569.95,1081.2 1572.26,905.43 1574.57,1040.21 1576.88,987.195 1579.19,1007.25 1581.49,871.416 1583.8,987.987 1586.11,1060.15 1588.42,815.647 1590.73,872.559 1593.03,994.873 1595.34,1070.64 1597.65,870.438 1599.96,1094.2 1602.26,1018.16 1604.57,703.76 1606.88,957.99 1609.19,949.548 1611.5,962.883 1613.8,1088.57 1616.11,919.574 1618.42,894.393 1620.73,899.57 1623.04,937.857 1625.34,1076.85 1627.65,1012.44 1629.96,1018.46 1632.27,800.214 1634.58,993.837 1636.88,1188.95 1639.19,1009.3 1641.5,1092.72 1643.81,931.27 1646.12,881.684 1648.42,1077.61 1650.73,968.711 1653.04,888.837 1655.35,866.09 1657.65,1065.26 1659.96,867.773 1662.27,973.262 1664.58,1038.8 1666.89,1034.08 1669.19,919.48 1671.5,752.574 1673.81,973.706 1676.12,1065 1678.43,983.358 1680.73,952.952 1683.04,861.689 1685.35,1159.48 1687.66,955.8 1689.97,834.812 1692.27,976.466 1694.58,821.829 1696.89,843.561 1699.2,854.036 1701.51,1082.19 1703.81,875.667 1706.12,1140.31 1708.43,987.856 1710.74,1006.38 1713.04,866.721 1715.35,943.345 1717.66,955.983 1719.97,994.452 1722.28,939.177 1724.58,812.152 1726.89,920.778 1729.2,808.172 1731.51,938.584 1733.82,879.867 1736.12,934.595 1738.43,903.43 1740.74,1064.57 1743.05,929.013 1745.36,774.965 1747.66,1178.5 1749.97,847.489 1752.28,990.124 1754.59,1075.41 1756.9,929.766 1759.2,933.254 1761.51,913.639 1763.82,1096.51 1766.13,836.836 1768.43,996.008 1770.74,912.255 1773.05,1024.07 1775.36,1043.69 1777.67,973.556 1779.97,768.627 1782.28,981.914 1784.59,910.53 1786.9,1066.66 1789.21,877.176 1791.51,945.095 1793.82,780.558 1796.13,962.163 1798.44,933.078 1800.75,1013.36 1803.05,982.091 1805.36,876.144 1807.67,1051.16 1809.98,968.313 1812.28,1068.28 1814.59,838.191 1816.9,1052.28 1819.21,1035.79 1821.52,977.539 1823.82,1043.99 1826.13,862.805 1828.44,937.652 1830.75,796.074 1833.06,991.26 1835.36,975.274 1837.67,730.329 1839.98,933.312 1842.29,1172.71 1844.6,1033.16 1846.9,946.06 1849.21,963.459 1851.52,1001.32 1853.83,914.004 1856.14,960.053 1858.44,1037.11 1860.75,991.821 1863.06,966.323 1865.37,1031.2 1867.67,976.841 1869.98,849.501 1872.29,974.474 1874.6,1024.49 1876.91,972.584 1879.21,849.893 1881.52,935.477 1883.83,1025.16 1886.14,904.353 1888.45,797.503 1890.75,810.633 1893.06,1006.09 1895.37,949.518 1897.68,768.416 1899.99,879.966 1902.29,877.373 1904.6,982.822 1906.91,1174.21 1909.22,1082.67 1911.53,1000.47 1913.83,968.431 1916.14,944.174 1918.45,825.002 1920.76,1063.5 1923.06,1064.39 1925.37,1050.09 1927.68,755.589 1929.99,924.014 1932.3,1114.8 1934.6,1070.01 1936.91,1042.02 1939.22,910.207 1941.53,909.261 1943.84,983.497 1946.14,956.809 1948.45,869.409 1950.76,833.143 1953.07,997.057 1955.38,816.671 1957.68,742.802 1959.99,861.395 1962.3,816.887 1964.61,965.424 1966.91,858.038 1969.22,1148.71 1971.53,786.73 1973.84,1025.74 1976.15,904.911 1978.45,963.228 1980.76,871.529 1983.07,912.155 1985.38,1025.19 1987.69,1276.22 1989.99,912.623 1992.3,675.387 1994.61,958.698 1996.92,849.103 1999.23,1136.48 2001.53,1096.86 2003.84,1013.28 2006.15,947.712 2008.46,1042.98 2010.77,1001.58 2013.07,1012.63 2015.38,1040.7 2017.69,880.467 2020,1080.09 2022.3,1205.25 2024.61,844.719 2026.92,837.317 2029.23,970.061 2031.54,797.058 2033.84,922.994 2036.15,1097.45 2038.46,965.735 2040.77,880.582 2043.08,920.063 2045.38,934.667 2047.69,943.484 2050,918.792 2052.31,953.931 2054.62,779.093 2056.92,860.087 2059.23,1010.39 2061.54,1058.93 2063.85,981.583 2066.16,842.81 2068.46,801.914 2070.77,1060.14 2073.08,954.316 2075.39,670.184 2077.69,819.396 2080,908.736 2082.31,1031.08 2084.62,936.915 2086.93,935.829 2089.23,828.457 2091.54,845.458 2093.85,894.512 2096.16,917.989 2098.47,949.382 2100.77,1023.01 2103.08,1014.87 2105.39,1009.94 2107.7,885.891 2110.01,1192.06 2112.31,745.953 2114.62,879.738 2116.93,857.78 2119.24,798.281 2121.55,877.71 2123.85,833.953 2126.16,830.083 2128.47,1015.4 2130.78,1136.23 2133.08,928.085 2135.39,960.695 2137.7,1021.99 2140.01,983.659 2142.32,879.974 2144.62,1037.19 2146.93,1032.2 2149.24,1043.12 2151.55,1022.21 2153.86,1033.29 2156.16,985.933 2158.47,987.785 2160.78,1088.84 2163.09,1066.25 2165.4,891.331 2167.7,924.895 2170.01,1103.63 2172.32,815.077 2174.63,847.873 2176.93,1026.02 2179.24,1155.96 2181.55,772.146 2183.86,764.49 2186.17,863.751 2188.47,1011.7 2190.78,1000.89 2193.09,1186.05 2195.4,942.157 2197.71,931.793 2200.01,968.848 2202.32,1015.11 2204.63,844.433 2206.94,976.415 2209.25,960.196 2211.55,1005.64 2213.86,1025.77 2216.17,933.861 2218.48,933.935 2220.79,903.057 2223.09,833.988 2225.4,705.297 2227.71,1005.29 2230.02,1152.89 2232.32,1163.18 2234.63,726.907 2236.94,971.173 2239.25,1139.62 2241.56,869.41 2243.86,1062.5 2246.17,1110.86 2248.48,1005.71 2250.79,978.945 2253.1,1047.17 2255.4,979.795 2257.71,950.622 2260.02,760.025 2262.33,873.746 2264.64,951.545 2266.94,1016.16 2269.25,900.218 2271.56,850.784 2273.87,837.396 2276.18,991.115 2278.48,991.505 2280.79,980.208 2283.1,1045.68 2285.41,1001.91 2287.71,893.952 2290.02,801.222 2292.33,990.29 2294.64,825.723 2296.95,818.587 2299.25,970.574 2301.56,851.857 2303.87,1074.39 2306.18,826.14 2308.49,846.123 2310.79,987.996 2313.1,1068.74 2315.41,1055.85 2317.72,1033.12 2320.03,1060.63 2322.33,838.047 2324.64,957.844 2326.95,883.766 2329.26,919.081 2331.56,1023.61 2333.87,1003.62 2336.18,893.508 2338.49,1026.27 2340.8,966.264 2343.1,885.661 2345.41,808.638 2347.72,1007.41 2350.03,887.33 2352.34,967.7 2354.64,1032.64 2356.95,940.389 2359.26,1082.84 2361.57,848.721 2363.88,809.361 2366.18,963.84 2368.49,833.421 2370.8,916.558 2373.11,795.996 2375.42,1010.68 2377.72,1035.4 2380.03,1061.44 2382.34,1038.85 2384.65,890.367 2386.95,917.088 2389.26,1051.09 2391.57,992.659 2393.88,918.676 2396.19,893.645 2398.49,893.625 2400.8,823.108 2403.11,920.274 2405.42,1098.77 2407.73,782.416 2410.03,982.255 2412.34,946.297 2414.65,936.185 2416.96,1007.82 2419.27,860.199 2421.57,953.263 2423.88,1125.93 2426.19,913.684 2428.5,1128.54 2430.81,979.329 2433.11,945.012 2435.42,936.068 2437.73,804.233 2440.04,1007.38 2442.34,913.349 2444.65,839.445 2446.96,956.937 2449.27,965.646 2451.58,896.392 2453.88,912.572 2456.19,868.383 2458.5,1026.61 2460.81,981.368 2463.12,993.563 2465.42,1040.63 2467.73,864.71 2470.04,795.737 2472.35,942.752 2474.66,1050.63 2476.96,987.866 2479.27,880 2481.58,1139.95 2483.89,1186.92 2486.2,795.407 2488.5,904.37 2490.81,1002.22 2493.12,939.933 2495.43,843.182 2497.73,1090.23 2500.04,1032.12 2502.35,958.738 2504.66,984.678 2506.97,792.939 2509.27,998.405 2511.58,1131.9 2513.89,857.396 2516.2,1014.55 2518.51,1021.69 2520.81,1003.44 2523.12,936.203 2525.43,934.283 2527.74,1013.07 2530.05,876.198 2532.35,976.725 2534.66,843.898 2536.97,854.419 2539.28,1028.2 2541.58,977.751 2543.89,994.74 2546.2,956.135 2548.51,983.477 2550.82,1157.37 2553.12,914.513 2555.43,869.846 2557.74,821.275 2560.05,837.388 2562.36,935.716 2564.66,1009.59 2566.97,785.267 2569.28,1119.11 2571.59,1023.32 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,815.569 268.292,380.928 270.6,551.276 272.908,431.377 275.216,610.885 277.524,241.839 279.832,440.089 282.139,421.216 284.447,520.73 286.755,428.935 289.063,437.291 291.371,314.72 293.679,609.736 295.987,626.448 298.295,413.322 300.603,385.471 302.911,388.956 305.219,503.262 307.527,421.978 309.834,256.62 312.142,527.759 314.45,503.328 316.758,469.949 319.066,439.583 321.374,379.284 323.682,757.057 325.99,246.378 328.298,503.15 330.606,439.45 332.914,470.249 335.221,484.937 337.529,527.807 339.837,420.709 342.145,388.749 344.453,361.159 346.761,481.246 349.069,346.664 351.377,517.98 353.685,399.054 355.993,400.383 358.301,402.766 360.608,444.302 362.916,479.017 365.224,553.591 367.532,454.155 369.84,474.921 372.148,453.819 374.456,485.512 376.764,463.919 379.072,481.505 381.38,578.5 383.688,373.19 385.996,413.666 388.303,414.347 390.611,561.361 392.919,366.465 395.227,456.919 397.535,449.842 399.843,352.299 402.151,500.571 404.459,328.578 406.767,267.484 409.075,590.955 411.383,262.138 413.69,428.267 415.998,466.52 418.306,394.698 420.614,507.654 422.922,485.792 425.23,499.353 427.538,445.873 429.846,485.164 432.154,455.054 434.462,574.506 436.77,486.331 439.077,343.313 441.385,454.968 443.693,538.483 446.001,326.754 448.309,510.381 450.617,384.89 452.925,371.882 455.233,403.497 457.541,404.757 459.849,533.035 462.157,534.089 464.465,523.003 466.772,514.523 469.08,498.7 471.388,488.111 473.696,391.075 476.004,409.334 478.312,527.433 480.62,462.039 482.928,452.121 485.236,554.75 487.544,511.039 489.852,421.823 492.159,543.84 494.467,268.692 496.775,360.44 499.083,425.521 501.391,432.05 503.699,385.664 506.007,437.944 508.315,529.735 510.623,410.151 512.931,555.462 515.239,519.059 517.546,437.05 519.854,261.267 522.162,487.14 524.47,544.888 526.778,297.536 529.086,369.693 531.394,532.954 533.702,408.073 536.01,483.868 538.318,514.628 540.626,548.904 542.933,398.422 545.241,553.019 547.549,366.503 549.857,459.672 552.165,560.631 554.473,668.588 556.781,398.162 559.089,580.113 561.397,697.772 563.705,557.224 566.013,561.881 568.321,435.658 570.628,473.497 572.936,484.871 575.244,432.359 577.552,414.255 579.86,565.991 582.168,555.471 584.476,548.038 586.784,417.964 589.092,359.987 591.4,471.445 593.708,550.129 596.015,489.169 598.323,601.733 600.631,616.863 602.939,501.069 605.247,500.778 607.555,439.925 609.863,426.778 612.171,456.137 614.479,467.69 616.787,545.478 619.095,489.496 621.402,510.61 623.71,459.328 626.018,418.833 628.326,340.674 630.634,393.304 632.942,325.437 635.25,582.425 637.558,421.622 639.866,400.264 642.174,547.437 644.482,597.282 646.79,397.734 649.097,495.809 651.405,552.854 653.713,426.425 656.021,416.798 658.329,444.659 660.637,471.995 662.945,630.168 665.253,448.921 667.561,602.196 669.869,498.942 672.177,513.965 674.484,402.684 676.792,465.29 679.1,492.324 681.408,316.765 683.716,548.743 686.024,465.627 688.332,336.439 690.64,485.687 692.948,352.854 695.256,423.693 697.564,608.501 699.871,345.693 702.179,468.306 704.487,579.68 706.795,391.054 709.103,333.478 711.411,687.208 713.719,441.49 716.027,357.783 718.335,284.637 720.643,389.536 722.951,371.24 725.259,469.995 727.566,444.137 729.874,541.31 732.182,602.213 734.49,403.728 736.798,412.636 739.106,826.078 741.414,412.006 743.722,490.995 746.03,506.902 748.338,514.664 750.646,331.425 752.953,490.583 755.261,560.11 757.569,425.882 759.877,673.338 762.185,502.993 764.493,616.245 766.801,438.37 769.109,640.878 771.417,358.675 773.725,475.418 776.033,521.986 778.34,476.402 780.648,540.371 782.956,553.636 785.264,636.433 787.572,507.874 789.88,311.537 792.188,487.767 794.496,532.407 796.804,496.747 799.112,341.342 801.42,621.154 803.728,407.557 806.035,353.734 808.343,444.063 810.651,585.777 812.959,360.337 815.267,444.435 817.575,398.519 819.883,465.395 822.191,369.92 824.499,335.502 826.807,391.504 829.115,322.561 831.422,602.472 833.73,351.464 836.038,397.984 838.346,524.094 840.654,686.418 842.962,390.853 845.27,322.019 847.578,298.732 849.886,426.554 852.194,540.296 854.502,415.966 856.809,268.672 859.117,529.788 861.425,323.536 863.733,220.691 866.041,444.757 868.349,376.619 870.657,225.683 872.965,401.473 875.273,550.137 877.581,528.957 879.889,392.077 882.197,537.283 884.504,398.372 886.812,450.089 889.12,569.994 891.428,529.927 893.736,317.84 896.044,352.331 898.352,586.888 900.66,280.319 902.968,421.259 905.276,412.725 907.584,272.435 909.891,576.603 912.199,311.448 914.507,556.467 916.815,428.862 919.123,587.408 921.431,521.212 923.739,291.512 926.047,495.347 928.355,655.688 930.663,447.479 932.971,545.66 935.278,424.346 937.586,510.962 939.894,264.176 942.202,440.422 944.51,385.168 946.818,418.272 949.126,499.751 951.434,552.954 953.742,519.637 956.05,548.847 958.358,426.244 960.665,429.085 962.973,352.803 965.281,475.299 967.589,381.052 969.897,400.73 972.205,299.519 974.513,532.026 976.821,496.911 979.129,516.616 981.437,418.064 983.745,391.75 986.053,442.966 988.36,505.21 990.668,537.655 992.976,341.916 995.284,413.099 997.592,521.257 999.9,249.151 1002.21,486.499 1004.52,416.988 1006.82,610.515 1009.13,439.98 1011.44,622.473 1013.75,458.092 1016.06,360.758 1018.36,494.049 1020.67,316.695 1022.98,551.843 1025.29,386.815 1027.59,497.259 1029.9,382.348 1032.21,544.787 1034.52,631.013 1036.83,585.856 1039.13,352.395 1041.44,418.948 1043.75,452.688 1046.06,482.723 1048.37,429.833 1050.67,413.426 1052.98,545.879 1055.29,504.158 1057.6,305.313 1059.91,587.897 1062.21,260.593 1064.52,464.977 1066.83,466.206 1069.14,474.397 1071.45,442.19 1073.75,332.72 1076.06,390.932 1078.37,96.8724 1080.68,383.241 1082.98,528.18 1085.29,502.084 1087.6,231.663 1089.91,260.921 1092.22,298.81 1094.52,556.842 1096.83,451.131 1099.14,503.411 1101.45,551.74 1103.76,552.989 1106.06,556.984 1108.37,325.402 1110.68,524.811 1112.99,676.095 1115.3,451.668 1117.6,201.256 1119.91,380.741 1122.22,371.686 1124.53,347.511 1126.84,618.23 1129.14,561.78 1131.45,274.615 1133.76,375.775 1136.07,541.357 1138.37,510.324 1140.68,327.846 1142.99,515.219 1145.3,615.192 1147.61,292.374 1149.91,498.229 1152.22,486.805 1154.53,386.371 1156.84,475.15 1159.15,480.798 1161.45,373.425 1163.76,310.449 1166.07,452.701 1168.38,561.46 1170.69,421.621 1172.99,447.181 1175.3,501.435 1177.61,511.556 1179.92,622.265 1182.23,397.429 1184.53,283.895 1186.84,562.217 1189.15,346.924 1191.46,400.271 1193.76,627.639 1196.07,296.656 1198.38,328.032 1200.69,305.361 1203,471.549 1205.3,479.258 1207.61,387.236 1209.92,620.684 1212.23,421.262 1214.54,407.641 1216.84,479.809 1219.15,287.784 1221.46,568.178 1223.77,454.078 1226.08,435.788 1228.38,491.594 1230.69,515.999 1233,311.84 1235.31,436.192 1237.61,200.984 1239.92,411.864 1242.23,428.818 1244.54,425.588 1246.85,476.139 1249.15,405.436 1251.46,370.466 1253.77,425.624 1256.08,346.054 1258.39,458.386 1260.69,403.852 1263,455.551 1265.31,429.836 1267.62,431.852 1269.93,319.098 1272.23,408.371 1274.54,286.249 1276.85,367.564 1279.16,437.81 1281.47,482.879 1283.77,385.879 1286.08,405.89 1288.39,580.844 1290.7,470.463 1293,605.254 1295.31,401.84 1297.62,339.327 1299.93,386.866 1302.24,584.707 1304.54,436.037 1306.85,314.37 1309.16,479.193 1311.47,376.776 1313.78,522.229 1316.08,486.115 1318.39,457.589 1320.7,574.241 1323.01,406.878 1325.32,389.829 1327.62,404.053 1329.93,409.383 1332.24,490.956 1334.55,484.702 1336.86,424.63 1339.16,471.335 1341.47,429.697 1343.78,716.018 1346.09,633.235 1348.39,344.82 1350.7,436.089 1353.01,399.189 1355.32,406.645 1357.63,482.473 1359.93,435.215 1362.24,532.849 1364.55,544.721 1366.86,520.017 1369.17,697.04 1371.47,414.047 1373.78,410.866 1376.09,508.106 1378.4,455.221 1380.71,635.608 1383.01,539.104 1385.32,248.145 1387.63,737.86 1389.94,668.267 1392.24,294.149 1394.55,443.41 1396.86,491.124 1399.17,339.792 1401.48,462.483 1403.78,566.95 1406.09,358.329 1408.4,720.96 1410.71,470.637 1413.02,327.43 1415.32,485.369 1417.63,565.571 1419.94,577.39 1422.25,424.926 1424.56,433.741 1426.86,395.525 1429.17,329.339 1431.48,549.24 1433.79,535.742 1436.1,410.178 1438.4,416.651 1440.71,539.172 1443.02,519.264 1445.33,365.747 1447.63,530.345 1449.94,377.446 1452.25,462.464 1454.56,549.523 1456.87,499.154 1459.17,571.121 1461.48,482.767 1463.79,523.169 1466.1,546.462 1468.41,461.922 1470.71,284.282 1473.02,524.142 1475.33,449.82 1477.64,356.363 1479.95,567.047 1482.25,393.433 1484.56,562.099 1486.87,314.651 1489.18,452.485 1491.49,408.946 1493.79,541.867 1496.1,435.167 1498.41,417.243 1500.72,533.967 1503.02,420.986 1505.33,483.469 1507.64,421.698 1509.95,473.734 1512.26,425.697 1514.56,601.161 1516.87,466.757 1519.18,590.664 1521.49,302.182 1523.8,600.409 1526.1,704.116 1528.41,243.325 1530.72,586.114 1533.03,550.411 1535.34,644.88 1537.64,619.818 1539.95,452.29 1542.26,380.327 1544.57,588.472 1546.88,517.341 1549.18,348.835 1551.49,574.9 1553.8,665.065 1556.11,600.05 1558.41,351.93 1560.72,369.225 1563.03,404.384 1565.34,443.764 1567.65,393.657 1569.95,518.417 1572.26,303.931 1574.57,463.269 1576.88,646.59 1579.19,528.882 1581.49,385.445 1583.8,654.723 1586.11,610.686 1588.42,523.109 1590.73,623.055 1593.03,303.415 1595.34,615.339 1597.65,413.652 1599.96,332.114 1602.26,516.863 1604.57,443.89 1606.88,590.237 1609.19,457.181 1611.5,342.119 1613.8,499.298 1616.11,609.177 1618.42,412.585 1620.73,223.098 1623.04,280.952 1625.34,441.807 1627.65,454.767 1629.96,401.995 1632.27,185.624 1634.58,456.093 1636.88,451.077 1639.19,549.684 1641.5,315.432 1643.81,318.531 1646.12,466.981 1648.42,444.517 1650.73,362.751 1653.04,618.958 1655.35,621.43 1657.65,587.091 1659.96,385.317 1662.27,475.765 1664.58,462.837 1666.89,302.286 1669.19,485.436 1671.5,567.756 1673.81,359.664 1676.12,427.496 1678.43,466.547 1680.73,374.46 1683.04,444.344 1685.35,555.458 1687.66,534.681 1689.97,489.359 1692.27,501.543 1694.58,404.252 1696.89,472.421 1699.2,291.568 1701.51,294.231 1703.81,606.609 1706.12,327.228 1708.43,383.576 1710.74,382.957 1713.04,529.403 1715.35,617.678 1717.66,406.249 1719.97,544.856 1722.28,405.337 1724.58,553.623 1726.89,532.198 1729.2,478.918 1731.51,367.709 1733.82,652.036 1736.12,530.892 1738.43,386.237 1740.74,459.445 1743.05,438.052 1745.36,412.732 1747.66,251.583 1749.97,730.901 1752.28,501.949 1754.59,302.415 1756.9,477.542 1759.2,463.315 1761.51,313.977 1763.82,373.112 1766.13,617.29 1768.43,495.866 1770.74,502.187 1773.05,363.4 1775.36,589.319 1777.67,235.045 1779.97,323.803 1782.28,469.253 1784.59,557.573 1786.9,498.364 1789.21,491.366 1791.51,357.747 1793.82,372.311 1796.13,482.952 1798.44,596.565 1800.75,374.749 1803.05,344.302 1805.36,488.871 1807.67,444.587 1809.98,478.614 1812.28,620.043 1814.59,523.014 1816.9,446.806 1819.21,461.227 1821.52,584.349 1823.82,441.399 1826.13,226.682 1828.44,237.909 1830.75,373.554 1833.06,461.029 1835.36,447.681 1837.67,564.03 1839.98,433.878 1842.29,471.707 1844.6,525.036 1846.9,370.365 1849.21,517.562 1851.52,550.868 1853.83,539.914 1856.14,309.438 1858.44,494.943 1860.75,396.533 1863.06,448.335 1865.37,539.579 1867.67,574.547 1869.98,477.256 1872.29,539.26 1874.6,455.271 1876.91,664.547 1879.21,515.853 1881.52,348.611 1883.83,621.98 1886.14,469.923 1888.45,437.338 1890.75,481.518 1893.06,609.291 1895.37,467.913 1897.68,299.082 1899.99,507.647 1902.29,418.475 1904.6,422.057 1906.91,453.76 1909.22,351.153 1911.53,471.357 1913.83,386.631 1916.14,418.375 1918.45,449.526 1920.76,444.135 1923.06,401.322 1925.37,517.95 1927.68,400.023 1929.99,468.371 1932.3,516.138 1934.6,352.425 1936.91,491.249 1939.22,349.865 1941.53,409.342 1943.84,329.022 1946.14,410.737 1948.45,659.862 1950.76,569.493 1953.07,634.331 1955.38,320.442 1957.68,568.259 1959.99,585.606 1962.3,623.125 1964.61,308.124 1966.91,498.891 1969.22,472.656 1971.53,266.629 1973.84,736.434 1976.15,461.106 1978.45,392.758 1980.76,379.361 1983.07,482.395 1985.38,477.091 1987.69,418.222 1989.99,411.055 1992.3,447.621 1994.61,568.164 1996.92,469.41 1999.23,465.953 2001.53,371.119 2003.84,576.715 2006.15,454.329 2008.46,497.118 2010.77,420.721 2013.07,633.291 2015.38,558.118 2017.69,398.226 2020,462.352 2022.3,558.6 2024.61,398.423 2026.92,616.872 2029.23,454.039 2031.54,442.371 2033.84,425.788 2036.15,490.991 2038.46,268.887 2040.77,559.76 2043.08,482.698 2045.38,440.68 2047.69,469.195 2050,645.394 2052.31,267.078 2054.62,642.584 2056.92,464.323 2059.23,479.915 2061.54,464.163 2063.85,429.67 2066.16,530.606 2068.46,515.486 2070.77,505.94 2073.08,406.301 2075.39,495.616 2077.69,689.288 2080,459.255 2082.31,387.412 2084.62,682.638 2086.93,558.452 2089.23,536.601 2091.54,500.764 2093.85,224.247 2096.16,411.737 2098.47,429.749 2100.77,402.022 2103.08,461.469 2105.39,379.145 2107.7,491.663 2110.01,635.83 2112.31,296.66 2114.62,376.02 2116.93,491.5 2119.24,471.778 2121.55,502.977 2123.85,379.072 2126.16,403.816 2128.47,618.03 2130.78,498.928 2133.08,351.114 2135.39,378.088 2137.7,434.419 2140.01,408.01 2142.32,485.89 2144.62,499.675 2146.93,536.224 2149.24,307.54 2151.55,332.467 2153.86,475.757 2156.16,312.57 2158.47,414.889 2160.78,529.491 2163.09,529.951 2165.4,475.756 2167.7,297.87 2170.01,586.762 2172.32,398.798 2174.63,508.271 2176.93,443.707 2179.24,370.528 2181.55,470.062 2183.86,282.39 2186.17,374.647 2188.47,420.734 2190.78,536.673 2193.09,544.09 2195.4,381.588 2197.71,581.633 2200.01,262.487 2202.32,511.346 2204.63,430.949 2206.94,508.855 2209.25,530.487 2211.55,620.609 2213.86,632.99 2216.17,395.562 2218.48,559.617 2220.79,416.282 2223.09,371.657 2225.4,507.539 2227.71,533.063 2230.02,450.481 2232.32,317.153 2234.63,629.048 2236.94,357.197 2239.25,477.077 2241.56,436.755 2243.86,384.424 2246.17,481.373 2248.48,564.86 2250.79,385.856 2253.1,474.926 2255.4,506.816 2257.71,513.171 2260.02,273.795 2262.33,594.728 2264.64,341.433 2266.94,618.669 2269.25,466.634 2271.56,416.017 2273.87,469.408 2276.18,456.857 2278.48,433.336 2280.79,308.873 2283.1,422.408 2285.41,484.269 2287.71,455.085 2290.02,622.647 2292.33,428.567 2294.64,587.566 2296.95,632.005 2299.25,504.033 2301.56,221.598 2303.87,520.53 2306.18,449.737 2308.49,581.438 2310.79,509.143 2313.1,263.299 2315.41,494.617 2317.72,558.353 2320.03,464.611 2322.33,612.868 2324.64,398.527 2326.95,290.184 2329.26,539.622 2331.56,507.508 2333.87,287.654 2336.18,631.748 2338.49,415.963 2340.8,529.319 2343.1,448.865 2345.41,469.121 2347.72,492.854 2350.03,517.895 2352.34,465.553 2354.64,450.531 2356.95,489.211 2359.26,384.477 2361.57,441.731 2363.88,455.995 2366.18,427.307 2368.49,610.281 2370.8,515.72 2373.11,389.376 2375.42,324.627 2377.72,570.677 2380.03,411.375 2382.34,219.296 2384.65,481.621 2386.95,446.002 2389.26,205.56 2391.57,454.956 2393.88,446.58 2396.19,509.473 2398.49,481.131 2400.8,445.028 2403.11,402.532 2405.42,443.607 2407.73,578.146 2410.03,494.944 2412.34,316.841 2414.65,481.87 2416.96,461.198 2419.27,530.368 2421.57,343.922 2423.88,251.631 2426.19,446.147 2428.5,448.909 2430.81,415.337 2433.11,643.58 2435.42,524.647 2437.73,503.941 2440.04,495.462 2442.34,489.75 2444.65,421.873 2446.96,300.622 2449.27,378.479 2451.58,236.467 2453.88,412.357 2456.19,394.911 2458.5,327.237 2460.81,481.659 2463.12,375.381 2465.42,424.37 2467.73,541.537 2470.04,376.576 2472.35,237.104 2474.66,342.543 2476.96,595.424 2479.27,473.625 2481.58,505.21 2483.89,448.809 2486.2,399.208 2488.5,642.646 2490.81,320.458 2493.12,407.661 2495.43,404.284 2497.73,566.153 2500.04,388.557 2502.35,423.875 2504.66,466.505 2506.97,429.607 2509.27,375.016 2511.58,487.307 2513.89,533.751 2516.2,285.197 2518.51,569.198 2520.81,410.778 2523.12,594.677 2525.43,428.008 2527.74,480.543 2530.05,460.056 2532.35,550.314 2534.66,409.988 2536.97,389.01 2539.28,605.896 2541.58,475.929 2543.89,607.976 2546.2,541.634 2548.51,499.836 2550.82,622.022 2553.12,267.502 2555.43,455.181 2557.74,301.707 2560.05,441.368 2562.36,303.928 2564.66,347.136 2566.97,340.815 2569.28,640.797 2571.59,359.368 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(stack, samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:310</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.82054   -2.78079  -4.91748    -5.61306  …  -4.81246   -5.52136  -4.44417
  0.472995  -1.17457  -0.0323569   1.68311     -0.924473  -1.55548  -1.05323
  2.40658    3.85434   2.83228     6.79233      5.80227    5.30767   5.10481

[:, :, 2] =
 -2.22908   -4.10984   -3.85288   -4.2068   …  -4.1405   -3.69255  -4.03062
 -0.301152   0.482334  -0.467833   1.09873     -0.52991   0.83766  -0.882388
  2.08178    4.77341    5.63302    5.43125      4.13474   5.79353   6.05183

[:, :, 3] =
 -1.42902   -2.69924   -6.50869   -5.7118   …  -4.98648   -5.00674  -5.00674
 -0.250333  -0.878001   0.253999  -1.19311      0.109849   2.13246   2.13246
  1.0076     3.59339    3.41945    5.74911      4.50663    5.25835   5.25835

[:, :, 4] =
 -2.39502  -3.64376  -6.21853   -6.39505    …  -5.67977  -3.45815   -2.86348
  1.53535   1.41915  -0.813361   0.0356287     -2.846    -0.907703  -0.32079
  2.94166   4.07407   3.2008     4.0094         4.11479   3.65198    3.30617</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00778   1.0608
 -0.037426  1.06078
  4.98273   1.02918</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is just a <code>Vector{&lt;:Real}</code>, so we just need the following line:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>) <span class="op">=</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.6 seconds
Compute duration  = 2.6 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -4.9989    1.0414    0.0170   3757.6579   5916.1311    0.9999   ⋯
        x[2]   -0.0056    1.0518    0.0174   3632.5834   5623.9129    1.0000   ⋯
        x[3]    5.0125    1.0406    0.0175   3564.0037   5904.2984    1.0006   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -7.0411   -5.7076   -4.9989   -4.2892   -2.9626
        x[2]   -2.0564   -0.7196   -0.0157    0.7015    2.0949
        x[3]    2.9606    4.3174    5.0235    5.6973    7.0695
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.68 seconds
Compute duration  = 1.68 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.5045    0.1920    0.0026   5257.7210   6371.3843    1.0003   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1470    0.3625    0.5028    0.6505    0.8600
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.6985    0.1863    0.0367    22.5409        NaN    1.4714     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.2346    0.6476    0.8032    0.8230    0.8230
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.06459689284478431,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:443</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadunsafe!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:889</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:291</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:262</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:244</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:445</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ��

          σ²    0.9419    0.7399    0.0900   102.6961   146.1361    1.0406     ⋯
           x    0.1288    1.1705    0.1672    83.6330    28.1155    1.0214     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.0978    0.3568    0.7736    1.3040    2.9221
           x   -2.7088   -0.3290    0.0310    0.4751    3.3943
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ReverseDiff.jl</a>:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.88 seconds
Compute duration  = 2.88 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8368    0.5873    0.0218   515.5959   325.7872    1.0056     ⋯
           x   -0.0276    0.8359    0.0372   652.1223   123.5919    1.0103     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1375    0.3721    0.6859    1.1845    2.3499
           x   -1.8449   -0.3673    0.0219    0.3331    1.7657
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li><ol type="1">
<li>and (2) makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol></li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>