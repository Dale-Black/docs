<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/00-introduction/index.html" rel="next">
<link href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Using Turing - Modelling Syntax and Interface</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-16-using-turing-external-samplers/index.html">Implementing samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-16-using-turing-external-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Using Turing - Modelling Syntax and Interface</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-16-using-turing-external-samplers/index.html">Implementing samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step. To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> NormalLogDensity{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>NormalLogDensity</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">NormalLogDensity</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.48583394132779</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.48583394132779</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>NormalLogDensity</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <u>should not go in the sampler itself</u>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>We currently have two things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reprodicibility.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers which wants to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_new.x, state_new</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([0.0, 0.0, 0.0], MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.48742   -2.99492   -4.60132   -4.80471  …  -5.21399  -4.80544  -6.67764
  0.544599   0.561547  -0.788695  -0.90862     -1.42402  -1.49548   0.293026
  3.85999    5.17692    5.2013     4.11109      6.08336   3.9234    5.55994</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0127      1.05257
  0.00697516  1.06839
  5.02418     1.03836</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip540">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip540)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip541">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip540)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip542">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip540)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1662.39 2640.76,1662.39 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1419.79 2640.76,1419.79 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1177.19 2640.76,1177.19 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,934.591 2640.76,934.591 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,691.992 2640.76,691.992 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,449.394 2640.76,449.394 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,206.796 2640.76,206.796 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1662.39 215.714,1662.39 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1419.79 215.714,1419.79 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1177.19 215.714,1177.19 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,934.591 215.714,934.591 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,691.992 215.714,691.992 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,449.394 215.714,449.394 "></polyline>
<polyline clip-path="url(#clip540)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,206.796 215.714,206.796 "></polyline>
<path clip-path="url(#clip540)" d="M50.5475 1662.84 L80.2233 1662.84 L80.2233 1666.77 L50.5475 1666.77 L50.5475 1662.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M89.1352 1645.11 L111.357 1645.11 L111.357 1647.1 L98.8111 1679.67 L93.9269 1679.67 L105.732 1649.04 L89.1352 1649.04 L89.1352 1645.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M120.478 1673.79 L125.362 1673.79 L125.362 1679.67 L120.478 1679.67 L120.478 1673.79 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M135.593 1645.11 L153.95 1645.11 L153.95 1649.04 L139.876 1649.04 L139.876 1657.51 Q140.894 1657.17 141.913 1657 Q142.931 1656.82 143.95 1656.82 Q149.737 1656.82 153.116 1659.99 Q156.496 1663.16 156.496 1668.58 Q156.496 1674.16 153.024 1677.26 Q149.552 1680.34 143.232 1680.34 Q141.056 1680.34 138.788 1679.97 Q136.542 1679.6 134.135 1678.86 L134.135 1674.16 Q136.218 1675.29 138.441 1675.85 Q140.663 1676.4 143.14 1676.4 Q147.144 1676.4 149.482 1674.3 Q151.82 1672.19 151.82 1668.58 Q151.82 1664.97 149.482 1662.86 Q147.144 1660.75 143.14 1660.75 Q141.265 1660.75 139.39 1661.17 Q137.538 1661.59 135.593 1662.47 L135.593 1645.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M49.5521 1420.24 L79.2279 1420.24 L79.2279 1424.17 L49.5521 1424.17 L49.5521 1420.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M89.3667 1402.51 L107.723 1402.51 L107.723 1406.44 L93.6491 1406.44 L93.6491 1414.91 Q94.6676 1414.57 95.6861 1414.41 Q96.7047 1414.22 97.7232 1414.22 Q103.51 1414.22 106.89 1417.39 Q110.269 1420.56 110.269 1425.98 Q110.269 1431.56 106.797 1434.66 Q103.325 1437.74 97.0056 1437.74 Q94.8297 1437.74 92.5612 1437.37 Q90.3158 1437 87.9084 1436.26 L87.9084 1431.56 Q89.9917 1432.69 92.2139 1433.25 Q94.4361 1433.8 96.913 1433.8 Q100.918 1433.8 103.256 1431.7 Q105.593 1429.59 105.593 1425.98 Q105.593 1422.37 103.256 1420.26 Q100.918 1418.16 96.913 1418.16 Q95.038 1418.16 93.163 1418.57 Q91.3112 1418.99 89.3667 1419.87 L89.3667 1402.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M119.482 1431.19 L124.367 1431.19 L124.367 1437.07 L119.482 1437.07 L119.482 1431.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M144.552 1405.59 Q140.941 1405.59 139.112 1409.15 Q137.306 1412.69 137.306 1419.82 Q137.306 1426.93 139.112 1430.49 Q140.941 1434.03 144.552 1434.03 Q148.186 1434.03 149.991 1430.49 Q151.82 1426.93 151.82 1419.82 Q151.82 1412.69 149.991 1409.15 Q148.186 1405.59 144.552 1405.59 M144.552 1401.88 Q150.362 1401.88 153.417 1406.49 Q156.496 1411.07 156.496 1419.82 Q156.496 1428.55 153.417 1433.16 Q150.362 1437.74 144.552 1437.74 Q138.741 1437.74 135.663 1433.16 Q132.607 1428.55 132.607 1419.82 Q132.607 1411.07 135.663 1406.49 Q138.741 1401.88 144.552 1401.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M50.5475 1177.64 L80.2233 1177.64 L80.2233 1181.58 L50.5475 1181.58 L50.5475 1177.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M94.3436 1190.53 L110.663 1190.53 L110.663 1194.47 L88.7186 1194.47 L88.7186 1190.53 Q91.3806 1187.78 95.9639 1183.15 Q100.57 1178.5 101.751 1177.15 Q103.996 1174.63 104.876 1172.89 Q105.779 1171.14 105.779 1169.45 Q105.779 1166.69 103.834 1164.96 Q101.913 1163.22 98.8111 1163.22 Q96.6121 1163.22 94.1584 1163.98 Q91.7278 1164.75 88.9501 1166.3 L88.9501 1161.58 Q91.7741 1160.44 94.2278 1159.86 Q96.6815 1159.28 98.7185 1159.28 Q104.089 1159.28 107.283 1161.97 Q110.478 1164.65 110.478 1169.14 Q110.478 1171.27 109.668 1173.2 Q108.881 1175.09 106.774 1177.69 Q106.195 1178.36 103.094 1181.58 Q99.9917 1184.77 94.3436 1190.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M120.478 1188.59 L125.362 1188.59 L125.362 1194.47 L120.478 1194.47 L120.478 1188.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M135.593 1159.91 L153.95 1159.91 L153.95 1163.84 L139.876 1163.84 L139.876 1172.32 Q140.894 1171.97 141.913 1171.81 Q142.931 1171.62 143.95 1171.62 Q149.737 1171.62 153.116 1174.79 Q156.496 1177.96 156.496 1183.38 Q156.496 1188.96 153.024 1192.06 Q149.552 1195.14 143.232 1195.14 Q141.056 1195.14 138.788 1194.77 Q136.542 1194.4 134.135 1193.66 L134.135 1188.96 Q136.218 1190.09 138.441 1190.65 Q140.663 1191.21 143.14 1191.21 Q147.144 1191.21 149.482 1189.1 Q151.82 1186.99 151.82 1183.38 Q151.82 1179.77 149.482 1177.66 Q147.144 1175.56 143.14 1175.56 Q141.265 1175.56 139.39 1175.97 Q137.538 1176.39 135.593 1177.27 L135.593 1159.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M99.3204 920.389 Q95.7093 920.389 93.8806 923.954 Q92.075 927.496 92.075 934.625 Q92.075 941.732 93.8806 945.297 Q95.7093 948.838 99.3204 948.838 Q102.955 948.838 104.76 945.297 Q106.589 941.732 106.589 934.625 Q106.589 927.496 104.76 923.954 Q102.955 920.389 99.3204 920.389 M99.3204 916.686 Q105.131 916.686 108.186 921.292 Q111.265 925.875 111.265 934.625 Q111.265 943.352 108.186 947.959 Q105.131 952.542 99.3204 952.542 Q93.5102 952.542 90.4315 947.959 Q87.376 943.352 87.376 934.625 Q87.376 925.875 90.4315 921.292 Q93.5102 916.686 99.3204 916.686 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M119.482 945.991 L124.367 945.991 L124.367 951.871 L119.482 951.871 L119.482 945.991 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M144.552 920.389 Q140.941 920.389 139.112 923.954 Q137.306 927.496 137.306 934.625 Q137.306 941.732 139.112 945.297 Q140.941 948.838 144.552 948.838 Q148.186 948.838 149.991 945.297 Q151.82 941.732 151.82 934.625 Q151.82 927.496 149.991 923.954 Q148.186 920.389 144.552 920.389 M144.552 916.686 Q150.362 916.686 153.417 921.292 Q156.496 925.875 156.496 934.625 Q156.496 943.352 153.417 947.959 Q150.362 952.542 144.552 952.542 Q138.741 952.542 135.663 947.959 Q132.607 943.352 132.607 934.625 Q132.607 925.875 135.663 921.292 Q138.741 916.686 144.552 916.686 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M94.3436 705.337 L110.663 705.337 L110.663 709.272 L88.7186 709.272 L88.7186 705.337 Q91.3806 702.583 95.9639 697.953 Q100.57 693.3 101.751 691.958 Q103.996 689.435 104.876 687.699 Q105.779 685.939 105.779 684.249 Q105.779 681.495 103.834 679.759 Q101.913 678.023 98.8111 678.023 Q96.6121 678.023 94.1584 678.787 Q91.7278 679.55 88.9501 681.101 L88.9501 676.379 Q91.7741 675.245 94.2278 674.666 Q96.6815 674.087 98.7185 674.087 Q104.089 674.087 107.283 676.773 Q110.478 679.458 110.478 683.949 Q110.478 686.078 109.668 687.999 Q108.881 689.898 106.774 692.49 Q106.195 693.161 103.094 696.379 Q99.9917 699.573 94.3436 705.337 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M120.478 703.393 L125.362 703.393 L125.362 709.272 L120.478 709.272 L120.478 703.393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M135.593 674.712 L153.95 674.712 L153.95 678.648 L139.876 678.648 L139.876 687.12 Q140.894 686.773 141.913 686.611 Q142.931 686.425 143.95 686.425 Q149.737 686.425 153.116 689.597 Q156.496 692.768 156.496 698.185 Q156.496 703.763 153.024 706.865 Q149.552 709.944 143.232 709.944 Q141.056 709.944 138.788 709.573 Q136.542 709.203 134.135 708.462 L134.135 703.763 Q136.218 704.898 138.441 705.453 Q140.663 706.009 143.14 706.009 Q147.144 706.009 149.482 703.902 Q151.82 701.796 151.82 698.185 Q151.82 694.573 149.482 692.467 Q147.144 690.361 143.14 690.361 Q141.265 690.361 139.39 690.777 Q137.538 691.194 135.593 692.074 L135.593 674.712 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M89.3667 432.114 L107.723 432.114 L107.723 436.049 L93.6491 436.049 L93.6491 444.522 Q94.6676 444.174 95.6861 444.012 Q96.7047 443.827 97.7232 443.827 Q103.51 443.827 106.89 446.998 Q110.269 450.17 110.269 455.586 Q110.269 461.165 106.797 464.267 Q103.325 467.346 97.0056 467.346 Q94.8297 467.346 92.5612 466.975 Q90.3158 466.605 87.9084 465.864 L87.9084 461.165 Q89.9917 462.299 92.2139 462.855 Q94.4361 463.41 96.913 463.41 Q100.918 463.41 103.256 461.304 Q105.593 459.197 105.593 455.586 Q105.593 451.975 103.256 449.869 Q100.918 447.762 96.913 447.762 Q95.038 447.762 93.163 448.179 Q91.3112 448.596 89.3667 449.475 L89.3667 432.114 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M119.482 460.795 L124.367 460.795 L124.367 466.674 L119.482 466.674 L119.482 460.795 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M144.552 435.193 Q140.941 435.193 139.112 438.758 Q137.306 442.299 137.306 449.429 Q137.306 456.535 139.112 460.1 Q140.941 463.642 144.552 463.642 Q148.186 463.642 149.991 460.1 Q151.82 456.535 151.82 449.429 Q151.82 442.299 149.991 438.758 Q148.186 435.193 144.552 435.193 M144.552 431.489 Q150.362 431.489 153.417 436.096 Q156.496 440.679 156.496 449.429 Q156.496 458.156 153.417 462.762 Q150.362 467.346 144.552 467.346 Q138.741 467.346 135.663 462.762 Q132.607 458.156 132.607 449.429 Q132.607 440.679 135.663 436.096 Q138.741 431.489 144.552 431.489 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M89.1352 189.516 L111.357 189.516 L111.357 191.507 L98.8111 224.076 L93.9269 224.076 L105.732 193.451 L89.1352 193.451 L89.1352 189.516 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M120.478 218.196 L125.362 218.196 L125.362 224.076 L120.478 224.076 L120.478 218.196 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip540)" d="M135.593 189.516 L153.95 189.516 L153.95 193.451 L139.876 193.451 L139.876 201.923 Q140.894 201.576 141.913 201.414 Q142.931 201.229 143.95 201.229 Q149.737 201.229 153.116 204.4 Q156.496 207.572 156.496 212.988 Q156.496 218.567 153.024 221.669 Q149.552 224.747 143.232 224.747 Q141.056 224.747 138.788 224.377 Q136.542 224.007 134.135 223.266 L134.135 218.567 Q136.218 219.701 138.441 220.257 Q140.663 220.812 143.14 220.812 Q147.144 220.812 149.482 218.706 Q151.82 216.599 151.82 212.988 Q151.82 209.377 149.482 207.271 Q147.144 205.164 143.14 205.164 Q141.265 205.164 139.39 205.581 Q137.538 205.997 135.593 206.877 L135.593 189.516 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip542)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1175.97 268.292,1446.31 270.6,1161.88 272.908,1437.12 275.216,1611.57 277.524,1409.33 279.832,1505.99 282.139,1421.67 284.447,1355.56 286.755,1258.08 289.063,1354.06 291.371,1429.88 293.679,1467.69 295.987,1361.13 298.295,1499.56 300.603,1407.75 302.911,1507.99 305.219,1548.97 307.527,1528.82 309.834,1272.6 312.142,1465.21 314.45,1421.79 316.758,1258.1 319.066,1364.5 321.374,1455.02 323.682,1411.55 325.99,1408.85 328.298,1409.87 330.606,1288.27 332.914,1277.94 335.221,1604.36 337.529,1557.48 339.837,1464.6 342.145,1486.23 344.453,1207.41 346.761,1372.79 349.069,1241.27 351.377,1420.52 353.685,1263.17 355.993,1334.74 358.301,1384.51 360.608,1404.53 362.916,1325.14 365.224,1470.6 367.532,1386.06 369.84,1468.16 372.148,1401.26 374.456,1349.79 376.764,1385.52 379.072,1242.12 381.38,1426.44 383.688,1328.48 385.996,1424.97 388.303,1303.18 390.611,1347.62 392.919,1347.6 395.227,1316.6 397.535,1518.35 399.843,1470.17 402.151,1351.54 404.459,1505.42 406.767,1402.35 409.075,1469.99 411.383,1317.1 413.69,1427.33 415.998,1326.55 418.306,1425.25 420.614,1501.14 422.922,1373.76 425.23,1451.31 427.538,1247.76 429.846,1350.22 432.154,1387.47 434.462,1311.19 436.77,1475.84 439.077,1428.78 441.385,1241.75 443.693,1339.5 446.001,1547.69 448.309,1531.11 450.617,1160.34 452.925,1518.12 455.233,1318.42 457.541,1494.31 459.849,1379.63 462.157,1306.95 464.465,1458.56 466.772,1386.64 469.08,1565.65 471.388,1508.41 473.696,1412.63 476.004,1458.17 478.312,1426.63 480.62,1380.8 482.928,1416.54 485.236,1528.82 487.544,1446.87 489.852,1522.31 492.159,1492.08 494.467,1339.29 496.775,1505.43 499.083,1490.72 501.391,1367.4 503.699,1459.79 506.007,1467.22 508.315,1341.04 510.623,1479.37 512.931,1471.12 515.239,1451.76 517.546,1354.59 519.854,1321.16 522.162,1235.19 524.47,1401.7 526.778,1367.58 529.086,1473.28 531.394,1378.66 533.702,1358.67 536.01,1642.52 538.318,1384.08 540.626,1422.01 542.933,1523.5 545.241,1470.58 547.549,1382.78 549.857,1462.07 552.165,1320.88 554.473,1499.29 556.781,1578.99 559.089,1327.18 561.397,1427.97 563.705,1380.74 566.013,1408.04 568.321,1387.82 570.628,1508.82 572.936,1340.06 575.244,1310.59 577.552,1554.29 579.86,1521.75 582.168,1485.69 584.476,1721.48 586.784,1330.17 589.092,1326.38 591.4,1487.37 593.708,1307.12 596.015,1333.01 598.323,1488.42 600.631,1584.11 602.939,1105.61 605.247,1439.68 607.555,1426.97 609.863,1315.03 612.171,1624.09 614.479,1336.3 616.787,1396.39 619.095,1418.7 621.402,1248.91 623.71,1347.56 626.018,1585.97 628.326,1462.66 630.634,1270.72 632.942,1465.28 635.25,1283.61 637.558,1390.27 639.866,1336 642.174,1317.62 644.482,1408.4 646.79,1464.75 649.097,1571.91 651.405,1460.71 653.713,1319.11 656.021,1574.68 658.329,1344.4 660.637,1589.28 662.945,1456.64 665.253,1425.46 667.561,1368.96 669.869,1437.61 672.177,1436.7 674.484,1409.97 676.792,1524.68 679.1,1298.08 681.408,1512.76 683.716,1340.4 686.024,1305.53 688.332,1290.44 690.64,1471.74 692.948,1499.53 695.256,1654.77 697.564,1376.16 699.871,1415.04 702.179,1492.96 704.487,1692.64 706.795,1621.87 709.103,1453.95 711.411,1321.05 713.719,1524.15 716.027,1348.35 718.335,1325.08 720.643,1492.18 722.951,1384.07 725.259,1454.41 727.566,1557.85 729.874,1322.6 732.182,1577.65 734.49,1515.58 736.798,1313.72 739.106,1441.13 741.414,1320.2 743.722,1411.67 746.03,1329.39 748.338,1406.01 750.646,1142.49 752.953,1365.27 755.261,1477.18 757.569,1408.8 759.877,1530.87 762.185,1300.08 764.493,1512.82 766.801,1558.19 769.109,1409.6 771.417,1587.91 773.725,1337.25 776.033,1386.22 778.34,1639.17 780.648,1425.28 782.956,1341.97 785.264,1383.77 787.572,1317.77 789.88,1548.06 792.188,1545.27 794.496,1517.76 796.804,1288.19 799.112,1612.27 801.42,1379.01 803.728,1452.86 806.035,1563.56 808.343,1690.58 810.651,1408.94 812.959,1471.37 815.267,1536.06 817.575,1383.93 819.883,1466.85 822.191,1449.1 824.499,1552.03 826.807,1497.51 829.115,1525 831.422,1290.6 833.73,1361.21 836.038,1586.87 838.346,1468.78 840.654,1415.05 842.962,1520.02 845.27,1297.85 847.578,1313.63 849.886,1478.46 852.194,1495.05 854.502,1434.36 856.809,1375.23 859.117,1400.55 861.425,1519.92 863.733,1452.98 866.041,1443 868.349,1451.58 870.657,1527.74 872.965,1475.76 875.273,1625.79 877.581,1270.48 879.889,1450.65 882.197,1284.99 884.504,1331.32 886.812,1238.38 889.12,1272.78 891.428,1317.83 893.736,1357.08 896.044,1445.64 898.352,1460.89 900.66,1375.22 902.968,1497.79 905.276,1410.77 907.584,1343.34 909.891,1420.66 912.199,1287.59 914.507,1370.51 916.815,1650.63 919.123,1257.48 921.431,1483.68 923.739,1458.34 926.047,1360.56 928.355,1271.56 930.663,1427.84 932.971,1416.12 935.278,1539.18 937.586,1368.89 939.894,1335.3 942.202,1487.34 944.51,1368.54 946.818,1333.07 949.126,1548.12 951.434,1570.71 953.742,1423 956.05,1387.52 958.358,1465.8 960.665,1403.13 962.973,1359.51 965.281,1543 967.589,1419.77 969.897,1466.33 972.205,1437.16 974.513,1500.29 976.821,1473.43 979.129,1469.17 981.437,1316.34 983.745,1394.57 986.053,1568.83 988.36,1055.01 990.668,1268.82 992.976,1449.65 995.284,1418.48 997.592,1447.77 999.9,1429.72 1002.21,1253.9 1004.52,1371.63 1006.82,1611.73 1009.13,1494.17 1011.44,1475.46 1013.75,1379.7 1016.06,1353.96 1018.36,1346.15 1020.67,1506.21 1022.98,1323.33 1025.29,1427.64 1027.59,1387.51 1029.9,1454.7 1032.21,1409.44 1034.52,1345.39 1036.83,1436.78 1039.13,1358.34 1041.44,1658.22 1043.75,1320.48 1046.06,1498.69 1048.37,1288.62 1050.67,1165.33 1052.98,1529.4 1055.29,1268.68 1057.6,1524.71 1059.91,1410.02 1062.21,1355.6 1064.52,1283.6 1066.83,1322.8 1069.14,1395.11 1071.45,1369.48 1073.75,1453.16 1076.06,1416.66 1078.37,1514.13 1080.68,1338.77 1082.98,1277.39 1085.29,1487.19 1087.6,1523.53 1089.91,1652.3 1092.22,1282.73 1094.52,1439.79 1096.83,1564.34 1099.14,1467.8 1101.45,1242.47 1103.76,1441.68 1106.06,1335.91 1108.37,1612.37 1110.68,1421.6 1112.99,1323 1115.3,1399.07 1117.6,1300.72 1119.91,1397.45 1122.22,1215.64 1124.53,1580.47 1126.84,1591.37 1129.14,1385.74 1131.45,1584.63 1133.76,1496.71 1136.07,1433.65 1138.37,1375.7 1140.68,1545.25 1142.99,1519.41 1145.3,1351.93 1147.61,1378.97 1149.91,1354.66 1152.22,1522.16 1154.53,1408.61 1156.84,1217.99 1159.15,1433.1 1161.45,1357.81 1163.76,1558.75 1166.07,1411.6 1168.38,1324.67 1170.69,1373.13 1172.99,1531.97 1175.3,1429.89 1177.61,1425.52 1179.92,1352.74 1182.23,1371.44 1184.53,1460.78 1186.84,1371.4 1189.15,1436.25 1191.46,1382.78 1193.76,1379.83 1196.07,1562.39 1198.38,1476.35 1200.69,1503.47 1203,1558.11 1205.3,1426.13 1207.61,1430.28 1209.92,1384.85 1212.23,1365.25 1214.54,1253.9 1216.84,1534.47 1219.15,1450.92 1221.46,1448.67 1223.77,1379.37 1226.08,1208.64 1228.38,1348.25 1230.69,1378.68 1233,1365.11 1235.31,1396.91 1237.61,1407.39 1239.92,1500.52 1242.23,1426.46 1244.54,1344.49 1246.85,1375.19 1249.15,1526.71 1251.46,1444.63 1253.77,1413.03 1256.08,1511.63 1258.39,1237.7 1260.69,1358.41 1263,1278.59 1265.31,1254.7 1267.62,1399.07 1269.93,1460.45 1272.23,1350.01 1274.54,1404.87 1276.85,1339.37 1279.16,1450.94 1281.47,1296.24 1283.77,1343.04 1286.08,1442.01 1288.39,1476.32 1290.7,1456.2 1293,1420.46 1295.31,1424.03 1297.62,1534.24 1299.93,1374.23 1302.24,1289.2 1304.54,1446.28 1306.85,1256.16 1309.16,1372.67 1311.47,1373.99 1313.78,1384.16 1316.08,1314.3 1318.39,1444.98 1320.7,1473.44 1323.01,1453.78 1325.32,1429.55 1327.62,1544.91 1329.93,1427.34 1332.24,1627.3 1334.55,1530.82 1336.86,1590.6 1339.16,1510.88 1341.47,1373.79 1343.78,1356.82 1346.09,1235.32 1348.39,1241.05 1350.7,1376.74 1353.01,1256.99 1355.32,1460.11 1357.63,1393.56 1359.93,1300.6 1362.24,1390.26 1364.55,1316.54 1366.86,1326.52 1369.17,1413.7 1371.47,1579.74 1373.78,1368.94 1376.09,1294.35 1378.4,1238.31 1380.71,1464.06 1383.01,1360.21 1385.32,1477.61 1387.63,1472.4 1389.94,1289.5 1392.24,1355.62 1394.55,1306.31 1396.86,1565.85 1399.17,1264.16 1401.48,1519.8 1403.78,1276.71 1406.09,1379.92 1408.4,1275.63 1410.71,1442.79 1413.02,1611.91 1415.32,1346.39 1417.63,1446.04 1419.94,1435.72 1422.25,1498.95 1424.56,1282.72 1426.86,1412.17 1429.17,1494.49 1431.48,1527.45 1433.79,1393.36 1436.1,1383.26 1438.4,1237.58 1440.71,1593.99 1443.02,1461.45 1445.33,1579.55 1447.63,1458.37 1449.94,1443.86 1452.25,1653.01 1454.56,1439.41 1456.87,1259.49 1459.17,1429 1461.48,1401.63 1463.79,1405.72 1466.1,1381.12 1468.41,1468.78 1470.71,1413.03 1473.02,1353.88 1475.33,1487.6 1477.64,1449.18 1479.95,1667.87 1482.25,1268.28 1484.56,1300.01 1486.87,1429.8 1489.18,1537.49 1491.49,1383.89 1493.79,1370.16 1496.1,1427.47 1498.41,1462 1500.72,1452.99 1503.02,1309.99 1505.33,1366.82 1507.64,1305.26 1509.95,1609.21 1512.26,1453.83 1514.56,1557.48 1516.87,1445.65 1519.18,1489.3 1521.49,1458.09 1523.8,1503.42 1526.1,1389 1528.41,1408.99 1530.72,1332.61 1533.03,1451.54 1535.34,1443.76 1537.64,1326.99 1539.95,1474.06 1542.26,1507.12 1544.57,1489.78 1546.88,1543.06 1549.18,1309.96 1551.49,1459.07 1553.8,1227.18 1556.11,1547.64 1558.41,1305.76 1560.72,1418.6 1563.03,1479.74 1565.34,1446.07 1567.65,1438.92 1569.95,1280.27 1572.26,1616.4 1574.57,1467.51 1576.88,1476.02 1579.19,1284.18 1581.49,1415.97 1583.8,1507.68 1586.11,1480.81 1588.42,1330.41 1590.73,1411.63 1593.03,1341.19 1595.34,1400.06 1597.65,1476.95 1599.96,1567.66 1602.26,1439.57 1604.57,1435.92 1606.88,1477.61 1609.19,1540.25 1611.5,1532.04 1613.8,1538.92 1616.11,1447.15 1618.42,1174.37 1620.73,1432.26 1623.04,1512.49 1625.34,1475.43 1627.65,1480.18 1629.96,1229.35 1632.27,1405.4 1634.58,1503.43 1636.88,1369.13 1639.19,1359.35 1641.5,1356.36 1643.81,1320.24 1646.12,1328.45 1648.42,1407.44 1650.73,1341.09 1653.04,1264.8 1655.35,1460.15 1657.65,1341.07 1659.96,1549.76 1662.27,1355.86 1664.58,1357.8 1666.89,1168.23 1669.19,1383.24 1671.5,1460.75 1673.81,1581.11 1676.12,1363.47 1678.43,1508.15 1680.73,1379.5 1683.04,1507.98 1685.35,1403.53 1687.66,1543.9 1689.97,1378.78 1692.27,1610.35 1694.58,1453.13 1696.89,1635.82 1699.2,1502.78 1701.51,1546.88 1703.81,1593.18 1706.12,1298.01 1708.43,1325.45 1710.74,1398.6 1713.04,1303.06 1715.35,1454.28 1717.66,1499.97 1719.97,1323.55 1722.28,1365.84 1724.58,1334.92 1726.89,1430.58 1729.2,1628.24 1731.51,1525.62 1733.82,1422 1736.12,1645.62 1738.43,1514.32 1740.74,1431.95 1743.05,1489.69 1745.36,1430.02 1747.66,1449.98 1749.97,1401.39 1752.28,1492.14 1754.59,1477.04 1756.9,1339.46 1759.2,1388.22 1761.51,1302.07 1763.82,1325 1766.13,1430.96 1768.43,1210.18 1770.74,1463.86 1773.05,1496.64 1775.36,1403.02 1777.67,1560.3 1779.97,1674.71 1782.28,1564.12 1784.59,1401.72 1786.9,1448.59 1789.21,1446.73 1791.51,1313.29 1793.82,1416.47 1796.13,1435.52 1798.44,1288.21 1800.75,1423.85 1803.05,1364.25 1805.36,1346.97 1807.67,1313.8 1809.98,1398.47 1812.28,1416.36 1814.59,1420.02 1816.9,1554.45 1819.21,1528.04 1821.52,1528.66 1823.82,1515.49 1826.13,1415.59 1828.44,1497.63 1830.75,1300.31 1833.06,1288.62 1835.36,1452.97 1837.67,1492.28 1839.98,1591.28 1842.29,1341.26 1844.6,1396.97 1846.9,1423.33 1849.21,1479.84 1851.52,1398.51 1853.83,1493.55 1856.14,1527.81 1858.44,1320.84 1860.75,1418.74 1863.06,1391.8 1865.37,1416.09 1867.67,1492.23 1869.98,1417.58 1872.29,1360.53 1874.6,1644.43 1876.91,1343.51 1879.21,1374.91 1881.52,1340.98 1883.83,1448.63 1886.14,1399.39 1888.45,1353.52 1890.75,1399.69 1893.06,1406.66 1895.37,1326.73 1897.68,1380.63 1899.99,1365.12 1902.29,1370.75 1904.6,1683.46 1906.91,1350.6 1909.22,1495.92 1911.53,1347.64 1913.83,1292.67 1916.14,1299.46 1918.45,1427.1 1920.76,1349.81 1923.06,1388.31 1925.37,1457.7 1927.68,1337.17 1929.99,1433.27 1932.3,1439.87 1934.6,1580.46 1936.91,1350.83 1939.22,1285.99 1941.53,1463.45 1943.84,1435.19 1946.14,1473.84 1948.45,1506.69 1950.76,1366.25 1953.07,1495.04 1955.38,1229.55 1957.68,1420.27 1959.99,1309.31 1962.3,1356.97 1964.61,1222.71 1966.91,1372.95 1969.22,1248.63 1971.53,1400.1 1973.84,1331.34 1976.15,1452 1978.45,1353.11 1980.76,1278.56 1983.07,1563.95 1985.38,1491.71 1987.69,1470.24 1989.99,1395.71 1992.3,1532.88 1994.61,1452.82 1996.92,1567.73 1999.23,1279.6 2001.53,1495.55 2003.84,1597.16 2006.15,1391.76 2008.46,1535.48 2010.77,1461.85 2013.07,1434.05 2015.38,1184.65 2017.69,1441.83 2020,1548.45 2022.3,1340.96 2024.61,1384.26 2026.92,1223.67 2029.23,1412.57 2031.54,1512.26 2033.84,1385.41 2036.15,1476.66 2038.46,1551.69 2040.77,1168.46 2043.08,1464.64 2045.38,1343.07 2047.69,1495 2050,1535.46 2052.31,1485.84 2054.62,1464.94 2056.92,1491.02 2059.23,1266.38 2061.54,1418.89 2063.85,1485.65 2066.16,1538.75 2068.46,1376.41 2070.77,1304.44 2073.08,1558.88 2075.39,1247.77 2077.69,1235.77 2080,1372.5 2082.31,1410.19 2084.62,1454.17 2086.93,1415.66 2089.23,1445.89 2091.54,1161.47 2093.85,1288.68 2096.16,1356.96 2098.47,1135.74 2100.77,1415.84 2103.08,1409.65 2105.39,1445.67 2107.7,1238.76 2110.01,1246.51 2112.31,1358.83 2114.62,1276.34 2116.93,1570.18 2119.24,1420.56 2121.55,1190.26 2123.85,1261.24 2126.16,1575.38 2128.47,1186.94 2130.78,1383.46 2133.08,1508.93 2135.39,1404.56 2137.7,1355.36 2140.01,1580.42 2142.32,1388.58 2144.62,1362.02 2146.93,1475.48 2149.24,1475.98 2151.55,1423.46 2153.86,1299.55 2156.16,1519.85 2158.47,1449.42 2160.78,1348.03 2163.09,1485.48 2165.4,1605.37 2167.7,1381.11 2170.01,1494.23 2172.32,1403.55 2174.63,1578.29 2176.93,1388.62 2179.24,1360.83 2181.55,1616.53 2183.86,1293.61 2186.17,1515.39 2188.47,1477.62 2190.78,1467.31 2193.09,1469.01 2195.4,1322.53 2197.71,1446.06 2200.01,1355.26 2202.32,1392.07 2204.63,1426.41 2206.94,1503.76 2209.25,1360.44 2211.55,1549.27 2213.86,1399.84 2216.17,1357.49 2218.48,1435.48 2220.79,1460.69 2223.09,1550.93 2225.4,1355.47 2227.71,1395.59 2230.02,1465.9 2232.32,1301.1 2234.63,1536.89 2236.94,1553.33 2239.25,1314.92 2241.56,1304.7 2243.86,1507.32 2246.17,1551.39 2248.48,1249.54 2250.79,1344.84 2253.1,1335.92 2255.4,1356.98 2257.71,1592.15 2260.02,1461.39 2262.33,1425.28 2264.64,1464.35 2266.94,1560.67 2269.25,1376.33 2271.56,1413.27 2273.87,1450.91 2276.18,1348.41 2278.48,1432.11 2280.79,1521.12 2283.1,1454.95 2285.41,1447.89 2287.71,1584.98 2290.02,1596.45 2292.33,1445.72 2294.64,1367.15 2296.95,1289.76 2299.25,1459.65 2301.56,1301.24 2303.87,1620.4 2306.18,1435.35 2308.49,1363.3 2310.79,1397.31 2313.1,1291.03 2315.41,1476.25 2317.72,1364.35 2320.03,1461.09 2322.33,1447.89 2324.64,1419.55 2326.95,1486.87 2329.26,1530.01 2331.56,1407.33 2333.87,1636.43 2336.18,1402.45 2338.49,1336.3 2340.8,1150.47 2343.1,1415.44 2345.41,1428.45 2347.72,1512.71 2350.03,1751.15 2352.34,1218.35 2354.64,1377.64 2356.95,1253.62 2359.26,1282.55 2361.57,1303.97 2363.88,1495.7 2366.18,1470.79 2368.49,1489.04 2370.8,1476.08 2373.11,1364.14 2375.42,1360.28 2377.72,1229.24 2380.03,1329.32 2382.34,1427.24 2384.65,1292.01 2386.95,1407.4 2389.26,1521.29 2391.57,1481.59 2393.88,1553.12 2396.19,1392.92 2398.49,1527.55 2400.8,1598.6 2403.11,1356.29 2405.42,1369.5 2407.73,1372.8 2410.03,1420.24 2412.34,1425.07 2414.65,1516.49 2416.96,1545.56 2419.27,1452.81 2421.57,1586.16 2423.88,1368.41 2426.19,1603.7 2428.5,1323.02 2430.81,1340.05 2433.11,1530.31 2435.42,1454.19 2437.73,1459.04 2440.04,1503 2442.34,1430.97 2444.65,1360.52 2446.96,1213.32 2449.27,1487.22 2451.58,1375.19 2453.88,1349 2456.19,1411.14 2458.5,1277.24 2460.81,1407.71 2463.12,1335.88 2465.42,1353.2 2467.73,1408.86 2470.04,1389.31 2472.35,1360.16 2474.66,1359.03 2476.96,1501.3 2479.27,1282.68 2481.58,1449.27 2483.89,1391.64 2486.2,1281.04 2488.5,1451.66 2490.81,1321.53 2493.12,1344.57 2495.43,1634.61 2497.73,1406.6 2500.04,1470.21 2502.35,1357.51 2504.66,1415.52 2506.97,1263.34 2509.27,1385.45 2511.58,1212.94 2513.89,1323.56 2516.2,1282.65 2518.51,1496.98 2520.81,1381.55 2523.12,1388.82 2525.43,1509.16 2527.74,1426.19 2530.05,1378.03 2532.35,1322.35 2534.66,1339.87 2536.97,1395.23 2539.28,1389.31 2541.58,1478.04 2543.89,1438.64 2546.2,1328.52 2548.51,1554.06 2550.82,1424.64 2553.12,1586.62 2555.43,1409.52 2557.74,1529.49 2560.05,1388.07 2562.36,1577.43 2564.66,1457.14 2566.97,1423.33 2569.28,1239.72 2571.59,1508.86 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,881.743 268.292,909.934 270.6,956.669 272.908,972.777 275.216,1060.83 277.524,874.786 279.832,665.035 282.139,1079.83 284.447,950.397 286.755,926.633 289.063,991.292 291.371,880.936 293.679,831.396 295.987,767.046 298.295,947.526 300.603,897.071 302.911,688.877 305.219,819.31 307.527,1033.71 309.834,886.257 312.142,799.688 314.45,882.898 316.758,1019.52 319.066,952.09 321.374,1012.74 323.682,1148.66 325.99,1105.36 328.298,814.335 330.606,1011.19 332.914,770.634 335.221,1007.17 337.529,839.942 339.837,1084.52 342.145,773.854 344.453,1008 346.761,968.828 349.069,910.462 351.377,870.949 353.685,987.939 355.993,868.298 358.301,890.552 360.608,703.281 362.916,855.994 365.224,835.593 367.532,937.261 369.84,987.579 372.148,975.185 374.456,1045.46 376.764,1021.69 379.072,839.938 381.38,780.767 383.688,944.108 385.996,812.376 388.303,856.912 390.611,966.2 392.919,741.407 395.227,813.215 397.535,950.592 399.843,886.648 402.151,905.904 404.459,781.044 406.767,966.59 409.075,844.891 411.383,1122.31 413.69,809.155 415.998,836.077 418.306,1019.95 420.614,939.375 422.922,866.449 425.23,959.579 427.538,831.297 429.846,933.656 432.154,867.138 434.462,1020.51 436.77,857.028 439.077,896.779 441.385,1010.1 443.693,749.022 446.001,910.089 448.309,1059.39 450.617,985.419 452.925,915.976 455.233,1060.39 457.541,884.387 459.849,888.105 462.157,939.916 464.465,921.135 466.772,1022.51 469.08,853.631 471.388,1046.55 473.696,888.55 476.004,727.057 478.312,774.296 480.62,1107.95 482.928,1044.82 485.236,786.209 487.544,838.682 489.852,851.811 492.159,913.48 494.467,883.223 496.775,993.275 499.083,793.181 501.391,1023.79 503.699,935.093 506.007,945.313 508.315,851.724 510.623,968.499 512.931,931.285 515.239,1010.42 517.546,1086.45 519.854,838.1 522.162,849.625 524.47,902.698 526.778,948.396 529.086,905.349 531.394,872.624 533.702,935.469 536.01,1059.48 538.318,1132.99 540.626,860.731 542.933,978.484 545.241,1051.07 547.549,853.249 549.857,876.509 552.165,1080.02 554.473,1130.65 556.781,842.858 559.089,894.74 561.397,954.85 563.705,989.326 566.013,904.971 568.321,828.001 570.628,957.419 572.936,925.052 575.244,1111.9 577.552,777.581 579.86,1139.45 582.168,621.07 584.476,962.88 586.784,1037.68 589.092,986.015 591.4,871.234 593.708,920.532 596.015,1008.06 598.323,916.573 600.631,943.355 602.939,884.523 605.247,1035.13 607.555,975.935 609.863,940.035 612.171,1020.51 614.479,729.297 616.787,785.209 619.095,927.861 621.402,1010.8 623.71,845.46 626.018,1036.52 628.326,926.287 630.634,928.732 632.942,833.545 635.25,921.579 637.558,1003.43 639.866,856.837 642.174,1138.53 644.482,850.035 646.79,1051.23 649.097,1018.3 651.405,911.151 653.713,1011.08 656.021,941.727 658.329,1071.2 660.637,972.915 662.945,931.393 665.253,811.793 667.561,903.452 669.869,864.463 672.177,970.416 674.484,874.118 676.792,1110.26 679.1,1058.59 681.408,1005.54 683.716,879.204 686.024,973.606 688.332,910.149 690.64,812.921 692.948,895.508 695.256,1012.48 697.564,965.923 699.871,933.71 702.179,977.437 704.487,821.678 706.795,957.613 709.103,1009.57 711.411,1052.87 713.719,867.913 716.027,845.632 718.335,813.991 720.643,1000.58 722.951,772.975 725.259,866.384 727.566,853.536 729.874,1049.92 732.182,1077.25 734.49,894.752 736.798,906.186 739.106,841.867 741.414,853.866 743.722,971.925 746.03,984.214 748.338,929.918 750.646,968.786 752.953,871.368 755.261,837.245 757.569,883.255 759.877,942.185 762.185,880.83 764.493,988.408 766.801,1062.04 769.109,776.641 771.417,904.786 773.725,772.736 776.033,824.602 778.34,898.296 780.648,884.321 782.956,836.863 785.264,951.593 787.572,999.501 789.88,1094.33 792.188,964.316 794.496,852.186 796.804,1047.65 799.112,1027.31 801.42,813.659 803.728,914.458 806.035,703.894 808.343,972.763 810.651,728.111 812.959,878.539 815.267,954.18 817.575,897.385 819.883,918.486 822.191,1044.37 824.499,763.587 826.807,883.046 829.115,947.757 831.422,944.306 833.73,881.819 836.038,882.026 838.346,1005.88 840.654,892.563 842.962,945.202 845.27,865.092 847.578,946.371 849.886,921.389 852.194,835.762 854.502,1022.5 856.809,873.5 859.117,865.725 861.425,964.135 863.733,954.675 866.041,803.561 868.349,1019.41 870.657,970.895 872.965,1095.07 875.273,784.337 877.581,910.081 879.889,862.948 882.197,915.922 884.504,818.226 886.812,931.338 889.12,1019.39 891.428,1042.46 893.736,893.018 896.044,1123.28 898.352,836.104 900.66,986.252 902.968,886.135 905.276,1083.14 907.584,851.749 909.891,947.187 912.199,892.434 914.507,1048.97 916.815,826.328 919.123,1005.06 921.431,848.898 923.739,1067.91 926.047,978.212 928.355,996.486 930.663,1048.55 932.971,988.275 935.278,1017.32 937.586,891.498 939.894,1037.88 942.202,917.902 944.51,909.607 946.818,918.37 949.126,845.94 951.434,759.839 953.742,1112.71 956.05,845.898 958.358,1038.67 960.665,905.919 962.973,950.982 965.281,792.576 967.589,986.346 969.897,967.138 972.205,848.658 974.513,844.971 976.821,791.911 979.129,862.569 981.437,796.72 983.745,744.399 986.053,812.928 988.36,1010.08 990.668,1028.04 992.976,920.035 995.284,975.107 997.592,900.755 999.9,875.385 1002.21,928.778 1004.52,839.86 1006.82,944.744 1009.13,918.612 1011.44,996.77 1013.75,830.902 1016.06,806.632 1018.36,938.489 1020.67,1102.36 1022.98,1126.93 1025.29,762.214 1027.59,988.321 1029.9,861.667 1032.21,1002.29 1034.52,931.41 1036.83,1149.58 1039.13,774.904 1041.44,877.312 1043.75,1006.37 1046.06,1078.99 1048.37,1081.46 1050.67,923.933 1052.98,884.034 1055.29,968.6 1057.6,880.893 1059.91,877.618 1062.21,1011.71 1064.52,852.976 1066.83,1040.48 1069.14,1150.04 1071.45,1103.04 1073.75,909.144 1076.06,1062.22 1078.37,947.261 1080.68,1063.4 1082.98,926.236 1085.29,883.525 1087.6,938.82 1089.91,801.531 1092.22,985.802 1094.52,929.571 1096.83,806.535 1099.14,953.91 1101.45,896.071 1103.76,981.139 1106.06,914.319 1108.37,938.373 1110.68,760.729 1112.99,918.263 1115.3,938.542 1117.6,925.927 1119.91,930.566 1122.22,891.989 1124.53,1022.77 1126.84,1110.09 1129.14,925.592 1131.45,1031.32 1133.76,1102.36 1136.07,1094.71 1138.37,829.609 1140.68,1014.75 1142.99,745.705 1145.3,774.098 1147.61,1075.69 1149.91,1011.12 1152.22,824.495 1154.53,853.441 1156.84,1150.87 1159.15,877.238 1161.45,1049.39 1163.76,973.394 1166.07,964.221 1168.38,852.7 1170.69,752.198 1172.99,1109.22 1175.3,996.924 1177.61,1075.8 1179.92,902.194 1182.23,1031.93 1184.53,908.655 1186.84,912.738 1189.15,925.609 1191.46,832.383 1193.76,747.578 1196.07,1026.2 1198.38,892.419 1200.69,936.017 1203,887.768 1205.3,829.312 1207.61,1007.73 1209.92,996.607 1212.23,914.137 1214.54,945.961 1216.84,890.255 1219.15,1006.7 1221.46,961.947 1223.77,820.456 1226.08,912.621 1228.38,1076.69 1230.69,935.323 1233,832.141 1235.31,700.789 1237.61,923.006 1239.92,879.836 1242.23,1019.63 1244.54,798.773 1246.85,856.147 1249.15,926.969 1251.46,996.658 1253.77,842.455 1256.08,1002.34 1258.39,915.295 1260.69,990.864 1263,968.953 1265.31,939.475 1267.62,975.41 1269.93,1090.22 1272.23,922.777 1274.54,876.993 1276.85,870.338 1279.16,849.381 1281.47,1111.45 1283.77,1028.39 1286.08,814.994 1288.39,984.562 1290.7,829.14 1293,922.58 1295.31,827.232 1297.62,974.069 1299.93,977.098 1302.24,1081.26 1304.54,1003.49 1306.85,906.436 1309.16,911.548 1311.47,1068.43 1313.78,946.062 1316.08,868.315 1318.39,1020.14 1320.7,1033.89 1323.01,777.758 1325.32,1007.53 1327.62,1137.25 1329.93,782.419 1332.24,895.512 1334.55,824.016 1336.86,835.434 1339.16,1059.2 1341.47,1096.22 1343.78,816.543 1346.09,976.411 1348.39,821.077 1350.7,868.414 1353.01,925.569 1355.32,943.163 1357.63,1079.24 1359.93,1054.77 1362.24,961.245 1364.55,1021.36 1366.86,855.813 1369.17,1132.07 1371.47,856.876 1373.78,969.435 1376.09,1025.15 1378.4,807.257 1380.71,943.206 1383.01,949.87 1385.32,914.794 1387.63,805.38 1389.94,963.026 1392.24,1059.84 1394.55,565.109 1396.86,883.874 1399.17,877.533 1401.48,936.301 1403.78,829.718 1406.09,764.468 1408.4,950.438 1410.71,849.774 1413.02,932.765 1415.32,1121.93 1417.63,1024.11 1419.94,971.912 1422.25,1081.77 1424.56,899.238 1426.86,1049.2 1429.17,846.011 1431.48,1120.5 1433.79,845.006 1436.1,1068.77 1438.4,869.49 1440.71,791.418 1443.02,958.995 1445.33,963.633 1447.63,764.062 1449.94,919.56 1452.25,930.651 1454.56,850.224 1456.87,1053.26 1459.17,740.015 1461.48,879.533 1463.79,806.87 1466.1,788.216 1468.41,897.462 1470.71,746.531 1473.02,862.701 1475.33,797.077 1477.64,1124.19 1479.95,972.764 1482.25,947.435 1484.56,1045.89 1486.87,1025.44 1489.18,819.676 1491.49,945.465 1493.79,857.074 1496.1,1035.94 1498.41,956.828 1500.72,963.073 1503.02,954.315 1505.33,814.822 1507.64,1049 1509.95,1005.02 1512.26,943.835 1514.56,1019.87 1516.87,857.678 1519.18,888.803 1521.49,1174.74 1523.8,799.643 1526.1,967.555 1528.41,981.38 1530.72,890.28 1533.03,1023.87 1535.34,1069.74 1537.64,1097.06 1539.95,1024.6 1542.26,1198.73 1544.57,817.414 1546.88,818.982 1549.18,837.025 1551.49,859.241 1553.8,944.437 1556.11,1042.82 1558.41,964.393 1560.72,979.809 1563.03,1109.33 1565.34,824.836 1567.65,968.301 1569.95,995.822 1572.26,1009.21 1574.57,785.937 1576.88,706.485 1579.19,1110.81 1581.49,899.294 1583.8,958.561 1586.11,1037.66 1588.42,672.005 1590.73,1105.67 1593.03,1023.98 1595.34,715.071 1597.65,786.55 1599.96,911.029 1602.26,1148 1604.57,741.824 1606.88,1029.76 1609.19,1130.81 1611.5,923.039 1613.8,849.581 1616.11,772.108 1618.42,1009.62 1620.73,1091.07 1623.04,950.94 1625.34,1045.78 1627.65,925.812 1629.96,987.974 1632.27,936.308 1634.58,857.763 1636.88,947.579 1639.19,872.699 1641.5,1004.08 1643.81,1106.77 1646.12,810.37 1648.42,857.355 1650.73,904.377 1653.04,921.434 1655.35,714.07 1657.65,958.767 1659.96,1079.59 1662.27,811.516 1664.58,1170.1 1666.89,851.973 1669.19,880.158 1671.5,1052.83 1673.81,895.427 1676.12,1067.45 1678.43,745.2 1680.73,1207.89 1683.04,1117.87 1685.35,938.415 1687.66,765.152 1689.97,913.027 1692.27,879.519 1694.58,996.867 1696.89,798.038 1699.2,926.855 1701.51,916.603 1703.81,923.444 1706.12,946.75 1708.43,1054.7 1710.74,999.325 1713.04,849.067 1715.35,731.413 1717.66,965.327 1719.97,875.855 1722.28,868.728 1724.58,933.334 1726.89,932.588 1729.2,880.63 1731.51,815.248 1733.82,943.012 1736.12,1056.03 1738.43,999.608 1740.74,1186.36 1743.05,1128.21 1745.36,917.522 1747.66,978.044 1749.97,796.465 1752.28,981.914 1754.59,698.023 1756.9,897.281 1759.2,1009.53 1761.51,806.254 1763.82,935.639 1766.13,849.494 1768.43,851.368 1770.74,823.862 1773.05,837.417 1775.36,1068.94 1777.67,1116.69 1779.97,1041.04 1782.28,902.529 1784.59,1017.54 1786.9,950.509 1789.21,870.379 1791.51,1051.81 1793.82,682.576 1796.13,1031.73 1798.44,856.522 1800.75,959.021 1803.05,926.514 1805.36,993.675 1807.67,892.768 1809.98,915.582 1812.28,910.421 1814.59,1052.8 1816.9,935.699 1819.21,952.712 1821.52,1143.13 1823.82,785.592 1826.13,1207.62 1828.44,876.84 1830.75,717.302 1833.06,1141.04 1835.36,1057.72 1837.67,860.474 1839.98,810.379 1842.29,1112.08 1844.6,919.043 1846.9,992.745 1849.21,830.143 1851.52,875.393 1853.83,914.227 1856.14,955.961 1858.44,993.23 1860.75,846.233 1863.06,1087.23 1865.37,878.882 1867.67,939.365 1869.98,920.468 1872.29,839.352 1874.6,1058.71 1876.91,864.099 1879.21,874.619 1881.52,1038.53 1883.83,834.743 1886.14,895.258 1888.45,836.743 1890.75,979.626 1893.06,832.554 1895.37,758.902 1897.68,841.022 1899.99,944.485 1902.29,919.481 1904.6,976.968 1906.91,997.098 1909.22,1002.7 1911.53,1029.55 1913.83,1060.98 1916.14,772.523 1918.45,899.777 1920.76,843.981 1923.06,1149.66 1925.37,984.806 1927.68,855.171 1929.99,867.804 1932.3,916.468 1934.6,1138.09 1936.91,1010.86 1939.22,921.546 1941.53,896.246 1943.84,994.712 1946.14,1023.44 1948.45,969.553 1950.76,858.767 1953.07,772.107 1955.38,924.108 1957.68,984.269 1959.99,853.883 1962.3,938.141 1964.61,1008.61 1966.91,763.622 1969.22,883.332 1971.53,1069.8 1973.84,769.879 1976.15,997.096 1978.45,893.785 1980.76,1124.94 1983.07,752.855 1985.38,917.726 1987.69,1085.75 1989.99,818.329 1992.3,1137.37 1994.61,896.586 1996.92,913.579 1999.23,896.69 2001.53,841.916 2003.84,713.221 2006.15,905.586 2008.46,830.37 2010.77,760.563 2013.07,1080.85 2015.38,960.188 2017.69,932.217 2020,910.279 2022.3,1044.57 2024.61,1126.79 2026.92,926.931 2029.23,855.343 2031.54,982.263 2033.84,856.296 2036.15,847.291 2038.46,1104.28 2040.77,850.062 2043.08,1005.98 2045.38,958.585 2047.69,764.739 2050,915.119 2052.31,779.802 2054.62,891.17 2056.92,897.421 2059.23,903.927 2061.54,944.875 2063.85,937.647 2066.16,875.767 2068.46,781.212 2070.77,965.766 2073.08,922.835 2075.39,829.832 2077.69,771.964 2080,940.492 2082.31,836.77 2084.62,976.105 2086.93,859.352 2089.23,927.801 2091.54,821.139 2093.85,1024.41 2096.16,937.567 2098.47,1058.24 2100.77,964.75 2103.08,995.874 2105.39,867.729 2107.7,987.671 2110.01,1001.98 2112.31,1024.89 2114.62,921.535 2116.93,887.677 2119.24,809.981 2121.55,760.036 2123.85,848.041 2126.16,995.343 2128.47,923.511 2130.78,854.665 2133.08,892.418 2135.39,880.745 2137.7,807.833 2140.01,1110.11 2142.32,908.797 2144.62,947.262 2146.93,881.536 2149.24,752.202 2151.55,929.233 2153.86,791.142 2156.16,934.878 2158.47,872.542 2160.78,862.928 2163.09,764.113 2165.4,918.186 2167.7,1051.24 2170.01,997.589 2172.32,830.23 2174.63,874.135 2176.93,970.49 2179.24,916.845 2181.55,1073.39 2183.86,817.201 2186.17,748.515 2188.47,1028.72 2190.78,981.43 2193.09,1065.8 2195.4,704.406 2197.71,868.281 2200.01,839.962 2202.32,861.616 2204.63,802.399 2206.94,965.593 2209.25,892.511 2211.55,836.114 2213.86,818.666 2216.17,920.418 2218.48,983.2 2220.79,1117.01 2223.09,858.098 2225.4,1091.86 2227.71,782.772 2230.02,898.99 2232.32,875.762 2234.63,980.357 2236.94,852.233 2239.25,873.212 2241.56,995.07 2243.86,964.547 2246.17,810.352 2248.48,882.174 2250.79,883.2 2253.1,873.745 2255.4,856.569 2257.71,925.385 2260.02,930.734 2262.33,1013.38 2264.64,959.889 2266.94,1037.99 2269.25,888.525 2271.56,922.98 2273.87,857.303 2276.18,1098.45 2278.48,948.404 2280.79,800.561 2283.1,977.095 2285.41,972.193 2287.71,879.17 2290.02,913.554 2292.33,829.795 2294.64,1042.58 2296.95,804.847 2299.25,975.228 2301.56,926.468 2303.87,776.669 2306.18,1049.67 2308.49,958.055 2310.79,865.366 2313.1,792.364 2315.41,974.436 2317.72,901.278 2320.03,1041.55 2322.33,766.565 2324.64,1008.24 2326.95,991.6 2329.26,845.92 2331.56,933.016 2333.87,946.367 2336.18,747.252 2338.49,1005.77 2340.8,1075.15 2343.1,919.826 2345.41,1083.86 2347.72,1053.85 2350.03,915.247 2352.34,1061.98 2354.64,963.62 2356.95,1028.73 2359.26,968.289 2361.57,792.374 2363.88,943.79 2366.18,890.303 2368.49,688.709 2370.8,885.546 2373.11,826.808 2375.42,1041.34 2377.72,872.16 2380.03,944.222 2382.34,891.608 2384.65,968.682 2386.95,729.602 2389.26,905.513 2391.57,1058.37 2393.88,1054.22 2396.19,877.327 2398.49,904.161 2400.8,934.514 2403.11,852.094 2405.42,775.215 2407.73,1009.4 2410.03,874.016 2412.34,731.12 2414.65,909.225 2416.96,911.715 2419.27,977.18 2421.57,917.504 2423.88,1136.25 2426.19,977.393 2428.5,973.045 2430.81,911.001 2433.11,867.628 2435.42,910.15 2437.73,950.62 2440.04,1044.19 2442.34,1012.4 2444.65,750.128 2446.96,994.38 2449.27,1057.7 2451.58,818.581 2453.88,871.331 2456.19,732.585 2458.5,853.812 2460.81,956.591 2463.12,911.025 2465.42,894.133 2467.73,905.525 2470.04,992.654 2472.35,1049.39 2474.66,1057.54 2476.96,961.983 2479.27,919.243 2481.58,935.141 2483.89,1048.58 2486.2,798.599 2488.5,956.877 2490.81,976.253 2493.12,981.586 2495.43,743.709 2497.73,852.422 2500.04,926.273 2502.35,1160.31 2504.66,902.727 2506.97,1002.32 2509.27,1171.3 2511.58,1046.65 2513.89,901.075 2516.2,1031.17 2518.51,894.018 2520.81,1089.26 2523.12,835.012 2525.43,1004.41 2527.74,1040.97 2530.05,786.369 2532.35,952.978 2534.66,983.051 2536.97,1005.85 2539.28,772.253 2541.58,1090.71 2543.89,881.38 2546.2,770.756 2548.51,980.702 2550.82,931.375 2553.12,874.926 2555.43,700.913 2557.74,903.98 2560.05,807.924 2562.36,963.285 2564.66,1130.33 2566.97,911.486 2569.28,881.256 2571.59,890.441 "></polyline>
<polyline clip-path="url(#clip542)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,560.02 268.292,591.568 270.6,500.942 272.908,382.704 275.216,562.908 277.524,309.099 279.832,369.639 282.139,509.901 284.447,363.875 286.755,295.317 289.063,411.085 291.371,402.06 293.679,313.808 295.987,451.281 298.295,527.831 300.603,457.422 302.911,453.046 305.219,531.763 307.527,537.239 309.834,466.328 312.142,520.687 314.45,293.107 316.758,488.711 319.066,404.374 321.374,463.908 323.682,382.271 325.99,527.676 328.298,368.127 330.606,568.735 332.914,476.194 335.221,427.933 337.529,522.739 339.837,375.494 342.145,536.091 344.453,319.13 346.761,603.381 349.069,341.725 351.377,465.061 353.685,366.626 355.993,404.922 358.301,331.706 360.608,428.287 362.916,405.744 365.224,450.558 367.532,479.046 369.84,514.106 372.148,400.519 374.456,327.747 376.764,559.629 379.072,543.534 381.38,509.178 383.688,210.443 385.996,496.229 388.303,481.785 390.611,524.536 392.919,481.451 395.227,427.793 397.535,404.244 399.843,543.838 402.151,231.717 404.459,404.973 406.767,505.87 409.075,468.657 411.383,424.759 413.69,382.056 415.998,514.909 418.306,432.387 420.614,364.426 422.922,463.518 425.23,630.57 427.538,400.091 429.846,550.221 432.154,550.792 434.462,553.911 436.77,444.343 439.077,382.806 441.385,587.517 443.693,569.833 446.001,585.174 448.309,368.064 450.617,339.849 452.925,525.37 455.233,557.492 457.541,351.791 459.849,386.142 462.157,427.94 464.465,445.79 466.772,350.559 469.08,524.021 471.388,581.514 473.696,485.195 476.004,356.142 478.312,339.901 480.62,223.621 482.928,384.536 485.236,584.115 487.544,564.3 489.852,296.537 492.159,488.393 494.467,500.565 496.775,441.485 499.083,338.48 501.391,370.953 503.699,477.85 506.007,434.315 508.315,403.687 510.623,303.555 512.931,523.338 515.239,354.501 517.546,653.884 519.854,431.377 522.162,623.17 524.47,298.114 526.778,450.18 529.086,235.214 531.394,315.374 533.702,557.082 536.01,391.203 538.318,703.273 540.626,431.519 542.933,255.955 545.241,537.593 547.549,555.158 549.857,443.297 552.165,451.757 554.473,362.082 556.781,370.456 559.089,499.64 561.397,441.304 563.705,458.873 566.013,525.738 568.321,436.445 570.628,515.297 572.936,492.868 575.244,517.866 577.552,346.23 579.86,325.828 582.168,347.238 584.476,254.782 586.784,303.433 589.092,361.636 591.4,409.992 593.708,435.13 596.015,551.1 598.323,473.093 600.631,453.504 602.939,497.015 605.247,222.371 607.555,514.51 609.863,585.8 612.171,597.078 614.479,585.315 616.787,678.271 619.095,378.64 621.402,547.413 623.71,485.757 626.018,519.858 628.326,349.123 630.634,448.454 632.942,407.624 635.25,433.478 637.558,629.772 639.866,456.7 642.174,494.963 644.482,479.211 646.79,393.495 649.097,406.696 651.405,562.242 653.713,496.736 656.021,288.21 658.329,521.31 660.637,315.611 662.945,386.239 665.253,365.715 667.561,441.622 669.869,335.396 672.177,638.918 674.484,467.428 676.792,382.418 679.1,426.751 681.408,442.996 683.716,575.252 686.024,417.033 688.332,346.339 690.64,437.767 692.948,413.189 695.256,506.818 697.564,422.061 699.871,317.391 702.179,409.127 704.487,336.317 706.795,346.372 709.103,630.64 711.411,447.764 713.719,547.369 716.027,576.604 718.335,515.87 720.643,442.322 722.951,429.944 725.259,465.543 727.566,441.452 729.874,307.33 732.182,406.928 734.49,475.427 736.798,467.917 739.106,528.871 741.414,480.99 743.722,586.349 746.03,488.462 748.338,416.593 750.646,492.675 752.953,364.118 755.261,598.167 757.569,585.858 759.877,443.671 762.185,440.362 764.493,508.543 766.801,320.17 769.109,303.439 771.417,542.141 773.725,426.557 776.033,558.922 778.34,424.973 780.648,475.688 782.956,298.306 785.264,528.232 787.572,452 789.88,502.614 792.188,573.892 794.496,428.671 796.804,414.462 799.112,530.682 801.42,312.782 803.728,393.005 806.035,545.845 808.343,582.006 810.651,599.641 812.959,579.782 815.267,426.362 817.575,597.869 819.883,524.867 822.191,546.305 824.499,361.858 826.807,408.99 829.115,404.118 831.422,617.434 833.73,430.279 836.038,722.485 838.346,356.285 840.654,596.187 842.962,552.61 845.27,554.161 847.578,670.988 849.886,380.344 852.194,412.02 854.502,430.304 856.809,465.461 859.117,362.177 861.425,466.419 863.733,337.247 866.041,512.192 868.349,432.41 870.657,470.21 872.965,352.641 875.273,464.447 877.581,415.522 879.889,276.061 882.197,576.966 884.504,550.484 886.812,482.803 889.12,593.714 891.428,394.512 893.736,378.377 896.044,280.151 898.352,440.613 900.66,271.116 902.968,308.458 905.276,541.638 907.584,383.538 909.891,504.209 912.199,540.742 914.507,349.732 916.815,501.608 919.123,398.425 921.431,417.186 923.739,521.625 926.047,484.659 928.355,759.433 930.663,468.763 932.971,404.708 935.278,433.865 937.586,411.315 939.894,429.597 942.202,483.002 944.51,359.321 946.818,507.858 949.126,572.588 951.434,599.76 953.742,355.079 956.05,529.733 958.358,500.085 960.665,416.364 962.973,332.803 965.281,535.324 967.589,465.377 969.897,530.198 972.205,557.493 974.513,338.616 976.821,506.589 979.129,530.02 981.437,291.54 983.745,568.703 986.053,357.642 988.36,545.753 990.668,532.709 992.976,601.779 995.284,449.613 997.592,301.249 999.9,429.877 1002.21,589.356 1004.52,545.038 1006.82,650.297 1009.13,561.584 1011.44,413.478 1013.75,323.488 1016.06,604.493 1018.36,477.666 1020.67,466.282 1022.98,465.039 1025.29,295.761 1027.59,389.533 1029.9,462.202 1032.21,512.723 1034.52,234.92 1036.83,558.699 1039.13,441.677 1041.44,459.207 1043.75,385.314 1046.06,456.837 1048.37,299.914 1050.67,536.518 1052.98,523.998 1055.29,284.022 1057.6,251.774 1059.91,288.467 1062.21,496.551 1064.52,431.834 1066.83,360.665 1069.14,356.81 1071.45,572.989 1073.75,501.304 1076.06,452.206 1078.37,409.848 1080.68,268.217 1082.98,575.099 1085.29,625.17 1087.6,413.466 1089.91,528.088 1092.22,361.721 1094.52,408.208 1096.83,379.519 1099.14,342.908 1101.45,408.011 1103.76,508.078 1106.06,400.721 1108.37,435.317 1110.68,512.242 1112.99,434.098 1115.3,247.307 1117.6,275.757 1119.91,275.273 1122.22,482.519 1124.53,411.703 1126.84,486.117 1129.14,539.475 1131.45,512.374 1133.76,395.541 1136.07,517.581 1138.37,397.941 1140.68,420.107 1142.99,241.217 1145.3,417.601 1147.61,404 1149.91,479.609 1152.22,541.174 1154.53,491.101 1156.84,397.906 1159.15,438.445 1161.45,390.428 1163.76,319.637 1166.07,422.627 1168.38,406.843 1170.69,372.689 1172.99,648.563 1175.3,466.808 1177.61,450.453 1179.92,392.145 1182.23,516.779 1184.53,511.224 1186.84,388.453 1189.15,578.069 1191.46,396.183 1193.76,430.707 1196.07,434.084 1198.38,450.972 1200.69,388.941 1203,577.379 1205.3,413.892 1207.61,557.654 1209.92,409.484 1212.23,461.863 1214.54,493.539 1216.84,395.705 1219.15,315.723 1221.46,520.394 1223.77,438.584 1226.08,420.358 1228.38,280.944 1230.69,394.742 1233,372.73 1235.31,303.084 1237.61,583.152 1239.92,435.543 1242.23,424.035 1244.54,514.967 1246.85,325.361 1249.15,255.175 1251.46,453.457 1253.77,479.998 1256.08,467.639 1258.39,292.737 1260.69,320.452 1263,454.948 1265.31,521.091 1267.62,575.478 1269.93,517.403 1272.23,267.84 1274.54,337.047 1276.85,219.089 1279.16,456.94 1281.47,406.62 1283.77,416.513 1286.08,420.688 1288.39,392.971 1290.7,524.341 1293,96.8724 1295.31,485.866 1297.62,400.681 1299.93,525.154 1302.24,581.97 1304.54,528.1 1306.85,481.207 1309.16,412.99 1311.47,360.039 1313.78,533.109 1316.08,372.442 1318.39,294.286 1320.7,422.064 1323.01,292.434 1325.32,388.208 1327.62,535.076 1329.93,511.174 1332.24,553.198 1334.55,393.483 1336.86,232.729 1339.16,497.55 1341.47,387.452 1343.78,438.379 1346.09,472.122 1348.39,495.426 1350.7,400.636 1353.01,529.839 1355.32,596.159 1357.63,547.622 1359.93,542.519 1362.24,605.353 1364.55,398.719 1366.86,470.275 1369.17,284.601 1371.47,353.124 1373.78,341.571 1376.09,515.356 1378.4,351.754 1380.71,427.473 1383.01,488.394 1385.32,380.518 1387.63,491.191 1389.94,608.323 1392.24,497.671 1394.55,415.281 1396.86,446.611 1399.17,540.394 1401.48,454.725 1403.78,386.326 1406.09,443.916 1408.4,452.62 1410.71,314.491 1413.02,682.001 1415.32,431.113 1417.63,650.565 1419.94,330.551 1422.25,469.125 1424.56,318.471 1426.86,327.814 1429.17,458.447 1431.48,370.452 1433.79,316.968 1436.1,388.972 1438.4,603.351 1440.71,399.184 1443.02,200.238 1445.33,369.55 1447.63,421.865 1449.94,366.384 1452.25,448.991 1454.56,499.458 1456.87,417.235 1459.17,294.083 1461.48,532.522 1463.79,448.812 1466.1,266.712 1468.41,510.484 1470.71,340.431 1473.02,398.796 1475.33,603.793 1477.64,380.333 1479.95,500.935 1482.25,403.945 1484.56,522.895 1486.87,452.421 1489.18,569.018 1491.49,546.492 1493.79,355.182 1496.1,410.639 1498.41,379.98 1500.72,487.37 1503.02,389.83 1505.33,334.085 1507.64,408.137 1509.95,613.401 1512.26,544.661 1514.56,564.181 1516.87,498.44 1519.18,392.859 1521.49,375.637 1523.8,431.343 1526.1,316.07 1528.41,409.551 1530.72,466.625 1533.03,550.023 1535.34,397.046 1537.64,354.009 1539.95,439.7 1542.26,383.537 1544.57,296.411 1546.88,646.322 1549.18,327.309 1551.49,308.013 1553.8,530.175 1556.11,263.544 1558.41,526.452 1560.72,487.776 1563.03,436.571 1565.34,539.047 1567.65,333.448 1569.95,404.298 1572.26,338.102 1574.57,489.529 1576.88,291.641 1579.19,330.476 1581.49,425.501 1583.8,548.038 1586.11,534.184 1588.42,500.974 1590.73,524.419 1593.03,543.743 1595.34,497.886 1597.65,296.498 1599.96,540.031 1602.26,468.195 1604.57,637.245 1606.88,532.727 1609.19,553.618 1611.5,324.819 1613.8,430.901 1616.11,130.322 1618.42,470.249 1620.73,593.246 1623.04,495.71 1625.34,448.343 1627.65,289.214 1629.96,468.873 1632.27,425.58 1634.58,309.235 1636.88,485.767 1639.19,376.825 1641.5,326.726 1643.81,510.794 1646.12,466.231 1648.42,344.132 1650.73,427.028 1653.04,634.498 1655.35,392.935 1657.65,544.435 1659.96,336.742 1662.27,522.77 1664.58,571.705 1666.89,564.566 1669.19,556.242 1671.5,540.925 1673.81,353.307 1676.12,276.906 1678.43,554.563 1680.73,504.616 1683.04,433.029 1685.35,452.263 1687.66,480.097 1689.97,313.741 1692.27,497.027 1694.58,456.119 1696.89,487.55 1699.2,514.684 1701.51,371.596 1703.81,565.394 1706.12,531.938 1708.43,502.737 1710.74,400.973 1713.04,446.552 1715.35,430.982 1717.66,283.409 1719.97,421.393 1722.28,530.154 1724.58,333.015 1726.89,272.578 1729.2,378.908 1731.51,659.191 1733.82,468.269 1736.12,312.558 1738.43,665.512 1740.74,611.095 1743.05,356.343 1745.36,473.76 1747.66,412.39 1749.97,482.459 1752.28,337.616 1754.59,641.071 1756.9,394.923 1759.2,398.228 1761.51,267.627 1763.82,351.315 1766.13,520.198 1768.43,481.233 1770.74,497.352 1773.05,413.899 1775.36,401.744 1777.67,413.304 1779.97,498.722 1782.28,341.631 1784.59,401.367 1786.9,572.399 1789.21,595.24 1791.51,466.126 1793.82,144.499 1796.13,549.151 1798.44,525.958 1800.75,636.582 1803.05,496.428 1805.36,448.724 1807.67,548.18 1809.98,426.927 1812.28,372.394 1814.59,455.656 1816.9,510.062 1819.21,362.413 1821.52,621.474 1823.82,441.954 1826.13,463.126 1828.44,315.505 1830.75,335.026 1833.06,562.471 1835.36,482.997 1837.67,452.906 1839.98,410.51 1842.29,287.855 1844.6,310.204 1846.9,387.236 1849.21,464.128 1851.52,514.73 1853.83,518.431 1856.14,420.359 1858.44,373.517 1860.75,399.093 1863.06,457.401 1865.37,547.302 1867.67,272.475 1869.98,534.129 1872.29,302.797 1874.6,480.182 1876.91,453.96 1879.21,565.201 1881.52,481.085 1883.83,597.471 1886.14,589.176 1888.45,418.784 1890.75,504.914 1893.06,533.163 1895.37,553.871 1897.68,400.59 1899.99,640.675 1902.29,491.754 1904.6,511.226 1906.91,427.251 1909.22,632.731 1911.53,664.606 1913.83,365.292 1916.14,361.216 1918.45,443.881 1920.76,378.66 1923.06,472.788 1925.37,423.716 1927.68,387.743 1929.99,469.562 1932.3,547.393 1934.6,510.505 1936.91,382.845 1939.22,471.265 1941.53,530.03 1943.84,625.66 1946.14,457.656 1948.45,236.355 1950.76,528.536 1953.07,284.382 1955.38,327.436 1957.68,504.351 1959.99,351.731 1962.3,565.912 1964.61,465.066 1966.91,505.656 1969.22,394.732 1971.53,424.966 1973.84,522.019 1976.15,594.909 1978.45,367.459 1980.76,566.197 1983.07,286.759 1985.38,749.477 1987.69,315.366 1989.99,294.473 1992.3,332.722 1994.61,330.576 1996.92,351.906 1999.23,462.613 2001.53,537.31 2003.84,436.329 2006.15,322.102 2008.46,347.893 2010.77,513.279 2013.07,488.341 2015.38,504.754 2017.69,443.88 2020,250.441 2022.3,476.688 2024.61,498.825 2026.92,294.803 2029.23,433.148 2031.54,442.485 2033.84,487.13 2036.15,417.784 2038.46,605.746 2040.77,430.48 2043.08,435.213 2045.38,528.453 2047.69,380.96 2050,634.949 2052.31,406.778 2054.62,343.916 2056.92,375.549 2059.23,230.886 2061.54,586.078 2063.85,396.496 2066.16,417.269 2068.46,502.06 2070.77,228.091 2073.08,359.878 2075.39,429.099 2077.69,449.295 2080,351.416 2082.31,387.724 2084.62,621.33 2086.93,518.983 2089.23,464.081 2091.54,547.585 2093.85,377.188 2096.16,532.919 2098.47,456.301 2100.77,461.627 2103.08,545.141 2105.39,702.06 2107.7,591.413 2110.01,571.183 2112.31,620.787 2114.62,379.308 2116.93,533.319 2119.24,424.243 2121.55,527.077 2123.85,384.789 2126.16,365.434 2128.47,427.373 2130.78,664.587 2133.08,372.634 2135.39,388.103 2137.7,426.65 2140.01,422.575 2142.32,563.461 2144.62,275.471 2146.93,341.486 2149.24,555.923 2151.55,392.099 2153.86,464.985 2156.16,434.865 2158.47,422.661 2160.78,502.407 2163.09,462.366 2165.4,373.179 2167.7,400.536 2170.01,337.457 2172.32,571.148 2174.63,605.275 2176.93,447.078 2179.24,586.061 2181.55,347.048 2183.86,355.854 2186.17,322.233 2188.47,412.933 2190.78,396.989 2193.09,538.886 2195.4,385.877 2197.71,444.685 2200.01,452.153 2202.32,659.945 2204.63,415.223 2206.94,631.326 2209.25,409.665 2211.55,205.204 2213.86,477.311 2216.17,629.057 2218.48,610.773 2220.79,311.636 2223.09,425.072 2225.4,402.021 2227.71,336.579 2230.02,386.679 2232.32,390.538 2234.63,365.399 2236.94,284.5 2239.25,389.349 2241.56,319.511 2243.86,254.898 2246.17,531.872 2248.48,472.367 2250.79,396.924 2253.1,566.887 2255.4,612.756 2257.71,449.806 2260.02,418.327 2262.33,448.831 2264.64,694.545 2266.94,432.622 2269.25,391.663 2271.56,140.538 2273.87,413.077 2276.18,455.058 2278.48,430.992 2280.79,460.817 2283.1,440.189 2285.41,582.598 2287.71,518.478 2290.02,590.054 2292.33,429.258 2294.64,515.93 2296.95,327.095 2299.25,463.575 2301.56,502.739 2303.87,396.568 2306.18,695.08 2308.49,476.68 2310.79,648.326 2313.1,329.821 2315.41,379.037 2317.72,393.559 2320.03,467.063 2322.33,525.052 2324.64,351.733 2326.95,405.493 2329.26,523.501 2331.56,412.09 2333.87,488.493 2336.18,702.572 2338.49,290.342 2340.8,309.852 2343.1,608.955 2345.41,332.465 2347.72,468.285 2350.03,561.071 2352.34,366.103 2354.64,507.726 2356.95,310.436 2359.26,408.402 2361.57,438.745 2363.88,439.607 2366.18,444.643 2368.49,396.381 2370.8,517.583 2373.11,410.998 2375.42,419.012 2377.72,651.021 2380.03,637.481 2382.34,452.433 2384.65,513.236 2386.95,553.621 2389.26,521.943 2391.57,328.574 2393.88,465.803 2396.19,384.065 2398.49,506.088 2400.8,365.432 2403.11,402.285 2405.42,410.678 2407.73,411.701 2410.03,367.482 2412.34,354.827 2414.65,518.541 2416.96,431.766 2419.27,346.997 2421.57,428.149 2423.88,281.106 2426.19,291.408 2428.5,423.585 2430.81,398.135 2433.11,473.58 2435.42,455.76 2437.73,457.442 2440.04,271.875 2442.34,413.223 2444.65,392.439 2446.96,577.846 2449.27,500.053 2451.58,349.7 2453.88,419.122 2456.19,536.319 2458.5,583.507 2460.81,511.421 2463.12,318.198 2465.42,388.514 2467.73,542.453 2470.04,453.235 2472.35,543.667 2474.66,398.04 2476.96,603.952 2479.27,255.027 2481.58,404.088 2483.89,492.734 2486.2,616.04 2488.5,355.72 2490.81,349.644 2493.12,590.464 2495.43,550.924 2497.73,462.718 2500.04,471.295 2502.35,460.639 2504.66,396.628 2506.97,238.844 2509.27,499.514 2511.58,399.684 2513.89,551.264 2516.2,207.867 2518.51,286.919 2520.81,584.26 2523.12,434.634 2525.43,345.451 2527.74,487.683 2530.05,452.182 2532.35,347.811 2534.66,535.21 2536.97,583.387 2539.28,596.738 2541.58,334.655 2543.89,450.379 2546.2,501.514 2548.51,471.548 2550.82,386.634 2553.12,577.574 2555.43,344.583 2557.74,407.901 2560.05,575.128 2562.36,548.938 2564.66,342.21 2566.97,491.419 2569.28,504.71 2571.59,351.72 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(stack, samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:310</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.5774   -5.70006   -5.60664   …  -4.45631   -4.23627   -3.81623
 -1.83888  -0.925958   0.640634     -0.180588   0.762267  -0.175935
  1.28195   4.07713    5.49997       4.66904    6.15017    5.73618

[:, :, 2] =
 -2.94415  -4.94063  -4.4328    -4.25497   …  -4.55081  -5.2523   -4.53848
 -1.50015  -1.79869   0.997253   0.328593     -1.75148  -1.51229   2.07743
  2.84427   2.50212   4.72022    5.42687       4.74361   5.28267   4.44124

[:, :, 3] =
 -3.67268   -5.61921   -5.24342   …  -5.19954   -5.43802   -5.08445
 -0.351704   0.580319   0.841587      0.420477  -0.873533  -0.990647
  1.98976    4.47355    4.82045       2.53135    3.43147    6.56059

[:, :, 4] =
 -1.68251   -2.01387   -2.69168  -4.28377   …  -7.20048  -5.33157   -5.33157
  0.418087  -0.673306   1.34943   0.891787     -1.25667   0.317394   0.317394
  3.11299    2.92425    4.1035    4.16962       5.50262   5.38082    5.38082</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01573    1.07496
  0.0307619  1.06943
  4.99781    1.05132</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>.</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.77 seconds
Compute duration  = 2.77 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -4.9979    1.0454    0.0183   3270.5150   5444.4079    1.0004   ⋯
        x[2]    0.0190    1.0403    0.0179   3380.5987   5251.8598    1.0000   ⋯
        x[3]    4.9915    1.0679    0.0181   3498.0330   5299.1828    1.0005   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -7.0301   -5.6997   -5.0163   -4.3023   -2.9049
        x[2]   -1.9865   -0.6628    0.0129    0.7257    2.0612
        x[3]    2.8790    4.2674    5.0031    5.7231    7.0761
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.66 seconds
Compute duration  = 1.66 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.4965    0.1920    0.0027   5031.8599   6322.2573    0.9999   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1431    0.3539    0.4956    0.6372    0.8549
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.6125    0.2096    0.0416    23.1270    32.4361    1.1589     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.2143    0.4553    0.7214    0.7951    0.7951
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.46881768264388035,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:442</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadunsafe!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:889</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:291</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:262</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:244</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:444</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    7.5515    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.2784    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    7.5515    7.5515    7.5515    7.5515    7.5515
           x    1.2784    1.2784    1.2784    1.2784    1.2784
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ReverseDiff.jl</a>:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.91 seconds
Compute duration  = 2.91 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8759    0.6957    0.0648   148.8025    65.3651    1.0559     ⋯
           x   -0.2480    1.1695    0.1486    83.9010    64.3827    1.0026     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1005    0.3547    0.6257    1.1988    2.8491
           x   -3.3240   -0.6947   -0.0375    0.2792    2.0570
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li><ol type="1">
<li>and (2) makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol></li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="pagination-link" aria-label="Sampler Visualization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Sampler Visualization</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../tutorials/00-introduction/index.html" class="pagination-link" aria-label="Introduction to Turing">
        <span class="nav-page-text">Introduction to Turing</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-16-using-turing-external-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>