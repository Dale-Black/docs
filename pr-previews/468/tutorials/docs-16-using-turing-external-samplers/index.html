<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/00-introduction/index.html" rel="next">
<link href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Using Turing - Modelling Syntax and Interface</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-16-using-turing-external-samplers/index.html">Implementing samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-16-using-turing-external-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Documentation</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-00-getting-started/index.html">Using Turing - Modelling Syntax and Interface</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-16-using-turing-external-samplers/index.html">Implementing samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step. To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> NormalLogDensity{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>NormalLogDensity</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">NormalLogDensity</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-19.912457541258625</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-19.912457541258625</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>NormalLogDensity</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <u>should not go in the sampler itself</u>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>We currently have two things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reprodicibility.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers which wants to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_new.x, state_new</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([0.0, 0.0, 0.0], MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.42818  -2.21864   -3.34337  -4.64836  …  -4.31824   -3.89924  -5.30383
 -1.03774  -0.419054   1.13252   1.61644     -0.575768   1.25934   0.474183
  3.94977   3.34686    3.68658   4.50695      4.76439    4.53543   4.63745</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99068    1.04192
  0.0181559  1.04742
  4.99069    1.03514</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip580">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip580)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip581">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip580)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip582">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip580)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1691.88 2640.76,1691.88 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1448.51 2640.76,1448.51 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1205.15 2640.76,1205.15 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,961.78 2640.76,961.78 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,718.415 2640.76,718.415 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,475.05 2640.76,475.05 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,231.685 2640.76,231.685 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1691.88 215.714,1691.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1448.51 215.714,1448.51 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1205.15 215.714,1205.15 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,961.78 215.714,961.78 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,718.415 215.714,718.415 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,475.05 215.714,475.05 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,231.685 215.714,231.685 "></polyline>
<path clip-path="url(#clip580)" d="M50.5475 1692.33 L80.2233 1692.33 L80.2233 1696.26 L50.5475 1696.26 L50.5475 1692.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.1352 1674.6 L111.357 1674.6 L111.357 1676.59 L98.8111 1709.16 L93.9269 1709.16 L105.732 1678.53 L89.1352 1678.53 L89.1352 1674.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 1703.28 L125.362 1703.28 L125.362 1709.16 L120.478 1709.16 L120.478 1703.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 1674.6 L153.95 1674.6 L153.95 1678.53 L139.876 1678.53 L139.876 1687 Q140.894 1686.66 141.913 1686.49 Q142.931 1686.31 143.95 1686.31 Q149.737 1686.31 153.116 1689.48 Q156.496 1692.65 156.496 1698.07 Q156.496 1703.65 153.024 1706.75 Q149.552 1709.83 143.232 1709.83 Q141.056 1709.83 138.788 1709.46 Q136.542 1709.09 134.135 1708.35 L134.135 1703.65 Q136.218 1704.78 138.441 1705.34 Q140.663 1705.89 143.14 1705.89 Q147.144 1705.89 149.482 1703.79 Q151.82 1701.68 151.82 1698.07 Q151.82 1694.46 149.482 1692.35 Q147.144 1690.24 143.14 1690.24 Q141.265 1690.24 139.39 1690.66 Q137.538 1691.08 135.593 1691.96 L135.593 1674.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M49.5521 1448.96 L79.2279 1448.96 L79.2279 1452.9 L49.5521 1452.9 L49.5521 1448.96 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.3667 1431.23 L107.723 1431.23 L107.723 1435.17 L93.6491 1435.17 L93.6491 1443.64 Q94.6676 1443.29 95.6861 1443.13 Q96.7047 1442.94 97.7232 1442.94 Q103.51 1442.94 106.89 1446.12 Q110.269 1449.29 110.269 1454.7 Q110.269 1460.28 106.797 1463.38 Q103.325 1466.46 97.0056 1466.46 Q94.8297 1466.46 92.5612 1466.09 Q90.3158 1465.72 87.9084 1464.98 L87.9084 1460.28 Q89.9917 1461.42 92.2139 1461.97 Q94.4361 1462.53 96.913 1462.53 Q100.918 1462.53 103.256 1460.42 Q105.593 1458.31 105.593 1454.7 Q105.593 1451.09 103.256 1448.99 Q100.918 1446.88 96.913 1446.88 Q95.038 1446.88 93.163 1447.3 Q91.3112 1447.71 89.3667 1448.59 L89.3667 1431.23 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M119.482 1459.91 L124.367 1459.91 L124.367 1465.79 L119.482 1465.79 L119.482 1459.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M144.552 1434.31 Q140.941 1434.31 139.112 1437.87 Q137.306 1441.42 137.306 1448.55 Q137.306 1455.65 139.112 1459.22 Q140.941 1462.76 144.552 1462.76 Q148.186 1462.76 149.991 1459.22 Q151.82 1455.65 151.82 1448.55 Q151.82 1441.42 149.991 1437.87 Q148.186 1434.31 144.552 1434.31 M144.552 1430.61 Q150.362 1430.61 153.417 1435.21 Q156.496 1439.8 156.496 1448.55 Q156.496 1457.27 153.417 1461.88 Q150.362 1466.46 144.552 1466.46 Q138.741 1466.46 135.663 1461.88 Q132.607 1457.27 132.607 1448.55 Q132.607 1439.8 135.663 1435.21 Q138.741 1430.61 144.552 1430.61 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M50.5475 1205.6 L80.2233 1205.6 L80.2233 1209.53 L50.5475 1209.53 L50.5475 1205.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M94.3436 1218.49 L110.663 1218.49 L110.663 1222.43 L88.7186 1222.43 L88.7186 1218.49 Q91.3806 1215.74 95.9639 1211.11 Q100.57 1206.45 101.751 1205.11 Q103.996 1202.59 104.876 1200.85 Q105.779 1199.09 105.779 1197.4 Q105.779 1194.65 103.834 1192.91 Q101.913 1191.18 98.8111 1191.18 Q96.6121 1191.18 94.1584 1191.94 Q91.7278 1192.7 88.9501 1194.25 L88.9501 1189.53 Q91.7741 1188.4 94.2278 1187.82 Q96.6815 1187.24 98.7185 1187.24 Q104.089 1187.24 107.283 1189.93 Q110.478 1192.61 110.478 1197.1 Q110.478 1199.23 109.668 1201.15 Q108.881 1203.05 106.774 1205.64 Q106.195 1206.31 103.094 1209.53 Q99.9917 1212.73 94.3436 1218.49 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 1216.55 L125.362 1216.55 L125.362 1222.43 L120.478 1222.43 L120.478 1216.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 1187.87 L153.95 1187.87 L153.95 1191.8 L139.876 1191.8 L139.876 1200.27 Q140.894 1199.93 141.913 1199.76 Q142.931 1199.58 143.95 1199.58 Q149.737 1199.58 153.116 1202.75 Q156.496 1205.92 156.496 1211.34 Q156.496 1216.92 153.024 1220.02 Q149.552 1223.1 143.232 1223.1 Q141.056 1223.1 138.788 1222.73 Q136.542 1222.36 134.135 1221.62 L134.135 1216.92 Q136.218 1218.05 138.441 1218.61 Q140.663 1219.16 143.14 1219.16 Q147.144 1219.16 149.482 1217.06 Q151.82 1214.95 151.82 1211.34 Q151.82 1207.73 149.482 1205.62 Q147.144 1203.51 143.14 1203.51 Q141.265 1203.51 139.39 1203.93 Q137.538 1204.35 135.593 1205.23 L135.593 1187.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M99.3204 947.579 Q95.7093 947.579 93.8806 951.144 Q92.075 954.686 92.075 961.815 Q92.075 968.922 93.8806 972.486 Q95.7093 976.028 99.3204 976.028 Q102.955 976.028 104.76 972.486 Q106.589 968.922 106.589 961.815 Q106.589 954.686 104.76 951.144 Q102.955 947.579 99.3204 947.579 M99.3204 943.875 Q105.131 943.875 108.186 948.482 Q111.265 953.065 111.265 961.815 Q111.265 970.542 108.186 975.148 Q105.131 979.732 99.3204 979.732 Q93.5102 979.732 90.4315 975.148 Q87.376 970.542 87.376 961.815 Q87.376 953.065 90.4315 948.482 Q93.5102 943.875 99.3204 943.875 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M119.482 973.181 L124.367 973.181 L124.367 979.06 L119.482 979.06 L119.482 973.181 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M144.552 947.579 Q140.941 947.579 139.112 951.144 Q137.306 954.686 137.306 961.815 Q137.306 968.922 139.112 972.486 Q140.941 976.028 144.552 976.028 Q148.186 976.028 149.991 972.486 Q151.82 968.922 151.82 961.815 Q151.82 954.686 149.991 951.144 Q148.186 947.579 144.552 947.579 M144.552 943.875 Q150.362 943.875 153.417 948.482 Q156.496 953.065 156.496 961.815 Q156.496 970.542 153.417 975.148 Q150.362 979.732 144.552 979.732 Q138.741 979.732 135.663 975.148 Q132.607 970.542 132.607 961.815 Q132.607 953.065 135.663 948.482 Q138.741 943.875 144.552 943.875 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M94.3436 731.76 L110.663 731.76 L110.663 735.695 L88.7186 735.695 L88.7186 731.76 Q91.3806 729.005 95.9639 724.376 Q100.57 719.723 101.751 718.38 Q103.996 715.857 104.876 714.121 Q105.779 712.362 105.779 710.672 Q105.779 707.918 103.834 706.181 Q101.913 704.445 98.8111 704.445 Q96.6121 704.445 94.1584 705.209 Q91.7278 705.973 88.9501 707.524 L88.9501 702.802 Q91.7741 701.668 94.2278 701.089 Q96.6815 700.51 98.7185 700.51 Q104.089 700.51 107.283 703.195 Q110.478 705.881 110.478 710.371 Q110.478 712.501 109.668 714.422 Q108.881 716.32 106.774 718.913 Q106.195 719.584 103.094 722.802 Q99.9917 725.996 94.3436 731.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 729.816 L125.362 729.816 L125.362 735.695 L120.478 735.695 L120.478 729.816 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 701.135 L153.95 701.135 L153.95 705.07 L139.876 705.07 L139.876 713.543 Q140.894 713.195 141.913 713.033 Q142.931 712.848 143.95 712.848 Q149.737 712.848 153.116 716.019 Q156.496 719.191 156.496 724.607 Q156.496 730.186 153.024 733.288 Q149.552 736.366 143.232 736.366 Q141.056 736.366 138.788 735.996 Q136.542 735.626 134.135 734.885 L134.135 730.186 Q136.218 731.32 138.441 731.876 Q140.663 732.431 143.14 732.431 Q147.144 732.431 149.482 730.325 Q151.82 728.218 151.82 724.607 Q151.82 720.996 149.482 718.89 Q147.144 716.783 143.14 716.783 Q141.265 716.783 139.39 717.2 Q137.538 717.617 135.593 718.496 L135.593 701.135 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.3667 457.77 L107.723 457.77 L107.723 461.705 L93.6491 461.705 L93.6491 470.177 Q94.6676 469.83 95.6861 469.668 Q96.7047 469.483 97.7232 469.483 Q103.51 469.483 106.89 472.654 Q110.269 475.825 110.269 481.242 Q110.269 486.821 106.797 489.922 Q103.325 493.001 97.0056 493.001 Q94.8297 493.001 92.5612 492.631 Q90.3158 492.26 87.9084 491.52 L87.9084 486.821 Q89.9917 487.955 92.2139 488.51 Q94.4361 489.066 96.913 489.066 Q100.918 489.066 103.256 486.96 Q105.593 484.853 105.593 481.242 Q105.593 477.631 103.256 475.524 Q100.918 473.418 96.913 473.418 Q95.038 473.418 93.163 473.835 Q91.3112 474.251 89.3667 475.131 L89.3667 457.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M119.482 486.45 L124.367 486.45 L124.367 492.33 L119.482 492.33 L119.482 486.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M144.552 460.849 Q140.941 460.849 139.112 464.413 Q137.306 467.955 137.306 475.085 Q137.306 482.191 139.112 485.756 Q140.941 489.298 144.552 489.298 Q148.186 489.298 149.991 485.756 Q151.82 482.191 151.82 475.085 Q151.82 467.955 149.991 464.413 Q148.186 460.849 144.552 460.849 M144.552 457.145 Q150.362 457.145 153.417 461.751 Q156.496 466.335 156.496 475.085 Q156.496 483.811 153.417 488.418 Q150.362 493.001 144.552 493.001 Q138.741 493.001 135.663 488.418 Q132.607 483.811 132.607 475.085 Q132.607 466.335 135.663 461.751 Q138.741 457.145 144.552 457.145 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.1352 214.405 L111.357 214.405 L111.357 216.395 L98.8111 248.965 L93.9269 248.965 L105.732 218.34 L89.1352 218.34 L89.1352 214.405 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 243.085 L125.362 243.085 L125.362 248.965 L120.478 248.965 L120.478 243.085 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 214.405 L153.95 214.405 L153.95 218.34 L139.876 218.34 L139.876 226.812 Q140.894 226.465 141.913 226.303 Q142.931 226.118 143.95 226.118 Q149.737 226.118 153.116 229.289 Q156.496 232.46 156.496 237.877 Q156.496 243.455 153.024 246.557 Q149.552 249.636 143.232 249.636 Q141.056 249.636 138.788 249.266 Q136.542 248.895 134.135 248.154 L134.135 243.455 Q136.218 244.59 138.441 245.145 Q140.663 245.701 143.14 245.701 Q147.144 245.701 149.482 243.594 Q151.82 241.488 151.82 237.877 Q151.82 234.266 149.482 232.159 Q147.144 230.053 143.14 230.053 Q141.265 230.053 139.39 230.469 Q137.538 230.886 135.593 231.766 L135.593 214.405 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip582)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1198.15 268.292,1452.47 270.6,1529.79 272.908,1482.06 275.216,1447.24 277.524,1537.64 279.832,1465.62 282.139,1384.51 284.447,1438.64 286.755,1408.12 289.063,1684.3 291.371,1277.13 293.679,1637.15 295.987,1245.56 298.295,1504.56 300.603,1307.6 302.911,1400.37 305.219,1325.58 307.527,1477.99 309.834,1473.66 312.142,1681.99 314.45,1527.08 316.758,1307.72 319.066,1236.63 321.374,1533.58 323.682,1429.42 325.99,1409.88 328.298,1455.02 330.606,1499.2 332.914,1464.89 335.221,1172.2 337.529,1247.59 339.837,1506.27 342.145,1339.09 344.453,1489.14 346.761,1209.52 349.069,1341.27 351.377,1556.02 353.685,1463.7 355.993,1453 358.301,1382.4 360.608,1481.62 362.916,1528.45 365.224,1531.91 367.532,1471.94 369.84,1361.33 372.148,1552.78 374.456,1617.71 376.764,1499.51 379.072,1523.22 381.38,1554.2 383.688,1298.68 385.996,1523.41 388.303,1447.31 390.611,1419.11 392.919,1454.73 395.227,1309.93 397.535,1348.96 399.843,1582.73 402.151,1496.16 404.459,1350.38 406.767,1421.97 409.075,1214.36 411.383,1618.51 413.69,1395.03 415.998,1608.57 418.306,1431.7 420.614,1406.3 422.922,1465.07 425.23,1527.1 427.538,1556.08 429.846,1470.91 432.154,1487.71 434.462,1400.9 436.77,1496.25 439.077,1473.71 441.385,1445.72 443.693,1504.79 446.001,1461.29 448.309,1561.2 450.617,1351.34 452.925,1332.31 455.233,1503.81 457.541,1162.52 459.849,1416.86 462.157,1548.33 464.465,1574.16 466.772,1420.3 469.08,1489.85 471.388,1323.48 473.696,1456.48 476.004,1236.41 478.312,1592.5 480.62,1433.09 482.928,1457.49 485.236,1370.94 487.544,1439.62 489.852,1518.12 492.159,1389.6 494.467,1615.14 496.775,1323.2 499.083,1344.47 501.391,1333.25 503.699,1290.06 506.007,1421.08 508.315,1394.13 510.623,1671.52 512.931,1481.95 515.239,1472.33 517.546,1197.97 519.854,1505.03 522.162,1492.31 524.47,1331.85 526.778,1395.96 529.086,1580.91 531.394,1533.98 533.702,1407.92 536.01,1559.1 538.318,1528.37 540.626,1534.93 542.933,1383.9 545.241,1519.72 547.549,1454.33 549.857,1546.5 552.165,1521.39 554.473,1464.91 556.781,1414.77 559.089,1347.21 561.397,1431.57 563.705,1528.25 566.013,1326.56 568.321,1383.01 570.628,1502.73 572.936,1350.11 575.244,1471.77 577.552,1424.22 579.86,1509.7 582.168,1594.76 584.476,1621.67 586.784,1359.7 589.092,1306.89 591.4,1399.03 593.708,1511.62 596.015,1403.77 598.323,1312.5 600.631,1370.16 602.939,1257.45 605.247,1549.7 607.555,1570.43 609.863,1441.06 612.171,1446.09 614.479,1330.86 616.787,1440.76 619.095,1407.81 621.402,1566.85 623.71,1357.36 626.018,1392.85 628.326,1512.77 630.634,1347.29 632.942,1495.42 635.25,1453.45 637.558,1483.16 639.866,1731 642.174,1434.21 644.482,1526.29 646.79,1303.46 649.097,1526.14 651.405,1415.31 653.713,1445.74 656.021,1534.05 658.329,1594.06 660.637,1380.05 662.945,1534.35 665.253,1430.53 667.561,1426.64 669.869,1529.58 672.177,1601.41 674.484,1659.11 676.792,1327.14 679.1,1478.44 681.408,1446.52 683.716,1401.98 686.024,1635.33 688.332,1463.58 690.64,1389.46 692.948,1460.53 695.256,1488.32 697.564,1507.77 699.871,1598.39 702.179,1569.39 704.487,1434.38 706.795,1171.98 709.103,1313.35 711.411,1623.27 713.719,1439.09 716.027,1365.55 718.335,1310.42 720.643,1514.83 722.951,1552.36 725.259,1641.06 727.566,1447.37 729.874,1482.42 732.182,1336.5 734.49,1596.21 736.798,1540.95 739.106,1424.41 741.414,1548.72 743.722,1425.08 746.03,1574.64 748.338,1262.46 750.646,1552.45 752.953,1295.92 755.261,1372.52 757.569,1435.01 759.877,1403.02 762.185,1621.22 764.493,1388.28 766.801,1494 769.109,1476.28 771.417,1596.13 773.725,1450.12 776.033,1396.37 778.34,1462.84 780.648,1460.8 782.956,1396.5 785.264,1448.61 787.572,1359.19 789.88,1359.54 792.188,1441.15 794.496,1448.96 796.804,1367.96 799.112,1666.16 801.42,1429.63 803.728,1477.84 806.035,1253.26 808.343,1410.26 810.651,1445.07 812.959,1413.19 815.267,1501.11 817.575,1390.15 819.883,1391.88 822.191,1440.15 824.499,1536.3 826.807,1490.72 829.115,1520.7 831.422,1567.97 833.73,1432.69 836.038,1275.95 838.346,1306.91 840.654,1463.51 842.962,1206.31 845.27,1379.63 847.578,1313.38 849.886,1419.21 852.194,1306.6 854.502,1348.48 856.809,1323.7 859.117,1576.79 861.425,1466.84 863.733,1521.16 866.041,1489.11 868.349,1462.93 870.657,1579.44 872.965,1514.01 875.273,1705.69 877.581,1508.03 879.889,1374.65 882.197,1478.26 884.504,1536.02 886.812,1513.35 889.12,1568.88 891.428,1405.45 893.736,1299.95 896.044,1389.85 898.352,1253.99 900.66,1524.42 902.968,1518.53 905.276,1624.64 907.584,1324.74 909.891,1442.32 912.199,1248.97 914.507,1221.88 916.815,1427.3 919.123,1381.37 921.431,1335.1 923.739,1340.33 926.047,1498.79 928.355,1420.12 930.663,1232.79 932.971,1498.73 935.278,1462.65 937.586,1441 939.894,1467.7 942.202,1406.81 944.51,1275.54 946.818,1448.88 949.126,1537.39 951.434,1439.57 953.742,1427.3 956.05,1349.91 958.358,1554.99 960.665,1573.96 962.973,1341.68 965.281,1246.83 967.589,1593.97 969.897,1574.15 972.205,1333.05 974.513,1488.17 976.821,1537.23 979.129,1336.06 981.437,1553.72 983.745,1470.31 986.053,1554.3 988.36,1449.41 990.668,1313.26 992.976,1321.61 995.284,1574.09 997.592,1645.82 999.9,1535.69 1002.21,1564.09 1004.52,1329.14 1006.82,1573.14 1009.13,1606.35 1011.44,1383.21 1013.75,1456.53 1016.06,1474.17 1018.36,1498.9 1020.67,1609.76 1022.98,1472.8 1025.29,1427.08 1027.59,1478.9 1029.9,1609.17 1032.21,1480.63 1034.52,1302.76 1036.83,1480.87 1039.13,1689.81 1041.44,1606.15 1043.75,1458.95 1046.06,1428.19 1048.37,1454.94 1050.67,1203.48 1052.98,1297.08 1055.29,1500.67 1057.6,1334.07 1059.91,1374.39 1062.21,1400.67 1064.52,1682.85 1066.83,1589.07 1069.14,1459.96 1071.45,1365.4 1073.75,1501 1076.06,1377.87 1078.37,1572.71 1080.68,1389.07 1082.98,1514.7 1085.29,1378.06 1087.6,1494.62 1089.91,1306.17 1092.22,1526.79 1094.52,1421.19 1096.83,1326.98 1099.14,1449.66 1101.45,1319.74 1103.76,1506.43 1106.06,1419.5 1108.37,1556.48 1110.68,1398.81 1112.99,1449.28 1115.3,1474.64 1117.6,1365.43 1119.91,1404.93 1122.22,1379.58 1124.53,1638.1 1126.84,1425.28 1129.14,1426.98 1131.45,1538.93 1133.76,1333.53 1136.07,1319.46 1138.37,1552.03 1140.68,1695.1 1142.99,1632.21 1145.3,1137.49 1147.61,1507.91 1149.91,1291.2 1152.22,1307.01 1154.53,1584.39 1156.84,1484.74 1159.15,1488.91 1161.45,1622.25 1163.76,1413.76 1166.07,1261.58 1168.38,1302.84 1170.69,1452.52 1172.99,1506.02 1175.3,1525.8 1177.61,1421.54 1179.92,1307.16 1182.23,1437.95 1184.53,1236.04 1186.84,1422.72 1189.15,1392.11 1191.46,1525.57 1193.76,1460.93 1196.07,1498.36 1198.38,1446.52 1200.69,1414.85 1203,1388.03 1205.3,1437.1 1207.61,1480.76 1209.92,1269.34 1212.23,1496.97 1214.54,1515.65 1216.84,1480.83 1219.15,1556.42 1221.46,1481.69 1223.77,1451.73 1226.08,1342.59 1228.38,1528.58 1230.69,1339.34 1233,1430.9 1235.31,1390.47 1237.61,1620.7 1239.92,1497.87 1242.23,1273.07 1244.54,1423.81 1246.85,1491.28 1249.15,1367.59 1251.46,1481.2 1253.77,1460.65 1256.08,1488.67 1258.39,1361.18 1260.69,1526.92 1263,1573.92 1265.31,1515.29 1267.62,1352.88 1269.93,1479.46 1272.23,1594.79 1274.54,1483.73 1276.85,1454.22 1279.16,1266.89 1281.47,1593.72 1283.77,1415.28 1286.08,1540.53 1288.39,1311.05 1290.7,1550.42 1293,1550.83 1295.31,1606.2 1297.62,1327.9 1299.93,1289.59 1302.24,1578.2 1304.54,1326.17 1306.85,1417.48 1309.16,1563.63 1311.47,1353.58 1313.78,1470.68 1316.08,1476.55 1318.39,1418 1320.7,1582.34 1323.01,1612.59 1325.32,1542.57 1327.62,1604.96 1329.93,1457.57 1332.24,1394.04 1334.55,1434.05 1336.86,1518.08 1339.16,1491.37 1341.47,1546.17 1343.78,1584.31 1346.09,1498.3 1348.39,1475.7 1350.7,1529.06 1353.01,1499.09 1355.32,1418.44 1357.63,1474.94 1359.93,1476.53 1362.24,1510.78 1364.55,1483.4 1366.86,1436.41 1369.17,1538.4 1371.47,1588.28 1373.78,1437.6 1376.09,1412.81 1378.4,1381.12 1380.71,1302.49 1383.01,1373.4 1385.32,1371.3 1387.63,1408.2 1389.94,1644.07 1392.24,1528.58 1394.55,1597.95 1396.86,1567.68 1399.17,1472.71 1401.48,1537.59 1403.78,1366.41 1406.09,1334.07 1408.4,1649.86 1410.71,1464 1413.02,1398.34 1415.32,1448.2 1417.63,1588.82 1419.94,1308.9 1422.25,1422.96 1424.56,1491.38 1426.86,1301.81 1429.17,1513.61 1431.48,1421.44 1433.79,1424.99 1436.1,1408.12 1438.4,1328.87 1440.71,1360.38 1443.02,1646.7 1445.33,1597 1447.63,1459.92 1449.94,1374.27 1452.25,1396.4 1454.56,1460.31 1456.87,1422.81 1459.17,1272.63 1461.48,1217.17 1463.79,1527.36 1466.1,1403.44 1468.41,1535.61 1470.71,1507.34 1473.02,1524.05 1475.33,1442.35 1477.64,1424.97 1479.95,1424.69 1482.25,1319.73 1484.56,1570.72 1486.87,1494.2 1489.18,1616.7 1491.49,1633.03 1493.79,1313.23 1496.1,1267.14 1498.41,1458.26 1500.72,1538.16 1503.02,1496.78 1505.33,1425.59 1507.64,1488.36 1509.95,1470.87 1512.26,1517.97 1514.56,1544.7 1516.87,1329.98 1519.18,1316.06 1521.49,1492.08 1523.8,1524.47 1526.1,1521.08 1528.41,1366 1530.72,1500.87 1533.03,1693.61 1535.34,1274.62 1537.64,1515.7 1539.95,1361.52 1542.26,1317.19 1544.57,1398.37 1546.88,1421.15 1549.18,1613.77 1551.49,1473.6 1553.8,1508.08 1556.11,1591.99 1558.41,1548.62 1560.72,1480.85 1563.03,1374.66 1565.34,1386.96 1567.65,1361.16 1569.95,1375.97 1572.26,1289.45 1574.57,1536.05 1576.88,1468.81 1579.19,1696.89 1581.49,1564.69 1583.8,1542.63 1586.11,1509.59 1588.42,1432.12 1590.73,1493.36 1593.03,1566.6 1595.34,1418.12 1597.65,1335.11 1599.96,1406.22 1602.26,1430.91 1604.57,1584.11 1606.88,1476.26 1609.19,1419.39 1611.5,1377.22 1613.8,1144.99 1616.11,1502.74 1618.42,1619.03 1620.73,1498.89 1623.04,1473.48 1625.34,1419.34 1627.65,1272.25 1629.96,1454.87 1632.27,1409.11 1634.58,1337.19 1636.88,1522.5 1639.19,1411.94 1641.5,1307.45 1643.81,1391.43 1646.12,1434.75 1648.42,1306.26 1650.73,1541.11 1653.04,1399.25 1655.35,1456.89 1657.65,1493.72 1659.96,1319.36 1662.27,1439.2 1664.58,1213.68 1666.89,1357.36 1669.19,1295.15 1671.5,1472.25 1673.81,1556.62 1676.12,1462.06 1678.43,1399.58 1680.73,1620.95 1683.04,1482.11 1685.35,1336.11 1687.66,1338.9 1689.97,1456.4 1692.27,1502.84 1694.58,1295.3 1696.89,1446.78 1699.2,1615.87 1701.51,1512.18 1703.81,1470.94 1706.12,1217.39 1708.43,1440.38 1710.74,1518.79 1713.04,1396.77 1715.35,1409.65 1717.66,1441.24 1719.97,1598 1722.28,1468.35 1724.58,1359.24 1726.89,1476.05 1729.2,1224.72 1731.51,1565.29 1733.82,1494.13 1736.12,1554.55 1738.43,1400.66 1740.74,1443.07 1743.05,1669.55 1745.36,1516.87 1747.66,1484.19 1749.97,1523.47 1752.28,1198.6 1754.59,1539.27 1756.9,1401.35 1759.2,1609.33 1761.51,1401.87 1763.82,1340.67 1766.13,1526.11 1768.43,1424.88 1770.74,1459.28 1773.05,1507.3 1775.36,1509.26 1777.67,1531.44 1779.97,1494.67 1782.28,1265.54 1784.59,1328.74 1786.9,1482.65 1789.21,1416.59 1791.51,1350.44 1793.82,1298.36 1796.13,1404.76 1798.44,1561.4 1800.75,1463.96 1803.05,1504.35 1805.36,1406.69 1807.67,1434.51 1809.98,1392.12 1812.28,1530.91 1814.59,1440.99 1816.9,1568.97 1819.21,1307.83 1821.52,1495.92 1823.82,1598.02 1826.13,1404.34 1828.44,1454.88 1830.75,1586.42 1833.06,1469.9 1835.36,1421.2 1837.67,1520.24 1839.98,1454.8 1842.29,1469.45 1844.6,1616.56 1846.9,1538.28 1849.21,1440.95 1851.52,1324.53 1853.83,1190.17 1856.14,1456 1858.44,1457.16 1860.75,1502.71 1863.06,1510.61 1865.37,1464.38 1867.67,1446.03 1869.98,1557.82 1872.29,1358.22 1874.6,1543.17 1876.91,1545.47 1879.21,1338.39 1881.52,1503.12 1883.83,1581.76 1886.14,1487.18 1888.45,1416.55 1890.75,1443.24 1893.06,1665.25 1895.37,1586.53 1897.68,1547.58 1899.99,1427.05 1902.29,1477.37 1904.6,1459.8 1906.91,1478.21 1909.22,1482.74 1911.53,1305.85 1913.83,1427.32 1916.14,1339.24 1918.45,1309.86 1920.76,1669.86 1923.06,1482.15 1925.37,1444.98 1927.68,1488.73 1929.99,1514.7 1932.3,1577.59 1934.6,1394.69 1936.91,1457.82 1939.22,1387.61 1941.53,1581.04 1943.84,1568.18 1946.14,1439.63 1948.45,1533.78 1950.76,1323.64 1953.07,1488.05 1955.38,1243.43 1957.68,1751.15 1959.99,1343.65 1962.3,1664.12 1964.61,1304.15 1966.91,1449.71 1969.22,1576.36 1971.53,1550.3 1973.84,1427 1976.15,1443.51 1978.45,1345.1 1980.76,1399.4 1983.07,1518.23 1985.38,1451.63 1987.69,1510.89 1989.99,1258.13 1992.3,1456.46 1994.61,1521.45 1996.92,1342.55 1999.23,1402.78 2001.53,1451.67 2003.84,1510.88 2006.15,1412.77 2008.46,1614.78 2010.77,1495.09 2013.07,1529.56 2015.38,1442.72 2017.69,1564.18 2020,1314.06 2022.3,1509.88 2024.61,1390.14 2026.92,1452.84 2029.23,1491.04 2031.54,1480.64 2033.84,1361.62 2036.15,1477.71 2038.46,1447.8 2040.77,1299.62 2043.08,1431.43 2045.38,1442.6 2047.69,1473 2050,1285.41 2052.31,1359.85 2054.62,1439.81 2056.92,1545.96 2059.23,1436.25 2061.54,1624.16 2063.85,1339.7 2066.16,1332.21 2068.46,1467.84 2070.77,1568.83 2073.08,1449.71 2075.39,1462.46 2077.69,1555.94 2080,1517.72 2082.31,1561.88 2084.62,1460.65 2086.93,1452.86 2089.23,1515.96 2091.54,1535.05 2093.85,1258.84 2096.16,1447.18 2098.47,1468.92 2100.77,1291.67 2103.08,1591.46 2105.39,1620.25 2107.7,1245.79 2110.01,1463 2112.31,1503.32 2114.62,1476.06 2116.93,1512.55 2119.24,1437.52 2121.55,1434.7 2123.85,1445.29 2126.16,1225.69 2128.47,1535.83 2130.78,1451.47 2133.08,1534.63 2135.39,1435.39 2137.7,1388.98 2140.01,1517.03 2142.32,1449.67 2144.62,1454.29 2146.93,1628.69 2149.24,1531.05 2151.55,1366.94 2153.86,1616.54 2156.16,1385.49 2158.47,1284.73 2160.78,1398.94 2163.09,1499.98 2165.4,1527.98 2167.7,1331.85 2170.01,1396.93 2172.32,1451.25 2174.63,1437.94 2176.93,1639.92 2179.24,1459.54 2181.55,1541.09 2183.86,1249.46 2186.17,1401.66 2188.47,1442.2 2190.78,1479.58 2193.09,1537.16 2195.4,1561.32 2197.71,1353.99 2200.01,1327.2 2202.32,1490.19 2204.63,1357.1 2206.94,1614.98 2209.25,1512.56 2211.55,1483.29 2213.86,1330.62 2216.17,1424.65 2218.48,1538.08 2220.79,1385.05 2223.09,1519.57 2225.4,1462.05 2227.71,1367.05 2230.02,1460.24 2232.32,1425.26 2234.63,1500.21 2236.94,1425.02 2239.25,1322.91 2241.56,1454.64 2243.86,1406.27 2246.17,1508.03 2248.48,1446.17 2250.79,1381.15 2253.1,1584.71 2255.4,1318.25 2257.71,1443.62 2260.02,1412.54 2262.33,1567.44 2264.64,1383.79 2266.94,1404.83 2269.25,1431.11 2271.56,1473.77 2273.87,1617.84 2276.18,1506.23 2278.48,1480.2 2280.79,1499.03 2283.1,1545.37 2285.41,1362.8 2287.71,1335.29 2290.02,1549.81 2292.33,1600.52 2294.64,1439.71 2296.95,1482.67 2299.25,1362.57 2301.56,1362.3 2303.87,1505.86 2306.18,1415.02 2308.49,1463.96 2310.79,1333.85 2313.1,1450.44 2315.41,1513.41 2317.72,1282.49 2320.03,1242.81 2322.33,1552.02 2324.64,1565.52 2326.95,1553.3 2329.26,1549.79 2331.56,1458.74 2333.87,1422.99 2336.18,1339.65 2338.49,1430.35 2340.8,1386.38 2343.1,1533.56 2345.41,1447.51 2347.72,1352.76 2350.03,1477.14 2352.34,1537.62 2354.64,1531.05 2356.95,1542.97 2359.26,1464.4 2361.57,1360.2 2363.88,1444.64 2366.18,1416.85 2368.49,1558.95 2370.8,1445.11 2373.11,1621.69 2375.42,1372.79 2377.72,1475.68 2380.03,1456.52 2382.34,1364.58 2384.65,1601.85 2386.95,1478.24 2389.26,1410.18 2391.57,1490.07 2393.88,1184.4 2396.19,1339.32 2398.49,1347.1 2400.8,1302.18 2403.11,1403.79 2405.42,1444.7 2407.73,1501.7 2410.03,1662.42 2412.34,1400.55 2414.65,1606.9 2416.96,1437.53 2419.27,1469.41 2421.57,1330.79 2423.88,1472.59 2426.19,1516.74 2428.5,1426.35 2430.81,1314.37 2433.11,1480.03 2435.42,1442.05 2437.73,1526.46 2440.04,1545.08 2442.34,1611.59 2444.65,1551.17 2446.96,1448.58 2449.27,1513.5 2451.58,1297.69 2453.88,1403.93 2456.19,1611.17 2458.5,1412.99 2460.81,1327.5 2463.12,1341.28 2465.42,1572.18 2467.73,1406.53 2470.04,1407.24 2472.35,1579.78 2474.66,1527.68 2476.96,1673.82 2479.27,1652.86 2481.58,1627.51 2483.89,1527.06 2486.2,1510.1 2488.5,1501.76 2490.81,1323.78 2493.12,1515.05 2495.43,1467.19 2497.73,1422.65 2500.04,1644.92 2502.35,1433.73 2504.66,1486.17 2506.97,1240.68 2509.27,1499.21 2511.58,1453.16 2513.89,1514.03 2516.2,1339.98 2518.51,1466.04 2520.81,1365.89 2523.12,1563.84 2525.43,1499.86 2527.74,1590.59 2530.05,1581.07 2532.35,1409.76 2534.66,1495.09 2536.97,1357.01 2539.28,1608.34 2541.58,1150.97 2543.89,1565.49 2546.2,1401.53 2548.51,1405.52 2550.82,1495.2 2553.12,1351.95 2555.43,1395.31 2557.74,1241.99 2560.05,1452.81 2562.36,1551.39 2564.66,1411.9 2566.97,1576.07 2569.28,1629.73 2571.59,1597.61 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1062.8 268.292,959.207 270.6,971.862 272.908,851.767 275.216,869.98 277.524,1045.43 279.832,959.419 282.139,811.861 284.447,1010.8 286.755,951.52 289.063,1002.94 291.371,746.898 293.679,808.883 295.987,991.363 298.295,893.443 300.603,987.252 302.911,858.555 305.219,925.604 307.527,716.944 309.834,1021.79 312.142,1226.26 314.45,1022.57 316.758,1010.1 319.066,953.341 321.374,1030.61 323.682,989.802 325.99,858.56 328.298,843.66 330.606,1130.84 332.914,1054.79 335.221,1019.88 337.529,919.526 339.837,969.138 342.145,856 344.453,869.843 346.761,930.848 349.069,964.799 351.377,810.148 353.685,986.136 355.993,858.277 358.301,1121.14 360.608,1053.54 362.916,1068.33 365.224,1032.93 367.532,899.254 369.84,969.647 372.148,917.404 374.456,978.118 376.764,959.686 379.072,994.418 381.38,1069.84 383.688,1005.81 385.996,906.381 388.303,885.582 390.611,990.906 392.919,887.225 395.227,985.145 397.535,992.433 399.843,932.34 402.151,1193.84 404.459,1107.79 406.767,1007.22 409.075,910.847 411.383,999.322 413.69,867.329 415.998,1005.66 418.306,985.149 420.614,1054.75 422.922,1053.03 425.23,1005.51 427.538,947.875 429.846,845.036 432.154,1017.81 434.462,868.232 436.77,834.293 439.077,980.483 441.385,951.244 443.693,998.282 446.001,902.448 448.309,875.153 450.617,930.055 452.925,901.689 455.233,1105.53 457.541,936.258 459.849,803.309 462.157,1022.04 464.465,894.887 466.772,1158.72 469.08,1206.58 471.388,1009.12 473.696,1009.23 476.004,995.776 478.312,1035.8 480.62,1047.98 482.928,1095.05 485.236,900.82 487.544,887.148 489.852,1112.02 492.159,813.753 494.467,994.291 496.775,1159.04 499.083,963.464 501.391,1003.9 503.699,1030.57 506.007,919.445 508.315,1137.15 510.623,911.67 512.931,959.906 515.239,981.606 517.546,819.155 519.854,1024.99 522.162,942.874 524.47,893.411 526.778,933.477 529.086,1030.27 531.394,866.432 533.702,864.149 536.01,1100.34 538.318,1034.16 540.626,920.992 542.933,870.053 545.241,1058.39 547.549,945.606 549.857,845.358 552.165,810.651 554.473,1236.73 556.781,1038.69 559.089,999.655 561.397,896.844 563.705,886.817 566.013,672.413 568.321,957.428 570.628,978.782 572.936,816.296 575.244,925.047 577.552,985.956 579.86,865.864 582.168,1023.4 584.476,773.903 586.784,742.908 589.092,1098.37 591.4,937.27 593.708,1018.92 596.015,896.316 598.323,947.394 600.631,1006.83 602.939,980.018 605.247,1051.09 607.555,954.095 609.863,930.971 612.171,1009.31 614.479,1053.47 616.787,894.784 619.095,980.158 621.402,1003.65 623.71,929.41 626.018,856.113 628.326,973.379 630.634,1170.23 632.942,1181.18 635.25,1228.1 637.558,993.623 639.866,780.008 642.174,1036.87 644.482,822.281 646.79,1005.69 649.097,1038.92 651.405,805.989 653.713,1097.57 656.021,851.369 658.329,997.608 660.637,1128.03 662.945,736.788 665.253,908.163 667.561,931.507 669.869,1042.12 672.177,994.266 674.484,959.411 676.792,956.701 679.1,944.073 681.408,851.101 683.716,1076.58 686.024,1041.1 688.332,1069.8 690.64,903.201 692.948,980.372 695.256,838.129 697.564,936.464 699.871,968.046 702.179,1062.32 704.487,1102.2 706.795,1175.75 709.103,1005.15 711.411,889.353 713.719,1023.09 716.027,957.504 718.335,932.217 720.643,714.082 722.951,1106.07 725.259,954.251 727.566,1005.74 729.874,1058.76 732.182,1106.2 734.49,729.517 736.798,831.688 739.106,1084.39 741.414,1023.68 743.722,1068.95 746.03,934.768 748.338,811.039 750.646,1035.77 752.953,807.404 755.261,973.193 757.569,1019.58 759.877,963.13 762.185,956.386 764.493,841.289 766.801,1093.32 769.109,851.527 771.417,953.129 773.725,890.555 776.033,725.795 778.34,830.107 780.648,1019.86 782.956,1089.25 785.264,989.595 787.572,960.748 789.88,1082.95 792.188,1073.75 794.496,815.061 796.804,1002.99 799.112,851.674 801.42,1001.51 803.728,987.742 806.035,893.469 808.343,957.203 810.651,1013.44 812.959,1037.15 815.267,994.281 817.575,906.771 819.883,1084.08 822.191,1124.9 824.499,952.212 826.807,1060.89 829.115,973.045 831.422,836.464 833.73,984.665 836.038,955.288 838.346,1004.9 840.654,960.267 842.962,937.116 845.27,1114.62 847.578,910.302 849.886,763.952 852.194,803.321 854.502,1014.62 856.809,1005.46 859.117,869.204 861.425,1034.21 863.733,960.278 866.041,1024.75 868.349,1034.03 870.657,1007.11 872.965,1121.12 875.273,1080.03 877.581,892.104 879.889,999.261 882.197,1007.07 884.504,1063.96 886.812,890.24 889.12,829.048 891.428,1005.5 893.736,1056.63 896.044,1229.01 898.352,979.041 900.66,784.561 902.968,1067.07 905.276,1057.95 907.584,854.716 909.891,943.992 912.199,956.484 914.507,904.076 916.815,1002.11 919.123,901.599 921.431,948.389 923.739,870.518 926.047,1022.56 928.355,938.973 930.663,1079.48 932.971,961.014 935.278,863.297 937.586,866.622 939.894,916.039 942.202,1026.96 944.51,920.101 946.818,939.12 949.126,1068.44 951.434,938.945 953.742,1031.88 956.05,1129.55 958.358,889.956 960.665,853.706 962.973,988.46 965.281,1024.91 967.589,1069.7 969.897,838.738 972.205,801.086 974.513,941.556 976.821,1122.01 979.129,1175.06 981.437,1005.82 983.745,927.785 986.053,763.228 988.36,851.758 990.668,937.909 992.976,1082.54 995.284,951.321 997.592,798.321 999.9,957.507 1002.21,896.234 1004.52,943.795 1006.82,939.655 1009.13,1059.45 1011.44,952.938 1013.75,854.743 1016.06,991.618 1018.36,861.453 1020.67,926.265 1022.98,791.281 1025.29,1181.17 1027.59,1053.45 1029.9,973.749 1032.21,902.346 1034.52,932.79 1036.83,846.285 1039.13,925.338 1041.44,824.895 1043.75,1147.6 1046.06,947.401 1048.37,886.29 1050.67,1012.65 1052.98,956.459 1055.29,806.11 1057.6,1015.23 1059.91,1124.63 1062.21,867.414 1064.52,1002.56 1066.83,849.136 1069.14,992.609 1071.45,944.879 1073.75,874.034 1076.06,859.566 1078.37,1103.86 1080.68,863.561 1082.98,865.61 1085.29,897.706 1087.6,1075.86 1089.91,1051.16 1092.22,1065.78 1094.52,1050.76 1096.83,1070.09 1099.14,918.128 1101.45,1004.06 1103.76,907.59 1106.06,952.539 1108.37,930.596 1110.68,976.181 1112.99,1069.7 1115.3,723.512 1117.6,952.338 1119.91,1171.1 1122.22,959.731 1124.53,1022.24 1126.84,982.151 1129.14,1117.86 1131.45,819.761 1133.76,740.934 1136.07,1118.15 1138.37,935.561 1140.68,914.793 1142.99,899.506 1145.3,1137.4 1147.61,927.776 1149.91,979.923 1152.22,1147.59 1154.53,879.948 1156.84,886.301 1159.15,786.029 1161.45,932.692 1163.76,876.006 1166.07,999.775 1168.38,991.89 1170.69,859.996 1172.99,1057.12 1175.3,873.205 1177.61,903.528 1179.92,884.489 1182.23,957.049 1184.53,925.996 1186.84,995.54 1189.15,964.58 1191.46,1115.17 1193.76,898.733 1196.07,1016.44 1198.38,976.723 1200.69,955.265 1203,906.043 1205.3,808.323 1207.61,982.296 1209.92,891.833 1212.23,805.66 1214.54,1015.29 1216.84,1125.97 1219.15,915.987 1221.46,841.728 1223.77,799.884 1226.08,986.548 1228.38,834.57 1230.69,789.415 1233,891.378 1235.31,1115.03 1237.61,1060.24 1239.92,1051.64 1242.23,896.346 1244.54,1085.92 1246.85,1141.19 1249.15,917.826 1251.46,1087.43 1253.77,850.85 1256.08,1028.92 1258.39,1123.1 1260.69,888.076 1263,971.442 1265.31,984.003 1267.62,954.799 1269.93,1065.4 1272.23,968.11 1274.54,797.939 1276.85,890.594 1279.16,904.234 1281.47,867.549 1283.77,1026.6 1286.08,871.757 1288.39,997.294 1290.7,916.138 1293,934.709 1295.31,985.612 1297.62,981.286 1299.93,1141.46 1302.24,882.007 1304.54,1092.95 1306.85,919.489 1309.16,943.839 1311.47,949.678 1313.78,902.729 1316.08,765.841 1318.39,803.402 1320.7,768.945 1323.01,939.663 1325.32,1018.13 1327.62,904.285 1329.93,1075.79 1332.24,885.86 1334.55,1076.2 1336.86,791.586 1339.16,1219.7 1341.47,980.663 1343.78,1073.91 1346.09,883.297 1348.39,804.916 1350.7,1030.43 1353.01,907.761 1355.32,1043.06 1357.63,1160.09 1359.93,950.527 1362.24,1049.95 1364.55,1025.86 1366.86,823.174 1369.17,992.6 1371.47,1096.91 1373.78,806.699 1376.09,942.001 1378.4,922.739 1380.71,831.355 1383.01,894.431 1385.32,1066.07 1387.63,771.117 1389.94,971.147 1392.24,829.286 1394.55,982.792 1396.86,1052.55 1399.17,905.554 1401.48,1036.33 1403.78,883.591 1406.09,914.625 1408.4,1146.68 1410.71,940.234 1413.02,982.189 1415.32,1082.7 1417.63,938.014 1419.94,938.917 1422.25,928.619 1424.56,967.978 1426.86,1180.61 1429.17,855.173 1431.48,1034.57 1433.79,1152.36 1436.1,816.339 1438.4,1094.92 1440.71,996.655 1443.02,1069.28 1445.33,1021.36 1447.63,1006.67 1449.94,1067.21 1452.25,1076.63 1454.56,972.367 1456.87,1016.49 1459.17,1046.53 1461.48,850.183 1463.79,986.466 1466.1,847.763 1468.41,892.671 1470.71,983.431 1473.02,1044.02 1475.33,1001.11 1477.64,913.694 1479.95,826.5 1482.25,944.893 1484.56,1013.87 1486.87,1031.11 1489.18,1006.62 1491.49,994.947 1493.79,911.816 1496.1,783.634 1498.41,869.561 1500.72,1016.95 1503.02,944.288 1505.33,1106.2 1507.64,964.486 1509.95,686.799 1512.26,1062.07 1514.56,1060.43 1516.87,760.768 1519.18,907.322 1521.49,978.644 1523.8,1061.39 1526.1,938.551 1528.41,963.408 1530.72,1185.91 1533.03,965.395 1535.34,681.292 1537.64,1130.76 1539.95,796.216 1542.26,991.188 1544.57,955.724 1546.88,1037.55 1549.18,709.401 1551.49,1058.34 1553.8,931.039 1556.11,874.82 1558.41,1037.88 1560.72,904.672 1563.03,1020.5 1565.34,905.252 1567.65,811.425 1569.95,899.361 1572.26,1127.2 1574.57,1213.02 1576.88,1057.32 1579.19,872.285 1581.49,1207.09 1583.8,907.855 1586.11,1053.16 1588.42,993.668 1590.73,846.954 1593.03,953.49 1595.34,861.684 1597.65,696.638 1599.96,826.201 1602.26,1044.07 1604.57,849.015 1606.88,1191.97 1609.19,957.128 1611.5,1072.35 1613.8,1095.77 1616.11,967.969 1618.42,826.547 1620.73,921.778 1623.04,965.589 1625.34,1034.62 1627.65,799.512 1629.96,863.355 1632.27,889.072 1634.58,918.56 1636.88,1030.24 1639.19,688.124 1641.5,810.493 1643.81,1043.88 1646.12,1041.71 1648.42,863.464 1650.73,1185.19 1653.04,909.332 1655.35,891.286 1657.65,981.865 1659.96,1073.4 1662.27,925.266 1664.58,935.044 1666.89,855.801 1669.19,980.737 1671.5,906.129 1673.81,1025.13 1676.12,944.298 1678.43,998.473 1680.73,832.062 1683.04,963.976 1685.35,938.402 1687.66,966.37 1689.97,1189.84 1692.27,961.851 1694.58,973.605 1696.89,862.04 1699.2,1086.16 1701.51,737.489 1703.81,971.008 1706.12,859.692 1708.43,1040.71 1710.74,947.764 1713.04,1063.94 1715.35,1024.66 1717.66,832.734 1719.97,979.913 1722.28,1032 1724.58,1072.61 1726.89,1033.7 1729.2,1038.57 1731.51,912.873 1733.82,905.325 1736.12,1025.45 1738.43,970.881 1740.74,996.469 1743.05,843.556 1745.36,769.513 1747.66,901.462 1749.97,1033.47 1752.28,1022.86 1754.59,977.271 1756.9,924.137 1759.2,1094.14 1761.51,996.572 1763.82,1093.87 1766.13,881.32 1768.43,920.77 1770.74,864.918 1773.05,959.905 1775.36,1063.24 1777.67,1069.38 1779.97,988.839 1782.28,952.786 1784.59,866.575 1786.9,808.779 1789.21,1049.72 1791.51,1000.41 1793.82,860.136 1796.13,975.334 1798.44,934.543 1800.75,1145.2 1803.05,950.471 1805.36,986.997 1807.67,725.091 1809.98,1163.52 1812.28,900.534 1814.59,1042.99 1816.9,963.794 1819.21,1093.02 1821.52,825.972 1823.82,986.809 1826.13,814.523 1828.44,904.212 1830.75,933.932 1833.06,934.349 1835.36,1045.83 1837.67,937.506 1839.98,1055.33 1842.29,1058.84 1844.6,902.665 1846.9,967.337 1849.21,798.071 1851.52,1014.23 1853.83,984.959 1856.14,786.011 1858.44,949.058 1860.75,939.818 1863.06,1002.23 1865.37,968.286 1867.67,1101.25 1869.98,844.8 1872.29,891.264 1874.6,990.125 1876.91,1065.46 1879.21,866.27 1881.52,923.014 1883.83,783.085 1886.14,1053.8 1888.45,1051.51 1890.75,996.891 1893.06,1051.42 1895.37,1162.43 1897.68,1033.19 1899.99,1067.65 1902.29,873.453 1904.6,824.678 1906.91,843.121 1909.22,914.987 1911.53,862.623 1913.83,955.163 1916.14,840.589 1918.45,880.385 1920.76,763.039 1923.06,1022.83 1925.37,1113.95 1927.68,903.653 1929.99,786.329 1932.3,1087.46 1934.6,859.219 1936.91,1002.45 1939.22,1014.44 1941.53,1159.32 1943.84,967.833 1946.14,950.941 1948.45,1132.22 1950.76,787.721 1953.07,852.989 1955.38,803.908 1957.68,1015.36 1959.99,822.471 1962.3,969.141 1964.61,1050.29 1966.91,841.612 1969.22,1045.78 1971.53,1013.4 1973.84,964.974 1976.15,1005.31 1978.45,918.106 1980.76,880.289 1983.07,1023.04 1985.38,987.868 1987.69,1134.96 1989.99,991.033 1992.3,1015 1994.61,960.738 1996.92,957.01 1999.23,962.88 2001.53,1002.75 2003.84,898.57 2006.15,1142.55 2008.46,807.758 2010.77,1047.61 2013.07,951.982 2015.38,872.963 2017.69,932.918 2020,1111.77 2022.3,951.821 2024.61,1046.74 2026.92,1145.67 2029.23,999.254 2031.54,1018.68 2033.84,1060.79 2036.15,820.147 2038.46,1069.54 2040.77,937.248 2043.08,961.692 2045.38,1085.36 2047.69,867.755 2050,1017.17 2052.31,1003.02 2054.62,1071.33 2056.92,1033.33 2059.23,959.858 2061.54,823.431 2063.85,946.795 2066.16,1064.92 2068.46,1084.59 2070.77,821.744 2073.08,975.534 2075.39,892.587 2077.69,1125.76 2080,1072.93 2082.31,854.969 2084.62,762.013 2086.93,894.887 2089.23,1034.66 2091.54,758.486 2093.85,966.157 2096.16,1062.83 2098.47,1040.53 2100.77,971.656 2103.08,935.337 2105.39,903.512 2107.7,985.805 2110.01,759.56 2112.31,1051.01 2114.62,962.454 2116.93,979.975 2119.24,1070.99 2121.55,803.617 2123.85,1089.19 2126.16,863.15 2128.47,905.344 2130.78,1094.36 2133.08,1029.76 2135.39,867.616 2137.7,925.696 2140.01,1107.19 2142.32,892.987 2144.62,1018.61 2146.93,1040.31 2149.24,1029.71 2151.55,858.742 2153.86,961.401 2156.16,923.225 2158.47,1089.16 2160.78,807.659 2163.09,875.558 2165.4,802.51 2167.7,872.906 2170.01,1014.78 2172.32,976.784 2174.63,911.448 2176.93,822.703 2179.24,878.563 2181.55,964.68 2183.86,831.085 2186.17,975.879 2188.47,935.022 2190.78,1035.95 2193.09,947.828 2195.4,834.15 2197.71,995.477 2200.01,981.185 2202.32,916.24 2204.63,1081.8 2206.94,878.666 2209.25,819.397 2211.55,1059.41 2213.86,908.548 2216.17,1098.81 2218.48,967.3 2220.79,921.058 2223.09,968.632 2225.4,737.857 2227.71,854.066 2230.02,1062.64 2232.32,971.908 2234.63,884.334 2236.94,834.786 2239.25,983.268 2241.56,1061.55 2243.86,1132.73 2246.17,971.633 2248.48,814.498 2250.79,882.249 2253.1,1129.57 2255.4,847.421 2257.71,1045.12 2260.02,861.867 2262.33,1154.27 2264.64,941.22 2266.94,995.338 2269.25,919.016 2271.56,963.018 2273.87,1067.11 2276.18,920.438 2278.48,1094.05 2280.79,909.945 2283.1,976.992 2285.41,1224.84 2287.71,1004 2290.02,1049.77 2292.33,1114.42 2294.64,986.175 2296.95,937.886 2299.25,1036.38 2301.56,946.718 2303.87,1045.53 2306.18,1197.87 2308.49,786.78 2310.79,930.899 2313.1,1066.76 2315.41,910.736 2317.72,1029.55 2320.03,914.775 2322.33,767.961 2324.64,920.947 2326.95,947.92 2329.26,982.283 2331.56,1096.31 2333.87,1018.54 2336.18,917.054 2338.49,818.989 2340.8,943.839 2343.1,992.351 2345.41,980.722 2347.72,698.889 2350.03,802.117 2352.34,933.233 2354.64,992.603 2356.95,1019.94 2359.26,829.494 2361.57,1010.51 2363.88,1054.97 2366.18,959.04 2368.49,895.087 2370.8,1157.08 2373.11,953.783 2375.42,864.478 2377.72,916.651 2380.03,1156.9 2382.34,953.773 2384.65,1075.94 2386.95,933.936 2389.26,985.032 2391.57,1010.17 2393.88,985.665 2396.19,1153.09 2398.49,1145.53 2400.8,973.03 2403.11,898.452 2405.42,1057.23 2407.73,814.879 2410.03,1078.49 2412.34,1076.91 2414.65,976.156 2416.96,983.086 2419.27,712.169 2421.57,1031.94 2423.88,919.495 2426.19,880.345 2428.5,845.327 2430.81,972.544 2433.11,1171.95 2435.42,886.548 2437.73,796.791 2440.04,905.116 2442.34,892.188 2444.65,983.706 2446.96,957.574 2449.27,1048.01 2451.58,797.914 2453.88,961.132 2456.19,995.485 2458.5,782.262 2460.81,977.652 2463.12,1195.97 2465.42,843.378 2467.73,916.617 2470.04,982.546 2472.35,852.246 2474.66,1098.01 2476.96,1095 2479.27,1004.22 2481.58,1080.57 2483.89,1102.2 2486.2,1107.08 2488.5,937.625 2490.81,1022.85 2493.12,974.647 2495.43,1162.89 2497.73,846.519 2500.04,1063.06 2502.35,917.373 2504.66,970.707 2506.97,859.852 2509.27,991.566 2511.58,878.655 2513.89,1132.76 2516.2,1070.82 2518.51,977.422 2520.81,1114.17 2523.12,1007.86 2525.43,985.934 2527.74,1066.48 2530.05,811.328 2532.35,1013.47 2534.66,927.242 2536.97,986.711 2539.28,912.788 2541.58,1064.09 2543.89,894.405 2546.2,1003.75 2548.51,1083.93 2550.82,1033.4 2553.12,871.887 2555.43,965.13 2557.74,1085.56 2560.05,953.489 2562.36,914.856 2564.66,903.584 2566.97,1195.79 2569.28,1019.08 2571.59,972.606 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,577.286 268.292,392.901 270.6,487.101 272.908,498.285 275.216,507.303 277.524,366.42 279.832,561.861 282.139,343.311 284.447,529.502 286.755,453.472 289.063,490.689 291.371,566.668 293.679,566.878 295.987,300.161 298.295,617.963 300.603,518.115 302.911,434.362 305.219,395.828 307.527,464.314 309.834,412.672 312.142,699.588 314.45,594.054 316.758,418.298 319.066,410.464 321.374,534.18 323.682,536.558 325.99,388.045 328.298,654.146 330.606,518.436 332.914,422.314 335.221,414.859 337.529,369.059 339.837,615.282 342.145,747.163 344.453,574.738 346.761,525.263 349.069,648.234 351.377,615.497 353.685,386.86 355.993,435.631 358.301,543.191 360.608,440.936 362.916,336.853 365.224,506.169 367.532,434.026 369.84,415.808 372.148,593.91 374.456,399.227 376.764,386.578 379.072,501.899 381.38,567.739 383.688,554.731 385.996,565.721 388.303,529.534 390.611,316.213 392.919,335.549 395.227,368.996 397.535,446.094 399.843,626.39 402.151,306.443 404.459,614.843 406.767,593.596 409.075,409.269 411.383,485.547 413.69,490.206 415.998,367.645 418.306,409.476 420.614,365.996 422.922,417.332 425.23,521.321 427.538,524.193 429.846,599.71 432.154,649.054 434.462,567.687 436.77,619.682 439.077,528.753 441.385,345.913 443.693,630.735 446.001,520.081 448.309,540.305 450.617,584.964 452.925,514.554 455.233,461.641 457.541,600.419 459.849,364.31 462.157,445.794 464.465,447.296 466.772,476.993 469.08,486.94 471.388,253.103 473.696,374.201 476.004,561.445 478.312,351.984 480.62,662.964 482.928,405.794 485.236,348.364 487.544,670.981 489.852,619.944 492.159,316.837 494.467,522.172 496.775,278.746 499.083,343.346 501.391,444.071 503.699,429.213 506.007,425.351 508.315,548.729 510.623,399.833 512.931,532.847 515.239,495.322 517.546,582.928 519.854,415.924 522.162,555.406 524.47,637.205 526.778,547.722 529.086,302.752 531.394,501.157 533.702,446.125 536.01,333.461 538.318,309.803 540.626,379.186 542.933,475.542 545.241,376.334 547.549,645.605 549.857,502.584 552.165,373.782 554.473,333.453 556.781,291.669 559.089,366.447 561.397,457.537 563.705,483.54 566.013,496.566 568.321,438.142 570.628,420.645 572.936,594.766 575.244,490.549 577.552,269.865 579.86,673.069 582.168,305.845 584.476,400.087 586.784,578.584 589.092,498.434 591.4,583.789 593.708,443.305 596.015,488.985 598.323,633.031 600.631,439.627 602.939,472.963 605.247,445.212 607.555,525.997 609.863,372.06 612.171,368.303 614.479,405.145 616.787,551.051 619.095,379.364 621.402,392.128 623.71,652.707 626.018,542.223 628.326,605.002 630.634,302.393 632.942,491.419 635.25,469.556 637.558,354.975 639.866,270.321 642.174,496.14 644.482,496.883 646.79,541.089 649.097,351.593 651.405,534.887 653.713,346.453 656.021,410.779 658.329,362.646 660.637,283.179 662.945,480.652 665.253,631.866 667.561,290.939 669.869,615.202 672.177,444.137 674.484,446.998 676.792,326.999 679.1,510.247 681.408,485.284 683.716,509.784 686.024,426.956 688.332,433.937 690.64,593.761 692.948,548.138 695.256,425.409 697.564,254.926 699.871,269.283 702.179,617.587 704.487,336.795 706.795,374.033 709.103,303.302 711.411,614.007 713.719,384.911 716.027,640.426 718.335,472.267 720.643,440.535 722.951,512.432 725.259,488.805 727.566,511.703 729.874,436.781 732.182,382.644 734.49,526.406 736.798,461.564 739.106,661.797 741.414,475.472 743.722,502.956 746.03,375.789 748.338,627.626 750.646,577.873 752.953,215.007 755.261,413.33 757.569,397.43 759.877,544.426 762.185,522.988 764.493,538.868 766.801,484.871 769.109,335.751 771.417,394.954 773.725,617.863 776.033,514.98 778.34,419.302 780.648,627.542 782.956,445.419 785.264,591.199 787.572,535.027 789.88,481.246 792.188,458.857 794.496,471.96 796.804,446.915 799.112,434.927 801.42,685.661 803.728,714.163 806.035,512.018 808.343,522.451 810.651,379.469 812.959,459.547 815.267,459.465 817.575,518.12 819.883,635.317 822.191,514.776 824.499,400.472 826.807,608.039 829.115,288.32 831.422,610.47 833.73,397.269 836.038,300.546 838.346,530.975 840.654,535.702 842.962,427.165 845.27,427.17 847.578,401.047 849.886,565.428 852.194,404.368 854.502,398.871 856.809,532.563 859.117,357.312 861.425,320.972 863.733,475.781 866.041,412.857 868.349,489.941 870.657,462.435 872.965,585.256 875.273,512.013 877.581,465.097 879.889,382.763 882.197,331.212 884.504,496.752 886.812,703.686 889.12,589.099 891.428,560.848 893.736,342.49 896.044,361.777 898.352,513.671 900.66,454.12 902.968,568.613 905.276,475.212 907.584,383.223 909.891,687.546 912.199,358.456 914.507,560.562 916.815,471.558 919.123,341.676 921.431,312.152 923.739,541.964 926.047,471.1 928.355,361.76 930.663,319.989 932.971,589.716 935.278,410.473 937.586,482.102 939.894,581.924 942.202,426.308 944.51,611.405 946.818,418.23 949.126,360.366 951.434,356.137 953.742,345.527 956.05,538.353 958.358,477.714 960.665,398.123 962.973,405.658 965.281,479.937 967.589,345.257 969.897,519.758 972.205,531.577 974.513,451.015 976.821,400.985 979.129,612.371 981.437,349.638 983.745,407.051 986.053,569.237 988.36,453.312 990.668,304.446 992.976,429.13 995.284,588.83 997.592,417.558 999.9,602.286 1002.21,530.821 1004.52,354.648 1006.82,428.999 1009.13,555.335 1011.44,426.297 1013.75,488.47 1016.06,408.264 1018.36,321.286 1020.67,400.137 1022.98,544.763 1025.29,467.94 1027.59,446.911 1029.9,621.598 1032.21,595.44 1034.52,422.05 1036.83,302.651 1039.13,389.712 1041.44,482.485 1043.75,690.762 1046.06,462.034 1048.37,507.596 1050.67,362.131 1052.98,593.979 1055.29,446.371 1057.6,689.642 1059.91,576.981 1062.21,400.72 1064.52,470.971 1066.83,272.784 1069.14,356.445 1071.45,562.783 1073.75,621.279 1076.06,361.164 1078.37,521.368 1080.68,522.253 1082.98,519.409 1085.29,386.487 1087.6,303.383 1089.91,448.688 1092.22,653.622 1094.52,315.17 1096.83,332.836 1099.14,442.517 1101.45,413.868 1103.76,394.153 1106.06,398.185 1108.37,459.369 1110.68,429.403 1112.99,575.299 1115.3,454.912 1117.6,444.412 1119.91,645.999 1122.22,601.138 1124.53,731.058 1126.84,365.846 1129.14,462.416 1131.45,573.978 1133.76,426.599 1136.07,404.882 1138.37,407.57 1140.68,307.89 1142.99,430.706 1145.3,551.27 1147.61,561.19 1149.91,526.085 1152.22,538.401 1154.53,531.378 1156.84,477.407 1159.15,427.539 1161.45,408.724 1163.76,488.755 1166.07,551.414 1168.38,466.646 1170.69,513.487 1172.99,513.024 1175.3,436.554 1177.61,387.681 1179.92,465.185 1182.23,482.092 1184.53,422.81 1186.84,546.989 1189.15,599.197 1191.46,471.557 1193.76,530.884 1196.07,425.124 1198.38,391.106 1200.69,568.469 1203,591.419 1205.3,418.932 1207.61,434.323 1209.92,557.163 1212.23,614.771 1214.54,567.508 1216.84,691.502 1219.15,399.291 1221.46,629.339 1223.77,461.259 1226.08,617.17 1228.38,429.053 1230.69,484.735 1233,574.723 1235.31,455.526 1237.61,621.364 1239.92,544.578 1242.23,584.997 1244.54,474.308 1246.85,472.512 1249.15,483.83 1251.46,195.042 1253.77,375.39 1256.08,615.51 1258.39,443.585 1260.69,515.434 1263,477.512 1265.31,642.162 1267.62,433.598 1269.93,461.474 1272.23,373.453 1274.54,434.216 1276.85,512.049 1279.16,260.729 1281.47,475.81 1283.77,369.434 1286.08,594.805 1288.39,397.436 1290.7,548.571 1293,609.451 1295.31,447.633 1297.62,534.056 1299.93,429.048 1302.24,526.462 1304.54,339.268 1306.85,460.954 1309.16,499.709 1311.47,392.937 1313.78,502.552 1316.08,495.234 1318.39,522.307 1320.7,96.8724 1323.01,556.498 1325.32,358.877 1327.62,503.428 1329.93,547.381 1332.24,523.933 1334.55,636.408 1336.86,459.449 1339.16,564.603 1341.47,578.241 1343.78,216.436 1346.09,613.686 1348.39,513.012 1350.7,543.99 1353.01,530.708 1355.32,472.801 1357.63,537.934 1359.93,509.6 1362.24,531.975 1364.55,376.331 1366.86,350.56 1369.17,528.798 1371.47,555.208 1373.78,681.209 1376.09,595.115 1378.4,550.5 1380.71,344.276 1383.01,445.138 1385.32,594.857 1387.63,297.818 1389.94,465.434 1392.24,502.208 1394.55,143.299 1396.86,561.765 1399.17,498.401 1401.48,344.302 1403.78,524.724 1406.09,480.508 1408.4,342.199 1410.71,614.908 1413.02,414.575 1415.32,459.005 1417.63,442.338 1419.94,475.925 1422.25,331.557 1424.56,431.663 1426.86,557.689 1429.17,503.408 1431.48,622.275 1433.79,336.618 1436.1,407.736 1438.4,412.211 1440.71,402.734 1443.02,543.07 1445.33,597.549 1447.63,484.666 1449.94,390.43 1452.25,450.438 1454.56,447.832 1456.87,438.761 1459.17,336.4 1461.48,372.294 1463.79,380.789 1466.1,551.897 1468.41,362.894 1470.71,530.143 1473.02,575.832 1475.33,538.719 1477.64,525.614 1479.95,551.806 1482.25,572.713 1484.56,575.084 1486.87,539.96 1489.18,414.763 1491.49,462.816 1493.79,427.843 1496.1,501.539 1498.41,350.393 1500.72,617.81 1503.02,323.174 1505.33,416.026 1507.64,319.332 1509.95,608.234 1512.26,555.317 1514.56,404.923 1516.87,499.295 1519.18,573.387 1521.49,490.262 1523.8,534.301 1526.1,569.311 1528.41,531.441 1530.72,383.191 1533.03,606.276 1535.34,607.667 1537.64,401.57 1539.95,525.515 1542.26,357.929 1544.57,437.098 1546.88,511.567 1549.18,371.411 1551.49,498.246 1553.8,345.539 1556.11,571.785 1558.41,473.481 1560.72,313.35 1563.03,412.412 1565.34,417.764 1567.65,542.963 1569.95,380.172 1572.26,483.737 1574.57,470.95 1576.88,493.803 1579.19,495.774 1581.49,584.271 1583.8,579.808 1586.11,606.637 1588.42,485.074 1590.73,534.837 1593.03,469.265 1595.34,524.024 1597.65,488.497 1599.96,516.917 1602.26,475.048 1604.57,421.261 1606.88,476.43 1609.19,519.773 1611.5,522.07 1613.8,335.231 1616.11,452.608 1618.42,460.345 1620.73,461.892 1623.04,610.916 1625.34,368.508 1627.65,464.751 1629.96,503.261 1632.27,321.912 1634.58,478.754 1636.88,476.869 1639.19,549.239 1641.5,275.919 1643.81,522.887 1646.12,487.457 1648.42,433.967 1650.73,632.571 1653.04,481.232 1655.35,454.967 1657.65,683.057 1659.96,410.485 1662.27,345.284 1664.58,600.284 1666.89,609.662 1669.19,546.046 1671.5,388.036 1673.81,535.374 1676.12,395.239 1678.43,501.443 1680.73,489.639 1683.04,441.37 1685.35,557.824 1687.66,471.168 1689.97,441.684 1692.27,406.59 1694.58,461.915 1696.89,485.913 1699.2,489.43 1701.51,580.407 1703.81,433.016 1706.12,679.261 1708.43,545.959 1710.74,445.109 1713.04,416.838 1715.35,424.253 1717.66,520.162 1719.97,459.244 1722.28,446.136 1724.58,426.886 1726.89,431.997 1729.2,633.766 1731.51,545.666 1733.82,655.179 1736.12,525.505 1738.43,517.509 1740.74,547.191 1743.05,358.715 1745.36,625.486 1747.66,372.577 1749.97,452.753 1752.28,338.113 1754.59,550.279 1756.9,478.671 1759.2,591.755 1761.51,355.974 1763.82,397.463 1766.13,428.444 1768.43,343.155 1770.74,533.771 1773.05,428.555 1775.36,435.571 1777.67,342.886 1779.97,369.499 1782.28,581.322 1784.59,428.039 1786.9,589.829 1789.21,480.391 1791.51,470.721 1793.82,445.49 1796.13,302.825 1798.44,509.519 1800.75,540.311 1803.05,386.314 1805.36,366.497 1807.67,448.219 1809.98,470.476 1812.28,281.59 1814.59,287.584 1816.9,553.274 1819.21,429.251 1821.52,578.123 1823.82,546.043 1826.13,532.882 1828.44,594.965 1830.75,545.957 1833.06,491.526 1835.36,458.518 1837.67,472.593 1839.98,494.344 1842.29,478.304 1844.6,599.952 1846.9,462.403 1849.21,403.675 1851.52,606.077 1853.83,451.019 1856.14,546.105 1858.44,423.426 1860.75,417.102 1863.06,483.914 1865.37,575.169 1867.67,495.692 1869.98,282.043 1872.29,441.037 1874.6,399.77 1876.91,477.728 1879.21,342.729 1881.52,485.682 1883.83,483.867 1886.14,533.245 1888.45,414.42 1890.75,567.816 1893.06,557.511 1895.37,297.157 1897.68,345.882 1899.99,455.073 1902.29,598.496 1904.6,533.534 1906.91,744.346 1909.22,365.577 1911.53,495.376 1913.83,515.284 1916.14,456.619 1918.45,495.602 1920.76,532.452 1923.06,438.745 1925.37,513.437 1927.68,255.308 1929.99,427.319 1932.3,415.479 1934.6,520.799 1936.91,434.186 1939.22,538.774 1941.53,508.751 1943.84,355.768 1946.14,632.147 1948.45,438.612 1950.76,435.053 1953.07,533.607 1955.38,409.068 1957.68,585.738 1959.99,602.582 1962.3,563.719 1964.61,597.011 1966.91,574.505 1969.22,356.668 1971.53,425.997 1973.84,426.552 1976.15,505.528 1978.45,410.725 1980.76,348.083 1983.07,563.565 1985.38,519.894 1987.69,511.086 1989.99,506.817 1992.3,542.899 1994.61,448.856 1996.92,520.593 1999.23,405.647 2001.53,620.633 2003.84,536.549 2006.15,263.442 2008.46,555.244 2010.77,498.429 2013.07,650.721 2015.38,353.714 2017.69,607.523 2020,539.292 2022.3,335.924 2024.61,256.2 2026.92,551.671 2029.23,313.268 2031.54,348.648 2033.84,586.189 2036.15,276.696 2038.46,399.258 2040.77,538.32 2043.08,457.92 2045.38,640.682 2047.69,444.201 2050,381.829 2052.31,450.282 2054.62,554.735 2056.92,448.865 2059.23,577.054 2061.54,293.217 2063.85,588.331 2066.16,553.062 2068.46,571.054 2070.77,544.548 2073.08,553.791 2075.39,335.608 2077.69,384.094 2080,496.664 2082.31,390.02 2084.62,454.241 2086.93,363.657 2089.23,554.229 2091.54,419.637 2093.85,390.956 2096.16,404.384 2098.47,473.351 2100.77,533.207 2103.08,341.548 2105.39,447.803 2107.7,485.165 2110.01,381.719 2112.31,511.977 2114.62,453.244 2116.93,508.163 2119.24,352.846 2121.55,527.763 2123.85,368.598 2126.16,580.284 2128.47,568.607 2130.78,428.789 2133.08,371.854 2135.39,314.493 2137.7,437.736 2140.01,596.879 2142.32,416.508 2144.62,518.144 2146.93,329.971 2149.24,473.447 2151.55,448.49 2153.86,333.768 2156.16,550.308 2158.47,427.657 2160.78,360.123 2163.09,502.537 2165.4,438.643 2167.7,303.951 2170.01,437.885 2172.32,546.933 2174.63,638.529 2176.93,460.648 2179.24,507.517 2181.55,612.373 2183.86,638.804 2186.17,494.153 2188.47,460.817 2190.78,353.533 2193.09,450.618 2195.4,541.504 2197.71,438.601 2200.01,480.473 2202.32,309.026 2204.63,453.283 2206.94,655.82 2209.25,584.323 2211.55,527.593 2213.86,445.714 2216.17,422.602 2218.48,392.15 2220.79,626.323 2223.09,613.854 2225.4,458.146 2227.71,371.275 2230.02,573.234 2232.32,488.061 2234.63,384.208 2236.94,512.398 2239.25,539.457 2241.56,479.356 2243.86,294.177 2246.17,505.356 2248.48,620.053 2250.79,499.629 2253.1,535.981 2255.4,448.205 2257.71,395.693 2260.02,394.259 2262.33,546.417 2264.64,441.139 2266.94,580.076 2269.25,579.137 2271.56,427.77 2273.87,641.636 2276.18,519.162 2278.48,562.889 2280.79,467.468 2283.1,553.689 2285.41,636.545 2287.71,312.495 2290.02,419.716 2292.33,613.775 2294.64,439.796 2296.95,413.877 2299.25,307.946 2301.56,544.335 2303.87,501.043 2306.18,569.973 2308.49,515.647 2310.79,469.124 2313.1,518.548 2315.41,533.158 2317.72,468.4 2320.03,466.968 2322.33,452.578 2324.64,284.066 2326.95,378.871 2329.26,568.137 2331.56,528.498 2333.87,275.129 2336.18,454.03 2338.49,518.46 2340.8,658.33 2343.1,389.12 2345.41,468.981 2347.72,480.813 2350.03,567.847 2352.34,411.809 2354.64,445.74 2356.95,493.003 2359.26,271.588 2361.57,607.16 2363.88,519.951 2366.18,486.043 2368.49,422.172 2370.8,382.836 2373.11,310.144 2375.42,688.202 2377.72,449.481 2380.03,337.326 2382.34,381.731 2384.65,391.221 2386.95,436.46 2389.26,677.582 2391.57,405.147 2393.88,472.609 2396.19,515.609 2398.49,551.423 2400.8,289.179 2403.11,386.805 2405.42,507.611 2407.73,405.468 2410.03,540.934 2412.34,405.039 2414.65,527.416 2416.96,554.343 2419.27,704.266 2421.57,446.574 2423.88,384.063 2426.19,608.644 2428.5,589.465 2430.81,431.599 2433.11,511.795 2435.42,382.19 2437.73,599.102 2440.04,415.39 2442.34,409.076 2444.65,390.427 2446.96,396.88 2449.27,586.668 2451.58,453.037 2453.88,464.293 2456.19,663.579 2458.5,562.427 2460.81,331.689 2463.12,406.597 2465.42,548.994 2467.73,403.525 2470.04,450.449 2472.35,557.648 2474.66,723.558 2476.96,359.627 2479.27,621.795 2481.58,612.853 2483.89,525.489 2486.2,415.171 2488.5,461.417 2490.81,567.427 2493.12,389.175 2495.43,462.947 2497.73,456.175 2500.04,475.866 2502.35,537.981 2504.66,506.075 2506.97,471.491 2509.27,383.902 2511.58,465.173 2513.89,612.035 2516.2,613.807 2518.51,486.577 2520.81,483.869 2523.12,477.172 2525.43,131.854 2527.74,447.84 2530.05,344.69 2532.35,418.18 2534.66,424.748 2536.97,370.914 2539.28,400.924 2541.58,569.722 2543.89,438.977 2546.2,498.931 2548.51,553.775 2550.82,360.77 2553.12,596.905 2555.43,228.343 2557.74,505.158 2560.05,586.872 2562.36,595.357 2564.66,621.11 2566.97,450.498 2569.28,481.517 2571.59,316.099 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(stack, samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:310</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.01712   -4.55344  -1.92169  -3.81863  …  -4.83924    -3.58306   -5.99299
 -0.193697   1.40789   2.37042   2.4321       0.0215292   0.528136  -1.37387
  1.75653    1.42693   3.18564   2.76022      5.37268     5.03794    5.90748

[:, :, 2] =
 -2.68967  -2.99423  -3.23327   -2.90783  …  -5.12165   -2.99849  -3.1192
 -2.1934   -1.49804  -0.826848  -1.2246      -0.733294   1.66993  -0.906872
  2.60283   4.85761   5.26956    5.42445      3.52288    5.18364   6.53457

[:, :, 3] =
 -4.23353   -4.13569    -4.43603  …  -6.72945   -4.52315    -4.21495
 -0.764646  -0.0474106   1.89075     -0.180204  -0.0741137  -0.755161
  2.45053    2.89938     3.34758      5.23481    3.41951     4.94934

[:, :, 4] =
 -1.59254   -2.76097  -4.22541  -3.90176   …  -3.4866    -3.99084  -5.86171
 -0.855095  -1.02157  -1.68129   0.581998      0.770725   1.39415   1.72505
  3.38305    3.74993   4.58278   3.21093       4.733      6.07101   4.77222</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01918     1.0555
 -0.00259605  1.04859
  5.02915     1.04873</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>.</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.58 seconds
Compute duration  = 2.58 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0082    1.0558    0.0175   3634.0552   5593.3612    1.0001   ⋯
        x[2]   -0.0047    1.0506    0.0176   3566.3128   5669.7382    1.0004   ⋯
        x[3]    4.9827    1.0631    0.0187   3242.5789   5440.8044    1.0003   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -7.0677   -5.7198   -5.0041   -4.2954   -2.9260
        x[2]   -2.0771   -0.7001   -0.0009    0.6930    2.0904
        x[3]    2.8496    4.2859    4.9724    5.6932    7.0813
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.63 seconds
Compute duration  = 1.63 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5014    0.1910    0.0026   5252.0626   6168.3060    1.0008   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1471    0.3570    0.5054    0.6419    0.8576
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.2370    0.1115    0.0210    24.6622    21.5143    1.2430     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1879    0.2019    0.2019    0.2020    0.7204
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-1.6100248437768705,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:442</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadunsafe!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:889</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:291</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:262</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:244</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/tutorials/docs-16-using-turing-external-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:444</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.52 seconds
Compute duration  = 0.52 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.7130    0.5989    0.0625    51.7443    22.8849    1.0419     ⋯
           x   -0.0608    0.9266    0.0684   361.9767    78.7799    1.0394     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0966    0.1672    0.5756    1.0437    2.1643
           x   -2.4441   -0.3080    0.0632    0.2641    1.7742
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ReverseDiff.jl</a>:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.87 seconds
Compute duration  = 2.87 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8497    0.6337    0.0450   131.8925    39.3301    1.0020     ⋯
           x    0.0357    0.9195    0.0635   302.7894   156.4175    1.0038     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1015    0.3442    0.7095    1.1989    2.5680
           x   -2.1465   -0.3443   -0.0011    0.3729    2.3053
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li><ol type="1">
<li>and (2) makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol></li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="pagination-link" aria-label="Sampler Visualization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Sampler Visualization</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../tutorials/00-introduction/index.html" class="pagination-link" aria-label="Introduction to Turing">
        <span class="nav-page-text">Introduction to Turing</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-16-using-turing-external-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>