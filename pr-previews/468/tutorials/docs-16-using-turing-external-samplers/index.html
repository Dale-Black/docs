<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Turing.jl – Implementing samplers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-16-using-turing-external-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step. To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> NormalLogDensity{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>NormalLogDensity</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">NormalLogDensity</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.203365090053396</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">NormalLogDensity</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.203365090053396</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>NormalLogDensity</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <u>should not go in the sampler itself</u>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>We currently have two things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reprodicibility.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers which wants to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_new.x, state_new</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([0.0, 0.0, 0.0], MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.15846  -3.02451  -5.01636   -3.85914  …  -4.45269    -6.85437  -6.58385
  2.25451   1.54409  -0.320052  -2.20209     -0.0493717  -0.14373  -2.34744
  4.32475   3.92883   3.51849    5.80396      6.81514     6.87434   4.96875</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01084    1.03113
 -0.0166291  1.04081
  5.01208    1.04902</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip710">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip710)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip711">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip710)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip712">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip710)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1682.82 2640.76,1682.82 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1441.66 2640.76,1441.66 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1200.51 2640.76,1200.51 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,959.358 2640.76,959.358 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,718.205 2640.76,718.205 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,477.051 2640.76,477.051 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,235.898 2640.76,235.898 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1682.82 215.714,1682.82 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1441.66 215.714,1441.66 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1200.51 215.714,1200.51 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,959.358 215.714,959.358 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,718.205 215.714,718.205 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,477.051 215.714,477.051 "></polyline>
<polyline clip-path="url(#clip710)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,235.898 215.714,235.898 "></polyline>
<path clip-path="url(#clip710)" d="M50.5475 1683.27 L80.2233 1683.27 L80.2233 1687.2 L50.5475 1687.2 L50.5475 1683.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M89.1352 1665.54 L111.357 1665.54 L111.357 1667.53 L98.8111 1700.1 L93.9269 1700.1 L105.732 1669.47 L89.1352 1669.47 L89.1352 1665.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M120.478 1694.22 L125.362 1694.22 L125.362 1700.1 L120.478 1700.1 L120.478 1694.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M135.593 1665.54 L153.95 1665.54 L153.95 1669.47 L139.876 1669.47 L139.876 1677.95 Q140.894 1677.6 141.913 1677.44 Q142.931 1677.25 143.95 1677.25 Q149.737 1677.25 153.116 1680.42 Q156.496 1683.59 156.496 1689.01 Q156.496 1694.59 153.024 1697.69 Q149.552 1700.77 143.232 1700.77 Q141.056 1700.77 138.788 1700.4 Q136.542 1700.03 134.135 1699.29 L134.135 1694.59 Q136.218 1695.72 138.441 1696.28 Q140.663 1696.83 143.14 1696.83 Q147.144 1696.83 149.482 1694.73 Q151.82 1692.62 151.82 1689.01 Q151.82 1685.4 149.482 1683.29 Q147.144 1681.19 143.14 1681.19 Q141.265 1681.19 139.39 1681.6 Q137.538 1682.02 135.593 1682.9 L135.593 1665.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M49.5521 1442.12 L79.2279 1442.12 L79.2279 1446.05 L49.5521 1446.05 L49.5521 1442.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M89.3667 1424.38 L107.723 1424.38 L107.723 1428.32 L93.6491 1428.32 L93.6491 1436.79 Q94.6676 1436.44 95.6861 1436.28 Q96.7047 1436.1 97.7232 1436.1 Q103.51 1436.1 106.89 1439.27 Q110.269 1442.44 110.269 1447.86 Q110.269 1453.44 106.797 1456.54 Q103.325 1459.62 97.0056 1459.62 Q94.8297 1459.62 92.5612 1459.25 Q90.3158 1458.88 87.9084 1458.13 L87.9084 1453.44 Q89.9917 1454.57 92.2139 1455.13 Q94.4361 1455.68 96.913 1455.68 Q100.918 1455.68 103.256 1453.57 Q105.593 1451.47 105.593 1447.86 Q105.593 1444.25 103.256 1442.14 Q100.918 1440.03 96.913 1440.03 Q95.038 1440.03 93.163 1440.45 Q91.3112 1440.87 89.3667 1441.75 L89.3667 1424.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M119.482 1453.06 L124.367 1453.06 L124.367 1458.94 L119.482 1458.94 L119.482 1453.06 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M144.552 1427.46 Q140.941 1427.46 139.112 1431.03 Q137.306 1434.57 137.306 1441.7 Q137.306 1448.81 139.112 1452.37 Q140.941 1455.91 144.552 1455.91 Q148.186 1455.91 149.991 1452.37 Q151.82 1448.81 151.82 1441.7 Q151.82 1434.57 149.991 1431.03 Q148.186 1427.46 144.552 1427.46 M144.552 1423.76 Q150.362 1423.76 153.417 1428.37 Q156.496 1432.95 156.496 1441.7 Q156.496 1450.43 153.417 1455.03 Q150.362 1459.62 144.552 1459.62 Q138.741 1459.62 135.663 1455.03 Q132.607 1450.43 132.607 1441.7 Q132.607 1432.95 135.663 1428.37 Q138.741 1423.76 144.552 1423.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M50.5475 1200.96 L80.2233 1200.96 L80.2233 1204.9 L50.5475 1204.9 L50.5475 1200.96 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M94.3436 1213.86 L110.663 1213.86 L110.663 1217.79 L88.7186 1217.79 L88.7186 1213.86 Q91.3806 1211.1 95.9639 1206.47 Q100.57 1201.82 101.751 1200.48 Q103.996 1197.95 104.876 1196.22 Q105.779 1194.46 105.779 1192.77 Q105.779 1190.01 103.834 1188.28 Q101.913 1186.54 98.8111 1186.54 Q96.6121 1186.54 94.1584 1187.31 Q91.7278 1188.07 88.9501 1189.62 L88.9501 1184.9 Q91.7741 1183.76 94.2278 1183.18 Q96.6815 1182.61 98.7185 1182.61 Q104.089 1182.61 107.283 1185.29 Q110.478 1187.98 110.478 1192.47 Q110.478 1194.6 109.668 1196.52 Q108.881 1198.42 106.774 1201.01 Q106.195 1201.68 103.094 1204.9 Q99.9917 1208.09 94.3436 1213.86 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M120.478 1211.91 L125.362 1211.91 L125.362 1217.79 L120.478 1217.79 L120.478 1211.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M135.593 1183.23 L153.95 1183.23 L153.95 1187.17 L139.876 1187.17 L139.876 1195.64 Q140.894 1195.29 141.913 1195.13 Q142.931 1194.94 143.95 1194.94 Q149.737 1194.94 153.116 1198.12 Q156.496 1201.29 156.496 1206.7 Q156.496 1212.28 153.024 1215.38 Q149.552 1218.46 143.232 1218.46 Q141.056 1218.46 138.788 1218.09 Q136.542 1217.72 134.135 1216.98 L134.135 1212.28 Q136.218 1213.42 138.441 1213.97 Q140.663 1214.53 143.14 1214.53 Q147.144 1214.53 149.482 1212.42 Q151.82 1210.31 151.82 1206.7 Q151.82 1203.09 149.482 1200.99 Q147.144 1198.88 143.14 1198.88 Q141.265 1198.88 139.39 1199.3 Q137.538 1199.71 135.593 1200.59 L135.593 1183.23 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M99.3204 945.157 Q95.7093 945.157 93.8806 948.721 Q92.075 952.263 92.075 959.393 Q92.075 966.499 93.8806 970.064 Q95.7093 973.606 99.3204 973.606 Q102.955 973.606 104.76 970.064 Q106.589 966.499 106.589 959.393 Q106.589 952.263 104.76 948.721 Q102.955 945.157 99.3204 945.157 M99.3204 941.453 Q105.131 941.453 108.186 946.059 Q111.265 950.643 111.265 959.393 Q111.265 968.12 108.186 972.726 Q105.131 977.309 99.3204 977.309 Q93.5102 977.309 90.4315 972.726 Q87.376 968.12 87.376 959.393 Q87.376 950.643 90.4315 946.059 Q93.5102 941.453 99.3204 941.453 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M119.482 970.758 L124.367 970.758 L124.367 976.638 L119.482 976.638 L119.482 970.758 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M144.552 945.157 Q140.941 945.157 139.112 948.721 Q137.306 952.263 137.306 959.393 Q137.306 966.499 139.112 970.064 Q140.941 973.606 144.552 973.606 Q148.186 973.606 149.991 970.064 Q151.82 966.499 151.82 959.393 Q151.82 952.263 149.991 948.721 Q148.186 945.157 144.552 945.157 M144.552 941.453 Q150.362 941.453 153.417 946.059 Q156.496 950.643 156.496 959.393 Q156.496 968.12 153.417 972.726 Q150.362 977.309 144.552 977.309 Q138.741 977.309 135.663 972.726 Q132.607 968.12 132.607 959.393 Q132.607 950.643 135.663 946.059 Q138.741 941.453 144.552 941.453 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M94.3436 731.55 L110.663 731.55 L110.663 735.485 L88.7186 735.485 L88.7186 731.55 Q91.3806 728.795 95.9639 724.165 Q100.57 719.513 101.751 718.17 Q103.996 715.647 104.876 713.911 Q105.779 712.152 105.779 710.462 Q105.779 707.707 103.834 705.971 Q101.913 704.235 98.8111 704.235 Q96.6121 704.235 94.1584 704.999 Q91.7278 705.763 88.9501 707.314 L88.9501 702.591 Q91.7741 701.457 94.2278 700.878 Q96.6815 700.3 98.7185 700.3 Q104.089 700.3 107.283 702.985 Q110.478 705.67 110.478 710.161 Q110.478 712.29 109.668 714.212 Q108.881 716.11 106.774 718.702 Q106.195 719.374 103.094 722.591 Q99.9917 725.786 94.3436 731.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M120.478 729.605 L125.362 729.605 L125.362 735.485 L120.478 735.485 L120.478 729.605 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M135.593 700.925 L153.95 700.925 L153.95 704.86 L139.876 704.86 L139.876 713.332 Q140.894 712.985 141.913 712.823 Q142.931 712.638 143.95 712.638 Q149.737 712.638 153.116 715.809 Q156.496 718.98 156.496 724.397 Q156.496 729.975 153.024 733.077 Q149.552 736.156 143.232 736.156 Q141.056 736.156 138.788 735.786 Q136.542 735.415 134.135 734.675 L134.135 729.975 Q136.218 731.11 138.441 731.665 Q140.663 732.221 143.14 732.221 Q147.144 732.221 149.482 730.114 Q151.82 728.008 151.82 724.397 Q151.82 720.786 149.482 718.679 Q147.144 716.573 143.14 716.573 Q141.265 716.573 139.39 716.989 Q137.538 717.406 135.593 718.286 L135.593 700.925 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M89.3667 459.771 L107.723 459.771 L107.723 463.707 L93.6491 463.707 L93.6491 472.179 Q94.6676 471.832 95.6861 471.67 Q96.7047 471.484 97.7232 471.484 Q103.51 471.484 106.89 474.656 Q110.269 477.827 110.269 483.244 Q110.269 488.822 106.797 491.924 Q103.325 495.003 97.0056 495.003 Q94.8297 495.003 92.5612 494.632 Q90.3158 494.262 87.9084 493.521 L87.9084 488.822 Q89.9917 489.956 92.2139 490.512 Q94.4361 491.068 96.913 491.068 Q100.918 491.068 103.256 488.961 Q105.593 486.855 105.593 483.244 Q105.593 479.632 103.256 477.526 Q100.918 475.42 96.913 475.42 Q95.038 475.42 93.163 475.836 Q91.3112 476.253 89.3667 477.132 L89.3667 459.771 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M119.482 488.452 L124.367 488.452 L124.367 494.331 L119.482 494.331 L119.482 488.452 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M144.552 462.85 Q140.941 462.85 139.112 466.415 Q137.306 469.957 137.306 477.086 Q137.306 484.193 139.112 487.757 Q140.941 491.299 144.552 491.299 Q148.186 491.299 149.991 487.757 Q151.82 484.193 151.82 477.086 Q151.82 469.957 149.991 466.415 Q148.186 462.85 144.552 462.85 M144.552 459.146 Q150.362 459.146 153.417 463.753 Q156.496 468.336 156.496 477.086 Q156.496 485.813 153.417 490.419 Q150.362 495.003 144.552 495.003 Q138.741 495.003 135.663 490.419 Q132.607 485.813 132.607 477.086 Q132.607 468.336 135.663 463.753 Q138.741 459.146 144.552 459.146 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M89.1352 218.618 L111.357 218.618 L111.357 220.609 L98.8111 253.178 L93.9269 253.178 L105.732 222.553 L89.1352 222.553 L89.1352 218.618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M120.478 247.299 L125.362 247.299 L125.362 253.178 L120.478 253.178 L120.478 247.299 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip710)" d="M135.593 218.618 L153.95 218.618 L153.95 222.553 L139.876 222.553 L139.876 231.026 Q140.894 230.678 141.913 230.516 Q142.931 230.331 143.95 230.331 Q149.737 230.331 153.116 233.502 Q156.496 236.674 156.496 242.09 Q156.496 247.669 153.024 250.771 Q149.552 253.849 143.232 253.849 Q141.056 253.849 138.788 253.479 Q136.542 253.109 134.135 252.368 L134.135 247.669 Q136.218 248.803 138.441 249.359 Q140.663 249.914 143.14 249.914 Q147.144 249.914 149.482 247.808 Q151.82 245.701 151.82 242.09 Q151.82 238.479 149.482 236.373 Q147.144 234.266 143.14 234.266 Q141.265 234.266 139.39 234.683 Q137.538 235.1 135.593 235.979 L135.593 218.618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip712)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1167.57 268.292,1171.35 270.6,1347.7 272.908,1558.28 275.216,1329.82 277.524,1435.05 279.832,1262.37 282.139,1389.51 284.447,1578.87 286.755,1440.67 289.063,1420.03 291.371,1483.16 293.679,1431.67 295.987,1545.95 298.295,1616.94 300.603,1572.37 302.911,1417.31 305.219,1425.34 307.527,1422.63 309.834,1403.56 312.142,1405.96 314.45,1607.29 316.758,1575.84 319.066,1474.88 321.374,1583.83 323.682,1380.95 325.99,1555.78 328.298,1525.81 330.606,1391.67 332.914,1395.03 335.221,1469.33 337.529,1480.61 339.837,1529.98 342.145,1567.36 344.453,1508.72 346.761,1554.83 349.069,1589.98 351.377,1362.27 353.685,1399.66 355.993,1395.56 358.301,1500.69 360.608,1428.97 362.916,1424.96 365.224,1427.8 367.532,1430.18 369.84,1509.44 372.148,1650.74 374.456,1412.4 376.764,1475.2 379.072,1478.69 381.38,1555.91 383.688,1337.54 385.996,1521.31 388.303,1471.16 390.611,1588.18 392.919,1463.54 395.227,1475.28 397.535,1338.66 399.843,1689.41 402.151,1438.25 404.459,1450.67 406.767,1456.52 409.075,1493.05 411.383,1456.79 413.69,1390.45 415.998,1446.54 418.306,1493.17 420.614,1514.85 422.922,1408.98 425.23,1657.21 427.538,1200.22 429.846,1427 432.154,1542.35 434.462,1441.33 436.77,1495.14 439.077,1412.96 441.385,1461.57 443.693,1253.68 446.001,1352.75 448.309,1369.09 450.617,1614.88 452.925,1531.86 455.233,1727.87 457.541,1431.16 459.849,1568.81 462.157,1590.17 464.465,1208.46 466.772,1530.26 469.08,1507.12 471.388,1464.9 473.696,1437.79 476.004,1462.84 478.312,1538.58 480.62,1526.01 482.928,1286.97 485.236,1676.96 487.544,1393.98 489.852,1317.94 492.159,1454.1 494.467,1442.9 496.775,1381.73 499.083,1330.3 501.391,1520.97 503.699,1353.59 506.007,1350.39 508.315,1228.42 510.623,1474.47 512.931,1425.32 515.239,1332.34 517.546,1393.13 519.854,1409.19 522.162,1377.9 524.47,1576.3 526.778,1498.06 529.086,1495.41 531.394,1376.34 533.702,1449.93 536.01,1472.14 538.318,1515.88 540.626,1503 542.933,1462.89 545.241,1568.44 547.549,1187.8 549.857,1440.98 552.165,1322.37 554.473,1477.96 556.781,1369.41 559.089,1517.08 561.397,1528.04 563.705,1403.55 566.013,1448.63 568.321,1460.57 570.628,1346.74 572.936,1536.55 575.244,1373.89 577.552,1367.29 579.86,1379.73 582.168,1416.52 584.476,1336.27 586.784,1387.33 589.092,1410.92 591.4,1385.19 593.708,1448.64 596.015,1448.83 598.323,1336.89 600.631,1453.25 602.939,1261.39 605.247,1507.31 607.555,1368.02 609.863,1443.23 612.171,1365.7 614.479,1547.59 616.787,1362.34 619.095,1468.92 621.402,1406.19 623.71,1415.27 626.018,1466.58 628.326,1461.47 630.634,1446.91 632.942,1420.01 635.25,1353.59 637.558,1426.14 639.866,1589.53 642.174,1363.22 644.482,1247.3 646.79,1426.21 649.097,1321.11 651.405,1560.92 653.713,1389.43 656.021,1536 658.329,1249.55 660.637,1534.47 662.945,1565.71 665.253,1490.67 667.561,1510.44 669.869,1462.08 672.177,1345.82 674.484,1560.88 676.792,1355.94 679.1,1369.78 681.408,1512.76 683.716,1345.05 686.024,1659.76 688.332,1426.57 690.64,1446.89 692.948,1245.25 695.256,1501.71 697.564,1476.4 699.871,1354.19 702.179,1349.73 704.487,1519.65 706.795,1495.11 709.103,1399.93 711.411,1357.38 713.719,1536.63 716.027,1516.82 718.335,1602.24 720.643,1546.72 722.951,1409.52 725.259,1410.43 727.566,1607.22 729.874,1471.27 732.182,1308.84 734.49,1553.23 736.798,1427.27 739.106,1378.98 741.414,1513.22 743.722,1347.98 746.03,1450.06 748.338,1331.69 750.646,1404.91 752.953,1425.91 755.261,1494.69 757.569,1359.46 759.877,1590.84 762.185,1525.24 764.493,1489.54 766.801,1375.34 769.109,1438.9 771.417,1373.85 773.725,1338.51 776.033,1464.43 778.34,1427.16 780.648,1390.1 782.956,1448.4 785.264,1482.72 787.572,1330.38 789.88,1484.41 792.188,1288.21 794.496,1507.82 796.804,1386.2 799.112,1487.7 801.42,1472.74 803.728,1380.79 806.035,1531.13 808.343,1505.12 810.651,1535.16 812.959,1477.77 815.267,1409.22 817.575,1285.76 819.883,1558.15 822.191,1344.03 824.499,1305.41 826.807,1546.96 829.115,1386.67 831.422,1518.06 833.73,1220.56 836.038,1340.97 838.346,1415.9 840.654,1334.22 842.962,1426.57 845.27,1493.25 847.578,1333.39 849.886,1466.58 852.194,1473.05 854.502,1507.54 856.809,1545.75 859.117,1361.61 861.425,1427.74 863.733,1413.28 866.041,1579.3 868.349,1305.71 870.657,1441.9 872.965,1314.71 875.273,1272.44 877.581,1193.85 879.889,1455.47 882.197,1380.5 884.504,1268.54 886.812,1486.28 889.12,1412.14 891.428,1345.94 893.736,1522.33 896.044,1512.82 898.352,1488.29 900.66,1608 902.968,1409.2 905.276,1425.95 907.584,1444.79 909.891,1663.96 912.199,1270.37 914.507,1418.95 916.815,1476.72 919.123,1401.61 921.431,1448.29 923.739,1317.08 926.047,1379.77 928.355,1358.38 930.663,1434.09 932.971,1326.23 935.278,1427.75 937.586,1519.33 939.894,1456.01 942.202,1568.13 944.51,1581.51 946.818,1372.8 949.126,1546.6 951.434,1290.97 953.742,1549.76 956.05,1575.7 958.358,1301.82 960.665,1434.37 962.973,1495.78 965.281,1638.78 967.589,1564.22 969.897,1404.39 972.205,1572.42 974.513,1506.76 976.821,1487.83 979.129,1590.25 981.437,1339.09 983.745,1440.44 986.053,1425.39 988.36,1424.02 990.668,1377.05 992.976,1545.47 995.284,1279.74 997.592,1523.17 999.9,1593.02 1002.21,1502.29 1004.52,1291.66 1006.82,1555.09 1009.13,1345.33 1011.44,1526.24 1013.75,1572.34 1016.06,1459.31 1018.36,1384.51 1020.67,1451.85 1022.98,1467.28 1025.29,1435.39 1027.59,1312.22 1029.9,1418.14 1032.21,1374.69 1034.52,1381.9 1036.83,1372.7 1039.13,1318.97 1041.44,1468.8 1043.75,1435.04 1046.06,1456.28 1048.37,1390.42 1050.67,1603.81 1052.98,1285.23 1055.29,1487.62 1057.6,1357.89 1059.91,1558.94 1062.21,1392.27 1064.52,1628.02 1066.83,1424.97 1069.14,1483.05 1071.45,1410.9 1073.75,1453.01 1076.06,1495.68 1078.37,1384.06 1080.68,1394.02 1082.98,1495.84 1085.29,1318.56 1087.6,1350.38 1089.91,1449.66 1092.22,1512.77 1094.52,1522.02 1096.83,1521.41 1099.14,1498.48 1101.45,1399.86 1103.76,1496.8 1106.06,1533.03 1108.37,1369.65 1110.68,1407.1 1112.99,1381.83 1115.3,1613.79 1117.6,1482.99 1119.91,1493.05 1122.22,1501.45 1124.53,1492.58 1126.84,1491.67 1129.14,1478.39 1131.45,1429.78 1133.76,1433.69 1136.07,1599.83 1138.37,1484.97 1140.68,1503.25 1142.99,1498.61 1145.3,1540.79 1147.61,1432.66 1149.91,1392.65 1152.22,1425.26 1154.53,1546.24 1156.84,1556.31 1159.15,1580.13 1161.45,1658.79 1163.76,1498.83 1166.07,1508.34 1168.38,1388.33 1170.69,1438.16 1172.99,1408.13 1175.3,1468.83 1177.61,1507.67 1179.92,1454.4 1182.23,1552.73 1184.53,1461.45 1186.84,1290.29 1189.15,1323.02 1191.46,1438.26 1193.76,1487.6 1196.07,1366.32 1198.38,1498.93 1200.69,1457.16 1203,1351.51 1205.3,1409.94 1207.61,1451.63 1209.92,1469.82 1212.23,1393.16 1214.54,1371.46 1216.84,1467.97 1219.15,1411.12 1221.46,1407.77 1223.77,1505.46 1226.08,1423.09 1228.38,1481.65 1230.69,1274.7 1233,1532.19 1235.31,1402.67 1237.61,1406.49 1239.92,1605.76 1242.23,1304.84 1244.54,1463.86 1246.85,1521.87 1249.15,1244.42 1251.46,1427.69 1253.77,1540.1 1256.08,1353.73 1258.39,1587.91 1260.69,1477.56 1263,1415.53 1265.31,1433.87 1267.62,1581.87 1269.93,1468.81 1272.23,1372.45 1274.54,1409.87 1276.85,1293.88 1279.16,1486.58 1281.47,1413.36 1283.77,1423.82 1286.08,1468.21 1288.39,1597.74 1290.7,1473.66 1293,1235.27 1295.31,1425.26 1297.62,1391.25 1299.93,1271.09 1302.24,1509.16 1304.54,1348.23 1306.85,1731.87 1309.16,1480.34 1311.47,1405.16 1313.78,1328.11 1316.08,1338.86 1318.39,1318.52 1320.7,1411.89 1323.01,1439.34 1325.32,1474.41 1327.62,1326.92 1329.93,1514.91 1332.24,1350.93 1334.55,1436.45 1336.86,1567.62 1339.16,1434.86 1341.47,1574.19 1343.78,1334.14 1346.09,1494.8 1348.39,1426.98 1350.7,1259.56 1353.01,1356.98 1355.32,1532.55 1357.63,1473.35 1359.93,1484.82 1362.24,1490.7 1364.55,1577.95 1366.86,1514.92 1369.17,1413.53 1371.47,1495.82 1373.78,1277.58 1376.09,1298.31 1378.4,1500.4 1380.71,1440.71 1383.01,1433.41 1385.32,1374.7 1387.63,1416.89 1389.94,1373.06 1392.24,1519.59 1394.55,1427.54 1396.86,1283.01 1399.17,1536.2 1401.48,1384.96 1403.78,1394.84 1406.09,1545.78 1408.4,1618.38 1410.71,1474.64 1413.02,1585.43 1415.32,1431.2 1417.63,1299.54 1419.94,1329.2 1422.25,1642.34 1424.56,1578.76 1426.86,1464.15 1429.17,1498 1431.48,1483.78 1433.79,1524.31 1436.1,1530.16 1438.4,1394.4 1440.71,1481.05 1443.02,1459.92 1445.33,1379.23 1447.63,1427.73 1449.94,1439.03 1452.25,1361.27 1454.56,1354.51 1456.87,1327.29 1459.17,1553.36 1461.48,1445.69 1463.79,1392.73 1466.1,1426.44 1468.41,1427.82 1470.71,1444.76 1473.02,1471.93 1475.33,1501.73 1477.64,1470.16 1479.95,1335.84 1482.25,1434.24 1484.56,1294.06 1486.87,1486.84 1489.18,1589.19 1491.49,1519.73 1493.79,1490.72 1496.1,1406.57 1498.41,1308.6 1500.72,1460.07 1503.02,1212.27 1505.33,1397.82 1507.64,1434.77 1509.95,1378.24 1512.26,1531.19 1514.56,1488.17 1516.87,1487.95 1519.18,1515.98 1521.49,1367.98 1523.8,1389.07 1526.1,1477.37 1528.41,1312.46 1530.72,1375.14 1533.03,1467.55 1535.34,1460.3 1537.64,1669.69 1539.95,1512.93 1542.26,1443.33 1544.57,1377.82 1546.88,1426.8 1549.18,1340.62 1551.49,1348.41 1553.8,1421.02 1556.11,1451.59 1558.41,1377.67 1560.72,1470.67 1563.03,1482.59 1565.34,1529.5 1567.65,1380.44 1569.95,1518.08 1572.26,1535.41 1574.57,1512.36 1576.88,1311.19 1579.19,1567.82 1581.49,1358.38 1583.8,1540.27 1586.11,1607.91 1588.42,1467.59 1590.73,1396.27 1593.03,1522.17 1595.34,1482.05 1597.65,1529.04 1599.96,1387.98 1602.26,1444.91 1604.57,1319.02 1606.88,1347.33 1609.19,1497.5 1611.5,1325.91 1613.8,1396.17 1616.11,1461.5 1618.42,1410.95 1620.73,1514.48 1623.04,1381 1625.34,1709.74 1627.65,1456.17 1629.96,1537.58 1632.27,1381.57 1634.58,1358.37 1636.88,1463.76 1639.19,1368 1641.5,1519.29 1643.81,1476.74 1646.12,1360.97 1648.42,1451.87 1650.73,1751.15 1653.04,1378.33 1655.35,1392.56 1657.65,1449.51 1659.96,1579.79 1662.27,1521.73 1664.58,1382.64 1666.89,1494.19 1669.19,1292.58 1671.5,1527.03 1673.81,1484.82 1676.12,1419.68 1678.43,1546.74 1680.73,1331.86 1683.04,1326.75 1685.35,1515.96 1687.66,1594.84 1689.97,1597.81 1692.27,1545.99 1694.58,1338.58 1696.89,1640.92 1699.2,1419.16 1701.51,1461.72 1703.81,1273.25 1706.12,1377.91 1708.43,1313.98 1710.74,1231.71 1713.04,1508.79 1715.35,1457.32 1717.66,1342.45 1719.97,1269.3 1722.28,1599.86 1724.58,1291.75 1726.89,1511.94 1729.2,1419.76 1731.51,1329.16 1733.82,1384.8 1736.12,1516.87 1738.43,1498.66 1740.74,1603.35 1743.05,1487.18 1745.36,1572.07 1747.66,1442.41 1749.97,1337.54 1752.28,1419.1 1754.59,1417.84 1756.9,1503.59 1759.2,1419.43 1761.51,1477.42 1763.82,1539.42 1766.13,1497.5 1768.43,1338.98 1770.74,1387.28 1773.05,1507.57 1775.36,1431.6 1777.67,1355.45 1779.97,1619.7 1782.28,1379.43 1784.59,1395 1786.9,1373.29 1789.21,1379.12 1791.51,1322.89 1793.82,1397.96 1796.13,1528.12 1798.44,1350.39 1800.75,1200.85 1803.05,1423.28 1805.36,1536.76 1807.67,1491.65 1809.98,1444.76 1812.28,1483.83 1814.59,1501.28 1816.9,1565.03 1819.21,1409.94 1821.52,1385.15 1823.82,1465.78 1826.13,1412.51 1828.44,1478.51 1830.75,1380.39 1833.06,1413.84 1835.36,1581.1 1837.67,1342.91 1839.98,1416.82 1842.29,1261.23 1844.6,1390.85 1846.9,1317.93 1849.21,1529.42 1851.52,1407.27 1853.83,1361.79 1856.14,1494.75 1858.44,1422.06 1860.75,1499.7 1863.06,1540.46 1865.37,1497.41 1867.67,1405.21 1869.98,1469.11 1872.29,1390.17 1874.6,1468.8 1876.91,1410.61 1879.21,1451.23 1881.52,1399.21 1883.83,1554 1886.14,1622.78 1888.45,1385.8 1890.75,1326.17 1893.06,1384.38 1895.37,1360.07 1897.68,1410.11 1899.99,1322.27 1902.29,1558.27 1904.6,1290.8 1906.91,1464.06 1909.22,1468.37 1911.53,1311.58 1913.83,1601.79 1916.14,1386 1918.45,1369.86 1920.76,1215.2 1923.06,1371.16 1925.37,1435.73 1927.68,1576.31 1929.99,1499.71 1932.3,1509.74 1934.6,1488.76 1936.91,1283.53 1939.22,1503.76 1941.53,1372.16 1943.84,1385.38 1946.14,1448.97 1948.45,1506.76 1950.76,1434.28 1953.07,1542.17 1955.38,1409.48 1957.68,1313.56 1959.99,1344.62 1962.3,1580.52 1964.61,1495.56 1966.91,1572.75 1969.22,1341.8 1971.53,1541.73 1973.84,1447.76 1976.15,1389.07 1978.45,1501.66 1980.76,1344.39 1983.07,1527.12 1985.38,1321.49 1987.69,1489 1989.99,1330.35 1992.3,1404.98 1994.61,1513.07 1996.92,1388.27 1999.23,1492.49 2001.53,1339.81 2003.84,1492.84 2006.15,1236.49 2008.46,1523.28 2010.77,1441.54 2013.07,1389.96 2015.38,1529.15 2017.69,1532.18 2020,1494.06 2022.3,1110.04 2024.61,1533.2 2026.92,1525.75 2029.23,1463.8 2031.54,1425.43 2033.84,1433.33 2036.15,1309.8 2038.46,1441.81 2040.77,1353.72 2043.08,1638.02 2045.38,1676.66 2047.69,1324.34 2050,1430.29 2052.31,1514.93 2054.62,1243.04 2056.92,1657.32 2059.23,1302.41 2061.54,1648.44 2063.85,1282.03 2066.16,1625.07 2068.46,1471.45 2070.77,1337.72 2073.08,1568.85 2075.39,1450.52 2077.69,1268.11 2080,1405.05 2082.31,1410.87 2084.62,1252.02 2086.93,1589.62 2089.23,1516.48 2091.54,1508.79 2093.85,1446.1 2096.16,1346.37 2098.47,1359.37 2100.77,1433.32 2103.08,1443.07 2105.39,1491.9 2107.7,1575.4 2110.01,1435.87 2112.31,1465.28 2114.62,1435.87 2116.93,1510.06 2119.24,1360.76 2121.55,1451.67 2123.85,1319.72 2126.16,1535.51 2128.47,1457.85 2130.78,1387.47 2133.08,1345.67 2135.39,1520.09 2137.7,1352.5 2140.01,1470.09 2142.32,1662.59 2144.62,1480.22 2146.93,1502.2 2149.24,1451.16 2151.55,1420.52 2153.86,1531.45 2156.16,1403.03 2158.47,1575.07 2160.78,1408.45 2163.09,1403.89 2165.4,1574.47 2167.7,1361.88 2170.01,1580.09 2172.32,1364.48 2174.63,1331.08 2176.93,1545.53 2179.24,1340.27 2181.55,1290.66 2183.86,1328.48 2186.17,1311.37 2188.47,1287.47 2190.78,1413.88 2193.09,1453.1 2195.4,1323.1 2197.71,1303.03 2200.01,1530.67 2202.32,1443.51 2204.63,1423.81 2206.94,1366.46 2209.25,1462.15 2211.55,1349.03 2213.86,1397.7 2216.17,1366.19 2218.48,1461.58 2220.79,1425.36 2223.09,1321.3 2225.4,1328.98 2227.71,1584.99 2230.02,1451.78 2232.32,1438.32 2234.63,1529.51 2236.94,1417.6 2239.25,1362.31 2241.56,1528.41 2243.86,1454.75 2246.17,1306.18 2248.48,1389.27 2250.79,1480.22 2253.1,1477.05 2255.4,1453.5 2257.71,1612.05 2260.02,1585.63 2262.33,1409.63 2264.64,1325.44 2266.94,1463.46 2269.25,1500.48 2271.56,1546.89 2273.87,1345.16 2276.18,1519.49 2278.48,1517.12 2280.79,1379.56 2283.1,1358.3 2285.41,1427.92 2287.71,1482.99 2290.02,1329.54 2292.33,1393.59 2294.64,1428.5 2296.95,1453.3 2299.25,1273.98 2301.56,1573.68 2303.87,1289.7 2306.18,1311.41 2308.49,1563.08 2310.79,1439.49 2313.1,1329.77 2315.41,1526.75 2317.72,1386.64 2320.03,1413.14 2322.33,1499.26 2324.64,1606.67 2326.95,1651.64 2329.26,1554.14 2331.56,1230.09 2333.87,1375.1 2336.18,1392.56 2338.49,1556.61 2340.8,1438.37 2343.1,1482.37 2345.41,1500.5 2347.72,1166.68 2350.03,1454.18 2352.34,1482.36 2354.64,1294.61 2356.95,1454.98 2359.26,1258.85 2361.57,1512.06 2363.88,1543.66 2366.18,1383.3 2368.49,1543.47 2370.8,1283.3 2373.11,1351.56 2375.42,1413.58 2377.72,1369.03 2380.03,1442.83 2382.34,1480.3 2384.65,1478.09 2386.95,1551.31 2389.26,1339.14 2391.57,1470.28 2393.88,1384.95 2396.19,1421.41 2398.49,1397.72 2400.8,1609.21 2403.11,1423.65 2405.42,1467.47 2407.73,1530.46 2410.03,1311.66 2412.34,1500.44 2414.65,1497.42 2416.96,1426.61 2419.27,1468.21 2421.57,1585.9 2423.88,1428.24 2426.19,1486.06 2428.5,1533.13 2430.81,1354.41 2433.11,1538.28 2435.42,1486.1 2437.73,1696.96 2440.04,1423.9 2442.34,1472.15 2444.65,1477.93 2446.96,1367.47 2449.27,1570.03 2451.58,1419.54 2453.88,1313.98 2456.19,1322.53 2458.5,1323.15 2460.81,1403.76 2463.12,1561.68 2465.42,1551.16 2467.73,1363.76 2470.04,1492.67 2472.35,1421.74 2474.66,1598.48 2476.96,1421.15 2479.27,1590.05 2481.58,1469.16 2483.89,1356.84 2486.2,1453.01 2488.5,1448.45 2490.81,1426.42 2493.12,1431.22 2495.43,1515.48 2497.73,1482.17 2500.04,1336.49 2502.35,1539.53 2504.66,1580.62 2506.97,1404.63 2509.27,1477.82 2511.58,1238.81 2513.89,1462.88 2516.2,1466.75 2518.51,1479.61 2520.81,1531.43 2523.12,1362.66 2525.43,1450.73 2527.74,1229.41 2530.05,1589.49 2532.35,1375.78 2534.66,1336.26 2536.97,1358.8 2539.28,1492.26 2541.58,1454.23 2543.89,1347.06 2546.2,1502.6 2548.51,1509.81 2550.82,1438.48 2553.12,1502.95 2555.43,1619.44 2557.74,1469.52 2560.05,1536.93 2562.36,1469.76 2564.66,1528.25 2566.97,1383.23 2569.28,1531.54 2571.59,1483.14 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,741.885 268.292,951.612 270.6,982.638 272.908,1009.82 275.216,1085.39 277.524,1140.82 279.832,953.309 282.139,1118.97 284.447,864.825 286.755,926.198 289.063,973.837 291.371,983.332 293.679,1017.3 295.987,840.985 298.295,771.909 300.603,1124.92 302.911,982.263 305.219,1012.41 307.527,804.684 309.834,1114.89 312.142,976.723 314.45,1025.1 316.758,1037.85 319.066,901.933 321.374,864.947 323.682,869.816 325.99,901.459 328.298,1047.55 330.606,989.034 332.914,921.441 335.221,1018.47 337.529,875.733 339.837,929.905 342.145,1035.97 344.453,951.133 346.761,1031.57 349.069,1112.1 351.377,1047.73 353.685,1067.64 355.993,961.293 358.301,873.229 360.608,977.136 362.916,969.45 365.224,1026.4 367.532,807.315 369.84,946.315 372.148,1055.17 374.456,974.475 376.764,911.605 379.072,943.671 381.38,906.446 383.688,848.447 385.996,856.542 388.303,1022.03 390.611,1025.05 392.919,826.39 395.227,828.472 397.535,1044.23 399.843,1017.39 402.151,902.79 404.459,851.472 406.767,1148.62 409.075,1089.1 411.383,916.491 413.69,1085.01 415.998,950.176 418.306,843.666 420.614,760.707 422.922,939.359 425.23,807.882 427.538,1001.92 429.846,987.647 432.154,835.953 434.462,998.968 436.77,988.274 439.077,1054.07 441.385,933.526 443.693,978.117 446.001,969.163 448.309,915.528 450.617,926.955 452.925,942.331 455.233,1122.77 457.541,1007.86 459.849,1149.42 462.157,1064.64 464.465,983.72 466.772,1084.44 469.08,773.906 471.388,922.458 473.696,943.522 476.004,1092.9 478.312,986.169 480.62,970.779 482.928,979.684 485.236,820.919 487.544,881.767 489.852,789.676 492.159,913.398 494.467,949.612 496.775,823.151 499.083,916.428 501.391,914.928 503.699,1018.92 506.007,912.905 508.315,1015.95 510.623,720.924 512.931,1025.35 515.239,997.96 517.546,885.275 519.854,855.994 522.162,946.755 524.47,840.027 526.778,915.694 529.086,876.806 531.394,1196.98 533.702,947.364 536.01,1018.81 538.318,891.641 540.626,924.145 542.933,962.003 545.241,1013.04 547.549,1075.87 549.857,887.024 552.165,911.541 554.473,901.732 556.781,984.695 559.089,1028.06 561.397,1073.21 563.705,1008.65 566.013,1139.8 568.321,952.994 570.628,966.151 572.936,1036.6 575.244,922.974 577.552,943.923 579.86,1276.61 582.168,752.497 584.476,882.735 586.784,917.522 589.092,896.819 591.4,1024.82 593.708,1014.67 596.015,1145.81 598.323,916.207 600.631,876.802 602.939,1059.09 605.247,941.864 607.555,938.82 609.863,875.926 612.171,848.203 614.479,1142.89 616.787,1004.35 619.095,988.04 621.402,903.811 623.71,960.961 626.018,1012.26 628.326,987.936 630.634,916.13 632.942,1005.74 635.25,1026.01 637.558,902.185 639.866,964.084 642.174,1058.48 644.482,1194.18 646.79,986.354 649.097,1236.77 651.405,1037.33 653.713,962.72 656.021,969.823 658.329,953.567 660.637,981.55 662.945,928.693 665.253,1077.18 667.561,976.327 669.869,978.43 672.177,896.17 674.484,963.28 676.792,927.015 679.1,918.923 681.408,1101.91 683.716,1024.1 686.024,974.282 688.332,992.344 690.64,899.477 692.948,999.02 695.256,1025.08 697.564,906.669 699.871,1089.54 702.179,733.393 704.487,964.387 706.795,1054.66 709.103,912.08 711.411,1039.49 713.719,905.562 716.027,846.736 718.335,1019.37 720.643,926.769 722.951,915.485 725.259,826.629 727.566,925.153 729.874,905.505 732.182,905.784 734.49,964.595 736.798,924.975 739.106,921.596 741.414,1155.14 743.722,1050.54 746.03,944.294 748.338,858.679 750.646,986.88 752.953,963.256 755.261,955.773 757.569,871.827 759.877,1053.1 762.185,979.962 764.493,886.76 766.801,1027.11 769.109,1071.4 771.417,1084.03 773.725,1146.66 776.033,913.505 778.34,934.713 780.648,1057.86 782.956,922.448 785.264,1043.84 787.572,992.628 789.88,784.218 792.188,1121.36 794.496,1160.92 796.804,947.467 799.112,892.402 801.42,747.902 803.728,1019.2 806.035,1037.24 808.343,954.931 810.651,883.733 812.959,1000.94 815.267,998.561 817.575,961.84 819.883,853.115 822.191,919.859 824.499,892.228 826.807,1070.92 829.115,928.768 831.422,694.598 833.73,1042.91 836.038,939.237 838.346,988.787 840.654,861.709 842.962,1235.37 845.27,937.92 847.578,917.312 849.886,982.356 852.194,1024.41 854.502,868.225 856.809,816.999 859.117,862.36 861.425,987.362 863.733,1337.35 866.041,1044.68 868.349,1111.28 870.657,815.722 872.965,941.948 875.273,1046.36 877.581,1131.61 879.889,837.55 882.197,1025.28 884.504,827.375 886.812,1017.51 889.12,875.368 891.428,974.597 893.736,1021.62 896.044,1075.49 898.352,911.951 900.66,1061.14 902.968,901.516 905.276,1024.53 907.584,965.833 909.891,866.46 912.199,916.777 914.507,782.721 916.815,925.94 919.123,880.862 921.431,1010.58 923.739,790.188 926.047,903.266 928.355,1070.77 930.663,1045.06 932.971,1140.96 935.278,870.818 937.586,870.029 939.894,868.268 942.202,1067.99 944.51,961.008 946.818,744.143 949.126,1102.09 951.434,993.094 953.742,1026.21 956.05,857.219 958.358,992.554 960.665,947.155 962.973,973.7 965.281,1011.64 967.589,1064.04 969.897,830.428 972.205,965.15 974.513,915.21 976.821,936.387 979.129,892.3 981.437,1057.53 983.745,932.979 986.053,813.196 988.36,1106.07 990.668,1174.75 992.976,1149.89 995.284,1162.16 997.592,818.506 999.9,887.094 1002.21,974.63 1004.52,1087.79 1006.82,937.633 1009.13,1042.99 1011.44,896.532 1013.75,1030 1016.06,887.138 1018.36,989.855 1020.67,1089.67 1022.98,843.128 1025.29,933.438 1027.59,807.008 1029.9,898.605 1032.21,995.426 1034.52,837.475 1036.83,1042.45 1039.13,772.765 1041.44,785.735 1043.75,972.663 1046.06,947 1048.37,1022.62 1050.67,977.222 1052.98,873.574 1055.29,846.179 1057.6,971.368 1059.91,1002.59 1062.21,869.798 1064.52,1037.81 1066.83,1006.87 1069.14,815.184 1071.45,832.659 1073.75,1034.63 1076.06,875.159 1078.37,856.573 1080.68,1076.7 1082.98,945.01 1085.29,764.77 1087.6,1028.58 1089.91,940.874 1092.22,938.03 1094.52,1039.11 1096.83,1107.59 1099.14,973.935 1101.45,984.328 1103.76,1088.46 1106.06,935.175 1108.37,727.923 1110.68,1017.21 1112.99,868.841 1115.3,939.842 1117.6,772.058 1119.91,930.687 1122.22,884.929 1124.53,1051.24 1126.84,896.455 1129.14,912.491 1131.45,920.362 1133.76,1005.05 1136.07,946.208 1138.37,1007.76 1140.68,961.171 1142.99,889.467 1145.3,941.292 1147.61,928.767 1149.91,776.582 1152.22,905.584 1154.53,927.547 1156.84,847.913 1159.15,885.543 1161.45,1059.47 1163.76,1046.91 1166.07,934.039 1168.38,961.268 1170.69,1017.46 1172.99,948.697 1175.3,891.495 1177.61,962.255 1179.92,1114.35 1182.23,1044.33 1184.53,847.216 1186.84,1005.91 1189.15,1087.4 1191.46,1027.76 1193.76,1021.29 1196.07,985.044 1198.38,903.902 1200.69,970.582 1203,1142.18 1205.3,868.041 1207.61,979.933 1209.92,945.455 1212.23,1011.71 1214.54,1033.95 1216.84,717.899 1219.15,991.587 1221.46,1116.92 1223.77,1048.21 1226.08,1000.68 1228.38,883.047 1230.69,1059.56 1233,831.822 1235.31,978.358 1237.61,883.13 1239.92,904.421 1242.23,1133.94 1244.54,1016 1246.85,721.633 1249.15,983.657 1251.46,1017.58 1253.77,1023.72 1256.08,993.598 1258.39,1056.18 1260.69,1019.36 1263,831.996 1265.31,1025.03 1267.62,790.786 1269.93,808.435 1272.23,864.943 1274.54,894.315 1276.85,887.328 1279.16,1006.99 1281.47,991.62 1283.77,1020.4 1286.08,938.748 1288.39,981.655 1290.7,870.156 1293,875.825 1295.31,1046.9 1297.62,1024.68 1299.93,892.843 1302.24,906.98 1304.54,860.467 1306.85,1043.64 1309.16,1030.59 1311.47,880.159 1313.78,1076.85 1316.08,993.302 1318.39,964.515 1320.7,986.924 1323.01,1007.19 1325.32,1016.95 1327.62,921.787 1329.93,872.509 1332.24,1009.9 1334.55,991.235 1336.86,815.956 1339.16,985.437 1341.47,864.293 1343.78,903.199 1346.09,1004.81 1348.39,929.959 1350.7,883.597 1353.01,1016.94 1355.32,1070.33 1357.63,811.311 1359.93,878.382 1362.24,1052.32 1364.55,956.306 1366.86,1109.93 1369.17,1003.1 1371.47,1036.44 1373.78,939.898 1376.09,895.47 1378.4,946.771 1380.71,981.756 1383.01,985.148 1385.32,1062.6 1387.63,1078.09 1389.94,914.554 1392.24,916.794 1394.55,850.822 1396.86,1146.55 1399.17,1064.47 1401.48,726.302 1403.78,978.382 1406.09,830.685 1408.4,1083.96 1410.71,1049.36 1413.02,868.605 1415.32,965.785 1417.63,953.956 1419.94,917.207 1422.25,839.102 1424.56,975.663 1426.86,1083.81 1429.17,933.646 1431.48,1010.28 1433.79,1055.75 1436.1,806.908 1438.4,888.697 1440.71,915.22 1443.02,1035.68 1445.33,914.255 1447.63,1003.7 1449.94,946.429 1452.25,1094.89 1454.56,992.611 1456.87,762.427 1459.17,1003.72 1461.48,1036.45 1463.79,1166.37 1466.1,854.793 1468.41,1053.45 1470.71,911.583 1473.02,903.085 1475.33,1065.84 1477.64,1047.55 1479.95,1151.99 1482.25,932.837 1484.56,819.596 1486.87,995.875 1489.18,1076.18 1491.49,1152.51 1493.79,746.886 1496.1,843.073 1498.41,1014.37 1500.72,963.746 1503.02,918.728 1505.33,989.977 1507.64,791.853 1509.95,1060.65 1512.26,906.033 1514.56,864.861 1516.87,728.579 1519.18,1081.59 1521.49,854.911 1523.8,1202.79 1526.1,1077.86 1528.41,1009.5 1530.72,1008.7 1533.03,930.045 1535.34,953.442 1537.64,988.933 1539.95,802.626 1542.26,799.315 1544.57,985.405 1546.88,971.472 1549.18,1019.79 1551.49,1077.47 1553.8,875.779 1556.11,1088.64 1558.41,1146.01 1560.72,861.568 1563.03,1122.7 1565.34,786.884 1567.65,908.874 1569.95,846.414 1572.26,843.784 1574.57,1047.07 1576.88,1030.7 1579.19,1083.13 1581.49,1092.15 1583.8,1025.06 1586.11,773.625 1588.42,897.138 1590.73,927.196 1593.03,965.765 1595.34,858.376 1597.65,1058.78 1599.96,918.522 1602.26,1120.34 1604.57,939.021 1606.88,869.039 1609.19,1021.5 1611.5,1231.37 1613.8,1074 1616.11,1169.58 1618.42,1029.22 1620.73,1034.4 1623.04,981.041 1625.34,940.474 1627.65,967.512 1629.96,965.125 1632.27,1043.97 1634.58,1148.72 1636.88,1171.92 1639.19,996.209 1641.5,992.936 1643.81,987.399 1646.12,1005.92 1648.42,1244.66 1650.73,1038.74 1653.04,1005.14 1655.35,1051.27 1657.65,981.524 1659.96,1057.94 1662.27,991.292 1664.58,982.185 1666.89,912.033 1669.19,1004.57 1671.5,1075.18 1673.81,822.836 1676.12,1094.52 1678.43,778.605 1680.73,941.962 1683.04,938.221 1685.35,880.432 1687.66,852.621 1689.97,884.666 1692.27,797.313 1694.58,888.389 1696.89,957.908 1699.2,1047.69 1701.51,835.104 1703.81,1066.62 1706.12,1029.64 1708.43,815.257 1710.74,799.686 1713.04,972.201 1715.35,996.561 1717.66,821.893 1719.97,1125.81 1722.28,888.959 1724.58,967.804 1726.89,900.476 1729.2,828.294 1731.51,941.473 1733.82,1009.77 1736.12,908.06 1738.43,810.839 1740.74,1046.16 1743.05,1137.06 1745.36,945.013 1747.66,995.21 1749.97,1053.39 1752.28,884.628 1754.59,935.605 1756.9,932.255 1759.2,989.774 1761.51,1058.63 1763.82,936.478 1766.13,906.393 1768.43,900.515 1770.74,917.054 1773.05,1028.52 1775.36,1000.68 1777.67,980.985 1779.97,856.914 1782.28,1017.72 1784.59,941.955 1786.9,950.282 1789.21,974.655 1791.51,748.721 1793.82,1083.53 1796.13,883.376 1798.44,832.618 1800.75,993.207 1803.05,980.154 1805.36,991.264 1807.67,960.589 1809.98,1056.62 1812.28,1022.23 1814.59,1013.2 1816.9,1100.98 1819.21,1030.24 1821.52,819.607 1823.82,999.029 1826.13,1057.16 1828.44,1052.83 1830.75,1308.34 1833.06,900.191 1835.36,968.233 1837.67,914.877 1839.98,1023.88 1842.29,949.556 1844.6,961.486 1846.9,980.467 1849.21,991.34 1851.52,1051.28 1853.83,918.277 1856.14,971.755 1858.44,972.85 1860.75,931.837 1863.06,1102.3 1865.37,1187.19 1867.67,1087.6 1869.98,1007.09 1872.29,956.043 1874.6,928.951 1876.91,1115.52 1879.21,953.099 1881.52,1045.89 1883.83,1109.98 1886.14,994.448 1888.45,1111.72 1890.75,937.376 1893.06,1118.48 1895.37,821.688 1897.68,977.694 1899.99,937.111 1902.29,812.655 1904.6,1040.59 1906.91,1090.59 1909.22,1048.52 1911.53,1124.16 1913.83,835.178 1916.14,1014.75 1918.45,1023.4 1920.76,1033.42 1923.06,980.134 1925.37,975.7 1927.68,1086.07 1929.99,1058 1932.3,893.865 1934.6,867.269 1936.91,919.309 1939.22,937.033 1941.53,956.496 1943.84,996.908 1946.14,970.935 1948.45,975.653 1950.76,997.762 1953.07,974.287 1955.38,841.633 1957.68,875.291 1959.99,919.957 1962.3,943.037 1964.61,1005.25 1966.91,1124.58 1969.22,1129.38 1971.53,990.713 1973.84,829.192 1976.15,1032.97 1978.45,1115.42 1980.76,809.29 1983.07,949.988 1985.38,913.786 1987.69,968.398 1989.99,1037.29 1992.3,914.562 1994.61,982.486 1996.92,800.421 1999.23,879.579 2001.53,960.358 2003.84,898.496 2006.15,1063.69 2008.46,828.911 2010.77,922.845 2013.07,1047.84 2015.38,928.042 2017.69,915.663 2020,1012.83 2022.3,943.116 2024.61,1013.6 2026.92,827.414 2029.23,943.034 2031.54,972.602 2033.84,1026.9 2036.15,957.024 2038.46,878.119 2040.77,909.321 2043.08,1003.91 2045.38,1023.19 2047.69,944.242 2050,1017.58 2052.31,825.756 2054.62,831.517 2056.92,992.593 2059.23,948.984 2061.54,1048.72 2063.85,1032.15 2066.16,1119.9 2068.46,729.187 2070.77,745.445 2073.08,807.078 2075.39,928.973 2077.69,911.004 2080,985.919 2082.31,979.655 2084.62,853.393 2086.93,975.971 2089.23,1002.1 2091.54,880.486 2093.85,872.566 2096.16,1039.06 2098.47,1153.46 2100.77,990.508 2103.08,874.805 2105.39,1084.87 2107.7,1004.87 2110.01,884.77 2112.31,895.384 2114.62,884.86 2116.93,899.263 2119.24,990.977 2121.55,829.262 2123.85,956.228 2126.16,1104.98 2128.47,986.892 2130.78,975.926 2133.08,1042.09 2135.39,882.013 2137.7,1006.2 2140.01,917.333 2142.32,1020.94 2144.62,976.655 2146.93,1031.59 2149.24,1070.32 2151.55,948.811 2153.86,1143.43 2156.16,821.078 2158.47,1151.93 2160.78,911.347 2163.09,1012.16 2165.4,962.968 2167.7,967.763 2170.01,819.746 2172.32,927.586 2174.63,873.017 2176.93,943.904 2179.24,853.687 2181.55,985.911 2183.86,1033.67 2186.17,946.717 2188.47,808.774 2190.78,1051.11 2193.09,927.474 2195.4,826.206 2197.71,983.55 2200.01,779.104 2202.32,916.803 2204.63,1138.45 2206.94,862.862 2209.25,919.812 2211.55,1024.07 2213.86,942.263 2216.17,1008.27 2218.48,1055.89 2220.79,910.145 2223.09,1098.25 2225.4,987.823 2227.71,1049.38 2230.02,860.822 2232.32,885.562 2234.63,1128.18 2236.94,986.946 2239.25,1039.55 2241.56,989.063 2243.86,906.412 2246.17,1033.67 2248.48,972.047 2250.79,1098.84 2253.1,941.301 2255.4,934.51 2257.71,1005.57 2260.02,909.57 2262.33,899.667 2264.64,946.309 2266.94,939.009 2269.25,1162.76 2271.56,932.199 2273.87,1077.72 2276.18,1237.51 2278.48,1033.82 2280.79,838.582 2283.1,970.64 2285.41,939.713 2287.71,986.637 2290.02,930.614 2292.33,873.95 2294.64,899.98 2296.95,863.2 2299.25,1022.24 2301.56,916.697 2303.87,955.341 2306.18,1304.62 2308.49,920.052 2310.79,1177.77 2313.1,1055.64 2315.41,986.739 2317.72,937.109 2320.03,966.982 2322.33,942.394 2324.64,854.405 2326.95,1074.41 2329.26,954.098 2331.56,754.389 2333.87,887.555 2336.18,810.762 2338.49,966.422 2340.8,903.138 2343.1,1035.62 2345.41,951.059 2347.72,982.683 2350.03,898.068 2352.34,1057.07 2354.64,991.873 2356.95,954.599 2359.26,1147.78 2361.57,1011.17 2363.88,944.885 2366.18,970.762 2368.49,1005.16 2370.8,985.986 2373.11,752.535 2375.42,1009.79 2377.72,1009.23 2380.03,1026.03 2382.34,954.212 2384.65,1061.75 2386.95,1063.11 2389.26,987.18 2391.57,978.382 2393.88,814.593 2396.19,867.922 2398.49,865.174 2400.8,1089.21 2403.11,1011.23 2405.42,899.939 2407.73,1143.31 2410.03,1001.86 2412.34,1062.29 2414.65,973.743 2416.96,1081.31 2419.27,1007.17 2421.57,878.121 2423.88,965.378 2426.19,1022.26 2428.5,957.562 2430.81,940.706 2433.11,825.944 2435.42,964.308 2437.73,992.082 2440.04,933.013 2442.34,996.097 2444.65,845.315 2446.96,967.054 2449.27,802.131 2451.58,902.717 2453.88,965.946 2456.19,881.391 2458.5,1043.3 2460.81,962.994 2463.12,1012.87 2465.42,1050.14 2467.73,1007.87 2470.04,940.688 2472.35,942.516 2474.66,1162.03 2476.96,677.894 2479.27,997.166 2481.58,1014.78 2483.89,893.401 2486.2,1052.51 2488.5,767.403 2490.81,1250.9 2493.12,984.632 2495.43,992.91 2497.73,820.625 2500.04,862.536 2502.35,723.77 2504.66,898.741 2506.97,1006.89 2509.27,990.706 2511.58,697.766 2513.89,1023.56 2516.2,863.356 2518.51,970.393 2520.81,936.582 2523.12,1105.75 2525.43,1006.95 2527.74,973.305 2530.05,1163.4 2532.35,989.738 2534.66,1031.37 2536.97,1007.52 2539.28,886.204 2541.58,947.956 2543.89,932.818 2546.2,921.07 2548.51,1141.06 2550.82,950.383 2553.12,980.465 2555.43,932.659 2557.74,952.824 2560.05,979.87 2562.36,862.419 2564.66,1068.45 2566.97,989.76 2569.28,914.06 2571.59,979.447 "></polyline>
<polyline clip-path="url(#clip712)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,542.187 268.292,485.117 270.6,502.603 272.908,565.159 275.216,521.454 277.524,393.04 279.832,518.199 282.139,393.147 284.447,430.592 286.755,477.516 289.063,439.471 291.371,550.423 293.679,515.34 295.987,418.227 298.295,501.973 300.603,519.79 302.911,372.092 305.219,448.378 307.527,438.643 309.834,507.942 312.142,480.342 314.45,530.53 316.758,494.037 319.066,289.273 321.374,239.23 323.682,375.046 325.99,631.794 328.298,475.25 330.606,387.98 332.914,627.699 335.221,422.113 337.529,550.245 339.837,518.956 342.145,699.045 344.453,415.014 346.761,525.941 349.069,633.555 351.377,377.678 353.685,398.666 355.993,397.945 358.301,529.103 360.608,308.842 362.916,341.612 365.224,513.62 367.532,676.21 369.84,598.275 372.148,546.156 374.456,644.225 376.764,404.355 379.072,595.735 381.38,428.354 383.688,270.013 385.996,256.644 388.303,459.165 390.611,457.36 392.919,353.398 395.227,407.524 397.535,620.934 399.843,399.38 402.151,514.737 404.459,728.452 406.767,445.787 409.075,432.131 411.383,434.161 413.69,480.004 415.998,552.858 418.306,419.317 420.614,482.006 422.922,319.896 425.23,519.023 427.538,478.271 429.846,376.789 432.154,526.251 434.462,539.86 436.77,517.25 439.077,439.679 441.385,315.812 443.693,503.898 446.001,667.789 448.309,533.296 450.617,550.392 452.925,532.754 455.233,496.14 457.541,712.079 459.849,683.752 462.157,450.966 464.465,638.702 466.772,439.424 469.08,613.444 471.388,363.561 473.696,609.341 476.004,354.479 478.312,569.558 480.62,450.269 482.928,581.393 485.236,463.346 487.544,540.881 489.852,500.78 492.159,522.944 494.467,396.016 496.775,518.67 499.083,417.779 501.391,376.058 503.699,384.344 506.007,422.2 508.315,459.956 510.623,358.722 512.931,504.231 515.239,425.038 517.546,507.614 519.854,632.847 522.162,582.172 524.47,572.474 526.778,309.277 529.086,297.933 531.394,492.581 533.702,396.275 536.01,321.793 538.318,390.509 540.626,366.182 542.933,425.856 545.241,670.102 547.549,409.845 549.857,632.089 552.165,510.031 554.473,552.629 556.781,464.906 559.089,346.713 561.397,419.88 563.705,700.844 566.013,571.207 568.321,466.786 570.628,505.63 572.936,328.521 575.244,420.292 577.552,534.661 579.86,358.904 582.168,478.37 584.476,518.534 586.784,569.609 589.092,604.517 591.4,526.332 593.708,581.447 596.015,510.87 598.323,385.191 600.631,530.556 602.939,612.766 605.247,599.109 607.555,451.407 609.863,218.53 612.171,361.609 614.479,502.073 616.787,535.401 619.095,460.476 621.402,442.203 623.71,591.659 626.018,505.1 628.326,546.84 630.634,611.361 632.942,293.436 635.25,438.134 637.558,497.093 639.866,395.583 642.174,664.163 644.482,320.405 646.79,654.163 649.097,613.466 651.405,483.667 653.713,734.556 656.021,404.541 658.329,419.955 660.637,288.725 662.945,503.749 665.253,553.556 667.561,375.81 669.869,346.204 672.177,347.136 674.484,233.949 676.792,575.155 679.1,438.97 681.408,502.319 683.716,458.251 686.024,514.873 688.332,675.446 690.64,493.499 692.948,555.628 695.256,512.048 697.564,628.972 699.871,502.781 702.179,462.598 704.487,393.155 706.795,591.874 709.103,522.344 711.411,452.245 713.719,474.519 716.027,410.92 718.335,601.54 720.643,344.511 722.951,438.266 725.259,574.068 727.566,712.315 729.874,585.476 732.182,472.983 734.49,567.762 736.798,640.663 739.106,587.165 741.414,454.712 743.722,491.791 746.03,491.82 748.338,308.68 750.646,559.316 752.953,573.563 755.261,455.707 757.569,592.945 759.877,391.383 762.185,459.187 764.493,440.684 766.801,96.8724 769.109,607.913 771.417,487.74 773.725,190.529 776.033,487.954 778.34,551.806 780.648,541.902 782.956,285.088 785.264,439.387 787.572,418.95 789.88,550.397 792.188,366.466 794.496,438.943 796.804,506.18 799.112,503.031 801.42,386.294 803.728,476.187 806.035,333.032 808.343,378.444 810.651,348.12 812.959,556.348 815.267,383.298 817.575,372.464 819.883,435.487 822.191,650.282 824.499,465.884 826.807,482.615 829.115,584.332 831.422,555.516 833.73,734.188 836.038,547.813 838.346,275.602 840.654,442.18 842.962,500.878 845.27,432.648 847.578,484.681 849.886,328.335 852.194,474.266 854.502,590.235 856.809,356.77 859.117,552.316 861.425,489.327 863.733,396.841 866.041,313.076 868.349,444.478 870.657,421.999 872.965,458.444 875.273,691.557 877.581,487.142 879.889,495.703 882.197,623.245 884.504,384.77 886.812,275.238 889.12,514.416 891.428,660.144 893.736,460.14 896.044,522.606 898.352,417.372 900.66,418.156 902.968,535.033 905.276,610.314 907.584,460.551 909.891,428.029 912.199,584.746 914.507,567.05 916.815,651.969 919.123,500.937 921.431,582.367 923.739,621.328 926.047,403.16 928.355,448.172 930.663,450.505 932.971,429.456 935.278,450.284 937.586,514.697 939.894,510.129 942.202,750.398 944.51,557.642 946.818,302.774 949.126,268.564 951.434,520.311 953.742,300.45 956.05,541.247 958.358,521.483 960.665,502.129 962.973,356.999 965.281,269.375 967.589,423.506 969.897,546.757 972.205,603.031 974.513,362.098 976.821,539.346 979.129,363.889 981.437,367.761 983.745,504.451 986.053,435.026 988.36,427.037 990.668,224.158 992.976,501.596 995.284,452.914 997.592,323.499 999.9,521.574 1002.21,382.691 1004.52,224.737 1006.82,550.484 1009.13,496.184 1011.44,516.101 1013.75,221.314 1016.06,426.857 1018.36,496.771 1020.67,353.744 1022.98,502.275 1025.29,419.514 1027.59,386.306 1029.9,500.835 1032.21,451.548 1034.52,593.024 1036.83,419.637 1039.13,386.592 1041.44,454.013 1043.75,383.385 1046.06,436.755 1048.37,347.326 1050.67,558.406 1052.98,454.33 1055.29,548.521 1057.6,475.954 1059.91,465.994 1062.21,606.993 1064.52,323.511 1066.83,394.93 1069.14,423.928 1071.45,532.482 1073.75,630.2 1076.06,572.539 1078.37,468.339 1080.68,436.136 1082.98,461.337 1085.29,246.013 1087.6,483.927 1089.91,610.041 1092.22,540.404 1094.52,460.712 1096.83,499.701 1099.14,767.291 1101.45,428.748 1103.76,594.242 1106.06,621.079 1108.37,430.461 1110.68,507.818 1112.99,534.878 1115.3,491.542 1117.6,301.575 1119.91,441.907 1122.22,644.804 1124.53,268.781 1126.84,507.123 1129.14,535.875 1131.45,529.745 1133.76,532.713 1136.07,443.234 1138.37,447.38 1140.68,347.222 1142.99,482.652 1145.3,470.23 1147.61,641.141 1149.91,580.83 1152.22,455.836 1154.53,601.693 1156.84,493.651 1159.15,481.434 1161.45,490.837 1163.76,552.432 1166.07,367.157 1168.38,255.769 1170.69,679.114 1172.99,370.719 1175.3,498.784 1177.61,545.432 1179.92,508.455 1182.23,462.698 1184.53,457.289 1186.84,449.73 1189.15,527.311 1191.46,523.905 1193.76,338.572 1196.07,410.133 1198.38,409.061 1200.69,553.713 1203,438.903 1205.3,436.76 1207.61,369.451 1209.92,458.55 1212.23,643.325 1214.54,452.818 1216.84,395.978 1219.15,579.988 1221.46,497.618 1223.77,583.649 1226.08,468.991 1228.38,448.639 1230.69,639 1233,333.14 1235.31,561.475 1237.61,562.827 1239.92,462.787 1242.23,383.036 1244.54,516.402 1246.85,361.245 1249.15,524.893 1251.46,298.046 1253.77,370.156 1256.08,419.165 1258.39,409.047 1260.69,437.071 1263,540.117 1265.31,420.712 1267.62,584.331 1269.93,410.526 1272.23,449.258 1274.54,598.854 1276.85,321.641 1279.16,363.483 1281.47,379.451 1283.77,462.314 1286.08,346.213 1288.39,680.821 1290.7,375.17 1293,550.599 1295.31,569.856 1297.62,528.606 1299.93,273.69 1302.24,545.351 1304.54,558.058 1306.85,495.253 1309.16,549.837 1311.47,269.459 1313.78,403.233 1316.08,581.367 1318.39,629.783 1320.7,483.195 1323.01,465.932 1325.32,541.222 1327.62,427.314 1329.93,538.284 1332.24,525.662 1334.55,567.265 1336.86,568.751 1339.16,182.958 1341.47,416.191 1343.78,452.734 1346.09,619.739 1348.39,568.298 1350.7,475.373 1353.01,405.208 1355.32,330.385 1357.63,488.156 1359.93,516.581 1362.24,527.952 1364.55,579.762 1366.86,568.027 1369.17,414.616 1371.47,458.894 1373.78,566.022 1376.09,589.369 1378.4,465.865 1380.71,274.66 1383.01,485.117 1385.32,454.408 1387.63,370.977 1389.94,558.614 1392.24,433.323 1394.55,441.659 1396.86,402.946 1399.17,436.738 1401.48,459.859 1403.78,449.361 1406.09,604.378 1408.4,475.054 1410.71,387.604 1413.02,555.279 1415.32,497.838 1417.63,473.522 1419.94,472.476 1422.25,563.933 1424.56,414.739 1426.86,501.085 1429.17,446.911 1431.48,476.009 1433.79,454.75 1436.1,487.733 1438.4,572.01 1440.71,462.477 1443.02,416.728 1445.33,410.751 1447.63,764.596 1449.94,439.87 1452.25,216.15 1454.56,410.547 1456.87,516.496 1459.17,463.48 1461.48,469.787 1463.79,434.343 1466.1,470.105 1468.41,367.684 1470.71,459.122 1473.02,413.684 1475.33,295.178 1477.64,482.234 1479.95,529.044 1482.25,300.02 1484.56,419.394 1486.87,519.996 1489.18,457.712 1491.49,547.954 1493.79,373.6 1496.1,461.163 1498.41,403.568 1500.72,674.606 1503.02,416.028 1505.33,321.956 1507.64,605.798 1509.95,586.127 1512.26,525.196 1514.56,576.047 1516.87,417.502 1519.18,487.364 1521.49,537.884 1523.8,436.012 1526.1,391.334 1528.41,368.211 1530.72,385.101 1533.03,398.925 1535.34,539.618 1537.64,599.41 1539.95,525.245 1542.26,399.564 1544.57,635.011 1546.88,461.355 1549.18,514.133 1551.49,442.991 1553.8,396.513 1556.11,530.949 1558.41,548.354 1560.72,426.231 1563.03,537.59 1565.34,376.376 1567.65,439.347 1569.95,480.88 1572.26,235.508 1574.57,560.912 1576.88,462.647 1579.19,567.531 1581.49,549.652 1583.8,400.115 1586.11,475.698 1588.42,518.691 1590.73,536.87 1593.03,392.114 1595.34,415.29 1597.65,339.34 1599.96,461.156 1602.26,494.445 1604.57,589.978 1606.88,393.045 1609.19,491.218 1611.5,436.429 1613.8,573.664 1616.11,397.032 1618.42,568.138 1620.73,625.252 1623.04,403.873 1625.34,399.942 1627.65,421.359 1629.96,435.505 1632.27,281.469 1634.58,540.287 1636.88,611.204 1639.19,499.272 1641.5,656.875 1643.81,562.297 1646.12,390.482 1648.42,475.11 1650.73,454.761 1653.04,491.805 1655.35,512.267 1657.65,338.869 1659.96,393.294 1662.27,308.582 1664.58,628.933 1666.89,266.335 1669.19,532.092 1671.5,399.899 1673.81,583.388 1676.12,261.269 1678.43,457.044 1680.73,578.385 1683.04,499.411 1685.35,374.539 1687.66,386.736 1689.97,516.549 1692.27,452.31 1694.58,457.808 1696.89,437.464 1699.2,579.116 1701.51,415.203 1703.81,624.731 1706.12,574.194 1708.43,473.507 1710.74,433.308 1713.04,579.231 1715.35,449.605 1717.66,669.218 1719.97,386.274 1722.28,521.999 1724.58,329.816 1726.89,486.924 1729.2,381.714 1731.51,746.617 1733.82,501.439 1736.12,593.299 1738.43,501.671 1740.74,529.667 1743.05,378.746 1745.36,545.113 1747.66,467.105 1749.97,371.428 1752.28,486.36 1754.59,594.262 1756.9,722.208 1759.2,542.311 1761.51,432.613 1763.82,601.06 1766.13,453.462 1768.43,443.685 1770.74,504.333 1773.05,499.102 1775.36,365.235 1777.67,657.931 1779.97,400.773 1782.28,419.406 1784.59,186.697 1786.9,529.088 1789.21,420.841 1791.51,484.142 1793.82,310.516 1796.13,604.233 1798.44,802.52 1800.75,355.158 1803.05,448.605 1805.36,609.076 1807.67,405.442 1809.98,362.918 1812.28,606.759 1814.59,434.177 1816.9,386.868 1819.21,476.945 1821.52,554.544 1823.82,440.589 1826.13,283.612 1828.44,593.138 1830.75,513.011 1833.06,423.865 1835.36,421.944 1837.67,409.374 1839.98,516.722 1842.29,236.002 1844.6,362.185 1846.9,439.988 1849.21,547.037 1851.52,395.103 1853.83,558.198 1856.14,477.049 1858.44,690.757 1860.75,469.846 1863.06,477.325 1865.37,463.178 1867.67,602.742 1869.98,289.687 1872.29,453.861 1874.6,595.305 1876.91,457.461 1879.21,482.013 1881.52,414.673 1883.83,320.432 1886.14,438.206 1888.45,362.568 1890.75,319.645 1893.06,620.688 1895.37,497.147 1897.68,463.94 1899.99,392.026 1902.29,582.262 1904.6,434.224 1906.91,589.758 1909.22,349.995 1911.53,600.532 1913.83,482.147 1916.14,463.948 1918.45,256.448 1920.76,497.588 1923.06,461.965 1925.37,426.121 1927.68,438.251 1929.99,441.304 1932.3,561.205 1934.6,528.052 1936.91,502.482 1939.22,465.522 1941.53,384.695 1943.84,208.87 1946.14,553.738 1948.45,746.255 1950.76,533.264 1953.07,490.407 1955.38,538.707 1957.68,457.81 1959.99,415.095 1962.3,606.876 1964.61,615.5 1966.91,528.006 1969.22,394.474 1971.53,495.227 1973.84,389.963 1976.15,571.39 1978.45,384.417 1980.76,522.755 1983.07,455.262 1985.38,515.32 1987.69,386.251 1989.99,548.374 1992.3,483.305 1994.61,755.218 1996.92,386.85 1999.23,558.126 2001.53,510.082 2003.84,693.719 2006.15,389.244 2008.46,548.512 2010.77,538.381 2013.07,356.403 2015.38,491.219 2017.69,371.867 2020,365.994 2022.3,548.134 2024.61,496.34 2026.92,539.006 2029.23,466.109 2031.54,600.375 2033.84,483.453 2036.15,451.162 2038.46,466.294 2040.77,330.029 2043.08,316.063 2045.38,468.841 2047.69,342.643 2050,547.811 2052.31,638.334 2054.62,531.248 2056.92,459.274 2059.23,647.713 2061.54,515.736 2063.85,658.928 2066.16,684.474 2068.46,611.918 2070.77,509.381 2073.08,664.081 2075.39,348.747 2077.69,562.402 2080,558.265 2082.31,367.339 2084.62,387.297 2086.93,655.488 2089.23,441.085 2091.54,451.671 2093.85,585.03 2096.16,504.368 2098.47,518.041 2100.77,328.12 2103.08,505.198 2105.39,366.566 2107.7,481.804 2110.01,599.063 2112.31,524.637 2114.62,308.779 2116.93,437.267 2119.24,309.431 2121.55,357.606 2123.85,469.787 2126.16,405.869 2128.47,483.064 2130.78,373.016 2133.08,517.801 2135.39,579.041 2137.7,424.146 2140.01,507.508 2142.32,644.722 2144.62,538.463 2146.93,557.224 2149.24,518.676 2151.55,161.1 2153.86,818.976 2156.16,278.606 2158.47,474.627 2160.78,504.301 2163.09,501.996 2165.4,460.402 2167.7,289.282 2170.01,479.818 2172.32,520.831 2174.63,312.903 2176.93,380.601 2179.24,480.101 2181.55,410.644 2183.86,699.436 2186.17,575.997 2188.47,360.696 2190.78,483.409 2193.09,463.059 2195.4,441.024 2197.71,385.881 2200.01,419.735 2202.32,468.701 2204.63,449.235 2206.94,577.088 2209.25,561.58 2211.55,480.674 2213.86,558.649 2216.17,461.98 2218.48,500.326 2220.79,513.352 2223.09,434.532 2225.4,403.329 2227.71,557.509 2230.02,376.308 2232.32,421.095 2234.63,394.813 2236.94,432.014 2239.25,469.361 2241.56,486.645 2243.86,529.778 2246.17,510.289 2248.48,425.006 2250.79,547.463 2253.1,731.661 2255.4,502.765 2257.71,469.908 2260.02,435.95 2262.33,597.576 2264.64,490.656 2266.94,776.802 2269.25,378.199 2271.56,638.174 2273.87,637.91 2276.18,284.38 2278.48,480.634 2280.79,476.912 2283.1,448.998 2285.41,439.708 2287.71,537.221 2290.02,584.388 2292.33,354.155 2294.64,521.02 2296.95,390.607 2299.25,439.475 2301.56,406.249 2303.87,420.2 2306.18,507.995 2308.49,469.519 2310.79,442.889 2313.1,551.949 2315.41,463.105 2317.72,515.323 2320.03,468.203 2322.33,373.45 2324.64,509.43 2326.95,457.826 2329.26,587.928 2331.56,586.94 2333.87,392.564 2336.18,496.589 2338.49,491.552 2340.8,481.827 2343.1,482.595 2345.41,294.028 2347.72,437.586 2350.03,403.477 2352.34,525.815 2354.64,485.951 2356.95,295.224 2359.26,388.139 2361.57,494.75 2363.88,531.871 2366.18,544.39 2368.49,383.572 2370.8,460.825 2373.11,518.469 2375.42,468.573 2377.72,654.145 2380.03,521.796 2382.34,532.139 2384.65,465.548 2386.95,445.212 2389.26,514.651 2391.57,500.426 2393.88,185.209 2396.19,518.601 2398.49,426.959 2400.8,507.099 2403.11,436.044 2405.42,600.11 2407.73,348.812 2410.03,388.125 2412.34,663.62 2414.65,416.3 2416.96,380.204 2419.27,391.165 2421.57,664.018 2423.88,523.599 2426.19,337.45 2428.5,340.009 2430.81,468.504 2433.11,509.893 2435.42,478.976 2437.73,576.821 2440.04,574.88 2442.34,329.791 2444.65,560.631 2446.96,473.789 2449.27,539.222 2451.58,545.916 2453.88,498.284 2456.19,446.116 2458.5,291.063 2460.81,474.876 2463.12,479.742 2465.42,502.534 2467.73,373.456 2470.04,406.603 2472.35,609.721 2474.66,503.35 2476.96,535.246 2479.27,442.623 2481.58,462.936 2483.89,377.59 2486.2,482.09 2488.5,565.284 2490.81,524.037 2493.12,548.291 2495.43,478.345 2497.73,284.437 2500.04,508.092 2502.35,481.425 2504.66,545.231 2506.97,569.49 2509.27,685.203 2511.58,476.716 2513.89,541.645 2516.2,528.294 2518.51,453.381 2520.81,540.294 2523.12,446.144 2525.43,613.437 2527.74,478.217 2530.05,367.387 2532.35,610.863 2534.66,392.364 2536.97,489.735 2539.28,454.644 2541.58,322.05 2543.89,311.84 2546.2,551.113 2548.51,426.841 2550.82,415.352 2553.12,612.072 2555.43,702.561 2557.74,505.786 2560.05,523.981 2562.36,360.475 2564.66,584.109 2566.97,499.335 2569.28,598.786 2571.59,510.249 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(stack, samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:310</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.3554    -4.13952   -3.69937   -3.885     …  -6.11179  -6.87134  -6.56794
 -0.237483  -0.567746  -0.259164  -0.952548     -1.17767  -1.60275  -1.42489
  3.85511    3.13846    5.52051    4.27778       7.09683   6.18312   6.90686

[:, :, 2] =
 -1.84515  -4.30697   -4.30697   …  -4.72973  -4.10464    -3.83365
  1.16272  -0.481054  -0.481054     -1.49699  -0.0237611   0.608014
  3.12464   6.36443    6.36443       7.74047   4.95585     5.46392

[:, :, 3] =
 -2.93528  -4.70898  -3.31723     …  -5.76171   -4.76079  -5.0383
  1.5391    1.03648  -0.00298777      0.243723  -1.05752  -0.023874
  1.86972   1.61874   5.46612         5.58737    5.17928   5.46463

[:, :, 4] =
 -4.0211    -4.61433   -5.19777  -4.21492   …  -5.03802   -5.6671   -7.03791
 -0.626739   0.851975   1.05739  -0.254426      0.524564   1.83107  -0.456883
  3.91157    5.19494    6.49408   5.47223       5.22605    4.83747   4.29253</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00395     1.05196
  0.00277811  1.05201
  4.97371     1.03136</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>.</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.48 seconds
Compute duration  = 2.48 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9691    1.0504    0.0175   3622.3249   5606.4600    0.9999   ⋯
        x[2]   -0.0102    1.0393    0.0177   3451.7429   5657.5753    1.0005   ⋯
        x[3]    4.9822    1.0520    0.0174   3639.7509   6040.1738    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9923   -5.6921   -4.9736   -4.2524   -2.9219
        x[2]   -2.0608   -0.7008    0.0042    0.6724    2.0274
        x[3]    2.9385    4.2758    4.9812    5.6806    7.0779
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.62 seconds
Compute duration  = 1.62 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4983    0.1934    0.0027   4976.6417   5493.5304    1.0007   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1426    0.3516    0.4987    0.6457    0.8560
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.6656    0.2026    0.0403    22.1529        NaN    1.2843     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2239    0.5217    0.7986    0.8174    0.8174
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.53 seconds
Compute duration  = 2.53 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.1746    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -1.4866    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1746    0.1746    0.1746    0.1746    0.1746
           x   -1.4866   -1.4866   -1.4866   -1.4866   -1.4866
</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.53 seconds
Compute duration  = 0.53 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.9381    0.7514    0.0828   114.3716    29.7289    1.0150     ⋯
           x   -0.1588    1.2667    0.1670   101.6380    31.7296    1.0063     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1060    0.3501    0.7449    1.2953    2.9036
           x   -3.7285   -0.4646    0.0043    0.3400    2.1631
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ReverseDiff.jl</a>:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.82 seconds
Compute duration  = 2.82 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8650    0.6219    0.0448   115.8495    33.7279    1.0303     ⋯
           x    0.0839    1.0439    0.0694   318.4663   170.6979    1.0142     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1108    0.3441    0.7326    1.2648    2.4387
           x   -2.1510   -0.3304   -0.0003    0.4635    2.7877
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li><ol type="1">
<li>and (2) makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol></li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-16-using-turing-external-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>